{"version":3,"file":"./index.js","mappings":"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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./scripts/config.js","webpack:///./scripts/sortable.js","webpack:///./scripts/attributesConfig.js","webpack:///./scripts/systems.js","webpack:///./scripts/settings.js","webpack:///./scripts/lib/utils.js","webpack:///./scripts/app/AddEvent.js","webpack:///./scripts/app/CombatDock.js","webpack:///./scripts/app/CombatantPortrait.js","webpack:///./scripts/lib/welcome.js","webpack:///./scripts/main.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { MODULE_ID } from \"./main.js\";\n\nexport function initConfig() {\n\n    Hooks.on(\"renderCombatTrackerConfig\", (app, html, data) => {\n        if (!game.user.isGM) return;\n        const attributes = TokenDocument.implementation.getTrackedAttributes();\n        attributes.bar.forEach(a => a.push(\"value\"));\n        const attributeChoices = TokenDocument.implementation.getTrackedAttributeChoices(attributes)\n        attributeChoices.unshift({label: \"None\", value: \"\"})\n        const attributeBarChoices = TokenDocument.implementation.getTrackedAttributeChoices({bar: attributes.bar, value: []})\n        attributeBarChoices.unshift({label: \"None\", value: \"\"})\n        const compiled = Handlebars.compile(`<select name=\"flags.${MODULE_ID}.resource\">{{selectOptions options selected=value}}</select>`)\n        const compiled2 = Handlebars.compile(`<select name=\"flags.${MODULE_ID}.portraitResource\">{{selectOptions options selected=value}}</select>`)\n        const selectResourceHtml = compiled({options: attributeChoices, value: game.settings.get(MODULE_ID, \"resource\")})\n        const portraitResource = game.settings.get(MODULE_ID, \"portraitResource\");\n        const selectPortraitResourceHtml = compiled2({options: attributeBarChoices, value: portraitResource})\n\n        const fg = document.createElement(\"div\");\n        fg.classList.add(\"form-group\");\n        fg.innerHTML = `\n        <label>${game.i18n.localize('COMBAT.CONFIG.FIELDS.core.combatTrackerConfig.resource.label')} 2</label>\n        ${selectResourceHtml}\n        <p class=\"hint\">${game.i18n.localize('COMBAT.CONFIG.FIELDS.core.combatTrackerConfig.resource.hint')}</p>\n        `;\n\n        html.querySelector(`select[name=\"core.combatTrackerConfig.resource\"]`).closest(\".form-group\").appendChild(fg);\n\n        const portraitFg = document.createElement(\"div\");\n        portraitFg.classList.add(\"form-group\");\n        portraitFg.innerHTML = `\n        <label>${game.i18n.localize(`${MODULE_ID}.combatConfig.portraitResource.label`)}</label>\n        ${selectPortraitResourceHtml}\n        <p class=\"hint\">${game.i18n.localize(`${MODULE_ID}.combatConfig.portraitResource.hint`)}</p>\n        `;\n\n        html.querySelector(`select[name=\"flags.${MODULE_ID}.resource\"]`).closest(\".form-group\").appendChild(portraitFg);\n\n        const button = document.createElement(\"button\");\n        button.innerHTML = `<i class=\"fa-solid fa-gears\"></i> ` + game.i18n.localize(`${MODULE_ID}.configureCarousel`);\n\n        button.addEventListener(\"click\", (e) => {\n            e.preventDefault();\n            new foundry.applications.settings.SettingsConfig().render(true)\n            Hooks.once(\"renderSettingsConfig\", (app, html, data) => {\n                html.querySelector('button[data-tab=\"combat-tracker-dock\"]').click();\n            });\n        });\n\n        //find last form group\n        const lastFormGroup = html.querySelectorAll(\".form-group\")[html.querySelectorAll(\".form-group\").length - 1];\n        lastFormGroup.appendChild(button);\n\n        html.querySelector(`select[name=\"flags.${MODULE_ID}.resource\"]`).addEventListener(\"change\", async (event) => {\n            await game.settings.set(MODULE_ID, \"resource\", event.target.value);\n        });\n\n        html.querySelector(`select[name=\"flags.${MODULE_ID}.portraitResource\"]`).addEventListener(\"change\", async (event) => {\n            await game.settings.set(MODULE_ID, \"portraitResource\", event.target.value);\n        });\n\n        app.setPosition({height: \"auto\"});\n    });\n\n}","/**!\r\n * Sortable 1.15.0\r\n * @author\tRubaXa   <trash@rubaxa.org>\r\n * @author\towenm    <owen23355@gmail.com>\r\n * @license MIT\r\n */\r\nfunction ownKeys(object, enumerableOnly) {\r\n    var keys = Object.keys(object);\r\n  \r\n    if (Object.getOwnPropertySymbols) {\r\n      var symbols = Object.getOwnPropertySymbols(object);\r\n  \r\n      if (enumerableOnly) {\r\n        symbols = symbols.filter(function (sym) {\r\n          return Object.getOwnPropertyDescriptor(object, sym).enumerable;\r\n        });\r\n      }\r\n  \r\n      keys.push.apply(keys, symbols);\r\n    }\r\n  \r\n    return keys;\r\n  }\r\n  \r\n  function _objectSpread2(target) {\r\n    for (var i = 1; i < arguments.length; i++) {\r\n      var source = arguments[i] != null ? arguments[i] : {};\r\n  \r\n      if (i % 2) {\r\n        ownKeys(Object(source), true).forEach(function (key) {\r\n          _defineProperty(target, key, source[key]);\r\n        });\r\n      } else if (Object.getOwnPropertyDescriptors) {\r\n        Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\r\n      } else {\r\n        ownKeys(Object(source)).forEach(function (key) {\r\n          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\r\n        });\r\n      }\r\n    }\r\n  \r\n    return target;\r\n  }\r\n  \r\n  function _typeof(obj) {\r\n    \"@babel/helpers - typeof\";\r\n  \r\n    if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\r\n      _typeof = function (obj) {\r\n        return typeof obj;\r\n      };\r\n    } else {\r\n      _typeof = function (obj) {\r\n        return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\r\n      };\r\n    }\r\n  \r\n    return _typeof(obj);\r\n  }\r\n  \r\n  function _defineProperty(obj, key, value) {\r\n    if (key in obj) {\r\n      Object.defineProperty(obj, key, {\r\n        value: value,\r\n        enumerable: true,\r\n        configurable: true,\r\n        writable: true\r\n      });\r\n    } else {\r\n      obj[key] = value;\r\n    }\r\n  \r\n    return obj;\r\n  }\r\n  \r\n  function _extends() {\r\n    _extends = Object.assign || function (target) {\r\n      for (var i = 1; i < arguments.length; i++) {\r\n        var source = arguments[i];\r\n  \r\n        for (var key in source) {\r\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\r\n            target[key] = source[key];\r\n          }\r\n        }\r\n      }\r\n  \r\n      return target;\r\n    };\r\n  \r\n    return _extends.apply(this, arguments);\r\n  }\r\n  \r\n  function _objectWithoutPropertiesLoose(source, excluded) {\r\n    if (source == null) return {};\r\n    var target = {};\r\n    var sourceKeys = Object.keys(source);\r\n    var key, i;\r\n  \r\n    for (i = 0; i < sourceKeys.length; i++) {\r\n      key = sourceKeys[i];\r\n      if (excluded.indexOf(key) >= 0) continue;\r\n      target[key] = source[key];\r\n    }\r\n  \r\n    return target;\r\n  }\r\n  \r\n  function _objectWithoutProperties(source, excluded) {\r\n    if (source == null) return {};\r\n  \r\n    var target = _objectWithoutPropertiesLoose(source, excluded);\r\n  \r\n    var key, i;\r\n  \r\n    if (Object.getOwnPropertySymbols) {\r\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\r\n  \r\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\r\n        key = sourceSymbolKeys[i];\r\n        if (excluded.indexOf(key) >= 0) continue;\r\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\r\n        target[key] = source[key];\r\n      }\r\n    }\r\n  \r\n    return target;\r\n  }\r\n  \r\n  function _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\r\n  }\r\n  \r\n  function _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) return _arrayLikeToArray(arr);\r\n  }\r\n  \r\n  function _iterableToArray(iter) {\r\n    if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\r\n  }\r\n  \r\n  function _unsupportedIterableToArray(o, minLen) {\r\n    if (!o) return;\r\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\r\n    var n = Object.prototype.toString.call(o).slice(8, -1);\r\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\r\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\r\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\r\n  }\r\n  \r\n  function _arrayLikeToArray(arr, len) {\r\n    if (len == null || len > arr.length) len = arr.length;\r\n  \r\n    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\r\n  \r\n    return arr2;\r\n  }\r\n  \r\n  function _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\r\n  }\r\n  \r\n  var version = \"1.15.0\";\r\n  \r\n  function userAgent(pattern) {\r\n    if (typeof window !== 'undefined' && window.navigator) {\r\n      return !! /*@__PURE__*/navigator.userAgent.match(pattern);\r\n    }\r\n  }\r\n  \r\n  var IE11OrLess = userAgent(/(?:Trident.*rv[ :]?11\\.|msie|iemobile|Windows Phone)/i);\r\n  var Edge = userAgent(/Edge/i);\r\n  var FireFox = userAgent(/firefox/i);\r\n  var Safari = userAgent(/safari/i) && !userAgent(/chrome/i) && !userAgent(/android/i);\r\n  var IOS = userAgent(/iP(ad|od|hone)/i);\r\n  var ChromeForAndroid = userAgent(/chrome/i) && userAgent(/android/i);\r\n  \r\n  var captureMode = {\r\n    capture: false,\r\n    passive: false\r\n  };\r\n  \r\n  function on(el, event, fn) {\r\n    el.addEventListener(event, fn, !IE11OrLess && captureMode);\r\n  }\r\n  \r\n  function off(el, event, fn) {\r\n    el.removeEventListener(event, fn, !IE11OrLess && captureMode);\r\n  }\r\n  \r\n  function matches(\r\n  /**HTMLElement*/\r\n  el,\r\n  /**String*/\r\n  selector) {\r\n    if (!selector) return;\r\n    selector[0] === '>' && (selector = selector.substring(1));\r\n  \r\n    if (el) {\r\n      try {\r\n        if (el.matches) {\r\n          return el.matches(selector);\r\n        } else if (el.msMatchesSelector) {\r\n          return el.msMatchesSelector(selector);\r\n        } else if (el.webkitMatchesSelector) {\r\n          return el.webkitMatchesSelector(selector);\r\n        }\r\n      } catch (_) {\r\n        return false;\r\n      }\r\n    }\r\n  \r\n    return false;\r\n  }\r\n  \r\n  function getParentOrHost(el) {\r\n    return el.host && el !== document && el.host.nodeType ? el.host : el.parentNode;\r\n  }\r\n  \r\n  function closest(\r\n  /**HTMLElement*/\r\n  el,\r\n  /**String*/\r\n  selector,\r\n  /**HTMLElement*/\r\n  ctx, includeCTX) {\r\n    if (el) {\r\n      ctx = ctx || document;\r\n  \r\n      do {\r\n        if (selector != null && (selector[0] === '>' ? el.parentNode === ctx && matches(el, selector) : matches(el, selector)) || includeCTX && el === ctx) {\r\n          return el;\r\n        }\r\n  \r\n        if (el === ctx) break;\r\n        /* jshint boss:true */\r\n      } while (el = getParentOrHost(el));\r\n    }\r\n  \r\n    return null;\r\n  }\r\n  \r\n  var R_SPACE = /\\s+/g;\r\n  \r\n  function toggleClass(el, name, state) {\r\n    if (el && name) {\r\n      if (el.classList) {\r\n        el.classList[state ? 'add' : 'remove'](name);\r\n      } else {\r\n        var className = (' ' + el.className + ' ').replace(R_SPACE, ' ').replace(' ' + name + ' ', ' ');\r\n        el.className = (className + (state ? ' ' + name : '')).replace(R_SPACE, ' ');\r\n      }\r\n    }\r\n  }\r\n  \r\n  function css(el, prop, val) {\r\n    var style = el && el.style;\r\n  \r\n    if (style) {\r\n      if (val === void 0) {\r\n        if (document.defaultView && document.defaultView.getComputedStyle) {\r\n          val = document.defaultView.getComputedStyle(el, '');\r\n        } else if (el.currentStyle) {\r\n          val = el.currentStyle;\r\n        }\r\n  \r\n        return prop === void 0 ? val : val[prop];\r\n      } else {\r\n        if (!(prop in style) && prop.indexOf('webkit') === -1) {\r\n          prop = '-webkit-' + prop;\r\n        }\r\n  \r\n        style[prop] = val + (typeof val === 'string' ? '' : 'px');\r\n      }\r\n    }\r\n  }\r\n  \r\n  function matrix(el, selfOnly) {\r\n    var appliedTransforms = '';\r\n  \r\n    if (typeof el === 'string') {\r\n      appliedTransforms = el;\r\n    } else {\r\n      do {\r\n        var transform = css(el, 'transform');\r\n  \r\n        if (transform && transform !== 'none') {\r\n          appliedTransforms = transform + ' ' + appliedTransforms;\r\n        }\r\n        /* jshint boss:true */\r\n  \r\n      } while (!selfOnly && (el = el.parentNode));\r\n    }\r\n  \r\n    var matrixFn = window.DOMMatrix || window.WebKitCSSMatrix || window.CSSMatrix || window.MSCSSMatrix;\r\n    /*jshint -W056 */\r\n  \r\n    return matrixFn && new matrixFn(appliedTransforms);\r\n  }\r\n  \r\n  function find(ctx, tagName, iterator) {\r\n    if (ctx) {\r\n      var list = ctx.getElementsByTagName(tagName),\r\n          i = 0,\r\n          n = list.length;\r\n  \r\n      if (iterator) {\r\n        for (; i < n; i++) {\r\n          iterator(list[i], i);\r\n        }\r\n      }\r\n  \r\n      return list;\r\n    }\r\n  \r\n    return [];\r\n  }\r\n  \r\n  function getWindowScrollingElement() {\r\n    var scrollingElement = document.scrollingElement;\r\n  \r\n    if (scrollingElement) {\r\n      return scrollingElement;\r\n    } else {\r\n      return document.documentElement;\r\n    }\r\n  }\r\n  /**\r\n   * Returns the \"bounding client rect\" of given element\r\n   * @param  {HTMLElement} el                       The element whose boundingClientRect is wanted\r\n   * @param  {[Boolean]} relativeToContainingBlock  Whether the rect should be relative to the containing block of (including) the container\r\n   * @param  {[Boolean]} relativeToNonStaticParent  Whether the rect should be relative to the relative parent of (including) the contaienr\r\n   * @param  {[Boolean]} undoScale                  Whether the container's scale() should be undone\r\n   * @param  {[HTMLElement]} container              The parent the element will be placed in\r\n   * @return {Object}                               The boundingClientRect of el, with specified adjustments\r\n   */\r\n  \r\n  \r\n  function getRect(el, relativeToContainingBlock, relativeToNonStaticParent, undoScale, container) {\r\n    if (!el.getBoundingClientRect && el !== window) return;\r\n    var elRect, top, left, bottom, right, height, width;\r\n  \r\n    if (el !== window && el.parentNode && el !== getWindowScrollingElement()) {\r\n      elRect = el.getBoundingClientRect();\r\n      top = elRect.top;\r\n      left = elRect.left;\r\n      bottom = elRect.bottom;\r\n      right = elRect.right;\r\n      height = elRect.height;\r\n      width = elRect.width;\r\n    } else {\r\n      top = 0;\r\n      left = 0;\r\n      bottom = window.innerHeight;\r\n      right = window.innerWidth;\r\n      height = window.innerHeight;\r\n      width = window.innerWidth;\r\n    }\r\n  \r\n    if ((relativeToContainingBlock || relativeToNonStaticParent) && el !== window) {\r\n      // Adjust for translate()\r\n      container = container || el.parentNode; // solves #1123 (see: https://stackoverflow.com/a/37953806/6088312)\r\n      // Not needed on <= IE11\r\n  \r\n      if (!IE11OrLess) {\r\n        do {\r\n          if (container && container.getBoundingClientRect && (css(container, 'transform') !== 'none' || relativeToNonStaticParent && css(container, 'position') !== 'static')) {\r\n            var containerRect = container.getBoundingClientRect(); // Set relative to edges of padding box of container\r\n  \r\n            top -= containerRect.top + parseInt(css(container, 'border-top-width'));\r\n            left -= containerRect.left + parseInt(css(container, 'border-left-width'));\r\n            bottom = top + elRect.height;\r\n            right = left + elRect.width;\r\n            break;\r\n          }\r\n          /* jshint boss:true */\r\n  \r\n        } while (container = container.parentNode);\r\n      }\r\n    }\r\n  \r\n    if (undoScale && el !== window) {\r\n      // Adjust for scale()\r\n      var elMatrix = matrix(container || el),\r\n          scaleX = elMatrix && elMatrix.a,\r\n          scaleY = elMatrix && elMatrix.d;\r\n  \r\n      if (elMatrix) {\r\n        top /= scaleY;\r\n        left /= scaleX;\r\n        width /= scaleX;\r\n        height /= scaleY;\r\n        bottom = top + height;\r\n        right = left + width;\r\n      }\r\n    }\r\n  \r\n    return {\r\n      top: top,\r\n      left: left,\r\n      bottom: bottom,\r\n      right: right,\r\n      width: width,\r\n      height: height\r\n    };\r\n  }\r\n  /**\r\n   * Checks if a side of an element is scrolled past a side of its parents\r\n   * @param  {HTMLElement}  el           The element who's side being scrolled out of view is in question\r\n   * @param  {String}       elSide       Side of the element in question ('top', 'left', 'right', 'bottom')\r\n   * @param  {String}       parentSide   Side of the parent in question ('top', 'left', 'right', 'bottom')\r\n   * @return {HTMLElement}               The parent scroll element that the el's side is scrolled past, or null if there is no such element\r\n   */\r\n  \r\n  \r\n  function isScrolledPast(el, elSide, parentSide) {\r\n    var parent = getParentAutoScrollElement(el, true),\r\n        elSideVal = getRect(el)[elSide];\r\n    /* jshint boss:true */\r\n  \r\n    while (parent) {\r\n      var parentSideVal = getRect(parent)[parentSide],\r\n          visible = void 0;\r\n  \r\n      if (parentSide === 'top' || parentSide === 'left') {\r\n        visible = elSideVal >= parentSideVal;\r\n      } else {\r\n        visible = elSideVal <= parentSideVal;\r\n      }\r\n  \r\n      if (!visible) return parent;\r\n      if (parent === getWindowScrollingElement()) break;\r\n      parent = getParentAutoScrollElement(parent, false);\r\n    }\r\n  \r\n    return false;\r\n  }\r\n  /**\r\n   * Gets nth child of el, ignoring hidden children, sortable's elements (does not ignore clone if it's visible)\r\n   * and non-draggable elements\r\n   * @param  {HTMLElement} el       The parent element\r\n   * @param  {Number} childNum      The index of the child\r\n   * @param  {Object} options       Parent Sortable's options\r\n   * @return {HTMLElement}          The child at index childNum, or null if not found\r\n   */\r\n  \r\n  \r\n  function getChild(el, childNum, options, includeDragEl) {\r\n    var currentChild = 0,\r\n        i = 0,\r\n        children = el.children;\r\n  \r\n    while (i < children.length) {\r\n      if (children[i].style.display !== 'none' && children[i] !== Sortable.ghost && (includeDragEl || children[i] !== Sortable.dragged) && closest(children[i], options.draggable, el, false)) {\r\n        if (currentChild === childNum) {\r\n          return children[i];\r\n        }\r\n  \r\n        currentChild++;\r\n      }\r\n  \r\n      i++;\r\n    }\r\n  \r\n    return null;\r\n  }\r\n  /**\r\n   * Gets the last child in the el, ignoring ghostEl or invisible elements (clones)\r\n   * @param  {HTMLElement} el       Parent element\r\n   * @param  {selector} selector    Any other elements that should be ignored\r\n   * @return {HTMLElement}          The last child, ignoring ghostEl\r\n   */\r\n  \r\n  \r\n  function lastChild(el, selector) {\r\n    var last = el.lastElementChild;\r\n  \r\n    while (last && (last === Sortable.ghost || css(last, 'display') === 'none' || selector && !matches(last, selector))) {\r\n      last = last.previousElementSibling;\r\n    }\r\n  \r\n    return last || null;\r\n  }\r\n  /**\r\n   * Returns the index of an element within its parent for a selected set of\r\n   * elements\r\n   * @param  {HTMLElement} el\r\n   * @param  {selector} selector\r\n   * @return {number}\r\n   */\r\n  \r\n  \r\n  function index(el, selector) {\r\n    var index = 0;\r\n  \r\n    if (!el || !el.parentNode) {\r\n      return -1;\r\n    }\r\n    /* jshint boss:true */\r\n  \r\n  \r\n    while (el = el.previousElementSibling) {\r\n      if (el.nodeName.toUpperCase() !== 'TEMPLATE' && el !== Sortable.clone && (!selector || matches(el, selector))) {\r\n        index++;\r\n      }\r\n    }\r\n  \r\n    return index;\r\n  }\r\n  /**\r\n   * Returns the scroll offset of the given element, added with all the scroll offsets of parent elements.\r\n   * The value is returned in real pixels.\r\n   * @param  {HTMLElement} el\r\n   * @return {Array}             Offsets in the format of [left, top]\r\n   */\r\n  \r\n  \r\n  function getRelativeScrollOffset(el) {\r\n    var offsetLeft = 0,\r\n        offsetTop = 0,\r\n        winScroller = getWindowScrollingElement();\r\n  \r\n    if (el) {\r\n      do {\r\n        var elMatrix = matrix(el),\r\n            scaleX = elMatrix.a,\r\n            scaleY = elMatrix.d;\r\n        offsetLeft += el.scrollLeft * scaleX;\r\n        offsetTop += el.scrollTop * scaleY;\r\n      } while (el !== winScroller && (el = el.parentNode));\r\n    }\r\n  \r\n    return [offsetLeft, offsetTop];\r\n  }\r\n  /**\r\n   * Returns the index of the object within the given array\r\n   * @param  {Array} arr   Array that may or may not hold the object\r\n   * @param  {Object} obj  An object that has a key-value pair unique to and identical to a key-value pair in the object you want to find\r\n   * @return {Number}      The index of the object in the array, or -1\r\n   */\r\n  \r\n  \r\n  function indexOfObject(arr, obj) {\r\n    for (var i in arr) {\r\n      if (!arr.hasOwnProperty(i)) continue;\r\n  \r\n      for (var key in obj) {\r\n        if (obj.hasOwnProperty(key) && obj[key] === arr[i][key]) return Number(i);\r\n      }\r\n    }\r\n  \r\n    return -1;\r\n  }\r\n  \r\n  function getParentAutoScrollElement(el, includeSelf) {\r\n    // skip to window\r\n    if (!el || !el.getBoundingClientRect) return getWindowScrollingElement();\r\n    var elem = el;\r\n    var gotSelf = false;\r\n  \r\n    do {\r\n      // we don't need to get elem css if it isn't even overflowing in the first place (performance)\r\n      if (elem.clientWidth < elem.scrollWidth || elem.clientHeight < elem.scrollHeight) {\r\n        var elemCSS = css(elem);\r\n  \r\n        if (elem.clientWidth < elem.scrollWidth && (elemCSS.overflowX == 'auto' || elemCSS.overflowX == 'scroll') || elem.clientHeight < elem.scrollHeight && (elemCSS.overflowY == 'auto' || elemCSS.overflowY == 'scroll')) {\r\n          if (!elem.getBoundingClientRect || elem === document.body) return getWindowScrollingElement();\r\n          if (gotSelf || includeSelf) return elem;\r\n          gotSelf = true;\r\n        }\r\n      }\r\n      /* jshint boss:true */\r\n  \r\n    } while (elem = elem.parentNode);\r\n  \r\n    return getWindowScrollingElement();\r\n  }\r\n  \r\n  function extend(dst, src) {\r\n    if (dst && src) {\r\n      for (var key in src) {\r\n        if (src.hasOwnProperty(key)) {\r\n          dst[key] = src[key];\r\n        }\r\n      }\r\n    }\r\n  \r\n    return dst;\r\n  }\r\n  \r\n  function isRectEqual(rect1, rect2) {\r\n    return Math.round(rect1.top) === Math.round(rect2.top) && Math.round(rect1.left) === Math.round(rect2.left) && Math.round(rect1.height) === Math.round(rect2.height) && Math.round(rect1.width) === Math.round(rect2.width);\r\n  }\r\n  \r\n  var _throttleTimeout;\r\n  \r\n  function throttle(callback, ms) {\r\n    return function () {\r\n      if (!_throttleTimeout) {\r\n        var args = arguments,\r\n            _this = this;\r\n  \r\n        if (args.length === 1) {\r\n          callback.call(_this, args[0]);\r\n        } else {\r\n          callback.apply(_this, args);\r\n        }\r\n  \r\n        _throttleTimeout = setTimeout(function () {\r\n          _throttleTimeout = void 0;\r\n        }, ms);\r\n      }\r\n    };\r\n  }\r\n  \r\n  function cancelThrottle() {\r\n    clearTimeout(_throttleTimeout);\r\n    _throttleTimeout = void 0;\r\n  }\r\n  \r\n  function scrollBy(el, x, y) {\r\n    el.scrollLeft += x;\r\n    el.scrollTop += y;\r\n  }\r\n  \r\n  function clone(el) {\r\n    var Polymer = window.Polymer;\r\n    var $ = window.jQuery || window.Zepto;\r\n  \r\n    if (Polymer && Polymer.dom) {\r\n      return Polymer.dom(el).cloneNode(true);\r\n    } else if ($) {\r\n      return $(el).clone(true)[0];\r\n    } else {\r\n      return el.cloneNode(true);\r\n    }\r\n  }\r\n  \r\n  function setRect(el, rect) {\r\n    css(el, 'position', 'absolute');\r\n    css(el, 'top', rect.top);\r\n    css(el, 'left', rect.left);\r\n    css(el, 'width', rect.width);\r\n    css(el, 'height', rect.height);\r\n  }\r\n  \r\n  function unsetRect(el) {\r\n    css(el, 'position', '');\r\n    css(el, 'top', '');\r\n    css(el, 'left', '');\r\n    css(el, 'width', '');\r\n    css(el, 'height', '');\r\n  }\r\n  \r\n  var expando = 'Sortable' + new Date().getTime();\r\n  \r\n  function AnimationStateManager() {\r\n    var animationStates = [],\r\n        animationCallbackId;\r\n    return {\r\n      captureAnimationState: function captureAnimationState() {\r\n        animationStates = [];\r\n        if (!this.options.animation) return;\r\n        var children = [].slice.call(this.el.children);\r\n        children.forEach(function (child) {\r\n          if (css(child, 'display') === 'none' || child === Sortable.ghost) return;\r\n          animationStates.push({\r\n            target: child,\r\n            rect: getRect(child)\r\n          });\r\n  \r\n          var fromRect = _objectSpread2({}, animationStates[animationStates.length - 1].rect); // If animating: compensate for current animation\r\n  \r\n  \r\n          if (child.thisAnimationDuration) {\r\n            var childMatrix = matrix(child, true);\r\n  \r\n            if (childMatrix) {\r\n              fromRect.top -= childMatrix.f;\r\n              fromRect.left -= childMatrix.e;\r\n            }\r\n          }\r\n  \r\n          child.fromRect = fromRect;\r\n        });\r\n      },\r\n      addAnimationState: function addAnimationState(state) {\r\n        animationStates.push(state);\r\n      },\r\n      removeAnimationState: function removeAnimationState(target) {\r\n        animationStates.splice(indexOfObject(animationStates, {\r\n          target: target\r\n        }), 1);\r\n      },\r\n      animateAll: function animateAll(callback) {\r\n        var _this = this;\r\n  \r\n        if (!this.options.animation) {\r\n          clearTimeout(animationCallbackId);\r\n          if (typeof callback === 'function') callback();\r\n          return;\r\n        }\r\n  \r\n        var animating = false,\r\n            animationTime = 0;\r\n        animationStates.forEach(function (state) {\r\n          var time = 0,\r\n              target = state.target,\r\n              fromRect = target.fromRect,\r\n              toRect = getRect(target),\r\n              prevFromRect = target.prevFromRect,\r\n              prevToRect = target.prevToRect,\r\n              animatingRect = state.rect,\r\n              targetMatrix = matrix(target, true);\r\n  \r\n          if (targetMatrix) {\r\n            // Compensate for current animation\r\n            toRect.top -= targetMatrix.f;\r\n            toRect.left -= targetMatrix.e;\r\n          }\r\n  \r\n          target.toRect = toRect;\r\n  \r\n          if (target.thisAnimationDuration) {\r\n            // Could also check if animatingRect is between fromRect and toRect\r\n            if (isRectEqual(prevFromRect, toRect) && !isRectEqual(fromRect, toRect) && // Make sure animatingRect is on line between toRect & fromRect\r\n            (animatingRect.top - toRect.top) / (animatingRect.left - toRect.left) === (fromRect.top - toRect.top) / (fromRect.left - toRect.left)) {\r\n              // If returning to same place as started from animation and on same axis\r\n              time = calculateRealTime(animatingRect, prevFromRect, prevToRect, _this.options);\r\n            }\r\n          } // if fromRect != toRect: animate\r\n  \r\n  \r\n          if (!isRectEqual(toRect, fromRect)) {\r\n            target.prevFromRect = fromRect;\r\n            target.prevToRect = toRect;\r\n  \r\n            if (!time) {\r\n              time = _this.options.animation;\r\n            }\r\n  \r\n            _this.animate(target, animatingRect, toRect, time);\r\n          }\r\n  \r\n          if (time) {\r\n            animating = true;\r\n            animationTime = Math.max(animationTime, time);\r\n            clearTimeout(target.animationResetTimer);\r\n            target.animationResetTimer = setTimeout(function () {\r\n              target.animationTime = 0;\r\n              target.prevFromRect = null;\r\n              target.fromRect = null;\r\n              target.prevToRect = null;\r\n              target.thisAnimationDuration = null;\r\n            }, time);\r\n            target.thisAnimationDuration = time;\r\n          }\r\n        });\r\n        clearTimeout(animationCallbackId);\r\n  \r\n        if (!animating) {\r\n          if (typeof callback === 'function') callback();\r\n        } else {\r\n          animationCallbackId = setTimeout(function () {\r\n            if (typeof callback === 'function') callback();\r\n          }, animationTime);\r\n        }\r\n  \r\n        animationStates = [];\r\n      },\r\n      animate: function animate(target, currentRect, toRect, duration) {\r\n        if (duration) {\r\n          css(target, 'transition', '');\r\n          css(target, 'transform', '');\r\n          var elMatrix = matrix(this.el),\r\n              scaleX = elMatrix && elMatrix.a,\r\n              scaleY = elMatrix && elMatrix.d,\r\n              translateX = (currentRect.left - toRect.left) / (scaleX || 1),\r\n              translateY = (currentRect.top - toRect.top) / (scaleY || 1);\r\n          target.animatingX = !!translateX;\r\n          target.animatingY = !!translateY;\r\n          css(target, 'transform', 'translate3d(' + translateX + 'px,' + translateY + 'px,0)');\r\n          this.forRepaintDummy = repaint(target); // repaint\r\n  \r\n          css(target, 'transition', 'transform ' + duration + 'ms' + (this.options.easing ? ' ' + this.options.easing : ''));\r\n          css(target, 'transform', 'translate3d(0,0,0)');\r\n          typeof target.animated === 'number' && clearTimeout(target.animated);\r\n          target.animated = setTimeout(function () {\r\n            css(target, 'transition', '');\r\n            css(target, 'transform', '');\r\n            target.animated = false;\r\n            target.animatingX = false;\r\n            target.animatingY = false;\r\n          }, duration);\r\n        }\r\n      }\r\n    };\r\n  }\r\n  \r\n  function repaint(target) {\r\n    return target.offsetWidth;\r\n  }\r\n  \r\n  function calculateRealTime(animatingRect, fromRect, toRect, options) {\r\n    return Math.sqrt(Math.pow(fromRect.top - animatingRect.top, 2) + Math.pow(fromRect.left - animatingRect.left, 2)) / Math.sqrt(Math.pow(fromRect.top - toRect.top, 2) + Math.pow(fromRect.left - toRect.left, 2)) * options.animation;\r\n  }\r\n  \r\n  var plugins = [];\r\n  var defaults = {\r\n    initializeByDefault: true\r\n  };\r\n  var PluginManager = {\r\n    mount: function mount(plugin) {\r\n      // Set default static properties\r\n      for (var option in defaults) {\r\n        if (defaults.hasOwnProperty(option) && !(option in plugin)) {\r\n          plugin[option] = defaults[option];\r\n        }\r\n      }\r\n  \r\n      plugins.forEach(function (p) {\r\n        if (p.pluginName === plugin.pluginName) {\r\n          throw \"Sortable: Cannot mount plugin \".concat(plugin.pluginName, \" more than once\");\r\n        }\r\n      });\r\n      plugins.push(plugin);\r\n    },\r\n    pluginEvent: function pluginEvent(eventName, sortable, evt) {\r\n      var _this = this;\r\n  \r\n      this.eventCanceled = false;\r\n  \r\n      evt.cancel = function () {\r\n        _this.eventCanceled = true;\r\n      };\r\n  \r\n      var eventNameGlobal = eventName + 'Global';\r\n      plugins.forEach(function (plugin) {\r\n        if (!sortable[plugin.pluginName]) return; // Fire global events if it exists in this sortable\r\n  \r\n        if (sortable[plugin.pluginName][eventNameGlobal]) {\r\n          sortable[plugin.pluginName][eventNameGlobal](_objectSpread2({\r\n            sortable: sortable\r\n          }, evt));\r\n        } // Only fire plugin event if plugin is enabled in this sortable,\r\n        // and plugin has event defined\r\n  \r\n  \r\n        if (sortable.options[plugin.pluginName] && sortable[plugin.pluginName][eventName]) {\r\n          sortable[plugin.pluginName][eventName](_objectSpread2({\r\n            sortable: sortable\r\n          }, evt));\r\n        }\r\n      });\r\n    },\r\n    initializePlugins: function initializePlugins(sortable, el, defaults, options) {\r\n      plugins.forEach(function (plugin) {\r\n        var pluginName = plugin.pluginName;\r\n        if (!sortable.options[pluginName] && !plugin.initializeByDefault) return;\r\n        var initialized = new plugin(sortable, el, sortable.options);\r\n        initialized.sortable = sortable;\r\n        initialized.options = sortable.options;\r\n        sortable[pluginName] = initialized; // Add default options from plugin\r\n  \r\n        _extends(defaults, initialized.defaults);\r\n      });\r\n  \r\n      for (var option in sortable.options) {\r\n        if (!sortable.options.hasOwnProperty(option)) continue;\r\n        var modified = this.modifyOption(sortable, option, sortable.options[option]);\r\n  \r\n        if (typeof modified !== 'undefined') {\r\n          sortable.options[option] = modified;\r\n        }\r\n      }\r\n    },\r\n    getEventProperties: function getEventProperties(name, sortable) {\r\n      var eventProperties = {};\r\n      plugins.forEach(function (plugin) {\r\n        if (typeof plugin.eventProperties !== 'function') return;\r\n  \r\n        _extends(eventProperties, plugin.eventProperties.call(sortable[plugin.pluginName], name));\r\n      });\r\n      return eventProperties;\r\n    },\r\n    modifyOption: function modifyOption(sortable, name, value) {\r\n      var modifiedValue;\r\n      plugins.forEach(function (plugin) {\r\n        // Plugin must exist on the Sortable\r\n        if (!sortable[plugin.pluginName]) return; // If static option listener exists for this option, call in the context of the Sortable's instance of this plugin\r\n  \r\n        if (plugin.optionListeners && typeof plugin.optionListeners[name] === 'function') {\r\n          modifiedValue = plugin.optionListeners[name].call(sortable[plugin.pluginName], value);\r\n        }\r\n      });\r\n      return modifiedValue;\r\n    }\r\n  };\r\n  \r\n  function dispatchEvent(_ref) {\r\n    var sortable = _ref.sortable,\r\n        rootEl = _ref.rootEl,\r\n        name = _ref.name,\r\n        targetEl = _ref.targetEl,\r\n        cloneEl = _ref.cloneEl,\r\n        toEl = _ref.toEl,\r\n        fromEl = _ref.fromEl,\r\n        oldIndex = _ref.oldIndex,\r\n        newIndex = _ref.newIndex,\r\n        oldDraggableIndex = _ref.oldDraggableIndex,\r\n        newDraggableIndex = _ref.newDraggableIndex,\r\n        originalEvent = _ref.originalEvent,\r\n        putSortable = _ref.putSortable,\r\n        extraEventProperties = _ref.extraEventProperties;\r\n    sortable = sortable || rootEl && rootEl[expando];\r\n    if (!sortable) return;\r\n    var evt,\r\n        options = sortable.options,\r\n        onName = 'on' + name.charAt(0).toUpperCase() + name.substr(1); // Support for new CustomEvent feature\r\n  \r\n    if (window.CustomEvent && !IE11OrLess && !Edge) {\r\n      evt = new CustomEvent(name, {\r\n        bubbles: true,\r\n        cancelable: true\r\n      });\r\n    } else {\r\n      evt = document.createEvent('Event');\r\n      evt.initEvent(name, true, true);\r\n    }\r\n  \r\n    evt.to = toEl || rootEl;\r\n    evt.from = fromEl || rootEl;\r\n    evt.item = targetEl || rootEl;\r\n    evt.clone = cloneEl;\r\n    evt.oldIndex = oldIndex;\r\n    evt.newIndex = newIndex;\r\n    evt.oldDraggableIndex = oldDraggableIndex;\r\n    evt.newDraggableIndex = newDraggableIndex;\r\n    evt.originalEvent = originalEvent;\r\n    evt.pullMode = putSortable ? putSortable.lastPutMode : undefined;\r\n  \r\n    var allEventProperties = _objectSpread2(_objectSpread2({}, extraEventProperties), PluginManager.getEventProperties(name, sortable));\r\n  \r\n    for (var option in allEventProperties) {\r\n      evt[option] = allEventProperties[option];\r\n    }\r\n  \r\n    if (rootEl) {\r\n      rootEl.dispatchEvent(evt);\r\n    }\r\n  \r\n    if (options[onName]) {\r\n      options[onName].call(sortable, evt);\r\n    }\r\n  }\r\n  \r\n  var _excluded = [\"evt\"];\r\n  \r\n  var pluginEvent = function pluginEvent(eventName, sortable) {\r\n    var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\r\n        originalEvent = _ref.evt,\r\n        data = _objectWithoutProperties(_ref, _excluded);\r\n  \r\n    PluginManager.pluginEvent.bind(Sortable)(eventName, sortable, _objectSpread2({\r\n      dragEl: dragEl,\r\n      parentEl: parentEl,\r\n      ghostEl: ghostEl,\r\n      rootEl: rootEl,\r\n      nextEl: nextEl,\r\n      lastDownEl: lastDownEl,\r\n      cloneEl: cloneEl,\r\n      cloneHidden: cloneHidden,\r\n      dragStarted: moved,\r\n      putSortable: putSortable,\r\n      activeSortable: Sortable.active,\r\n      originalEvent: originalEvent,\r\n      oldIndex: oldIndex,\r\n      oldDraggableIndex: oldDraggableIndex,\r\n      newIndex: newIndex,\r\n      newDraggableIndex: newDraggableIndex,\r\n      hideGhostForTarget: _hideGhostForTarget,\r\n      unhideGhostForTarget: _unhideGhostForTarget,\r\n      cloneNowHidden: function cloneNowHidden() {\r\n        cloneHidden = true;\r\n      },\r\n      cloneNowShown: function cloneNowShown() {\r\n        cloneHidden = false;\r\n      },\r\n      dispatchSortableEvent: function dispatchSortableEvent(name) {\r\n        _dispatchEvent({\r\n          sortable: sortable,\r\n          name: name,\r\n          originalEvent: originalEvent\r\n        });\r\n      }\r\n    }, data));\r\n  };\r\n  \r\n  function _dispatchEvent(info) {\r\n    dispatchEvent(_objectSpread2({\r\n      putSortable: putSortable,\r\n      cloneEl: cloneEl,\r\n      targetEl: dragEl,\r\n      rootEl: rootEl,\r\n      oldIndex: oldIndex,\r\n      oldDraggableIndex: oldDraggableIndex,\r\n      newIndex: newIndex,\r\n      newDraggableIndex: newDraggableIndex\r\n    }, info));\r\n  }\r\n  \r\n  var dragEl,\r\n      parentEl,\r\n      ghostEl,\r\n      rootEl,\r\n      nextEl,\r\n      lastDownEl,\r\n      cloneEl,\r\n      cloneHidden,\r\n      oldIndex,\r\n      newIndex,\r\n      oldDraggableIndex,\r\n      newDraggableIndex,\r\n      activeGroup,\r\n      putSortable,\r\n      awaitingDragStarted = false,\r\n      ignoreNextClick = false,\r\n      sortables = [],\r\n      tapEvt,\r\n      touchEvt,\r\n      lastDx,\r\n      lastDy,\r\n      tapDistanceLeft,\r\n      tapDistanceTop,\r\n      moved,\r\n      lastTarget,\r\n      lastDirection,\r\n      pastFirstInvertThresh = false,\r\n      isCircumstantialInvert = false,\r\n      targetMoveDistance,\r\n      // For positioning ghost absolutely\r\n  ghostRelativeParent,\r\n      ghostRelativeParentInitialScroll = [],\r\n      // (left, top)\r\n  _silent = false,\r\n      savedInputChecked = [];\r\n  /** @const */\r\n  \r\n  var documentExists = typeof document !== 'undefined',\r\n      PositionGhostAbsolutely = IOS,\r\n      CSSFloatProperty = Edge || IE11OrLess ? 'cssFloat' : 'float',\r\n      // This will not pass for IE9, because IE9 DnD only works on anchors\r\n  supportDraggable = documentExists && !ChromeForAndroid && !IOS && 'draggable' in document.createElement('div'),\r\n      supportCssPointerEvents = function () {\r\n    if (!documentExists) return; // false when <= IE11\r\n  \r\n    if (IE11OrLess) {\r\n      return false;\r\n    }\r\n  \r\n    var el = document.createElement('x');\r\n    el.style.cssText = 'pointer-events:auto';\r\n    return el.style.pointerEvents === 'auto';\r\n  }(),\r\n      _detectDirection = function _detectDirection(el, options) {\r\n    var elCSS = css(el),\r\n        elWidth = parseInt(elCSS.width) - parseInt(elCSS.paddingLeft) - parseInt(elCSS.paddingRight) - parseInt(elCSS.borderLeftWidth) - parseInt(elCSS.borderRightWidth),\r\n        child1 = getChild(el, 0, options),\r\n        child2 = getChild(el, 1, options),\r\n        firstChildCSS = child1 && css(child1),\r\n        secondChildCSS = child2 && css(child2),\r\n        firstChildWidth = firstChildCSS && parseInt(firstChildCSS.marginLeft) + parseInt(firstChildCSS.marginRight) + getRect(child1).width,\r\n        secondChildWidth = secondChildCSS && parseInt(secondChildCSS.marginLeft) + parseInt(secondChildCSS.marginRight) + getRect(child2).width;\r\n  \r\n    if (elCSS.display === 'flex') {\r\n      return elCSS.flexDirection === 'column' || elCSS.flexDirection === 'column-reverse' ? 'vertical' : 'horizontal';\r\n    }\r\n  \r\n    if (elCSS.display === 'grid') {\r\n      return elCSS.gridTemplateColumns.split(' ').length <= 1 ? 'vertical' : 'horizontal';\r\n    }\r\n  \r\n    if (child1 && firstChildCSS[\"float\"] && firstChildCSS[\"float\"] !== 'none') {\r\n      var touchingSideChild2 = firstChildCSS[\"float\"] === 'left' ? 'left' : 'right';\r\n      return child2 && (secondChildCSS.clear === 'both' || secondChildCSS.clear === touchingSideChild2) ? 'vertical' : 'horizontal';\r\n    }\r\n  \r\n    return child1 && (firstChildCSS.display === 'block' || firstChildCSS.display === 'flex' || firstChildCSS.display === 'table' || firstChildCSS.display === 'grid' || firstChildWidth >= elWidth && elCSS[CSSFloatProperty] === 'none' || child2 && elCSS[CSSFloatProperty] === 'none' && firstChildWidth + secondChildWidth > elWidth) ? 'vertical' : 'horizontal';\r\n  },\r\n      _dragElInRowColumn = function _dragElInRowColumn(dragRect, targetRect, vertical) {\r\n    var dragElS1Opp = vertical ? dragRect.left : dragRect.top,\r\n        dragElS2Opp = vertical ? dragRect.right : dragRect.bottom,\r\n        dragElOppLength = vertical ? dragRect.width : dragRect.height,\r\n        targetS1Opp = vertical ? targetRect.left : targetRect.top,\r\n        targetS2Opp = vertical ? targetRect.right : targetRect.bottom,\r\n        targetOppLength = vertical ? targetRect.width : targetRect.height;\r\n    return dragElS1Opp === targetS1Opp || dragElS2Opp === targetS2Opp || dragElS1Opp + dragElOppLength / 2 === targetS1Opp + targetOppLength / 2;\r\n  },\r\n  \r\n  /**\r\n   * Detects first nearest empty sortable to X and Y position using emptyInsertThreshold.\r\n   * @param  {Number} x      X position\r\n   * @param  {Number} y      Y position\r\n   * @return {HTMLElement}   Element of the first found nearest Sortable\r\n   */\r\n  _detectNearestEmptySortable = function _detectNearestEmptySortable(x, y) {\r\n    var ret;\r\n    sortables.some(function (sortable) {\r\n      var threshold = sortable[expando].options.emptyInsertThreshold;\r\n      if (!threshold || lastChild(sortable)) return;\r\n      var rect = getRect(sortable),\r\n          insideHorizontally = x >= rect.left - threshold && x <= rect.right + threshold,\r\n          insideVertically = y >= rect.top - threshold && y <= rect.bottom + threshold;\r\n  \r\n      if (insideHorizontally && insideVertically) {\r\n        return ret = sortable;\r\n      }\r\n    });\r\n    return ret;\r\n  },\r\n      _prepareGroup = function _prepareGroup(options) {\r\n    function toFn(value, pull) {\r\n      return function (to, from, dragEl, evt) {\r\n        var sameGroup = to.options.group.name && from.options.group.name && to.options.group.name === from.options.group.name;\r\n  \r\n        if (value == null && (pull || sameGroup)) {\r\n          // Default pull value\r\n          // Default pull and put value if same group\r\n          return true;\r\n        } else if (value == null || value === false) {\r\n          return false;\r\n        } else if (pull && value === 'clone') {\r\n          return value;\r\n        } else if (typeof value === 'function') {\r\n          return toFn(value(to, from, dragEl, evt), pull)(to, from, dragEl, evt);\r\n        } else {\r\n          var otherGroup = (pull ? to : from).options.group.name;\r\n          return value === true || typeof value === 'string' && value === otherGroup || value.join && value.indexOf(otherGroup) > -1;\r\n        }\r\n      };\r\n    }\r\n  \r\n    var group = {};\r\n    var originalGroup = options.group;\r\n  \r\n    if (!originalGroup || _typeof(originalGroup) != 'object') {\r\n      originalGroup = {\r\n        name: originalGroup\r\n      };\r\n    }\r\n  \r\n    group.name = originalGroup.name;\r\n    group.checkPull = toFn(originalGroup.pull, true);\r\n    group.checkPut = toFn(originalGroup.put);\r\n    group.revertClone = originalGroup.revertClone;\r\n    options.group = group;\r\n  },\r\n      _hideGhostForTarget = function _hideGhostForTarget() {\r\n    if (!supportCssPointerEvents && ghostEl) {\r\n      css(ghostEl, 'display', 'none');\r\n    }\r\n  },\r\n      _unhideGhostForTarget = function _unhideGhostForTarget() {\r\n    if (!supportCssPointerEvents && ghostEl) {\r\n      css(ghostEl, 'display', '');\r\n    }\r\n  }; // #1184 fix - Prevent click event on fallback if dragged but item not changed position\r\n  \r\n  \r\n  if (documentExists && !ChromeForAndroid) {\r\n    document.addEventListener('click', function (evt) {\r\n      if (ignoreNextClick) {\r\n        evt.preventDefault();\r\n        evt.stopPropagation && evt.stopPropagation();\r\n        evt.stopImmediatePropagation && evt.stopImmediatePropagation();\r\n        ignoreNextClick = false;\r\n        return false;\r\n      }\r\n    }, true);\r\n  }\r\n  \r\n  var nearestEmptyInsertDetectEvent = function nearestEmptyInsertDetectEvent(evt) {\r\n    if (dragEl) {\r\n      evt = evt.touches ? evt.touches[0] : evt;\r\n  \r\n      var nearest = _detectNearestEmptySortable(evt.clientX, evt.clientY);\r\n  \r\n      if (nearest) {\r\n        // Create imitation event\r\n        var event = {};\r\n  \r\n        for (var i in evt) {\r\n          if (evt.hasOwnProperty(i)) {\r\n            event[i] = evt[i];\r\n          }\r\n        }\r\n  \r\n        event.target = event.rootEl = nearest;\r\n        event.preventDefault = void 0;\r\n        event.stopPropagation = void 0;\r\n  \r\n        nearest[expando]._onDragOver(event);\r\n      }\r\n    }\r\n  };\r\n  \r\n  var _checkOutsideTargetEl = function _checkOutsideTargetEl(evt) {\r\n    if (dragEl) {\r\n      dragEl.parentNode[expando]._isOutsideThisEl(evt.target);\r\n    }\r\n  };\r\n  /**\r\n   * @class  Sortable\r\n   * @param  {HTMLElement}  el\r\n   * @param  {Object}       [options]\r\n   */\r\n  \r\n  \r\n  function Sortable(el, options) {\r\n    if (!(el && el.nodeType && el.nodeType === 1)) {\r\n      throw \"Sortable: `el` must be an HTMLElement, not \".concat({}.toString.call(el));\r\n    }\r\n  \r\n    this.el = el; // root element\r\n  \r\n    this.options = options = _extends({}, options); // Export instance\r\n  \r\n    el[expando] = this;\r\n    var defaults = {\r\n      group: null,\r\n      sort: true,\r\n      disabled: false,\r\n      store: null,\r\n      handle: null,\r\n      draggable: /^[uo]l$/i.test(el.nodeName) ? '>li' : '>*',\r\n      swapThreshold: 1,\r\n      // percentage; 0 <= x <= 1\r\n      invertSwap: false,\r\n      // invert always\r\n      invertedSwapThreshold: null,\r\n      // will be set to same as swapThreshold if default\r\n      removeCloneOnHide: true,\r\n      direction: function direction() {\r\n        return _detectDirection(el, this.options);\r\n      },\r\n      ghostClass: 'sortable-ghost',\r\n      chosenClass: 'sortable-chosen',\r\n      dragClass: 'sortable-drag',\r\n      ignore: 'a, img',\r\n      filter: null,\r\n      preventOnFilter: true,\r\n      animation: 0,\r\n      easing: null,\r\n      setData: function setData(dataTransfer, dragEl) {\r\n        dataTransfer.setData('Text', dragEl.textContent);\r\n      },\r\n      dropBubble: false,\r\n      dragoverBubble: false,\r\n      dataIdAttr: 'data-id',\r\n      delay: 0,\r\n      delayOnTouchOnly: false,\r\n      touchStartThreshold: (Number.parseInt ? Number : window).parseInt(window.devicePixelRatio, 10) || 1,\r\n      forceFallback: false,\r\n      fallbackClass: 'sortable-fallback',\r\n      fallbackOnBody: false,\r\n      fallbackTolerance: 0,\r\n      fallbackOffset: {\r\n        x: 0,\r\n        y: 0\r\n      },\r\n      supportPointer: Sortable.supportPointer !== false && 'PointerEvent' in window && !Safari,\r\n      emptyInsertThreshold: 5\r\n    };\r\n    PluginManager.initializePlugins(this, el, defaults); // Set default options\r\n  \r\n    for (var name in defaults) {\r\n      !(name in options) && (options[name] = defaults[name]);\r\n    }\r\n  \r\n    _prepareGroup(options); // Bind all private methods\r\n  \r\n  \r\n    for (var fn in this) {\r\n      if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {\r\n        this[fn] = this[fn].bind(this);\r\n      }\r\n    } // Setup drag mode\r\n  \r\n  \r\n    this.nativeDraggable = options.forceFallback ? false : supportDraggable;\r\n  \r\n    if (this.nativeDraggable) {\r\n      // Touch start threshold cannot be greater than the native dragstart threshold\r\n      this.options.touchStartThreshold = 1;\r\n    } // Bind events\r\n  \r\n  \r\n    if (options.supportPointer) {\r\n      on(el, 'pointerdown', this._onTapStart);\r\n    } else {\r\n      on(el, 'mousedown', this._onTapStart);\r\n      on(el, 'touchstart', this._onTapStart);\r\n    }\r\n  \r\n    if (this.nativeDraggable) {\r\n      on(el, 'dragover', this);\r\n      on(el, 'dragenter', this);\r\n    }\r\n  \r\n    sortables.push(this.el); // Restore sorting\r\n  \r\n    options.store && options.store.get && this.sort(options.store.get(this) || []); // Add animation state manager\r\n  \r\n    _extends(this, AnimationStateManager());\r\n  }\r\n  \r\n  Sortable.prototype =\r\n  /** @lends Sortable.prototype */\r\n  {\r\n    constructor: Sortable,\r\n    _isOutsideThisEl: function _isOutsideThisEl(target) {\r\n      if (!this.el.contains(target) && target !== this.el) {\r\n        lastTarget = null;\r\n      }\r\n    },\r\n    _getDirection: function _getDirection(evt, target) {\r\n      return typeof this.options.direction === 'function' ? this.options.direction.call(this, evt, target, dragEl) : this.options.direction;\r\n    },\r\n    _onTapStart: function _onTapStart(\r\n    /** Event|TouchEvent */\r\n    evt) {\r\n      if (!evt.cancelable) return;\r\n  \r\n      var _this = this,\r\n          el = this.el,\r\n          options = this.options,\r\n          preventOnFilter = options.preventOnFilter,\r\n          type = evt.type,\r\n          touch = evt.touches && evt.touches[0] || evt.pointerType && evt.pointerType === 'touch' && evt,\r\n          target = (touch || evt).target,\r\n          originalTarget = evt.target.shadowRoot && (evt.path && evt.path[0] || evt.composedPath && evt.composedPath()[0]) || target,\r\n          filter = options.filter;\r\n  \r\n      _saveInputCheckedState(el); // Don't trigger start event when an element is been dragged, otherwise the evt.oldindex always wrong when set option.group.\r\n  \r\n  \r\n      if (dragEl) {\r\n        return;\r\n      }\r\n  \r\n      if (/mousedown|pointerdown/.test(type) && evt.button !== 0 || options.disabled) {\r\n        return; // only left button and enabled\r\n      } // cancel dnd if original target is content editable\r\n  \r\n  \r\n      if (originalTarget.isContentEditable) {\r\n        return;\r\n      } // Safari ignores further event handling after mousedown\r\n  \r\n  \r\n      if (!this.nativeDraggable && Safari && target && target.tagName.toUpperCase() === 'SELECT') {\r\n        return;\r\n      }\r\n  \r\n      target = closest(target, options.draggable, el, false);\r\n  \r\n      if (target && target.animated) {\r\n        return;\r\n      }\r\n  \r\n      if (lastDownEl === target) {\r\n        // Ignoring duplicate `down`\r\n        return;\r\n      } // Get the index of the dragged element within its parent\r\n  \r\n  \r\n      oldIndex = index(target);\r\n      oldDraggableIndex = index(target, options.draggable); // Check filter\r\n  \r\n      if (typeof filter === 'function') {\r\n        if (filter.call(this, evt, target, this)) {\r\n          _dispatchEvent({\r\n            sortable: _this,\r\n            rootEl: originalTarget,\r\n            name: 'filter',\r\n            targetEl: target,\r\n            toEl: el,\r\n            fromEl: el\r\n          });\r\n  \r\n          pluginEvent('filter', _this, {\r\n            evt: evt\r\n          });\r\n          preventOnFilter && evt.cancelable && evt.preventDefault();\r\n          return; // cancel dnd\r\n        }\r\n      } else if (filter) {\r\n        filter = filter.split(',').some(function (criteria) {\r\n          criteria = closest(originalTarget, criteria.trim(), el, false);\r\n  \r\n          if (criteria) {\r\n            _dispatchEvent({\r\n              sortable: _this,\r\n              rootEl: criteria,\r\n              name: 'filter',\r\n              targetEl: target,\r\n              fromEl: el,\r\n              toEl: el\r\n            });\r\n  \r\n            pluginEvent('filter', _this, {\r\n              evt: evt\r\n            });\r\n            return true;\r\n          }\r\n        });\r\n  \r\n        if (filter) {\r\n          preventOnFilter && evt.cancelable && evt.preventDefault();\r\n          return; // cancel dnd\r\n        }\r\n      }\r\n  \r\n      if (options.handle && !closest(originalTarget, options.handle, el, false)) {\r\n        return;\r\n      } // Prepare `dragstart`\r\n  \r\n  \r\n      this._prepareDragStart(evt, touch, target);\r\n    },\r\n    _prepareDragStart: function _prepareDragStart(\r\n    /** Event */\r\n    evt,\r\n    /** Touch */\r\n    touch,\r\n    /** HTMLElement */\r\n    target) {\r\n      var _this = this,\r\n          el = _this.el,\r\n          options = _this.options,\r\n          ownerDocument = el.ownerDocument,\r\n          dragStartFn;\r\n  \r\n      if (target && !dragEl && target.parentNode === el) {\r\n        var dragRect = getRect(target);\r\n        rootEl = el;\r\n        dragEl = target;\r\n        parentEl = dragEl.parentNode;\r\n        nextEl = dragEl.nextSibling;\r\n        lastDownEl = target;\r\n        activeGroup = options.group;\r\n        Sortable.dragged = dragEl;\r\n        tapEvt = {\r\n          target: dragEl,\r\n          clientX: (touch || evt).clientX,\r\n          clientY: (touch || evt).clientY\r\n        };\r\n        tapDistanceLeft = tapEvt.clientX - dragRect.left;\r\n        tapDistanceTop = tapEvt.clientY - dragRect.top;\r\n        this._lastX = (touch || evt).clientX;\r\n        this._lastY = (touch || evt).clientY;\r\n        dragEl.style['will-change'] = 'all';\r\n  \r\n        dragStartFn = function dragStartFn() {\r\n          pluginEvent('delayEnded', _this, {\r\n            evt: evt\r\n          });\r\n  \r\n          if (Sortable.eventCanceled) {\r\n            _this._onDrop();\r\n  \r\n            return;\r\n          } // Delayed drag has been triggered\r\n          // we can re-enable the events: touchmove/mousemove\r\n  \r\n  \r\n          _this._disableDelayedDragEvents();\r\n  \r\n          if (!FireFox && _this.nativeDraggable) {\r\n            dragEl.draggable = true;\r\n          } // Bind the events: dragstart/dragend\r\n  \r\n  \r\n          _this._triggerDragStart(evt, touch); // Drag start event\r\n  \r\n  \r\n          _dispatchEvent({\r\n            sortable: _this,\r\n            name: 'choose',\r\n            originalEvent: evt\r\n          }); // Chosen item\r\n  \r\n  \r\n          toggleClass(dragEl, options.chosenClass, true);\r\n        }; // Disable \"draggable\"\r\n  \r\n  \r\n        options.ignore.split(',').forEach(function (criteria) {\r\n          find(dragEl, criteria.trim(), _disableDraggable);\r\n        });\r\n        on(ownerDocument, 'dragover', nearestEmptyInsertDetectEvent);\r\n        on(ownerDocument, 'mousemove', nearestEmptyInsertDetectEvent);\r\n        on(ownerDocument, 'touchmove', nearestEmptyInsertDetectEvent);\r\n        on(ownerDocument, 'mouseup', _this._onDrop);\r\n        on(ownerDocument, 'touchend', _this._onDrop);\r\n        on(ownerDocument, 'touchcancel', _this._onDrop); // Make dragEl draggable (must be before delay for FireFox)\r\n  \r\n        if (FireFox && this.nativeDraggable) {\r\n          this.options.touchStartThreshold = 4;\r\n          dragEl.draggable = true;\r\n        }\r\n  \r\n        pluginEvent('delayStart', this, {\r\n          evt: evt\r\n        }); // Delay is impossible for native DnD in Edge or IE\r\n  \r\n        if (options.delay && (!options.delayOnTouchOnly || touch) && (!this.nativeDraggable || !(Edge || IE11OrLess))) {\r\n          if (Sortable.eventCanceled) {\r\n            this._onDrop();\r\n  \r\n            return;\r\n          } // If the user moves the pointer or let go the click or touch\r\n          // before the delay has been reached:\r\n          // disable the delayed drag\r\n  \r\n  \r\n          on(ownerDocument, 'mouseup', _this._disableDelayedDrag);\r\n          on(ownerDocument, 'touchend', _this._disableDelayedDrag);\r\n          on(ownerDocument, 'touchcancel', _this._disableDelayedDrag);\r\n          on(ownerDocument, 'mousemove', _this._delayedDragTouchMoveHandler);\r\n          on(ownerDocument, 'touchmove', _this._delayedDragTouchMoveHandler);\r\n          options.supportPointer && on(ownerDocument, 'pointermove', _this._delayedDragTouchMoveHandler);\r\n          _this._dragStartTimer = setTimeout(dragStartFn, options.delay);\r\n        } else {\r\n          dragStartFn();\r\n        }\r\n      }\r\n    },\r\n    _delayedDragTouchMoveHandler: function _delayedDragTouchMoveHandler(\r\n    /** TouchEvent|PointerEvent **/\r\n    e) {\r\n      var touch = e.touches ? e.touches[0] : e;\r\n  \r\n      if (Math.max(Math.abs(touch.clientX - this._lastX), Math.abs(touch.clientY - this._lastY)) >= Math.floor(this.options.touchStartThreshold / (this.nativeDraggable && window.devicePixelRatio || 1))) {\r\n        this._disableDelayedDrag();\r\n      }\r\n    },\r\n    _disableDelayedDrag: function _disableDelayedDrag() {\r\n      dragEl && _disableDraggable(dragEl);\r\n      clearTimeout(this._dragStartTimer);\r\n  \r\n      this._disableDelayedDragEvents();\r\n    },\r\n    _disableDelayedDragEvents: function _disableDelayedDragEvents() {\r\n      var ownerDocument = this.el.ownerDocument;\r\n      off(ownerDocument, 'mouseup', this._disableDelayedDrag);\r\n      off(ownerDocument, 'touchend', this._disableDelayedDrag);\r\n      off(ownerDocument, 'touchcancel', this._disableDelayedDrag);\r\n      off(ownerDocument, 'mousemove', this._delayedDragTouchMoveHandler);\r\n      off(ownerDocument, 'touchmove', this._delayedDragTouchMoveHandler);\r\n      off(ownerDocument, 'pointermove', this._delayedDragTouchMoveHandler);\r\n    },\r\n    _triggerDragStart: function _triggerDragStart(\r\n    /** Event */\r\n    evt,\r\n    /** Touch */\r\n    touch) {\r\n      touch = touch || evt.pointerType == 'touch' && evt;\r\n  \r\n      if (!this.nativeDraggable || touch) {\r\n        if (this.options.supportPointer) {\r\n          on(document, 'pointermove', this._onTouchMove);\r\n        } else if (touch) {\r\n          on(document, 'touchmove', this._onTouchMove);\r\n        } else {\r\n          on(document, 'mousemove', this._onTouchMove);\r\n        }\r\n      } else {\r\n        on(dragEl, 'dragend', this);\r\n        on(rootEl, 'dragstart', this._onDragStart);\r\n      }\r\n  \r\n      try {\r\n        if (document.selection) {\r\n          // Timeout neccessary for IE9\r\n          _nextTick(function () {\r\n            document.selection.empty();\r\n          });\r\n        } else {\r\n          window.getSelection().removeAllRanges();\r\n        }\r\n      } catch (err) {}\r\n    },\r\n    _dragStarted: function _dragStarted(fallback, evt) {\r\n  \r\n      awaitingDragStarted = false;\r\n  \r\n      if (rootEl && dragEl) {\r\n        pluginEvent('dragStarted', this, {\r\n          evt: evt\r\n        });\r\n  \r\n        if (this.nativeDraggable) {\r\n          on(document, 'dragover', _checkOutsideTargetEl);\r\n        }\r\n  \r\n        var options = this.options; // Apply effect\r\n  \r\n        !fallback && toggleClass(dragEl, options.dragClass, false);\r\n        toggleClass(dragEl, options.ghostClass, true);\r\n        Sortable.active = this;\r\n        fallback && this._appendGhost(); // Drag start event\r\n  \r\n        _dispatchEvent({\r\n          sortable: this,\r\n          name: 'start',\r\n          originalEvent: evt\r\n        });\r\n      } else {\r\n        this._nulling();\r\n      }\r\n    },\r\n    _emulateDragOver: function _emulateDragOver() {\r\n      if (touchEvt) {\r\n        this._lastX = touchEvt.clientX;\r\n        this._lastY = touchEvt.clientY;\r\n  \r\n        _hideGhostForTarget();\r\n  \r\n        var target = document.elementFromPoint(touchEvt.clientX, touchEvt.clientY);\r\n        var parent = target;\r\n  \r\n        while (target && target.shadowRoot) {\r\n          target = target.shadowRoot.elementFromPoint(touchEvt.clientX, touchEvt.clientY);\r\n          if (target === parent) break;\r\n          parent = target;\r\n        }\r\n  \r\n        dragEl.parentNode[expando]._isOutsideThisEl(target);\r\n  \r\n        if (parent) {\r\n          do {\r\n            if (parent[expando]) {\r\n              var inserted = void 0;\r\n              inserted = parent[expando]._onDragOver({\r\n                clientX: touchEvt.clientX,\r\n                clientY: touchEvt.clientY,\r\n                target: target,\r\n                rootEl: parent\r\n              });\r\n  \r\n              if (inserted && !this.options.dragoverBubble) {\r\n                break;\r\n              }\r\n            }\r\n  \r\n            target = parent; // store last element\r\n          }\r\n          /* jshint boss:true */\r\n          while (parent = parent.parentNode);\r\n        }\r\n  \r\n        _unhideGhostForTarget();\r\n      }\r\n    },\r\n    _onTouchMove: function _onTouchMove(\r\n    /**TouchEvent*/\r\n    evt) {\r\n      if (tapEvt) {\r\n        var options = this.options,\r\n            fallbackTolerance = options.fallbackTolerance,\r\n            fallbackOffset = options.fallbackOffset,\r\n            touch = evt.touches ? evt.touches[0] : evt,\r\n            ghostMatrix = ghostEl && matrix(ghostEl, true),\r\n            scaleX = ghostEl && ghostMatrix && ghostMatrix.a,\r\n            scaleY = ghostEl && ghostMatrix && ghostMatrix.d,\r\n            relativeScrollOffset = PositionGhostAbsolutely && ghostRelativeParent && getRelativeScrollOffset(ghostRelativeParent),\r\n            dx = (touch.clientX - tapEvt.clientX + fallbackOffset.x) / (scaleX || 1) + (relativeScrollOffset ? relativeScrollOffset[0] - ghostRelativeParentInitialScroll[0] : 0) / (scaleX || 1),\r\n            dy = (touch.clientY - tapEvt.clientY + fallbackOffset.y) / (scaleY || 1) + (relativeScrollOffset ? relativeScrollOffset[1] - ghostRelativeParentInitialScroll[1] : 0) / (scaleY || 1); // only set the status to dragging, when we are actually dragging\r\n  \r\n        if (!Sortable.active && !awaitingDragStarted) {\r\n          if (fallbackTolerance && Math.max(Math.abs(touch.clientX - this._lastX), Math.abs(touch.clientY - this._lastY)) < fallbackTolerance) {\r\n            return;\r\n          }\r\n  \r\n          this._onDragStart(evt, true);\r\n        }\r\n  \r\n        if (ghostEl) {\r\n          if (ghostMatrix) {\r\n            ghostMatrix.e += dx - (lastDx || 0);\r\n            ghostMatrix.f += dy - (lastDy || 0);\r\n          } else {\r\n            ghostMatrix = {\r\n              a: 1,\r\n              b: 0,\r\n              c: 0,\r\n              d: 1,\r\n              e: dx,\r\n              f: dy\r\n            };\r\n          }\r\n  \r\n          var cssMatrix = \"matrix(\".concat(ghostMatrix.a, \",\").concat(ghostMatrix.b, \",\").concat(ghostMatrix.c, \",\").concat(ghostMatrix.d, \",\").concat(ghostMatrix.e, \",\").concat(ghostMatrix.f, \")\");\r\n          css(ghostEl, 'webkitTransform', cssMatrix);\r\n          css(ghostEl, 'mozTransform', cssMatrix);\r\n          css(ghostEl, 'msTransform', cssMatrix);\r\n          css(ghostEl, 'transform', cssMatrix);\r\n          lastDx = dx;\r\n          lastDy = dy;\r\n          touchEvt = touch;\r\n        }\r\n  \r\n        evt.cancelable && evt.preventDefault();\r\n      }\r\n    },\r\n    _appendGhost: function _appendGhost() {\r\n      // Bug if using scale(): https://stackoverflow.com/questions/2637058\r\n      // Not being adjusted for\r\n      if (!ghostEl) {\r\n        var container = this.options.fallbackOnBody ? document.body : rootEl,\r\n            rect = getRect(dragEl, true, PositionGhostAbsolutely, true, container),\r\n            options = this.options; // Position absolutely\r\n  \r\n        if (PositionGhostAbsolutely) {\r\n          // Get relatively positioned parent\r\n          ghostRelativeParent = container;\r\n  \r\n          while (css(ghostRelativeParent, 'position') === 'static' && css(ghostRelativeParent, 'transform') === 'none' && ghostRelativeParent !== document) {\r\n            ghostRelativeParent = ghostRelativeParent.parentNode;\r\n          }\r\n  \r\n          if (ghostRelativeParent !== document.body && ghostRelativeParent !== document.documentElement) {\r\n            if (ghostRelativeParent === document) ghostRelativeParent = getWindowScrollingElement();\r\n            rect.top += ghostRelativeParent.scrollTop;\r\n            rect.left += ghostRelativeParent.scrollLeft;\r\n          } else {\r\n            ghostRelativeParent = getWindowScrollingElement();\r\n          }\r\n  \r\n          ghostRelativeParentInitialScroll = getRelativeScrollOffset(ghostRelativeParent);\r\n        }\r\n  \r\n        ghostEl = dragEl.cloneNode(true);\r\n        toggleClass(ghostEl, options.ghostClass, false);\r\n        toggleClass(ghostEl, options.fallbackClass, true);\r\n        toggleClass(ghostEl, options.dragClass, true);\r\n        css(ghostEl, 'transition', '');\r\n        css(ghostEl, 'transform', '');\r\n        css(ghostEl, 'box-sizing', 'border-box');\r\n        css(ghostEl, 'margin', 0);\r\n        css(ghostEl, 'top', rect.top);\r\n        css(ghostEl, 'left', rect.left);\r\n        css(ghostEl, 'width', rect.width);\r\n        css(ghostEl, 'height', rect.height);\r\n        css(ghostEl, 'opacity', '0.8');\r\n        css(ghostEl, 'position', PositionGhostAbsolutely ? 'absolute' : 'fixed');\r\n        css(ghostEl, 'zIndex', '100000');\r\n        css(ghostEl, 'pointerEvents', 'none');\r\n        Sortable.ghost = ghostEl;\r\n        container.appendChild(ghostEl); // Set transform-origin\r\n  \r\n        css(ghostEl, 'transform-origin', tapDistanceLeft / parseInt(ghostEl.style.width) * 100 + '% ' + tapDistanceTop / parseInt(ghostEl.style.height) * 100 + '%');\r\n      }\r\n    },\r\n    _onDragStart: function _onDragStart(\r\n    /**Event*/\r\n    evt,\r\n    /**boolean*/\r\n    fallback) {\r\n      var _this = this;\r\n  \r\n      var dataTransfer = evt.dataTransfer;\r\n      var options = _this.options;\r\n      pluginEvent('dragStart', this, {\r\n        evt: evt\r\n      });\r\n  \r\n      if (Sortable.eventCanceled) {\r\n        this._onDrop();\r\n  \r\n        return;\r\n      }\r\n  \r\n      pluginEvent('setupClone', this);\r\n  \r\n      if (!Sortable.eventCanceled) {\r\n        cloneEl = clone(dragEl);\r\n        cloneEl.removeAttribute(\"id\");\r\n        cloneEl.draggable = false;\r\n        cloneEl.style['will-change'] = '';\r\n  \r\n        this._hideClone();\r\n  \r\n        toggleClass(cloneEl, this.options.chosenClass, false);\r\n        Sortable.clone = cloneEl;\r\n      } // #1143: IFrame support workaround\r\n  \r\n  \r\n      _this.cloneId = _nextTick(function () {\r\n        pluginEvent('clone', _this);\r\n        if (Sortable.eventCanceled) return;\r\n  \r\n        if (!_this.options.removeCloneOnHide) {\r\n          rootEl.insertBefore(cloneEl, dragEl);\r\n        }\r\n  \r\n        _this._hideClone();\r\n  \r\n        _dispatchEvent({\r\n          sortable: _this,\r\n          name: 'clone'\r\n        });\r\n      });\r\n      !fallback && toggleClass(dragEl, options.dragClass, true); // Set proper drop events\r\n  \r\n      if (fallback) {\r\n        ignoreNextClick = true;\r\n        _this._loopId = setInterval(_this._emulateDragOver, 50);\r\n      } else {\r\n        // Undo what was set in _prepareDragStart before drag started\r\n        off(document, 'mouseup', _this._onDrop);\r\n        off(document, 'touchend', _this._onDrop);\r\n        off(document, 'touchcancel', _this._onDrop);\r\n  \r\n        if (dataTransfer) {\r\n          dataTransfer.effectAllowed = 'move';\r\n          options.setData && options.setData.call(_this, dataTransfer, dragEl);\r\n        }\r\n  \r\n        on(document, 'drop', _this); // #1276 fix:\r\n  \r\n        css(dragEl, 'transform', 'translateZ(0)');\r\n      }\r\n  \r\n      awaitingDragStarted = true;\r\n      _this._dragStartId = _nextTick(_this._dragStarted.bind(_this, fallback, evt));\r\n      on(document, 'selectstart', _this);\r\n      moved = true;\r\n  \r\n      if (Safari) {\r\n        css(document.body, 'user-select', 'none');\r\n      }\r\n    },\r\n    // Returns true - if no further action is needed (either inserted or another condition)\r\n    _onDragOver: function _onDragOver(\r\n    /**Event*/\r\n    evt) {\r\n      var el = this.el,\r\n          target = evt.target,\r\n          dragRect,\r\n          targetRect,\r\n          revert,\r\n          options = this.options,\r\n          group = options.group,\r\n          activeSortable = Sortable.active,\r\n          isOwner = activeGroup === group,\r\n          canSort = options.sort,\r\n          fromSortable = putSortable || activeSortable,\r\n          vertical,\r\n          _this = this,\r\n          completedFired = false;\r\n  \r\n      if (_silent) return;\r\n  \r\n      function dragOverEvent(name, extra) {\r\n        pluginEvent(name, _this, _objectSpread2({\r\n          evt: evt,\r\n          isOwner: isOwner,\r\n          axis: vertical ? 'vertical' : 'horizontal',\r\n          revert: revert,\r\n          dragRect: dragRect,\r\n          targetRect: targetRect,\r\n          canSort: canSort,\r\n          fromSortable: fromSortable,\r\n          target: target,\r\n          completed: completed,\r\n          onMove: function onMove(target, after) {\r\n            return _onMove(rootEl, el, dragEl, dragRect, target, getRect(target), evt, after);\r\n          },\r\n          changed: changed\r\n        }, extra));\r\n      } // Capture animation state\r\n  \r\n  \r\n      function capture() {\r\n        dragOverEvent('dragOverAnimationCapture');\r\n  \r\n        _this.captureAnimationState();\r\n  \r\n        if (_this !== fromSortable) {\r\n          fromSortable.captureAnimationState();\r\n        }\r\n      } // Return invocation when dragEl is inserted (or completed)\r\n  \r\n  \r\n      function completed(insertion) {\r\n        dragOverEvent('dragOverCompleted', {\r\n          insertion: insertion\r\n        });\r\n  \r\n        if (insertion) {\r\n          // Clones must be hidden before folding animation to capture dragRectAbsolute properly\r\n          if (isOwner) {\r\n            activeSortable._hideClone();\r\n          } else {\r\n            activeSortable._showClone(_this);\r\n          }\r\n  \r\n          if (_this !== fromSortable) {\r\n            // Set ghost class to new sortable's ghost class\r\n            toggleClass(dragEl, putSortable ? putSortable.options.ghostClass : activeSortable.options.ghostClass, false);\r\n            toggleClass(dragEl, options.ghostClass, true);\r\n          }\r\n  \r\n          if (putSortable !== _this && _this !== Sortable.active) {\r\n            putSortable = _this;\r\n          } else if (_this === Sortable.active && putSortable) {\r\n            putSortable = null;\r\n          } // Animation\r\n  \r\n  \r\n          if (fromSortable === _this) {\r\n            _this._ignoreWhileAnimating = target;\r\n          }\r\n  \r\n          _this.animateAll(function () {\r\n            dragOverEvent('dragOverAnimationComplete');\r\n            _this._ignoreWhileAnimating = null;\r\n          });\r\n  \r\n          if (_this !== fromSortable) {\r\n            fromSortable.animateAll();\r\n            fromSortable._ignoreWhileAnimating = null;\r\n          }\r\n        } // Null lastTarget if it is not inside a previously swapped element\r\n  \r\n  \r\n        if (target === dragEl && !dragEl.animated || target === el && !target.animated) {\r\n          lastTarget = null;\r\n        } // no bubbling and not fallback\r\n  \r\n  \r\n        if (!options.dragoverBubble && !evt.rootEl && target !== document) {\r\n          dragEl.parentNode[expando]._isOutsideThisEl(evt.target); // Do not detect for empty insert if already inserted\r\n  \r\n  \r\n          !insertion && nearestEmptyInsertDetectEvent(evt);\r\n        }\r\n  \r\n        !options.dragoverBubble && evt.stopPropagation && evt.stopPropagation();\r\n        return completedFired = true;\r\n      } // Call when dragEl has been inserted\r\n  \r\n  \r\n      function changed() {\r\n        newIndex = index(dragEl);\r\n        newDraggableIndex = index(dragEl, options.draggable);\r\n  \r\n        _dispatchEvent({\r\n          sortable: _this,\r\n          name: 'change',\r\n          toEl: el,\r\n          newIndex: newIndex,\r\n          newDraggableIndex: newDraggableIndex,\r\n          originalEvent: evt\r\n        });\r\n      }\r\n  \r\n      if (evt.preventDefault !== void 0) {\r\n        evt.cancelable && evt.preventDefault();\r\n      }\r\n  \r\n      target = closest(target, options.draggable, el, true);\r\n      dragOverEvent('dragOver');\r\n      if (Sortable.eventCanceled) return completedFired;\r\n  \r\n      if (dragEl.contains(evt.target) || target.animated && target.animatingX && target.animatingY || _this._ignoreWhileAnimating === target) {\r\n        return completed(false);\r\n      }\r\n  \r\n      ignoreNextClick = false;\r\n  \r\n      if (activeSortable && !options.disabled && (isOwner ? canSort || (revert = parentEl !== rootEl) // Reverting item into the original list\r\n      : putSortable === this || (this.lastPutMode = activeGroup.checkPull(this, activeSortable, dragEl, evt)) && group.checkPut(this, activeSortable, dragEl, evt))) {\r\n        vertical = this._getDirection(evt, target) === 'vertical';\r\n        dragRect = getRect(dragEl);\r\n        dragOverEvent('dragOverValid');\r\n        if (Sortable.eventCanceled) return completedFired;\r\n  \r\n        if (revert) {\r\n          parentEl = rootEl; // actualization\r\n  \r\n          capture();\r\n  \r\n          this._hideClone();\r\n  \r\n          dragOverEvent('revert');\r\n  \r\n          if (!Sortable.eventCanceled) {\r\n            if (nextEl) {\r\n              rootEl.insertBefore(dragEl, nextEl);\r\n            } else {\r\n              rootEl.appendChild(dragEl);\r\n            }\r\n          }\r\n  \r\n          return completed(true);\r\n        }\r\n  \r\n        var elLastChild = lastChild(el, options.draggable);\r\n  \r\n        if (!elLastChild || _ghostIsLast(evt, vertical, this) && !elLastChild.animated) {\r\n          // Insert to end of list\r\n          // If already at end of list: Do not insert\r\n          if (elLastChild === dragEl) {\r\n            return completed(false);\r\n          } // if there is a last element, it is the target\r\n  \r\n  \r\n          if (elLastChild && el === evt.target) {\r\n            target = elLastChild;\r\n          }\r\n  \r\n          if (target) {\r\n            targetRect = getRect(target);\r\n          }\r\n  \r\n          if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, !!target) !== false) {\r\n            capture();\r\n  \r\n            if (elLastChild && elLastChild.nextSibling) {\r\n              // the last draggable element is not the last node\r\n              el.insertBefore(dragEl, elLastChild.nextSibling);\r\n            } else {\r\n              el.appendChild(dragEl);\r\n            }\r\n  \r\n            parentEl = el; // actualization\r\n  \r\n            changed();\r\n            return completed(true);\r\n          }\r\n        } else if (elLastChild && _ghostIsFirst(evt, vertical, this)) {\r\n          // Insert to start of list\r\n          var firstChild = getChild(el, 0, options, true);\r\n  \r\n          if (firstChild === dragEl) {\r\n            return completed(false);\r\n          }\r\n  \r\n          target = firstChild;\r\n          targetRect = getRect(target);\r\n  \r\n          if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, false) !== false) {\r\n            capture();\r\n            el.insertBefore(dragEl, firstChild);\r\n            parentEl = el; // actualization\r\n  \r\n            changed();\r\n            return completed(true);\r\n          }\r\n        } else if (target.parentNode === el) {\r\n          targetRect = getRect(target);\r\n          var direction = 0,\r\n              targetBeforeFirstSwap,\r\n              differentLevel = dragEl.parentNode !== el,\r\n              differentRowCol = !_dragElInRowColumn(dragEl.animated && dragEl.toRect || dragRect, target.animated && target.toRect || targetRect, vertical),\r\n              side1 = vertical ? 'top' : 'left',\r\n              scrolledPastTop = isScrolledPast(target, 'top', 'top') || isScrolledPast(dragEl, 'top', 'top'),\r\n              scrollBefore = scrolledPastTop ? scrolledPastTop.scrollTop : void 0;\r\n  \r\n          if (lastTarget !== target) {\r\n            targetBeforeFirstSwap = targetRect[side1];\r\n            pastFirstInvertThresh = false;\r\n            isCircumstantialInvert = !differentRowCol && options.invertSwap || differentLevel;\r\n          }\r\n  \r\n          direction = _getSwapDirection(evt, target, targetRect, vertical, differentRowCol ? 1 : options.swapThreshold, options.invertedSwapThreshold == null ? options.swapThreshold : options.invertedSwapThreshold, isCircumstantialInvert, lastTarget === target);\r\n          var sibling;\r\n  \r\n          if (direction !== 0) {\r\n            // Check if target is beside dragEl in respective direction (ignoring hidden elements)\r\n            var dragIndex = index(dragEl);\r\n  \r\n            do {\r\n              dragIndex -= direction;\r\n              sibling = parentEl.children[dragIndex];\r\n            } while (sibling && (css(sibling, 'display') === 'none' || sibling === ghostEl));\r\n          } // If dragEl is already beside target: Do not insert\r\n  \r\n  \r\n          if (direction === 0 || sibling === target) {\r\n            return completed(false);\r\n          }\r\n  \r\n          lastTarget = target;\r\n          lastDirection = direction;\r\n          var nextSibling = target.nextElementSibling,\r\n              after = false;\r\n          after = direction === 1;\r\n  \r\n          var moveVector = _onMove(rootEl, el, dragEl, dragRect, target, targetRect, evt, after);\r\n  \r\n          if (moveVector !== false) {\r\n            if (moveVector === 1 || moveVector === -1) {\r\n              after = moveVector === 1;\r\n            }\r\n  \r\n            _silent = true;\r\n            setTimeout(_unsilent, 30);\r\n            capture();\r\n  \r\n            if (after && !nextSibling) {\r\n              el.appendChild(dragEl);\r\n            } else {\r\n              target.parentNode.insertBefore(dragEl, after ? nextSibling : target);\r\n            } // Undo chrome's scroll adjustment (has no effect on other browsers)\r\n  \r\n  \r\n            if (scrolledPastTop) {\r\n              scrollBy(scrolledPastTop, 0, scrollBefore - scrolledPastTop.scrollTop);\r\n            }\r\n  \r\n            parentEl = dragEl.parentNode; // actualization\r\n            // must be done before animation\r\n  \r\n            if (targetBeforeFirstSwap !== undefined && !isCircumstantialInvert) {\r\n              targetMoveDistance = Math.abs(targetBeforeFirstSwap - getRect(target)[side1]);\r\n            }\r\n  \r\n            changed();\r\n            return completed(true);\r\n          }\r\n        }\r\n  \r\n        if (el.contains(dragEl)) {\r\n          return completed(false);\r\n        }\r\n      }\r\n  \r\n      return false;\r\n    },\r\n    _ignoreWhileAnimating: null,\r\n    _offMoveEvents: function _offMoveEvents() {\r\n      off(document, 'mousemove', this._onTouchMove);\r\n      off(document, 'touchmove', this._onTouchMove);\r\n      off(document, 'pointermove', this._onTouchMove);\r\n      off(document, 'dragover', nearestEmptyInsertDetectEvent);\r\n      off(document, 'mousemove', nearestEmptyInsertDetectEvent);\r\n      off(document, 'touchmove', nearestEmptyInsertDetectEvent);\r\n    },\r\n    _offUpEvents: function _offUpEvents() {\r\n      var ownerDocument = this.el.ownerDocument;\r\n      off(ownerDocument, 'mouseup', this._onDrop);\r\n      off(ownerDocument, 'touchend', this._onDrop);\r\n      off(ownerDocument, 'pointerup', this._onDrop);\r\n      off(ownerDocument, 'touchcancel', this._onDrop);\r\n      off(document, 'selectstart', this);\r\n    },\r\n    _onDrop: function _onDrop(\r\n    /**Event*/\r\n    evt) {\r\n      var el = this.el,\r\n          options = this.options; // Get the index of the dragged element within its parent\r\n  \r\n      newIndex = index(dragEl);\r\n      newDraggableIndex = index(dragEl, options.draggable);\r\n      pluginEvent('drop', this, {\r\n        evt: evt\r\n      });\r\n      parentEl = dragEl && dragEl.parentNode; // Get again after plugin event\r\n  \r\n      newIndex = index(dragEl);\r\n      newDraggableIndex = index(dragEl, options.draggable);\r\n  \r\n      if (Sortable.eventCanceled) {\r\n        this._nulling();\r\n  \r\n        return;\r\n      }\r\n  \r\n      awaitingDragStarted = false;\r\n      isCircumstantialInvert = false;\r\n      pastFirstInvertThresh = false;\r\n      clearInterval(this._loopId);\r\n      clearTimeout(this._dragStartTimer);\r\n  \r\n      _cancelNextTick(this.cloneId);\r\n  \r\n      _cancelNextTick(this._dragStartId); // Unbind events\r\n  \r\n  \r\n      if (this.nativeDraggable) {\r\n        off(document, 'drop', this);\r\n        off(el, 'dragstart', this._onDragStart);\r\n      }\r\n  \r\n      this._offMoveEvents();\r\n  \r\n      this._offUpEvents();\r\n  \r\n      if (Safari) {\r\n        css(document.body, 'user-select', '');\r\n      }\r\n  \r\n      css(dragEl, 'transform', '');\r\n  \r\n      if (evt) {\r\n        if (moved) {\r\n          evt.cancelable && evt.preventDefault();\r\n          !options.dropBubble && evt.stopPropagation();\r\n        }\r\n  \r\n        ghostEl && ghostEl.parentNode && ghostEl.parentNode.removeChild(ghostEl);\r\n  \r\n        if (rootEl === parentEl || putSortable && putSortable.lastPutMode !== 'clone') {\r\n          // Remove clone(s)\r\n          cloneEl && cloneEl.parentNode && cloneEl.parentNode.removeChild(cloneEl);\r\n        }\r\n  \r\n        if (dragEl) {\r\n          if (this.nativeDraggable) {\r\n            off(dragEl, 'dragend', this);\r\n          }\r\n  \r\n          _disableDraggable(dragEl);\r\n  \r\n          dragEl.style['will-change'] = ''; // Remove classes\r\n          // ghostClass is added in dragStarted\r\n  \r\n          if (moved && !awaitingDragStarted) {\r\n            toggleClass(dragEl, putSortable ? putSortable.options.ghostClass : this.options.ghostClass, false);\r\n          }\r\n  \r\n          toggleClass(dragEl, this.options.chosenClass, false); // Drag stop event\r\n  \r\n          _dispatchEvent({\r\n            sortable: this,\r\n            name: 'unchoose',\r\n            toEl: parentEl,\r\n            newIndex: null,\r\n            newDraggableIndex: null,\r\n            originalEvent: evt\r\n          });\r\n  \r\n          if (rootEl !== parentEl) {\r\n            if (newIndex >= 0) {\r\n              // Add event\r\n              _dispatchEvent({\r\n                rootEl: parentEl,\r\n                name: 'add',\r\n                toEl: parentEl,\r\n                fromEl: rootEl,\r\n                originalEvent: evt\r\n              }); // Remove event\r\n  \r\n  \r\n              _dispatchEvent({\r\n                sortable: this,\r\n                name: 'remove',\r\n                toEl: parentEl,\r\n                originalEvent: evt\r\n              }); // drag from one list and drop into another\r\n  \r\n  \r\n              _dispatchEvent({\r\n                rootEl: parentEl,\r\n                name: 'sort',\r\n                toEl: parentEl,\r\n                fromEl: rootEl,\r\n                originalEvent: evt\r\n              });\r\n  \r\n              _dispatchEvent({\r\n                sortable: this,\r\n                name: 'sort',\r\n                toEl: parentEl,\r\n                originalEvent: evt\r\n              });\r\n            }\r\n  \r\n            putSortable && putSortable.save();\r\n          } else {\r\n            if (newIndex !== oldIndex) {\r\n              if (newIndex >= 0) {\r\n                // drag & drop within the same list\r\n                _dispatchEvent({\r\n                  sortable: this,\r\n                  name: 'update',\r\n                  toEl: parentEl,\r\n                  originalEvent: evt\r\n                });\r\n  \r\n                _dispatchEvent({\r\n                  sortable: this,\r\n                  name: 'sort',\r\n                  toEl: parentEl,\r\n                  originalEvent: evt\r\n                });\r\n              }\r\n            }\r\n          }\r\n  \r\n          if (Sortable.active) {\r\n            /* jshint eqnull:true */\r\n            if (newIndex == null || newIndex === -1) {\r\n              newIndex = oldIndex;\r\n              newDraggableIndex = oldDraggableIndex;\r\n            }\r\n  \r\n            _dispatchEvent({\r\n              sortable: this,\r\n              name: 'end',\r\n              toEl: parentEl,\r\n              originalEvent: evt\r\n            }); // Save sorting\r\n  \r\n  \r\n            this.save();\r\n          }\r\n        }\r\n      }\r\n  \r\n      this._nulling();\r\n    },\r\n    _nulling: function _nulling() {\r\n      pluginEvent('nulling', this);\r\n      rootEl = dragEl = parentEl = ghostEl = nextEl = cloneEl = lastDownEl = cloneHidden = tapEvt = touchEvt = moved = newIndex = newDraggableIndex = oldIndex = oldDraggableIndex = lastTarget = lastDirection = putSortable = activeGroup = Sortable.dragged = Sortable.ghost = Sortable.clone = Sortable.active = null;\r\n      savedInputChecked.forEach(function (el) {\r\n        el.checked = true;\r\n      });\r\n      savedInputChecked.length = lastDx = lastDy = 0;\r\n    },\r\n    handleEvent: function handleEvent(\r\n    /**Event*/\r\n    evt) {\r\n      switch (evt.type) {\r\n        case 'drop':\r\n        case 'dragend':\r\n          this._onDrop(evt);\r\n  \r\n          break;\r\n  \r\n        case 'dragenter':\r\n        case 'dragover':\r\n          if (dragEl) {\r\n            this._onDragOver(evt);\r\n  \r\n            _globalDragOver(evt);\r\n          }\r\n  \r\n          break;\r\n  \r\n        case 'selectstart':\r\n          evt.preventDefault();\r\n          break;\r\n      }\r\n    },\r\n  \r\n    /**\r\n     * Serializes the item into an array of string.\r\n     * @returns {String[]}\r\n     */\r\n    toArray: function toArray() {\r\n      var order = [],\r\n          el,\r\n          children = this.el.children,\r\n          i = 0,\r\n          n = children.length,\r\n          options = this.options;\r\n  \r\n      for (; i < n; i++) {\r\n        el = children[i];\r\n  \r\n        if (closest(el, options.draggable, this.el, false)) {\r\n          order.push(el.getAttribute(options.dataIdAttr) || _generateId(el));\r\n        }\r\n      }\r\n  \r\n      return order;\r\n    },\r\n  \r\n    /**\r\n     * Sorts the elements according to the array.\r\n     * @param  {String[]}  order  order of the items\r\n     */\r\n    sort: function sort(order, useAnimation) {\r\n      var items = {},\r\n          rootEl = this.el;\r\n      this.toArray().forEach(function (id, i) {\r\n        var el = rootEl.children[i];\r\n  \r\n        if (closest(el, this.options.draggable, rootEl, false)) {\r\n          items[id] = el;\r\n        }\r\n      }, this);\r\n      useAnimation && this.captureAnimationState();\r\n      order.forEach(function (id) {\r\n        if (items[id]) {\r\n          rootEl.removeChild(items[id]);\r\n          rootEl.appendChild(items[id]);\r\n        }\r\n      });\r\n      useAnimation && this.animateAll();\r\n    },\r\n  \r\n    /**\r\n     * Save the current sorting\r\n     */\r\n    save: function save() {\r\n      var store = this.options.store;\r\n      store && store.set && store.set(this);\r\n    },\r\n  \r\n    /**\r\n     * For each element in the set, get the first element that matches the selector by testing the element itself and traversing up through its ancestors in the DOM tree.\r\n     * @param   {HTMLElement}  el\r\n     * @param   {String}       [selector]  default: `options.draggable`\r\n     * @returns {HTMLElement|null}\r\n     */\r\n    closest: function closest$1(el, selector) {\r\n      return closest(el, selector || this.options.draggable, this.el, false);\r\n    },\r\n  \r\n    /**\r\n     * Set/get option\r\n     * @param   {string} name\r\n     * @param   {*}      [value]\r\n     * @returns {*}\r\n     */\r\n    option: function option(name, value) {\r\n      var options = this.options;\r\n  \r\n      if (value === void 0) {\r\n        return options[name];\r\n      } else {\r\n        var modifiedValue = PluginManager.modifyOption(this, name, value);\r\n  \r\n        if (typeof modifiedValue !== 'undefined') {\r\n          options[name] = modifiedValue;\r\n        } else {\r\n          options[name] = value;\r\n        }\r\n  \r\n        if (name === 'group') {\r\n          _prepareGroup(options);\r\n        }\r\n      }\r\n    },\r\n  \r\n    /**\r\n     * Destroy\r\n     */\r\n    destroy: function destroy() {\r\n      pluginEvent('destroy', this);\r\n      var el = this.el;\r\n      el[expando] = null;\r\n      off(el, 'mousedown', this._onTapStart);\r\n      off(el, 'touchstart', this._onTapStart);\r\n      off(el, 'pointerdown', this._onTapStart);\r\n  \r\n      if (this.nativeDraggable) {\r\n        off(el, 'dragover', this);\r\n        off(el, 'dragenter', this);\r\n      } // Remove draggable attributes\r\n  \r\n  \r\n      Array.prototype.forEach.call(el.querySelectorAll('[draggable]'), function (el) {\r\n        el.removeAttribute('draggable');\r\n      });\r\n  \r\n      this._onDrop();\r\n  \r\n      this._disableDelayedDragEvents();\r\n  \r\n      sortables.splice(sortables.indexOf(this.el), 1);\r\n      this.el = el = null;\r\n    },\r\n    _hideClone: function _hideClone() {\r\n      if (!cloneHidden) {\r\n        pluginEvent('hideClone', this);\r\n        if (Sortable.eventCanceled) return;\r\n        css(cloneEl, 'display', 'none');\r\n  \r\n        if (this.options.removeCloneOnHide && cloneEl.parentNode) {\r\n          cloneEl.parentNode.removeChild(cloneEl);\r\n        }\r\n  \r\n        cloneHidden = true;\r\n      }\r\n    },\r\n    _showClone: function _showClone(putSortable) {\r\n      if (putSortable.lastPutMode !== 'clone') {\r\n        this._hideClone();\r\n  \r\n        return;\r\n      }\r\n  \r\n      if (cloneHidden) {\r\n        pluginEvent('showClone', this);\r\n        if (Sortable.eventCanceled) return; // show clone at dragEl or original position\r\n  \r\n        if (dragEl.parentNode == rootEl && !this.options.group.revertClone) {\r\n          rootEl.insertBefore(cloneEl, dragEl);\r\n        } else if (nextEl) {\r\n          rootEl.insertBefore(cloneEl, nextEl);\r\n        } else {\r\n          rootEl.appendChild(cloneEl);\r\n        }\r\n  \r\n        if (this.options.group.revertClone) {\r\n          this.animate(dragEl, cloneEl);\r\n        }\r\n  \r\n        css(cloneEl, 'display', '');\r\n        cloneHidden = false;\r\n      }\r\n    }\r\n  };\r\n  \r\n  function _globalDragOver(\r\n  /**Event*/\r\n  evt) {\r\n    if (evt.dataTransfer) {\r\n      evt.dataTransfer.dropEffect = 'move';\r\n    }\r\n  \r\n    evt.cancelable && evt.preventDefault();\r\n  }\r\n  \r\n  function _onMove(fromEl, toEl, dragEl, dragRect, targetEl, targetRect, originalEvent, willInsertAfter) {\r\n    var evt,\r\n        sortable = fromEl[expando],\r\n        onMoveFn = sortable.options.onMove,\r\n        retVal; // Support for new CustomEvent feature\r\n  \r\n    if (window.CustomEvent && !IE11OrLess && !Edge) {\r\n      evt = new CustomEvent('move', {\r\n        bubbles: true,\r\n        cancelable: true\r\n      });\r\n    } else {\r\n      evt = document.createEvent('Event');\r\n      evt.initEvent('move', true, true);\r\n    }\r\n  \r\n    evt.to = toEl;\r\n    evt.from = fromEl;\r\n    evt.dragged = dragEl;\r\n    evt.draggedRect = dragRect;\r\n    evt.related = targetEl || toEl;\r\n    evt.relatedRect = targetRect || getRect(toEl);\r\n    evt.willInsertAfter = willInsertAfter;\r\n    evt.originalEvent = originalEvent;\r\n    fromEl.dispatchEvent(evt);\r\n  \r\n    if (onMoveFn) {\r\n      retVal = onMoveFn.call(sortable, evt, originalEvent);\r\n    }\r\n  \r\n    return retVal;\r\n  }\r\n  \r\n  function _disableDraggable(el) {\r\n    el.draggable = false;\r\n  }\r\n  \r\n  function _unsilent() {\r\n    _silent = false;\r\n  }\r\n  \r\n  function _ghostIsFirst(evt, vertical, sortable) {\r\n    var rect = getRect(getChild(sortable.el, 0, sortable.options, true));\r\n    var spacer = 10;\r\n    return vertical ? evt.clientX < rect.left - spacer || evt.clientY < rect.top && evt.clientX < rect.right : evt.clientY < rect.top - spacer || evt.clientY < rect.bottom && evt.clientX < rect.left;\r\n  }\r\n  \r\n  function _ghostIsLast(evt, vertical, sortable) {\r\n    var rect = getRect(lastChild(sortable.el, sortable.options.draggable));\r\n    var spacer = 10;\r\n    return vertical ? evt.clientX > rect.right + spacer || evt.clientX <= rect.right && evt.clientY > rect.bottom && evt.clientX >= rect.left : evt.clientX > rect.right && evt.clientY > rect.top || evt.clientX <= rect.right && evt.clientY > rect.bottom + spacer;\r\n  }\r\n  \r\n  function _getSwapDirection(evt, target, targetRect, vertical, swapThreshold, invertedSwapThreshold, invertSwap, isLastTarget) {\r\n    var mouseOnAxis = vertical ? evt.clientY : evt.clientX,\r\n        targetLength = vertical ? targetRect.height : targetRect.width,\r\n        targetS1 = vertical ? targetRect.top : targetRect.left,\r\n        targetS2 = vertical ? targetRect.bottom : targetRect.right,\r\n        invert = false;\r\n  \r\n    if (!invertSwap) {\r\n      // Never invert or create dragEl shadow when target movemenet causes mouse to move past the end of regular swapThreshold\r\n      if (isLastTarget && targetMoveDistance < targetLength * swapThreshold) {\r\n        // multiplied only by swapThreshold because mouse will already be inside target by (1 - threshold) * targetLength / 2\r\n        // check if past first invert threshold on side opposite of lastDirection\r\n        if (!pastFirstInvertThresh && (lastDirection === 1 ? mouseOnAxis > targetS1 + targetLength * invertedSwapThreshold / 2 : mouseOnAxis < targetS2 - targetLength * invertedSwapThreshold / 2)) {\r\n          // past first invert threshold, do not restrict inverted threshold to dragEl shadow\r\n          pastFirstInvertThresh = true;\r\n        }\r\n  \r\n        if (!pastFirstInvertThresh) {\r\n          // dragEl shadow (target move distance shadow)\r\n          if (lastDirection === 1 ? mouseOnAxis < targetS1 + targetMoveDistance // over dragEl shadow\r\n          : mouseOnAxis > targetS2 - targetMoveDistance) {\r\n            return -lastDirection;\r\n          }\r\n        } else {\r\n          invert = true;\r\n        }\r\n      } else {\r\n        // Regular\r\n        if (mouseOnAxis > targetS1 + targetLength * (1 - swapThreshold) / 2 && mouseOnAxis < targetS2 - targetLength * (1 - swapThreshold) / 2) {\r\n          return _getInsertDirection(target);\r\n        }\r\n      }\r\n    }\r\n  \r\n    invert = invert || invertSwap;\r\n  \r\n    if (invert) {\r\n      // Invert of regular\r\n      if (mouseOnAxis < targetS1 + targetLength * invertedSwapThreshold / 2 || mouseOnAxis > targetS2 - targetLength * invertedSwapThreshold / 2) {\r\n        return mouseOnAxis > targetS1 + targetLength / 2 ? 1 : -1;\r\n      }\r\n    }\r\n  \r\n    return 0;\r\n  }\r\n  /**\r\n   * Gets the direction dragEl must be swapped relative to target in order to make it\r\n   * seem that dragEl has been \"inserted\" into that element's position\r\n   * @param  {HTMLElement} target       The target whose position dragEl is being inserted at\r\n   * @return {Number}                   Direction dragEl must be swapped\r\n   */\r\n  \r\n  \r\n  function _getInsertDirection(target) {\r\n    if (index(dragEl) < index(target)) {\r\n      return 1;\r\n    } else {\r\n      return -1;\r\n    }\r\n  }\r\n  /**\r\n   * Generate id\r\n   * @param   {HTMLElement} el\r\n   * @returns {String}\r\n   * @private\r\n   */\r\n  \r\n  \r\n  function _generateId(el) {\r\n    var str = el.tagName + el.className + el.src + el.href + el.textContent,\r\n        i = str.length,\r\n        sum = 0;\r\n  \r\n    while (i--) {\r\n      sum += str.charCodeAt(i);\r\n    }\r\n  \r\n    return sum.toString(36);\r\n  }\r\n  \r\n  function _saveInputCheckedState(root) {\r\n    savedInputChecked.length = 0;\r\n    var inputs = root.getElementsByTagName('input');\r\n    var idx = inputs.length;\r\n  \r\n    while (idx--) {\r\n      var el = inputs[idx];\r\n      el.checked && savedInputChecked.push(el);\r\n    }\r\n  }\r\n  \r\n  function _nextTick(fn) {\r\n    return setTimeout(fn, 0);\r\n  }\r\n  \r\n  function _cancelNextTick(id) {\r\n    return clearTimeout(id);\r\n  } // Fixed #973:\r\n  \r\n  \r\n  if (documentExists) {\r\n    on(document, 'touchmove', function (evt) {\r\n      if ((Sortable.active || awaitingDragStarted) && evt.cancelable) {\r\n        evt.preventDefault();\r\n      }\r\n    });\r\n  } // Export utils\r\n  \r\n  \r\n  Sortable.utils = {\r\n    on: on,\r\n    off: off,\r\n    css: css,\r\n    find: find,\r\n    is: function is(el, selector) {\r\n      return !!closest(el, selector, el, false);\r\n    },\r\n    extend: extend,\r\n    throttle: throttle,\r\n    closest: closest,\r\n    toggleClass: toggleClass,\r\n    clone: clone,\r\n    index: index,\r\n    nextTick: _nextTick,\r\n    cancelNextTick: _cancelNextTick,\r\n    detectDirection: _detectDirection,\r\n    getChild: getChild\r\n  };\r\n  /**\r\n   * Get the Sortable instance of an element\r\n   * @param  {HTMLElement} element The element\r\n   * @return {Sortable|undefined}         The instance of Sortable\r\n   */\r\n  \r\n  Sortable.get = function (element) {\r\n    return element[expando];\r\n  };\r\n  /**\r\n   * Mount a plugin to Sortable\r\n   * @param  {...SortablePlugin|SortablePlugin[]} plugins       Plugins being mounted\r\n   */\r\n  \r\n  \r\n  Sortable.mount = function () {\r\n    for (var _len = arguments.length, plugins = new Array(_len), _key = 0; _key < _len; _key++) {\r\n      plugins[_key] = arguments[_key];\r\n    }\r\n  \r\n    if (plugins[0].constructor === Array) plugins = plugins[0];\r\n    plugins.forEach(function (plugin) {\r\n      if (!plugin.prototype || !plugin.prototype.constructor) {\r\n        throw \"Sortable: Mounted plugin must be a constructor function, not \".concat({}.toString.call(plugin));\r\n      }\r\n  \r\n      if (plugin.utils) Sortable.utils = _objectSpread2(_objectSpread2({}, Sortable.utils), plugin.utils);\r\n      PluginManager.mount(plugin);\r\n    });\r\n  };\r\n  /**\r\n   * Create sortable instance\r\n   * @param {HTMLElement}  el\r\n   * @param {Object}      [options]\r\n   */\r\n  \r\n  \r\n  Sortable.create = function (el, options) {\r\n    return new Sortable(el, options);\r\n  }; // Export\r\n  \r\n  \r\n  Sortable.version = version;\r\n  \r\n  var autoScrolls = [],\r\n      scrollEl,\r\n      scrollRootEl,\r\n      scrolling = false,\r\n      lastAutoScrollX,\r\n      lastAutoScrollY,\r\n      touchEvt$1,\r\n      pointerElemChangedInterval;\r\n  \r\n  function AutoScrollPlugin() {\r\n    function AutoScroll() {\r\n      this.defaults = {\r\n        scroll: true,\r\n        forceAutoScrollFallback: false,\r\n        scrollSensitivity: 30,\r\n        scrollSpeed: 10,\r\n        bubbleScroll: true\r\n      }; // Bind all private methods\r\n  \r\n      for (var fn in this) {\r\n        if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {\r\n          this[fn] = this[fn].bind(this);\r\n        }\r\n      }\r\n    }\r\n  \r\n    AutoScroll.prototype = {\r\n      dragStarted: function dragStarted(_ref) {\r\n        var originalEvent = _ref.originalEvent;\r\n  \r\n        if (this.sortable.nativeDraggable) {\r\n          on(document, 'dragover', this._handleAutoScroll);\r\n        } else {\r\n          if (this.options.supportPointer) {\r\n            on(document, 'pointermove', this._handleFallbackAutoScroll);\r\n          } else if (originalEvent.touches) {\r\n            on(document, 'touchmove', this._handleFallbackAutoScroll);\r\n          } else {\r\n            on(document, 'mousemove', this._handleFallbackAutoScroll);\r\n          }\r\n        }\r\n      },\r\n      dragOverCompleted: function dragOverCompleted(_ref2) {\r\n        var originalEvent = _ref2.originalEvent;\r\n  \r\n        // For when bubbling is canceled and using fallback (fallback 'touchmove' always reached)\r\n        if (!this.options.dragOverBubble && !originalEvent.rootEl) {\r\n          this._handleAutoScroll(originalEvent);\r\n        }\r\n      },\r\n      drop: function drop() {\r\n        if (this.sortable.nativeDraggable) {\r\n          off(document, 'dragover', this._handleAutoScroll);\r\n        } else {\r\n          off(document, 'pointermove', this._handleFallbackAutoScroll);\r\n          off(document, 'touchmove', this._handleFallbackAutoScroll);\r\n          off(document, 'mousemove', this._handleFallbackAutoScroll);\r\n        }\r\n  \r\n        clearPointerElemChangedInterval();\r\n        clearAutoScrolls();\r\n        cancelThrottle();\r\n      },\r\n      nulling: function nulling() {\r\n        touchEvt$1 = scrollRootEl = scrollEl = scrolling = pointerElemChangedInterval = lastAutoScrollX = lastAutoScrollY = null;\r\n        autoScrolls.length = 0;\r\n      },\r\n      _handleFallbackAutoScroll: function _handleFallbackAutoScroll(evt) {\r\n        this._handleAutoScroll(evt, true);\r\n      },\r\n      _handleAutoScroll: function _handleAutoScroll(evt, fallback) {\r\n        var _this = this;\r\n  \r\n        var x = (evt.touches ? evt.touches[0] : evt).clientX,\r\n            y = (evt.touches ? evt.touches[0] : evt).clientY,\r\n            elem = document.elementFromPoint(x, y);\r\n        touchEvt$1 = evt; // IE does not seem to have native autoscroll,\r\n        // Edge's autoscroll seems too conditional,\r\n        // MACOS Safari does not have autoscroll,\r\n        // Firefox and Chrome are good\r\n  \r\n        if (fallback || this.options.forceAutoScrollFallback || Edge || IE11OrLess || Safari) {\r\n          autoScroll(evt, this.options, elem, fallback); // Listener for pointer element change\r\n  \r\n          var ogElemScroller = getParentAutoScrollElement(elem, true);\r\n  \r\n          if (scrolling && (!pointerElemChangedInterval || x !== lastAutoScrollX || y !== lastAutoScrollY)) {\r\n            pointerElemChangedInterval && clearPointerElemChangedInterval(); // Detect for pointer elem change, emulating native DnD behaviour\r\n  \r\n            pointerElemChangedInterval = setInterval(function () {\r\n              var newElem = getParentAutoScrollElement(document.elementFromPoint(x, y), true);\r\n  \r\n              if (newElem !== ogElemScroller) {\r\n                ogElemScroller = newElem;\r\n                clearAutoScrolls();\r\n              }\r\n  \r\n              autoScroll(evt, _this.options, newElem, fallback);\r\n            }, 10);\r\n            lastAutoScrollX = x;\r\n            lastAutoScrollY = y;\r\n          }\r\n        } else {\r\n          // if DnD is enabled (and browser has good autoscrolling), first autoscroll will already scroll, so get parent autoscroll of first autoscroll\r\n          if (!this.options.bubbleScroll || getParentAutoScrollElement(elem, true) === getWindowScrollingElement()) {\r\n            clearAutoScrolls();\r\n            return;\r\n          }\r\n  \r\n          autoScroll(evt, this.options, getParentAutoScrollElement(elem, false), false);\r\n        }\r\n      }\r\n    };\r\n    return _extends(AutoScroll, {\r\n      pluginName: 'scroll',\r\n      initializeByDefault: true\r\n    });\r\n  }\r\n  \r\n  function clearAutoScrolls() {\r\n    autoScrolls.forEach(function (autoScroll) {\r\n      clearInterval(autoScroll.pid);\r\n    });\r\n    autoScrolls = [];\r\n  }\r\n  \r\n  function clearPointerElemChangedInterval() {\r\n    clearInterval(pointerElemChangedInterval);\r\n  }\r\n  \r\n  var autoScroll = throttle(function (evt, options, rootEl, isFallback) {\r\n    // Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=505521\r\n    if (!options.scroll) return;\r\n    var x = (evt.touches ? evt.touches[0] : evt).clientX,\r\n        y = (evt.touches ? evt.touches[0] : evt).clientY,\r\n        sens = options.scrollSensitivity,\r\n        speed = options.scrollSpeed,\r\n        winScroller = getWindowScrollingElement();\r\n    var scrollThisInstance = false,\r\n        scrollCustomFn; // New scroll root, set scrollEl\r\n  \r\n    if (scrollRootEl !== rootEl) {\r\n      scrollRootEl = rootEl;\r\n      clearAutoScrolls();\r\n      scrollEl = options.scroll;\r\n      scrollCustomFn = options.scrollFn;\r\n  \r\n      if (scrollEl === true) {\r\n        scrollEl = getParentAutoScrollElement(rootEl, true);\r\n      }\r\n    }\r\n  \r\n    var layersOut = 0;\r\n    var currentParent = scrollEl;\r\n  \r\n    do {\r\n      var el = currentParent,\r\n          rect = getRect(el),\r\n          top = rect.top,\r\n          bottom = rect.bottom,\r\n          left = rect.left,\r\n          right = rect.right,\r\n          width = rect.width,\r\n          height = rect.height,\r\n          canScrollX = void 0,\r\n          canScrollY = void 0,\r\n          scrollWidth = el.scrollWidth,\r\n          scrollHeight = el.scrollHeight,\r\n          elCSS = css(el),\r\n          scrollPosX = el.scrollLeft,\r\n          scrollPosY = el.scrollTop;\r\n  \r\n      if (el === winScroller) {\r\n        canScrollX = width < scrollWidth && (elCSS.overflowX === 'auto' || elCSS.overflowX === 'scroll' || elCSS.overflowX === 'visible');\r\n        canScrollY = height < scrollHeight && (elCSS.overflowY === 'auto' || elCSS.overflowY === 'scroll' || elCSS.overflowY === 'visible');\r\n      } else {\r\n        canScrollX = width < scrollWidth && (elCSS.overflowX === 'auto' || elCSS.overflowX === 'scroll');\r\n        canScrollY = height < scrollHeight && (elCSS.overflowY === 'auto' || elCSS.overflowY === 'scroll');\r\n      }\r\n  \r\n      var vx = canScrollX && (Math.abs(right - x) <= sens && scrollPosX + width < scrollWidth) - (Math.abs(left - x) <= sens && !!scrollPosX);\r\n      var vy = canScrollY && (Math.abs(bottom - y) <= sens && scrollPosY + height < scrollHeight) - (Math.abs(top - y) <= sens && !!scrollPosY);\r\n  \r\n      if (!autoScrolls[layersOut]) {\r\n        for (var i = 0; i <= layersOut; i++) {\r\n          if (!autoScrolls[i]) {\r\n            autoScrolls[i] = {};\r\n          }\r\n        }\r\n      }\r\n  \r\n      if (autoScrolls[layersOut].vx != vx || autoScrolls[layersOut].vy != vy || autoScrolls[layersOut].el !== el) {\r\n        autoScrolls[layersOut].el = el;\r\n        autoScrolls[layersOut].vx = vx;\r\n        autoScrolls[layersOut].vy = vy;\r\n        clearInterval(autoScrolls[layersOut].pid);\r\n  \r\n        if (vx != 0 || vy != 0) {\r\n          scrollThisInstance = true;\r\n          /* jshint loopfunc:true */\r\n  \r\n          autoScrolls[layersOut].pid = setInterval(function () {\r\n            // emulate drag over during autoscroll (fallback), emulating native DnD behaviour\r\n            if (isFallback && this.layer === 0) {\r\n              Sortable.active._onTouchMove(touchEvt$1); // To move ghost if it is positioned absolutely\r\n  \r\n            }\r\n  \r\n            var scrollOffsetY = autoScrolls[this.layer].vy ? autoScrolls[this.layer].vy * speed : 0;\r\n            var scrollOffsetX = autoScrolls[this.layer].vx ? autoScrolls[this.layer].vx * speed : 0;\r\n  \r\n            if (typeof scrollCustomFn === 'function') {\r\n              if (scrollCustomFn.call(Sortable.dragged.parentNode[expando], scrollOffsetX, scrollOffsetY, evt, touchEvt$1, autoScrolls[this.layer].el) !== 'continue') {\r\n                return;\r\n              }\r\n            }\r\n  \r\n            scrollBy(autoScrolls[this.layer].el, scrollOffsetX, scrollOffsetY);\r\n          }.bind({\r\n            layer: layersOut\r\n          }), 24);\r\n        }\r\n      }\r\n  \r\n      layersOut++;\r\n    } while (options.bubbleScroll && currentParent !== winScroller && (currentParent = getParentAutoScrollElement(currentParent, false)));\r\n  \r\n    scrolling = scrollThisInstance; // in case another function catches scrolling as false in between when it is not\r\n  }, 30);\r\n  \r\n  var drop = function drop(_ref) {\r\n    var originalEvent = _ref.originalEvent,\r\n        putSortable = _ref.putSortable,\r\n        dragEl = _ref.dragEl,\r\n        activeSortable = _ref.activeSortable,\r\n        dispatchSortableEvent = _ref.dispatchSortableEvent,\r\n        hideGhostForTarget = _ref.hideGhostForTarget,\r\n        unhideGhostForTarget = _ref.unhideGhostForTarget;\r\n    if (!originalEvent) return;\r\n    var toSortable = putSortable || activeSortable;\r\n    hideGhostForTarget();\r\n    var touch = originalEvent.changedTouches && originalEvent.changedTouches.length ? originalEvent.changedTouches[0] : originalEvent;\r\n    var target = document.elementFromPoint(touch.clientX, touch.clientY);\r\n    unhideGhostForTarget();\r\n  \r\n    if (toSortable && !toSortable.el.contains(target)) {\r\n      dispatchSortableEvent('spill');\r\n      this.onSpill({\r\n        dragEl: dragEl,\r\n        putSortable: putSortable\r\n      });\r\n    }\r\n  };\r\n  \r\n  function Revert() {}\r\n  \r\n  Revert.prototype = {\r\n    startIndex: null,\r\n    dragStart: function dragStart(_ref2) {\r\n      var oldDraggableIndex = _ref2.oldDraggableIndex;\r\n      this.startIndex = oldDraggableIndex;\r\n    },\r\n    onSpill: function onSpill(_ref3) {\r\n      var dragEl = _ref3.dragEl,\r\n          putSortable = _ref3.putSortable;\r\n      this.sortable.captureAnimationState();\r\n  \r\n      if (putSortable) {\r\n        putSortable.captureAnimationState();\r\n      }\r\n  \r\n      var nextSibling = getChild(this.sortable.el, this.startIndex, this.options);\r\n  \r\n      if (nextSibling) {\r\n        this.sortable.el.insertBefore(dragEl, nextSibling);\r\n      } else {\r\n        this.sortable.el.appendChild(dragEl);\r\n      }\r\n  \r\n      this.sortable.animateAll();\r\n  \r\n      if (putSortable) {\r\n        putSortable.animateAll();\r\n      }\r\n    },\r\n    drop: drop\r\n  };\r\n  \r\n  _extends(Revert, {\r\n    pluginName: 'revertOnSpill'\r\n  });\r\n  \r\n  function Remove() {}\r\n  \r\n  Remove.prototype = {\r\n    onSpill: function onSpill(_ref4) {\r\n      var dragEl = _ref4.dragEl,\r\n          putSortable = _ref4.putSortable;\r\n      var parentSortable = putSortable || this.sortable;\r\n      parentSortable.captureAnimationState();\r\n      dragEl.parentNode && dragEl.parentNode.removeChild(dragEl);\r\n      parentSortable.animateAll();\r\n    },\r\n    drop: drop\r\n  };\r\n  \r\n  _extends(Remove, {\r\n    pluginName: 'removeOnSpill'\r\n  });\r\n  \r\n  var OnSpill = [Remove, Revert];\r\n  \r\n  var lastSwapEl;\r\n  \r\n  function SwapPlugin() {\r\n    function Swap() {\r\n      this.defaults = {\r\n        swapClass: 'sortable-swap-highlight'\r\n      };\r\n    }\r\n  \r\n    Swap.prototype = {\r\n      dragStart: function dragStart(_ref) {\r\n        var dragEl = _ref.dragEl;\r\n        lastSwapEl = dragEl;\r\n      },\r\n      dragOverValid: function dragOverValid(_ref2) {\r\n        var completed = _ref2.completed,\r\n            target = _ref2.target,\r\n            onMove = _ref2.onMove,\r\n            activeSortable = _ref2.activeSortable,\r\n            changed = _ref2.changed,\r\n            cancel = _ref2.cancel;\r\n        if (!activeSortable.options.swap) return;\r\n        var el = this.sortable.el,\r\n            options = this.options;\r\n  \r\n        if (target && target !== el) {\r\n          var prevSwapEl = lastSwapEl;\r\n  \r\n          if (onMove(target) !== false) {\r\n            toggleClass(target, options.swapClass, true);\r\n            lastSwapEl = target;\r\n          } else {\r\n            lastSwapEl = null;\r\n          }\r\n  \r\n          if (prevSwapEl && prevSwapEl !== lastSwapEl) {\r\n            toggleClass(prevSwapEl, options.swapClass, false);\r\n          }\r\n        }\r\n  \r\n        changed();\r\n        completed(true);\r\n        cancel();\r\n      },\r\n      drop: function drop(_ref3) {\r\n        var activeSortable = _ref3.activeSortable,\r\n            putSortable = _ref3.putSortable,\r\n            dragEl = _ref3.dragEl;\r\n        var toSortable = putSortable || this.sortable;\r\n        var options = this.options;\r\n        lastSwapEl && toggleClass(lastSwapEl, options.swapClass, false);\r\n  \r\n        if (lastSwapEl && (options.swap || putSortable && putSortable.options.swap)) {\r\n          if (dragEl !== lastSwapEl) {\r\n            toSortable.captureAnimationState();\r\n            if (toSortable !== activeSortable) activeSortable.captureAnimationState();\r\n            swapNodes(dragEl, lastSwapEl);\r\n            toSortable.animateAll();\r\n            if (toSortable !== activeSortable) activeSortable.animateAll();\r\n          }\r\n        }\r\n      },\r\n      nulling: function nulling() {\r\n        lastSwapEl = null;\r\n      }\r\n    };\r\n    return _extends(Swap, {\r\n      pluginName: 'swap',\r\n      eventProperties: function eventProperties() {\r\n        return {\r\n          swapItem: lastSwapEl\r\n        };\r\n      }\r\n    });\r\n  }\r\n  \r\n  function swapNodes(n1, n2) {\r\n    var p1 = n1.parentNode,\r\n        p2 = n2.parentNode,\r\n        i1,\r\n        i2;\r\n    if (!p1 || !p2 || p1.isEqualNode(n2) || p2.isEqualNode(n1)) return;\r\n    i1 = index(n1);\r\n    i2 = index(n2);\r\n  \r\n    if (p1.isEqualNode(p2) && i1 < i2) {\r\n      i2++;\r\n    }\r\n  \r\n    p1.insertBefore(n2, p1.children[i1]);\r\n    p2.insertBefore(n1, p2.children[i2]);\r\n  }\r\n  \r\n  var multiDragElements = [],\r\n      multiDragClones = [],\r\n      lastMultiDragSelect,\r\n      // for selection with modifier key down (SHIFT)\r\n  multiDragSortable,\r\n      initialFolding = false,\r\n      // Initial multi-drag fold when drag started\r\n  folding = false,\r\n      // Folding any other time\r\n  dragStarted = false,\r\n      dragEl$1,\r\n      clonesFromRect,\r\n      clonesHidden;\r\n  \r\n  function MultiDragPlugin() {\r\n    function MultiDrag(sortable) {\r\n      // Bind all private methods\r\n      for (var fn in this) {\r\n        if (fn.charAt(0) === '_' && typeof this[fn] === 'function') {\r\n          this[fn] = this[fn].bind(this);\r\n        }\r\n      }\r\n  \r\n      if (!sortable.options.avoidImplicitDeselect) {\r\n        if (sortable.options.supportPointer) {\r\n          on(document, 'pointerup', this._deselectMultiDrag);\r\n        } else {\r\n          on(document, 'mouseup', this._deselectMultiDrag);\r\n          on(document, 'touchend', this._deselectMultiDrag);\r\n        }\r\n      }\r\n  \r\n      on(document, 'keydown', this._checkKeyDown);\r\n      on(document, 'keyup', this._checkKeyUp);\r\n      this.defaults = {\r\n        selectedClass: 'sortable-selected',\r\n        multiDragKey: null,\r\n        avoidImplicitDeselect: false,\r\n        setData: function setData(dataTransfer, dragEl) {\r\n          var data = '';\r\n  \r\n          if (multiDragElements.length && multiDragSortable === sortable) {\r\n            multiDragElements.forEach(function (multiDragElement, i) {\r\n              data += (!i ? '' : ', ') + multiDragElement.textContent;\r\n            });\r\n          } else {\r\n            data = dragEl.textContent;\r\n          }\r\n  \r\n          dataTransfer.setData('Text', data);\r\n        }\r\n      };\r\n    }\r\n  \r\n    MultiDrag.prototype = {\r\n      multiDragKeyDown: false,\r\n      isMultiDrag: false,\r\n      delayStartGlobal: function delayStartGlobal(_ref) {\r\n        var dragged = _ref.dragEl;\r\n        dragEl$1 = dragged;\r\n      },\r\n      delayEnded: function delayEnded() {\r\n        this.isMultiDrag = ~multiDragElements.indexOf(dragEl$1);\r\n      },\r\n      setupClone: function setupClone(_ref2) {\r\n        var sortable = _ref2.sortable,\r\n            cancel = _ref2.cancel;\r\n        if (!this.isMultiDrag) return;\r\n  \r\n        for (var i = 0; i < multiDragElements.length; i++) {\r\n          multiDragClones.push(clone(multiDragElements[i]));\r\n          multiDragClones[i].sortableIndex = multiDragElements[i].sortableIndex;\r\n          multiDragClones[i].draggable = false;\r\n          multiDragClones[i].style['will-change'] = '';\r\n          toggleClass(multiDragClones[i], this.options.selectedClass, false);\r\n          multiDragElements[i] === dragEl$1 && toggleClass(multiDragClones[i], this.options.chosenClass, false);\r\n        }\r\n  \r\n        sortable._hideClone();\r\n  \r\n        cancel();\r\n      },\r\n      clone: function clone(_ref3) {\r\n        var sortable = _ref3.sortable,\r\n            rootEl = _ref3.rootEl,\r\n            dispatchSortableEvent = _ref3.dispatchSortableEvent,\r\n            cancel = _ref3.cancel;\r\n        if (!this.isMultiDrag) return;\r\n  \r\n        if (!this.options.removeCloneOnHide) {\r\n          if (multiDragElements.length && multiDragSortable === sortable) {\r\n            insertMultiDragClones(true, rootEl);\r\n            dispatchSortableEvent('clone');\r\n            cancel();\r\n          }\r\n        }\r\n      },\r\n      showClone: function showClone(_ref4) {\r\n        var cloneNowShown = _ref4.cloneNowShown,\r\n            rootEl = _ref4.rootEl,\r\n            cancel = _ref4.cancel;\r\n        if (!this.isMultiDrag) return;\r\n        insertMultiDragClones(false, rootEl);\r\n        multiDragClones.forEach(function (clone) {\r\n          css(clone, 'display', '');\r\n        });\r\n        cloneNowShown();\r\n        clonesHidden = false;\r\n        cancel();\r\n      },\r\n      hideClone: function hideClone(_ref5) {\r\n        var _this = this;\r\n  \r\n        var sortable = _ref5.sortable,\r\n            cloneNowHidden = _ref5.cloneNowHidden,\r\n            cancel = _ref5.cancel;\r\n        if (!this.isMultiDrag) return;\r\n        multiDragClones.forEach(function (clone) {\r\n          css(clone, 'display', 'none');\r\n  \r\n          if (_this.options.removeCloneOnHide && clone.parentNode) {\r\n            clone.parentNode.removeChild(clone);\r\n          }\r\n        });\r\n        cloneNowHidden();\r\n        clonesHidden = true;\r\n        cancel();\r\n      },\r\n      dragStartGlobal: function dragStartGlobal(_ref6) {\r\n        var sortable = _ref6.sortable;\r\n  \r\n        if (!this.isMultiDrag && multiDragSortable) {\r\n          multiDragSortable.multiDrag._deselectMultiDrag();\r\n        }\r\n  \r\n        multiDragElements.forEach(function (multiDragElement) {\r\n          multiDragElement.sortableIndex = index(multiDragElement);\r\n        }); // Sort multi-drag elements\r\n  \r\n        multiDragElements = multiDragElements.sort(function (a, b) {\r\n          return a.sortableIndex - b.sortableIndex;\r\n        });\r\n        dragStarted = true;\r\n      },\r\n      dragStarted: function dragStarted(_ref7) {\r\n        var _this2 = this;\r\n  \r\n        var sortable = _ref7.sortable;\r\n        if (!this.isMultiDrag) return;\r\n  \r\n        if (this.options.sort) {\r\n          // Capture rects,\r\n          // hide multi drag elements (by positioning them absolute),\r\n          // set multi drag elements rects to dragRect,\r\n          // show multi drag elements,\r\n          // animate to rects,\r\n          // unset rects & remove from DOM\r\n          sortable.captureAnimationState();\r\n  \r\n          if (this.options.animation) {\r\n            multiDragElements.forEach(function (multiDragElement) {\r\n              if (multiDragElement === dragEl$1) return;\r\n              css(multiDragElement, 'position', 'absolute');\r\n            });\r\n            var dragRect = getRect(dragEl$1, false, true, true);\r\n            multiDragElements.forEach(function (multiDragElement) {\r\n              if (multiDragElement === dragEl$1) return;\r\n              setRect(multiDragElement, dragRect);\r\n            });\r\n            folding = true;\r\n            initialFolding = true;\r\n          }\r\n        }\r\n  \r\n        sortable.animateAll(function () {\r\n          folding = false;\r\n          initialFolding = false;\r\n  \r\n          if (_this2.options.animation) {\r\n            multiDragElements.forEach(function (multiDragElement) {\r\n              unsetRect(multiDragElement);\r\n            });\r\n          } // Remove all auxiliary multidrag items from el, if sorting enabled\r\n  \r\n  \r\n          if (_this2.options.sort) {\r\n            removeMultiDragElements();\r\n          }\r\n        });\r\n      },\r\n      dragOver: function dragOver(_ref8) {\r\n        var target = _ref8.target,\r\n            completed = _ref8.completed,\r\n            cancel = _ref8.cancel;\r\n  \r\n        if (folding && ~multiDragElements.indexOf(target)) {\r\n          completed(false);\r\n          cancel();\r\n        }\r\n      },\r\n      revert: function revert(_ref9) {\r\n        var fromSortable = _ref9.fromSortable,\r\n            rootEl = _ref9.rootEl,\r\n            sortable = _ref9.sortable,\r\n            dragRect = _ref9.dragRect;\r\n  \r\n        if (multiDragElements.length > 1) {\r\n          // Setup unfold animation\r\n          multiDragElements.forEach(function (multiDragElement) {\r\n            sortable.addAnimationState({\r\n              target: multiDragElement,\r\n              rect: folding ? getRect(multiDragElement) : dragRect\r\n            });\r\n            unsetRect(multiDragElement);\r\n            multiDragElement.fromRect = dragRect;\r\n            fromSortable.removeAnimationState(multiDragElement);\r\n          });\r\n          folding = false;\r\n          insertMultiDragElements(!this.options.removeCloneOnHide, rootEl);\r\n        }\r\n      },\r\n      dragOverCompleted: function dragOverCompleted(_ref10) {\r\n        var sortable = _ref10.sortable,\r\n            isOwner = _ref10.isOwner,\r\n            insertion = _ref10.insertion,\r\n            activeSortable = _ref10.activeSortable,\r\n            parentEl = _ref10.parentEl,\r\n            putSortable = _ref10.putSortable;\r\n        var options = this.options;\r\n  \r\n        if (insertion) {\r\n          // Clones must be hidden before folding animation to capture dragRectAbsolute properly\r\n          if (isOwner) {\r\n            activeSortable._hideClone();\r\n          }\r\n  \r\n          initialFolding = false; // If leaving sort:false root, or already folding - Fold to new location\r\n  \r\n          if (options.animation && multiDragElements.length > 1 && (folding || !isOwner && !activeSortable.options.sort && !putSortable)) {\r\n            // Fold: Set all multi drag elements's rects to dragEl's rect when multi-drag elements are invisible\r\n            var dragRectAbsolute = getRect(dragEl$1, false, true, true);\r\n            multiDragElements.forEach(function (multiDragElement) {\r\n              if (multiDragElement === dragEl$1) return;\r\n              setRect(multiDragElement, dragRectAbsolute); // Move element(s) to end of parentEl so that it does not interfere with multi-drag clones insertion if they are inserted\r\n              // while folding, and so that we can capture them again because old sortable will no longer be fromSortable\r\n  \r\n              parentEl.appendChild(multiDragElement);\r\n            });\r\n            folding = true;\r\n          } // Clones must be shown (and check to remove multi drags) after folding when interfering multiDragElements are moved out\r\n  \r\n  \r\n          if (!isOwner) {\r\n            // Only remove if not folding (folding will remove them anyways)\r\n            if (!folding) {\r\n              removeMultiDragElements();\r\n            }\r\n  \r\n            if (multiDragElements.length > 1) {\r\n              var clonesHiddenBefore = clonesHidden;\r\n  \r\n              activeSortable._showClone(sortable); // Unfold animation for clones if showing from hidden\r\n  \r\n  \r\n              if (activeSortable.options.animation && !clonesHidden && clonesHiddenBefore) {\r\n                multiDragClones.forEach(function (clone) {\r\n                  activeSortable.addAnimationState({\r\n                    target: clone,\r\n                    rect: clonesFromRect\r\n                  });\r\n                  clone.fromRect = clonesFromRect;\r\n                  clone.thisAnimationDuration = null;\r\n                });\r\n              }\r\n            } else {\r\n              activeSortable._showClone(sortable);\r\n            }\r\n          }\r\n        }\r\n      },\r\n      dragOverAnimationCapture: function dragOverAnimationCapture(_ref11) {\r\n        var dragRect = _ref11.dragRect,\r\n            isOwner = _ref11.isOwner,\r\n            activeSortable = _ref11.activeSortable;\r\n        multiDragElements.forEach(function (multiDragElement) {\r\n          multiDragElement.thisAnimationDuration = null;\r\n        });\r\n  \r\n        if (activeSortable.options.animation && !isOwner && activeSortable.multiDrag.isMultiDrag) {\r\n          clonesFromRect = _extends({}, dragRect);\r\n          var dragMatrix = matrix(dragEl$1, true);\r\n          clonesFromRect.top -= dragMatrix.f;\r\n          clonesFromRect.left -= dragMatrix.e;\r\n        }\r\n      },\r\n      dragOverAnimationComplete: function dragOverAnimationComplete() {\r\n        if (folding) {\r\n          folding = false;\r\n          removeMultiDragElements();\r\n        }\r\n      },\r\n      drop: function drop(_ref12) {\r\n        var evt = _ref12.originalEvent,\r\n            rootEl = _ref12.rootEl,\r\n            parentEl = _ref12.parentEl,\r\n            sortable = _ref12.sortable,\r\n            dispatchSortableEvent = _ref12.dispatchSortableEvent,\r\n            oldIndex = _ref12.oldIndex,\r\n            putSortable = _ref12.putSortable;\r\n        var toSortable = putSortable || this.sortable;\r\n        if (!evt) return;\r\n        var options = this.options,\r\n            children = parentEl.children; // Multi-drag selection\r\n  \r\n        if (!dragStarted) {\r\n          if (options.multiDragKey && !this.multiDragKeyDown) {\r\n            this._deselectMultiDrag();\r\n          }\r\n  \r\n          toggleClass(dragEl$1, options.selectedClass, !~multiDragElements.indexOf(dragEl$1));\r\n  \r\n          if (!~multiDragElements.indexOf(dragEl$1)) {\r\n            multiDragElements.push(dragEl$1);\r\n            dispatchEvent({\r\n              sortable: sortable,\r\n              rootEl: rootEl,\r\n              name: 'select',\r\n              targetEl: dragEl$1,\r\n              originalEvent: evt\r\n            }); // Modifier activated, select from last to dragEl\r\n  \r\n            if (evt.shiftKey && lastMultiDragSelect && sortable.el.contains(lastMultiDragSelect)) {\r\n              var lastIndex = index(lastMultiDragSelect),\r\n                  currentIndex = index(dragEl$1);\r\n  \r\n              if (~lastIndex && ~currentIndex && lastIndex !== currentIndex) {\r\n                // Must include lastMultiDragSelect (select it), in case modified selection from no selection\r\n                // (but previous selection existed)\r\n                var n, i;\r\n  \r\n                if (currentIndex > lastIndex) {\r\n                  i = lastIndex;\r\n                  n = currentIndex;\r\n                } else {\r\n                  i = currentIndex;\r\n                  n = lastIndex + 1;\r\n                }\r\n  \r\n                for (; i < n; i++) {\r\n                  if (~multiDragElements.indexOf(children[i])) continue;\r\n                  toggleClass(children[i], options.selectedClass, true);\r\n                  multiDragElements.push(children[i]);\r\n                  dispatchEvent({\r\n                    sortable: sortable,\r\n                    rootEl: rootEl,\r\n                    name: 'select',\r\n                    targetEl: children[i],\r\n                    originalEvent: evt\r\n                  });\r\n                }\r\n              }\r\n            } else {\r\n              lastMultiDragSelect = dragEl$1;\r\n            }\r\n  \r\n            multiDragSortable = toSortable;\r\n          } else {\r\n            multiDragElements.splice(multiDragElements.indexOf(dragEl$1), 1);\r\n            lastMultiDragSelect = null;\r\n            dispatchEvent({\r\n              sortable: sortable,\r\n              rootEl: rootEl,\r\n              name: 'deselect',\r\n              targetEl: dragEl$1,\r\n              originalEvent: evt\r\n            });\r\n          }\r\n        } // Multi-drag drop\r\n  \r\n  \r\n        if (dragStarted && this.isMultiDrag) {\r\n          folding = false; // Do not \"unfold\" after around dragEl if reverted\r\n  \r\n          if ((parentEl[expando].options.sort || parentEl !== rootEl) && multiDragElements.length > 1) {\r\n            var dragRect = getRect(dragEl$1),\r\n                multiDragIndex = index(dragEl$1, ':not(.' + this.options.selectedClass + ')');\r\n            if (!initialFolding && options.animation) dragEl$1.thisAnimationDuration = null;\r\n            toSortable.captureAnimationState();\r\n  \r\n            if (!initialFolding) {\r\n              if (options.animation) {\r\n                dragEl$1.fromRect = dragRect;\r\n                multiDragElements.forEach(function (multiDragElement) {\r\n                  multiDragElement.thisAnimationDuration = null;\r\n  \r\n                  if (multiDragElement !== dragEl$1) {\r\n                    var rect = folding ? getRect(multiDragElement) : dragRect;\r\n                    multiDragElement.fromRect = rect; // Prepare unfold animation\r\n  \r\n                    toSortable.addAnimationState({\r\n                      target: multiDragElement,\r\n                      rect: rect\r\n                    });\r\n                  }\r\n                });\r\n              } // Multi drag elements are not necessarily removed from the DOM on drop, so to reinsert\r\n              // properly they must all be removed\r\n  \r\n  \r\n              removeMultiDragElements();\r\n              multiDragElements.forEach(function (multiDragElement) {\r\n                if (children[multiDragIndex]) {\r\n                  parentEl.insertBefore(multiDragElement, children[multiDragIndex]);\r\n                } else {\r\n                  parentEl.appendChild(multiDragElement);\r\n                }\r\n  \r\n                multiDragIndex++;\r\n              }); // If initial folding is done, the elements may have changed position because they are now\r\n              // unfolding around dragEl, even though dragEl may not have his index changed, so update event\r\n              // must be fired here as Sortable will not.\r\n  \r\n              if (oldIndex === index(dragEl$1)) {\r\n                var update = false;\r\n                multiDragElements.forEach(function (multiDragElement) {\r\n                  if (multiDragElement.sortableIndex !== index(multiDragElement)) {\r\n                    update = true;\r\n                    return;\r\n                  }\r\n                });\r\n  \r\n                if (update) {\r\n                  dispatchSortableEvent('update');\r\n                }\r\n              }\r\n            } // Must be done after capturing individual rects (scroll bar)\r\n  \r\n  \r\n            multiDragElements.forEach(function (multiDragElement) {\r\n              unsetRect(multiDragElement);\r\n            });\r\n            toSortable.animateAll();\r\n          }\r\n  \r\n          multiDragSortable = toSortable;\r\n        } // Remove clones if necessary\r\n  \r\n  \r\n        if (rootEl === parentEl || putSortable && putSortable.lastPutMode !== 'clone') {\r\n          multiDragClones.forEach(function (clone) {\r\n            clone.parentNode && clone.parentNode.removeChild(clone);\r\n          });\r\n        }\r\n      },\r\n      nullingGlobal: function nullingGlobal() {\r\n        this.isMultiDrag = dragStarted = false;\r\n        multiDragClones.length = 0;\r\n      },\r\n      destroyGlobal: function destroyGlobal() {\r\n        this._deselectMultiDrag();\r\n  \r\n        off(document, 'pointerup', this._deselectMultiDrag);\r\n        off(document, 'mouseup', this._deselectMultiDrag);\r\n        off(document, 'touchend', this._deselectMultiDrag);\r\n        off(document, 'keydown', this._checkKeyDown);\r\n        off(document, 'keyup', this._checkKeyUp);\r\n      },\r\n      _deselectMultiDrag: function _deselectMultiDrag(evt) {\r\n        if (typeof dragStarted !== \"undefined\" && dragStarted) return; // Only deselect if selection is in this sortable\r\n  \r\n        if (multiDragSortable !== this.sortable) return; // Only deselect if target is not item in this sortable\r\n  \r\n        if (evt && closest(evt.target, this.options.draggable, this.sortable.el, false)) return; // Only deselect if left click\r\n  \r\n        if (evt && evt.button !== 0) return;\r\n  \r\n        while (multiDragElements.length) {\r\n          var el = multiDragElements[0];\r\n          toggleClass(el, this.options.selectedClass, false);\r\n          multiDragElements.shift();\r\n          dispatchEvent({\r\n            sortable: this.sortable,\r\n            rootEl: this.sortable.el,\r\n            name: 'deselect',\r\n            targetEl: el,\r\n            originalEvent: evt\r\n          });\r\n        }\r\n      },\r\n      _checkKeyDown: function _checkKeyDown(evt) {\r\n        if (evt.key === this.options.multiDragKey) {\r\n          this.multiDragKeyDown = true;\r\n        }\r\n      },\r\n      _checkKeyUp: function _checkKeyUp(evt) {\r\n        if (evt.key === this.options.multiDragKey) {\r\n          this.multiDragKeyDown = false;\r\n        }\r\n      }\r\n    };\r\n    return _extends(MultiDrag, {\r\n      // Static methods & properties\r\n      pluginName: 'multiDrag',\r\n      utils: {\r\n        /**\r\n         * Selects the provided multi-drag item\r\n         * @param  {HTMLElement} el    The element to be selected\r\n         */\r\n        select: function select(el) {\r\n          var sortable = el.parentNode[expando];\r\n          if (!sortable || !sortable.options.multiDrag || ~multiDragElements.indexOf(el)) return;\r\n  \r\n          if (multiDragSortable && multiDragSortable !== sortable) {\r\n            multiDragSortable.multiDrag._deselectMultiDrag();\r\n  \r\n            multiDragSortable = sortable;\r\n          }\r\n  \r\n          toggleClass(el, sortable.options.selectedClass, true);\r\n          multiDragElements.push(el);\r\n        },\r\n  \r\n        /**\r\n         * Deselects the provided multi-drag item\r\n         * @param  {HTMLElement} el    The element to be deselected\r\n         */\r\n        deselect: function deselect(el) {\r\n          var sortable = el.parentNode[expando],\r\n              index = multiDragElements.indexOf(el);\r\n          if (!sortable || !sortable.options.multiDrag || !~index) return;\r\n          toggleClass(el, sortable.options.selectedClass, false);\r\n          multiDragElements.splice(index, 1);\r\n        }\r\n      },\r\n      eventProperties: function eventProperties() {\r\n        var _this3 = this;\r\n  \r\n        var oldIndicies = [],\r\n            newIndicies = [];\r\n        multiDragElements.forEach(function (multiDragElement) {\r\n          oldIndicies.push({\r\n            multiDragElement: multiDragElement,\r\n            index: multiDragElement.sortableIndex\r\n          }); // multiDragElements will already be sorted if folding\r\n  \r\n          var newIndex;\r\n  \r\n          if (folding && multiDragElement !== dragEl$1) {\r\n            newIndex = -1;\r\n          } else if (folding) {\r\n            newIndex = index(multiDragElement, ':not(.' + _this3.options.selectedClass + ')');\r\n          } else {\r\n            newIndex = index(multiDragElement);\r\n          }\r\n  \r\n          newIndicies.push({\r\n            multiDragElement: multiDragElement,\r\n            index: newIndex\r\n          });\r\n        });\r\n        return {\r\n          items: _toConsumableArray(multiDragElements),\r\n          clones: [].concat(multiDragClones),\r\n          oldIndicies: oldIndicies,\r\n          newIndicies: newIndicies\r\n        };\r\n      },\r\n      optionListeners: {\r\n        multiDragKey: function multiDragKey(key) {\r\n          key = key.toLowerCase();\r\n  \r\n          if (key === 'ctrl') {\r\n            key = 'Control';\r\n          } else if (key.length > 1) {\r\n            key = key.charAt(0).toUpperCase() + key.substr(1);\r\n          }\r\n  \r\n          return key;\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  function insertMultiDragElements(clonesInserted, rootEl) {\r\n    multiDragElements.forEach(function (multiDragElement, i) {\r\n      var target = rootEl.children[multiDragElement.sortableIndex + (clonesInserted ? Number(i) : 0)];\r\n  \r\n      if (target) {\r\n        rootEl.insertBefore(multiDragElement, target);\r\n      } else {\r\n        rootEl.appendChild(multiDragElement);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * Insert multi-drag clones\r\n   * @param  {[Boolean]} elementsInserted  Whether the multi-drag elements are inserted\r\n   * @param  {HTMLElement} rootEl\r\n   */\r\n  \r\n  \r\n  function insertMultiDragClones(elementsInserted, rootEl) {\r\n    multiDragClones.forEach(function (clone, i) {\r\n      var target = rootEl.children[clone.sortableIndex + (elementsInserted ? Number(i) : 0)];\r\n  \r\n      if (target) {\r\n        rootEl.insertBefore(clone, target);\r\n      } else {\r\n        rootEl.appendChild(clone);\r\n      }\r\n    });\r\n  }\r\n  \r\n  function removeMultiDragElements() {\r\n    multiDragElements.forEach(function (multiDragElement) {\r\n      if (multiDragElement === dragEl$1) return;\r\n      multiDragElement.parentNode && multiDragElement.parentNode.removeChild(multiDragElement);\r\n    });\r\n  }\r\n  \r\n  export default Sortable;\r\n  export { AutoScrollPlugin as AutoScroll, MultiDragPlugin as MultiDrag, OnSpill, Sortable, SwapPlugin as Swap };","import {MODULE_ID} from \"./main.js\";\r\nimport Sortable from \"./sortable.js\";\r\n\r\nexport class AttributesConfig extends FormApplication {\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return {\r\n            ...super.defaultOptions,\r\n            title: game.i18n.localize(`${MODULE_ID}.settings.attributesMenu.name`),\r\n            id: \"combat-dock-attributes-config\",\r\n            template: `modules/combat-tracker-dock/templates/attributes-config.hbs`,\r\n            popOut: true,\r\n            width: 500,\r\n        };\r\n    }\r\n\r\n    getData() {\r\n        const attributes = TokenDocument.implementation.getTrackedAttributes();\r\n        attributes.bar.forEach(a => a.push(\"value\"));\r\n        const attributeChoices = TokenDocument.implementation.getTrackedAttributeChoices(attributes)\r\n        return {attributes: game.settings.get(MODULE_ID, \"attributes\"), attributeChoices};\r\n    }\r\n    \r\n    activateListeners(html) {\r\n        super.activateListeners(html);\r\n        html[0].querySelector(\"#add\").addEventListener(\"click\", this._onAdd.bind(this));\r\n        html[0].querySelector(\"#reset\").addEventListener(\"click\", this._onReset.bind(this));\r\n        html[0].querySelectorAll(\".attributePicker\").forEach((picker) => {\r\n            picker.addEventListener(\"change\", (event) => {\r\n                const value = event.target.value;\r\n                const attributeInput = event.target.closest(\".form-group\").querySelector(\".attr\");\r\n                attributeInput.value = value;\r\n            });\r\n        });\r\n        Sortable.create(html[0].querySelector(\"ul\"), {\r\n            animation: 200,\r\n            filter: \"input\",\r\n            preventOnFilter: false,\r\n        });\r\n    }\r\n\r\n    async _onAdd(event) {\r\n        event.preventDefault();\r\n        await this._saveData();\r\n        const attributes = game.settings.get(MODULE_ID, \"attributes\");\r\n        attributes.push({\r\n            attr: \"\",\r\n            icon: \"\",\r\n            units: \"\",\r\n        });\r\n        await game.settings.set(MODULE_ID, \"attributes\", attributes);\r\n        this.render(true);\r\n    }\r\n\r\n    async _onReset(event) {\r\n        event.preventDefault();\r\n        Dialog.confirm({\r\n            title: game.i18n.localize(`${MODULE_ID}.settings.attributesMenu.reset`),\r\n            content: game.i18n.localize(`${MODULE_ID}.settings.attributesMenu.resetWarning`),\r\n            yes: async () => {\r\n                const defaultSett = game.settings.settings.get(\"combat-tracker-dock.attributes\").default;\r\n                await game.settings.set(MODULE_ID, \"attributes\", defaultSett);\r\n                this.render(true);\r\n            },\r\n        })\r\n    }\r\n\r\n    async _saveData() {\r\n        let attributes = this._getSubmitData();\r\n        attributes = attributes.filter((attr) => attr.attr !== \"\");\r\n        await game.settings.set(MODULE_ID, \"attributes\", attributes);\r\n    }\r\n\r\n    async _onSubmit(event) {\r\n        event.preventDefault();\r\n        await this._saveData();\r\n        this.close();\r\n    }\r\n\r\n    _getSubmitData() {\r\n        let data = [];\r\n        const li = this.element[0].querySelectorAll(\"li\");\r\n        for (let i = 0; i < li.length; i++) {\r\n            const attr = li[i].querySelector(\".attr\").value;\r\n            const icon = li[i].querySelector(\".icon\").value;\r\n            const units = li[i].querySelector(\".units\").value;\r\n            data.push({attr, icon, units});\r\n        }\r\n        return data;\r\n    }\r\n}","/*\r\n * -------------------------------------------------------------\r\n * Community Maintained\r\n * -------------------------------------------------------------\r\n *\r\n * This file is maintained by the community and is subject to the\r\n * terms of the MIT License.\r\n *\r\n * For more information, please visit:\r\n * https://opensource.org/licenses/MIT\r\n *\r\n * -------------------------------------------------------------\r\n */\r\n\r\nimport { MODULE_ID } from \"./main.js\";\r\nimport { registerSystemSetting, getSystemSetting } from \"./config.js\";\r\n\r\n/**\r\n * Returns the default attributes configuration for different game systems.\r\n *\r\n * @returns {Object} The default attributes configuration.\r\n */\r\n\r\nexport function defaultAttributesConfig() {\r\n    return {\r\n        dnd5e: [\r\n            {\r\n                attr: \"attributes.hp.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"HP\",\r\n            },\r\n            {\r\n                attr: \"attributes.ac.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"AC\",\r\n            },\r\n            {\r\n                attr: \"attributes.movement.walk\",\r\n                icon: \"fas fa-person-running-fast\",\r\n                units: \"ft.\",\r\n            },\r\n            {\r\n                attr: \"attributes.spell.dc\",\r\n                icon: \"fas fa-hand-holding-magic\",\r\n                units: \"Spell DC\",\r\n            },\r\n            {\r\n                attr: \"resources.legact.value\",\r\n                icon: \"far fa-bolt-lightning\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"resources.legres.value\",\r\n                icon: \"fas fa-shield-cross\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"resources.lair.value\",\r\n                icon: \"fa-solid fa-dungeon\",\r\n                units: \"\",\r\n            },\r\n        ],\r\n        \"dnd4e\": [\r\n            {\r\n                attr: \"defences.ac.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"DND4E.DefAC\"),\r\n            },\r\n            {\r\n                attr: \"defences.fort.value\",\r\n                icon: \"fas fa-heart-pulse\",\r\n                units: game.i18n.localize(\"DND4E.DefFort\"),\r\n            },\r\n            {\r\n                attr: \"defences.ref.value\",\r\n                icon: \"fas fa-rabbit-running\",\r\n                units: game.i18n.localize(\"DND4E.DefRef\"),\r\n            },\r\n            {\r\n                attr: \"defences.wil.value\",\r\n                icon: \"fas fa-brain\",\r\n                units: game.i18n.localize(\"DND4E.DefWil\"),\r\n            },\r\n            {\r\n                attr: \"attributes.init.value\",\r\n                icon: \"fas fa-traffic-light-go\",\r\n                units: game.i18n.localize(\"DND4E.Init\"),\r\n            },\r\n            {\r\n                attr: \"movement.walk.value\",\r\n                icon: \"fas fa-person-running\",\r\n                units: game.i18n.localize(\"DND4E.Speed\"),\r\n            },\r\n            {\r\n                attr: \"attributes.hp.max\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"DND4E.HPShort\"),\r\n            },\r\n            {\r\n                attr: \"details.bloodied\",\r\n                icon: \"fas fa-heart-half-stroke\",\r\n                units: null,\r\n            },\r\n\t\t],\r\n        \"cyberpunk-red-core\": [\r\n            {\r\n                attr: \"derivedStats.hp.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"HP\",\r\n            },\r\n            {\r\n                attr: \"derivedStats.walk.value\",\r\n                icon: \"fas fa-person-running\",\r\n                units: \"m/ft\",\r\n            },\r\n            {\r\n                attr: \"derivedStats.run.value\",\r\n                icon: \"fas fa-person-running-fast\",\r\n                units: \"m/ft\",\r\n            },\r\n            {\r\n                attr: \"externalData.currentArmorHead.value\",\r\n                icon: \"fas fa-helmet-safety\",\r\n                units: \"SP\",\r\n            },\r\n            {\r\n                attr: \"externalData.currentArmorBody.value\",\r\n                icon: \"fas fa-shirt-tank-top\",\r\n                units: \"SP\",\r\n            },\r\n        ],\r\n        swade: [\r\n            {\r\n                attr: \"wounds.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"SWADE.Wounds\"),\r\n            },\r\n            {\r\n                attr: \"fatigue.value\",\r\n                icon: \"fas fa-face-hand-yawn\",\r\n                units: game.i18n.localize(\"SWADE.Fatigue\"),\r\n            },\r\n            {\r\n                attr: \"bennies.value\",\r\n                icon: \"fas fa-bullseye\",\r\n                units: game.i18n.localize(\"SWADE.Bennies\"),\r\n            },\r\n            {\r\n                attr: \"stats.speed.value\",\r\n                icon: \"fas fa-person-running\",\r\n                units: game.i18n.localize(\"SWADE.Pace\"),\r\n            },\r\n            {\r\n                attr: \"stats.parry.value\",\r\n                icon: \"fas fa-swords\",\r\n                units: game.i18n.localize(\"SWADE.Parry\"),\r\n            },\r\n            {\r\n                attr: \"stats.toughness.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"SWADE.Tough\"),\r\n            },\r\n            {\r\n                attr: \"stats.toughness.armor\",\r\n                icon: \"fas fa-helmet-battle\",\r\n                units: game.i18n.localize(\"SWADE.Armor\"),\r\n            },\r\n        ],\r\n        pirateborg: [\r\n            {\r\n                attr: \"attributes.hp.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"HP\",\r\n            },\r\n            {\r\n                attr: \"attributes.luck.value\",\r\n                icon: \"fas fa-clover\",\r\n                units: \"Devil's Luck\",\r\n            },\r\n            {\r\n                attr: \"attributes.rituals.value\",\r\n                icon: \"fas fa-ankh\",\r\n                units: \"Rituals\",\r\n            },\r\n        ],\r\n        cyphersystem: [\r\n            {\r\n                attr: \"pools.might.value\",\r\n                icon: \"fas fa-hand-fist\",\r\n                units: \"Might\",\r\n            },\r\n            {\r\n                attr: \"pools.speed.value\",\r\n                icon: \"fas fa-person-running\",\r\n                units: \"Speed\",\r\n            },\r\n            {\r\n                attr: \"pools.intellect.value\",\r\n                icon: \"fas fa-brain\",\r\n                units: \"Intellect\",\r\n            },\r\n            {\r\n                attr: \"combat.damageTrack.state\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"pools.health.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"Health\",\r\n            },\r\n            {\r\n                attr: \"combat.armor\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"Armor\",\r\n            },\r\n            {\r\n                attr: \"combat.damage\",\r\n                icon: \"fas fa-axe-battle\",\r\n                units: \"Damage\",\r\n            },\r\n        ],\r\n        pf2e: [\r\n            {\r\n                attr: \"attributes.hp.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"HP\",\r\n            },\r\n            {\r\n                attr: \"attributes.ac.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"AC\",\r\n            },\r\n            {\r\n                attr: \"attributes.speed.value\",\r\n                icon: \"systems/pf2e/icons/default-icons/action.svg\",\r\n                units: \"ft.\",\r\n            },\r\n            {\r\n                attr: \"attributes.spellDC.value\",\r\n                icon: \"fas fa-hand-holding-magic\",\r\n                units: \"Spell DC\",\r\n            },\r\n            {\r\n                attr: \"attributes.shield.hp.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"Shield HP\",\r\n            },\r\n        ],\r\n        pf1: [\r\n            {\r\n                attr: \"attributes.hp.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"HP\",\r\n            },\r\n            {\r\n                attr: \"attributes.ac.normal.total\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"AC\",\r\n            },\r\n            {\r\n                attr: \"attributes.ac.touch.total\",\r\n                icon: \"fas fa-shield-slash\",\r\n                units: \"Touch AC\",\r\n            },\r\n            {\r\n                attr: \"attributes.ac.flatFooted.total\",\r\n                icon: \"fas fa-circle-exclamation\",\r\n                units: \"Flat Footed AC\",\r\n            },\r\n            {\r\n                attr: \"attributes.cmd.total\",\r\n                icon: \"fas fa-hand-fist\",\r\n                units: \"CMD\",\r\n            },\r\n            {\r\n                attr: \"attributes.cmd.flatFootedTotal\",\r\n                icon: \"fas fa-person-circle-exclamation\",\r\n                units: \"Flat Footed CMD\",\r\n            },\r\n            {\r\n                attr: \"attributes.sr.total\",\r\n                icon: \"fas fa-hand-holding-magic\",\r\n                units: \"Spell Resistance\",\r\n            },\r\n            {\r\n                attr: \"attributes.speed.land.total\",\r\n                icon: \"fas fa-person-running\",\r\n                units: \"ft.\",\r\n            },\r\n        ],\r\n        crucible: [\r\n            {\r\n                attr: \"resources.health.value\",\r\n                icon: \"fa-solid fa-heart\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"resources.morale.value\",\r\n                icon: \"fa-solid fa-brain\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"resources.action.value\",\r\n                icon: \"fa-solid fa-hand-fist\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"resources.focus.value\",\r\n                icon: \"fa-solid fa-hand-holding-magic\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"resources.wounds.value\",\r\n                icon: \"fa-solid fa-droplet\",\r\n                units: \"\",\r\n            },\r\n            {\r\n                attr: \"resources.madness.value\",\r\n                icon: \"fa-solid fa-head-side-brain\",\r\n                units: \"\",\r\n            },\r\n        ],\r\n        wfrp4e: [\r\n            {\r\n                attr: \"status.wounds.value\",\r\n                icon: \"fa-thin fa-heart\",\r\n                units: game.i18n.localize(\"Wounds\"),\r\n            },\r\n            {\r\n                attr: \"status.advantage.value\",\r\n                icon: \"fa-thin fa-swords\",\r\n                units: game.i18n.localize(\"Advantage\"),\r\n            },\r\n            {\r\n                attr: \"status.fortune.value\",\r\n                icon: \"fa-thin fa-clover\",\r\n                units: game.i18n.localize(\"Fortune\"),\r\n            },\r\n            {\r\n                attr: \"status.resolve.value\",\r\n                icon: \"fa-thin fa-face-pouting\",\r\n                units: game.i18n.localize(\"Resolve\"),\r\n            },\r\n            {\r\n                attr: \"details.move.run\",\r\n                icon: \"fa-thin fa-person-running\",\r\n                units: game.i18n.localize(\"yds\"),\r\n            },\r\n        ],\r\n        alienrpg: [\r\n            {\r\n                attr: \"header.health.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"ALIENRPG.Health\"),\r\n            },\r\n            {\r\n                attr: \"header.stress.value\",\r\n                icon: \"fas fa-face-scream\",\r\n                units: game.i18n.localize(\"ALIENRPG.Stress\"),\r\n            },\r\n            {\r\n                attr: \"general.armor.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"ALIENRPG.Armor\"),\r\n            },\r\n            {\r\n                attr: \"attributes.speed.value\",\r\n                icon: \"fas fa-person-running\",\r\n                units: game.i18n.localize(\"ALIENRPG.Speed\"),\r\n            },\r\n            {\r\n                attr: \"general.mobility.value\",\r\n                icon: \"fas fa-user-ninja\",\r\n                units: game.i18n.localize(\"ALIENRPG.Skillmobility\"),\r\n            },\r\n            {\r\n                attr: \"general.observation.value\",\r\n                icon: \"fas fa-eye\",\r\n                units: game.i18n.localize(\"ALIENRPG.Skillobservation\"),\r\n            },\r\n            {\r\n                attr: \"attributes.armorrating.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"ALIENRPG.ArmorRating\"),\r\n            },\r\n            {\r\n                attr: \"attributes.hull.value\",\r\n                icon: \"fas fa-shuttle-space\",\r\n                units: game.i18n.localize(\"ALIENRPG.HULL\"),\r\n            },\r\n            {\r\n                attr: \"attributes.armor.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"ALIENRPG.SHIP-ARMOR\"),\r\n            },\r\n            {\r\n                attr: \"attributes.thrusters.value\",\r\n                icon: \"fas fa-rocket-launch\",\r\n                units: game.i18n.localize(\"ALIENRPG.THRUSTERS\"),\r\n            },\r\n            {\r\n                attr: \"attributes.signature.value\",\r\n                icon: \"fas fa-satellite-dish\",\r\n                units: game.i18n.localize(\"ALIENRPG.SIGNATURE\"),\r\n            },\r\n        ],\r\n        exaltedthird: [\r\n            {\r\n                attr: \"health.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"Ex3.Health\"),\r\n            },\r\n            {\r\n                attr: \"evasion.value\",\r\n                icon: \"fas fa-rabbit-running\",\r\n                units: game.i18n.localize(\"Ex3.Evasion\"),\r\n            },\r\n            {\r\n                attr: \"parry.value\",\r\n                icon: \"fas fa-swords\",\r\n                units: game.i18n.localize(\"Ex3.Parry\"),\r\n            },\r\n            {\r\n                attr: \"soak.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"Ex3.Soak\"),\r\n            },\r\n            {\r\n                attr: \"hardness.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"Ex3.Hardness\"),\r\n            },\r\n            {\r\n                attr: \"willpower.value\",\r\n                icon: \"fas fa-hand-fist\",\r\n                units: game.i18n.localize(\"Ex3.Willpower\"),\r\n            },\r\n            {\r\n                attr: \"anima.value\",\r\n                icon: \"fas fa-sun\",\r\n                units: game.i18n.localize(\"Ex3.Anima\"),\r\n            },\r\n        ],\r\n        exaltedessence: [\r\n            {\r\n                attr: \"health.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"ExEss.Health\"),\r\n            },\r\n            {\r\n                attr: \"evasion.value\",\r\n                icon: \"fas fa-rabbit-running\",\r\n                units: game.i18n.localize(\"ExEss.Evasion\"),\r\n            },\r\n            {\r\n                attr: \"parry.value\",\r\n                icon: \"fas fa-swords\",\r\n                units: game.i18n.localize(\"ExEss.Parry\"),\r\n            },\r\n            {\r\n                attr: \"soak.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"ExEss.Soak\"),\r\n            },\r\n            {\r\n                attr: \"hardness.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"ExEss.Hardness\"),\r\n            },\r\n            {\r\n                attr: \"power.value\",\r\n                icon: \"fas fa-hand-fist\",\r\n                units: game.i18n.localize(\"ExEss.Power\"),\r\n            },\r\n            {\r\n                attr: \"will.value\",\r\n                icon: \"fas fa-hand-sparkles\",\r\n                units: game.i18n.localize(\"ExEss.Will\"),\r\n            },\r\n            {\r\n                attr: \"anima.value\",\r\n                icon: \"fas fa-sun\",\r\n                units: game.i18n.localize(\"ExEss.Anima\"),\r\n            },\r\n        ],\r\n        swnr: [\r\n            {\r\n                attr: \"health.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: game.i18n.localize(\"swnr.sheet.hp\"),\r\n            },\r\n            {\r\n                attr: \"ac\",\r\n                icon: \"fas fa-shield\",\r\n                units: game.i18n.localize(\"swnr.sheet.ac\"),\r\n            },\r\n            {\r\n                attr: \"speed\",\r\n                icon: \"fas fa-person-running-fast\",\r\n                units: \"m\",\r\n            },\r\n            {\r\n                attr: \"save.physical\",\r\n                icon: \"fas fa-hand-fist\",\r\n                units: game.i18n.localize(\"swnr.sheet.vs\"),\r\n            },\r\n            {\r\n                attr: \"save.evasion\",\r\n                icon: \"fas fa-feather-pointed\",\r\n                units: game.i18n.localize(\"swnr.sheet.vs\"),\r\n            },\r\n            {\r\n                attr: \"save.mental\",\r\n                icon: \"fas fa-brain\",\r\n                units: game.i18n.localize(\"swnr.sheet.vs\"),\r\n            },\r\n        ],\r\n        wwn: [\r\n            {\r\n                attr: \"hp.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"Hit Points\",\r\n            },\r\n            {\r\n                attr: \"details.strain.value\",\r\n                icon: \"fas fa-ankh\",\r\n                units: \"System Strain\",\r\n            },            \r\n            {\r\n                attr: \"aac.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"Armor Class\",\r\n            },\r\n            {\r\n                attr: \"movement.base\",\r\n                icon: \"fas fa-person-running\",\r\n                units: \"ft. Movement\",\r\n            },\r\n            {\r\n                attr: \"saves.evasion.value\",\r\n                icon: \"fas fa-bullseye\",\r\n                units: \"Evasion Save\",\r\n            },\r\n            {\r\n                attr: \"saves.mental.value\",\r\n                icon: \"fas fa-brain\",\r\n                units: \"Mental Save\",                \r\n            },\r\n            {\r\n                attr: \"saves.physical.value\",\r\n                icon: \"fas fa-hand-fist\",\r\n                units: \"Physical Save\",\r\n            },\r\n            {\r\n                attr: \"saves.luck.value\",\r\n                icon: \"fas fa-star\",\r\n                units: \"Luck Save\",\r\n            },\r\n        ],        \r\n        ars: [\r\n            {\r\n                attr: \"attributes.hp.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"Hit Points\",\r\n            },         \r\n            {\r\n                attr: \"attributes.ac.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"Armor Class\",\r\n            },\r\n            {\r\n                attr: \"attributes.movement.value\",\r\n                icon: \"fas fa-person-running\",\r\n                units: \"Movement\",\r\n            },\r\n            {\r\n                attr: \"attributes.thaco.value\",\r\n                icon: \"fas fa-swords\",\r\n                units: \"THAC0\",\r\n            },            \r\n        ],                \r\n        lancer: [\r\n            { attr: \"hp.value\", icon: \"mdi mdi-heart-outline\", units: \"\" },\r\n            { attr: \"structure.value\", icon: \"cci cci-structure\", units: \"\" },\r\n            { attr: \"heat.value\", icon: \"cci cci-heat\", units: \"\" },\r\n            { attr: \"stress.value\", icon: \"cci cci-reactor\", units: \"\" },\r\n        ],\r\n        dc20rpg: [\r\n            {\r\n                attr: \"resources.health.value\",\r\n                icon: \"fas fa-heart\",\r\n                units: \"HP\",\r\n            },\r\n            {\r\n                attr: \"resources.mana.value\",\r\n                icon: \"fas fa-star\",\r\n                units: \"MP\",\r\n            },\r\n            {\r\n                attr: \"resources.stamina.value\",\r\n                icon: \"fas fa-hand-fist\",\r\n                units: \"SP\",\r\n            },\r\n            {\r\n                attr: \"defences.physical.value\",\r\n                icon: \"fas fa-shield\",\r\n                units: \"PD\",\r\n            },\r\n            {\r\n                attr: \"defences.mystical.value\",\r\n                icon: \"fas fa-wand-magic-sparkles\",\r\n                units: \"MD\",\r\n            },\r\n            {\r\n                attr: \"movement.ground.value\",\r\n                icon: \"fas fa-person-walking\",\r\n                units: \"Spaces\",\r\n            },\r\n        ],\r\n        shadowdark: [\r\n            { attr: \"attributes.ac.value\", icon: \"fas fa-shield\", units: \"AC\" },\r\n            { attr: \"attributes.hp.value\", icon: \"fas fa-heart\", units: \"HP\" },\r\n        ],\r\n    };\r\n}\r\n\r\n/**\r\n * Generates a description for the given actor based on its data.\r\n * This description is shown in the Tooltip under the actor's name.\r\n *\r\n * @param {Object} actor - The actor object.\r\n * @returns {string|null} The generated description or null if no description is available.\r\n */\r\n\r\nexport function generateDescription(actor) {\r\n    const { type, system } = actor;\r\n    switch (game.system.id) {\r\n        case \"dnd5e\":\r\n            const isNPC = type === \"npc\";\r\n            const isPC = type === \"character\";\r\n            if (isNPC) {\r\n                const creatureType = game.i18n.localize(CONFIG.DND5E.creatureTypes[actor.system.details.type.value]?.label ?? actor.system.details.type.custom);\r\n                const cr = system.details.cr >= 1 || system.details.cr <= 0 ? system.details.cr : `1/${1 / system.details.cr}`;\r\n                return `CR ${cr} ${creatureType}`;\r\n            } else if (isPC) {\r\n                const classes = Object.values(actor.classes)\r\n                    .map((c) => c.name)\r\n                    .join(\" / \");\r\n                return `Level ${system.details.level} ${classes} (${system.details.race})`;\r\n            } else {\r\n                return null;\r\n            }\r\n        case \"dnd4e\":\r\n            switch (type) {\r\n                case \"Player Character\":\r\n\t\t\t\t\treturn `${game.i18n.localize(\"DND4E.Level\")} ${system.details.level} ${system.details.race} ${system.details.class} (${system.details.alignment})`;\r\n                case \"NPC\":\r\n\t\t\t\t\treturn `${CONFIG.DND4E.actorSizes[actor.system.details.size]?.label} ${CONFIG.DND4E.creatureOrigin[actor.system.details.origin]?.label} ${CONFIG.DND4E.creatureType[actor.system.details.type]?.label}`;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n        case \"swade\":\r\n            if (system?.wildcard) return `${game.i18n.localize(\"SWADE.WildCard\")}`;\r\n            switch (type) {\r\n                case \"character\":\r\n                case \"npc\":\r\n                    return `${game.i18n.localize(\"SWADE.Extra\")}`;\r\n                case \"vehicle\":\r\n                    return game.i18n.localize(\"TYPES.Actor.vehicle\");\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"pirateborg\":\r\n            switch (type) {\r\n                case \"character\":\r\n                    const classes = [actor.characterClass?.name || \"Character\"];\r\n                    if (actor.characterBaseClass?.name) {\r\n                        classes.push(actor.characterBaseClass.name);\r\n                    }\r\n                    return classes.join(\" - \");\r\n                case \"creature\":\r\n                    return \"Creature\";\r\n                case \"vehicle\":\r\n                case \"vehicle_npc\":\r\n                    return \"Ship\";\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"cyphersystem\":\r\n            switch (type) {\r\n                case \"pc\":\r\n                    return \"Character\";\r\n                case \"npc\":\r\n                    return \"Creature\";\r\n                case \"companion\":\r\n                    return \"Companion\";\r\n                case \"community\":\r\n                    return \"Community\";\r\n                case \"vehicle\":\r\n                    return \"Vehicle\";\r\n                case \"marker\":\r\n                    return \"Marker\";\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"pf2e\":\r\n            switch (type) {\r\n                case \"character\":\r\n                    return `Level ${system.details.level.value} ${system.details.class.name} (${system.details.ancestry.name})`;\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"crucible\":\r\n            if (actor.type === \"hero\") return `${system.details.ancestry.name} ${system.details.background.name} ${system.details.signatureName ? `(${system.details.signatureName})` : \"\"}`;\r\n            if (actor.type === \"adversary\") return `${system.details.taxonomy.name} ${system.details.archetype.name} (${game.i18n.localize(\"ADVANCEMENT.Level\")} ${system.details.level} ${game.i18n.localize(\"ADVERSARY.Threat\" + system.details.threat.charAt(0).toUpperCase() + system.details.threat.slice(1))})`;\r\n        case \"wfrp4e\":\r\n            switch (type) {\r\n                case \"character\":\r\n                    return `${actor.Species} ${actor.currentCareer.name}`;\r\n                case \"npc\":\r\n                    const length = actor.itemTypes.career.length - 1;\r\n                    if (length < 0) {\r\n                        return `${actor.Species}`;\r\n                    } else {\r\n                        const careers = Object.values(actor.itemTypes.career).map((c) => c.name);\r\n                        const career = careers[length];\r\n                        return `${actor.Species} ${career}`;\r\n                    }\r\n                case \"creature\":\r\n                    return `${actor.Species}`;\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"alienrpg\":\r\n            switch (type) {\r\n                case \"character\":\r\n                    let career;\r\n                    if (system.general.career.value == 1) career = game.i18n.localize(\"ALIENRPG.ColonialMarine\");\r\n                    else if (system.general.career.value == 2) career = game.i18n.localize(\"ALIENRPG.ColonialMarshal\");\r\n                    else if (system.general.career.value == 3) career = game.i18n.localize(\"ALIENRPG.CompanyAgent\");\r\n                    else if (system.general.career.value == 4) career = game.i18n.localize(\"ALIENRPG.Kid\");\r\n                    else if (system.general.career.value == 5) career = game.i18n.localize(\"ALIENRPG.Medic\");\r\n                    else if (system.general.career.value == 6) career = game.i18n.localize(\"ALIENRPG.Mercenary\");\r\n                    else if (system.general.career.value == 7) career = game.i18n.localize(\"ALIENRPG.Officer\");\r\n                    else if (system.general.career.value == 8) career = game.i18n.localize(\"ALIENRPG.Pilot\");\r\n                    else if (system.general.career.value == 9) career = game.i18n.localize(\"ALIENRPG.Roughneck\");\r\n                    else if (system.general.career.value == 10) career = game.i18n.localize(\"ALIENRPG.Scientist\");\r\n                    else if (system.general.career.value == 11) career = game.i18n.localize(\"ALIENRPG.Synthetic\");\r\n                    else if (system.general.career.value == 12) career = game.i18n.localize(\"ALIENRPG.Homebrew\");\r\n                    if (actor.itemTypes.specialty.length == 0) return `${career}`;\r\n                    else if (actor.itemTypes.specialty.length == 1) {\r\n                        const specialties = Object.values(actor.itemTypes.specialty).map((c) => c.name);\r\n                        const specialty = specialties[0];\r\n                        return `${career}: ${specialty}`;\r\n                    }\r\n                case \"synthetic\":\r\n                    let careersynth;\r\n                    if (system.general.career.value == 1) careersynth = game.i18n.localize(\"ALIENRPG.ColonialMarine\");\r\n                    else if (system.general.career.value == 2) careersynth = game.i18n.localize(\"ALIENRPG.ColonialMarshal\");\r\n                    else if (system.general.career.value == 3) careersynth = game.i18n.localize(\"ALIENRPG.CompanyAgent\");\r\n                    else if (system.general.career.value == 4) careersynth = game.i18n.localize(\"ALIENRPG.Kid\");\r\n                    else if (system.general.career.value == 5) careersynth = game.i18n.localize(\"ALIENRPG.Medic\");\r\n                    else if (system.general.career.value == 6) careersynth = game.i18n.localize(\"ALIENRPG.Mercenary\");\r\n                    else if (system.general.career.value == 7) careersynth = game.i18n.localize(\"ALIENRPG.Officer\");\r\n                    else if (system.general.career.value == 8) careersynth = game.i18n.localize(\"ALIENRPG.Pilot\");\r\n                    else if (system.general.career.value == 9) careersynth = game.i18n.localize(\"ALIENRPG.Roughneck\");\r\n                    else if (system.general.career.value == 10) careersynth = game.i18n.localize(\"ALIENRPG.Scientist\");\r\n                    else if (system.general.career.value == 11) careersynth = game.i18n.localize(\"ALIENRPG.Synthetic\");\r\n                    else if (system.general.career.value == 12) careersynth = game.i18n.localize(\"ALIENRPG.Homebrew\");\r\n                    if (actor.itemTypes.specialty.length == 0) return `${careersynth}`;\r\n                    else if (actor.itemTypes.specialty.length == 1) {\r\n                        const specialties = Object.values(actor.itemTypes.specialty).map((c) => c.name);\r\n                        const specialty = specialties[0];\r\n                        return `${careersynth}: ${specialty}`;\r\n                    }\r\n                case \"spacecraft\":\r\n                    return `${game.i18n.localize(\"ALIENRPG.MODEL\")}: ${system.attributes.model}`;\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"exaltedthird\":\r\n            switch (type) {\r\n                case \"character\":\r\n                case \"npc\":\r\n                    return `${game.i18n.localize(\"Ex3.Essence\")} ${system.essence.value}`;\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"exaltedessence\":\r\n            switch (type) {\r\n                case \"character\":\r\n                case \"npc\":\r\n                    return `${game.i18n.localize(\"ExEss.Essence\")} ${system.essence.value}`;\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"swnr\":\r\n            switch (type) {\r\n                case \"character\":\r\n                    return `${game.i18n.localize(\"swnr.sheet.level\")} ${system.level.value} ${system.background} ${system.class}`;\r\n                case \"npc\":\r\n                    return \"NPC\";\r\n                case \"vehicle\":\r\n                    return \"Vehicle\";\r\n                case \"ship\":\r\n                    return \"Ship\";\r\n                case \"drone\":\r\n                    return \"Drone\";\r\n                case \"mech\":\r\n                    return \"Mech\";\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"wwn\":\r\n            switch (type) {\r\n                case \"Character\":\r\n                    return `Level ${system.details.level} ${system.details.background} ${system.details.class}`;\r\n                case \"Faction\":\r\n                    return \"Faction\";\r\n                case \"Monster\":\r\n                    return `${system.hp.hd} hit dice Monster`;\r\n                default:\r\n                    return null;\r\n            }\r\n        case \"ars\":\r\n            switch (type) {\r\n                case \"character\":\r\n                    return \"Player Character\";\r\n                case \"lootable\":\r\n                    return \"Loot\";\r\n                case \"merchant\":\r\n                    return \"Merchant\";                    \r\n                case \"npc\":\r\n                    return \"Non-Player-Character\";\r\n                default:\r\n                    return null;\r\n            }            \r\n        case \"lancer\":\r\n            return game.lancer.combatTrackerDock?.generateDescription(actor);\r\n        case \"shadowdark\":\r\n            switch (type) {\r\n                case \"Player\":\r\n                case \"NPC\":\r\n                    return `Level: ${system.level.value}`;\r\n                default:\r\n                    return null;\r\n            }\r\n    }\r\n}\r\n\r\n/**\r\n * Retrieves the display information for the initiative of a combatant based on the game system.\r\n * The icon can be both a font-awesome icon or an image.\r\n *\r\n * @param {Object} combatant - The combatant object.\r\n * @returns {Object} The initiative display information, including value, icon, and roll icon.\r\n */\r\n\r\nexport function getInitiativeDisplay(combatant) {\r\n    switch (game.system.id) {\r\n        case \"swade\": {\r\n            let suit = \"\";\r\n            const getCardImage = (cardstr) => {\r\n                return Array.from(game.cards.get(game.settings.get(\"swade\", \"actionDeck\")).cards).find((c) => c.description === cardstr)?.img;\r\n            };\r\n            let cardString = combatant?.cardString ?? \"\";\r\n            if (cardString.includes(\"\")) suit = \"fas fa-heart\";\r\n            else if (cardString.includes(\"\")) suit = \"fas fa-diamond\";\r\n            else if (cardString.includes(\"\")) suit = \"fas fa-club\";\r\n            else if (cardString.includes(\"\")) suit = \"fas fa-spade\";\r\n            else if (cardString === \"Red J\" || cardString === \"Blk J\") cardString = \"JK\";\r\n\r\n            return {\r\n                value: cardString,\r\n                icon: getCardImage(combatant?.cardString ?? \"\") ?? suit,\r\n                rollIcon: \"far fa-cards-blank\",\r\n            };\r\n        }\r\n        case \"wfrp4e\": {\r\n            return {\r\n                value: combatant?.initiative,\r\n                icon: \"far fa-dice-d10\",\r\n                rollIcon: \"far fa-dice-d10\",\r\n            };\r\n        }\r\n        case \"alienrpg\": {\r\n            return {\r\n                value: combatant?.initiative,\r\n                icon: \"far fa-cards-blank\",\r\n                rollIcon: \"fa-solid fa-cards-blank\",\r\n            };\r\n        }\r\n        case \"exaltedthird\": {\r\n            return {\r\n                value: combatant?.initiative,\r\n                icon: \"far fa-dice-d10\",\r\n                rollIcon: \"far fa-dice-d10\",\r\n            };\r\n        }\r\n        case \"exaltedessence\": {\r\n            return {\r\n                value: combatant?.initiative,\r\n                icon: \"far fa-dice-d10\",\r\n                rollIcon: \"far fa-dice-d10\",\r\n            };\r\n        }\r\n        case \"lancer\":\r\n            return (\r\n                game.lancer.combatTrackerDock?.getInitiativeDisplay(combatant) ?? {\r\n                    value: combatant?.initiative,\r\n                    icon: \"fas fa-dice-d20\",\r\n                    rollIcon: \"fas fa-dice-d20\",\r\n                }\r\n            );\r\n        case \"dnd4e\":\r\n            return {\r\n\t\t\t\tvalue: combatant?.initiative ? parseInt(combatant.initiative).toString() : null,\r\n\t\t\t\ticon: \"fas fa-dice-d20\",\r\n\t\t\t\trollIcon: \"fas fa-dice-d20\",\r\n\t\t\t};\t\r\n        default:\r\n            return {\r\n                value: combatant?.initiative,\r\n                icon: \"far fa-dice-d20\",\r\n                rollIcon: \"far fa-dice-d20\",\r\n            };\r\n    }\r\n}\r\n\r\n/**\r\n * Retrieves system icons for the given actor based on the game system.\r\n * These icons can be shown both at the bottom of the tooltip and\r\n * in the portrait under the tracked resource. If a callback is provided, it will be called on click.\r\n *\r\n * Example Icon Object:\r\n *\r\n *  {\r\n *      icon: \"fas fa-times\",\r\n *      color: \"#e16de1\",\r\n *      enabled: true,\r\n *      visible: true, // If not provided, defaults to combattant permissions.\r\n *      callback: (event, combatant, iconIndex, iconId) => { },\r\n *      id: \"my-button\",\r\n *      fontSize: \"1rem\",\r\n *  }\r\n *\r\n * @param {Object} actor - The actor object.\r\n * @returns {Array} An array of system icons with their respective properties.\r\n */\r\n\r\nexport function getSystemIcons(combatant) {\r\n    switch (game.system.id) {\r\n        case \"dnd5e\": {\r\n            if (game.modules.get(\"midi-qol\")?.active && combatant.actor) {\r\n                const getMidiFlag = (actionType) => {\r\n                    const flag = combatant.actor.getFlag(\"midi-qol\", \"actions\") ?? {};\r\n                    return flag[actionType] ?? false;\r\n                };\r\n                const toggleMidiFlag = (actionType) => {\r\n                    const flag = combatant.actor.getFlag(\"midi-qol\", \"actions\") ?? {};\r\n                    flag[actionType] = !(flag[actionType] ?? false);\r\n                    combatant.actor.setFlag(\"midi-qol\", \"actions\", flag);\r\n                };\r\n                return [\r\n                    {\r\n                        icon: \"fas fa-circle\",\r\n                        color: getMidiFlag(\"action\") ? \"#888888\" : \"green\",\r\n                        enabled: true,\r\n                        callback: combatant.isOwner ? () => toggleMidiFlag(\"action\") : null,\r\n                    },\r\n                    {\r\n                        icon: \"fas fa-triangle\",\r\n                        color: getMidiFlag(\"bonus\") ? \"#888888\" : \"#ff9f4c\",\r\n                        enabled: true,\r\n                        callback: combatant.isOwner ? () => toggleMidiFlag(\"bonus\") : null,\r\n                    },\r\n                    {\r\n                        icon: \"fas fa-sparkle\",\r\n                        color: getMidiFlag(\"reaction\") ? \"#888888\" : \"#e16de1\",\r\n                        enabled: true,\r\n                        callback: combatant.isOwner ? () => toggleMidiFlag(\"reaction\") : null,\r\n                    },\r\n                ];\r\n            }\r\n            return [\r\n                {\r\n                    icon: \"fas fa-circle\",\r\n                    color: combatant.getFlag(MODULE_ID, \"action\") ?? true ? \"green\" : \"#888888\",\r\n                    enabled: true,\r\n                    callback: combatant.isOwner\r\n                        ? (event, combatant, iconIndex, iconId) => {\r\n                              combatant.setFlag(MODULE_ID, \"action\", !(combatant.getFlag(MODULE_ID, \"action\") ?? true));\r\n                          }\r\n                        : null,\r\n                },\r\n                {\r\n                    icon: \"fas fa-triangle\",\r\n                    color: combatant.getFlag(MODULE_ID, \"bonus\") ?? true ? \"#ff9f4c\" : \"#888888\",\r\n                    enabled: true,\r\n                    callback: combatant.isOwner\r\n                        ? (event, combatant, iconIndex, iconId) => {\r\n                              combatant.setFlag(MODULE_ID, \"bonus\", !(combatant.getFlag(MODULE_ID, \"bonus\") ?? true));\r\n                          }\r\n                        : null,\r\n                },\r\n                {\r\n                    icon: \"fas fa-sparkle\",\r\n                    color: combatant.getFlag(MODULE_ID, \"reaction\") ?? true ? \"#e16de1\" : \"#888888\",\r\n                    enabled: true,\r\n                    callback: combatant.isOwner\r\n                        ? (event, combatant, iconIndex, iconId) => {\r\n                              combatant.setFlag(MODULE_ID, \"reaction\", !(combatant.getFlag(MODULE_ID, \"reaction\") ?? true));\r\n                          }\r\n                        : null,\r\n                },\r\n            ];\r\n        }\r\n        case \"crucible\": {\r\n            const systemData = combatant.actor?.system;\r\n            const alwaysShowActions = getSystemSetting(\"alwaysShowActions\") || undefined;\r\n            const actions = {\r\n                value: systemData.resources.action.value,\r\n                max: systemData.resources.action.max,\r\n            };\r\n            const focus = {\r\n                value: systemData.resources.focus.value,\r\n                max: systemData.resources.focus.max,\r\n            };\r\n            const systemIcons = [];\r\n            for (let i = 0; i < actions.max; i++) {\r\n                systemIcons.push({\r\n                    icon: \"fas fa-square\",\r\n                    color: \"#ff6400\",\r\n                    enabled: actions.value > 0,\r\n                    visible: alwaysShowActions,\r\n                });\r\n                actions.value--;\r\n            }\r\n            for (let i = 0; i < focus.max; i++) {\r\n                systemIcons.push({\r\n                    icon: \"fas fa-sparkle\",\r\n                    color: \"#00bbff\",\r\n                    enabled: focus.value > 0,\r\n                });\r\n                focus.value--;\r\n            }\r\n            return systemIcons;\r\n        }\r\n        case \"alienrpg\": {\r\n            if (game.modules.get(\"alien-actions\")?.active && combatant.actor && combatant.actor.type !== \"spacecraft\") {\r\n                return [\r\n                    {\r\n                        icon: \"fas fa-play\",\r\n                        fontSize: \"1rem\",\r\n                        enabled: true,\r\n                        callback: combatant.isOwner\r\n                            ? (event, combatant) => {\r\n                                  const token = combatant.actor.getActiveTokens();\r\n                                  token.forEach((t) => t.toggleEffect(CONFIG.statusEffects.find((eff) => eff.id === \"slowAction\")));\r\n                              }\r\n                            : null,\r\n                    },\r\n                    {\r\n                        icon: \"fas fa-forward\",\r\n                        fontSize: \"1rem\",\r\n                        enabled: true,\r\n                        callback: combatant.isOwner\r\n                            ? (event, combatant) => {\r\n                                  const token = combatant.actor.getActiveTokens();\r\n                                  token.forEach((t) => t.toggleEffect(CONFIG.statusEffects.find((eff) => eff.id === \"fastAction\")));\r\n                              }\r\n                            : null,\r\n                    },\r\n                ];\r\n            }\r\n        }\r\n        case \"lancer\":\r\n            return game.lancer.combatTrackerDock?.getSystemIcons(combatant) ?? [];\r\n        default: {\r\n            return [];\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Register settings for specific game systems.\r\n * This function is called once on startup.\r\n * When you need to get the setting value, use `getSystemSetting(key) helper`.\r\n */\r\n\r\nexport function registerSystemSettings() {\r\n    switch (game.system.id) {\r\n        case \"crucible\":\r\n            registerSystemSetting(\"alwaysShowActions\", {\r\n                scope: \"world\",\r\n                config: true,\r\n                type: Boolean,\r\n                default: true,\r\n                onChange: () => ui.combatDock?.refresh(),\r\n            });\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n}\r\n","import { AttributesConfig } from \"./attributesConfig.js\";\nimport {registerSystemSettings} from \"./systems.js\";\nimport { MODULE_ID } from \"./main.js\";\n\nexport function registerSettings() {\n    game.settings.register(MODULE_ID, \"attributes\", {\n        scope: \"world\",\n        config: false,\n        type: Array,\n        default: CONFIG.combatTrackerDock.defaultAttributesConfig()[game.system.id] ?? [],\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"events\", {\n        scope: \"world\",\n        config: false,\n        type: Array,\n        default: [],\n    });\n\n    game.settings.registerMenu(MODULE_ID, \"attributesMenu\", {\n        name: game.i18n.localize(`${MODULE_ID}.settings.attributesMenu.name`),\n        label: game.i18n.localize(`${MODULE_ID}.settings.attributesMenu.label`),\n        hint: game.i18n.localize(`${MODULE_ID}.settings.attributesMenu.hint`),\n        icon: \"fas fa-cogs\",\n        scope: \"world\",\n        restricted: true,\n        type: AttributesConfig,\n    });\n\n    game.settings.register(MODULE_ID, \"direction\", {\n        name: \"combat-tracker-dock.settings.direction.name\",\n        hint: \"combat-tracker-dock.settings.direction.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            rowDocked: \"combat-tracker-dock.settings.direction.choices.rowDocked\",\n            rowFloat: \"combat-tracker-dock.settings.direction.choices.rowFloat\",\n            columnFloat: \"combat-tracker-dock.settings.direction.choices.columnFloat\",\n        },\n        default: \"rowDocked\",\n        onChange: async () => {\n            await ui.combatDock?.restart();\n            setDirection();\n            setOverflowStyle();\n            setFlex();\n            ui.combatDock?.autosize();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"portraitSize\", {\n        name: \"combat-tracker-dock.settings.portraitSize.name\",\n        hint: \"combat-tracker-dock.settings.portraitSize.hint\",\n        scope: \"client\",\n        config: true,\n        type: String,\n        choices: {\n            \"30px\": \"combat-tracker-dock.settings.portraitSize.choices.30px\",\n            \"50px\": \"combat-tracker-dock.settings.portraitSize.choices.50px\",\n            \"70px\": \"combat-tracker-dock.settings.portraitSize.choices.70px\",\n            \"90px\": \"combat-tracker-dock.settings.portraitSize.choices.90px\",\n            \"110px\": \"combat-tracker-dock.settings.portraitSize.choices.110px\",\n            \"150px\": \"combat-tracker-dock.settings.portraitSize.choices.150px\",\n            \"180px\": \"combat-tracker-dock.settings.portraitSize.choices.180px\",\n        },\n        default: \"70px\",\n        onChange: () => {\n            setPortraitSize();\n            ui.combatDock?.autosize();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"overflowStyle\", {\n        name: \"combat-tracker-dock.settings.overflowStyle.name\",\n        hint: \"combat-tracker-dock.settings.overflowStyle.hint\",\n        scope: \"client\",\n        config: true,\n        type: String,\n        choices: {\n            autofit: \"combat-tracker-dock.settings.overflowStyle.choices.autofit\",\n            hidden: \"combat-tracker-dock.settings.overflowStyle.choices.hidden\",\n            scroll: \"combat-tracker-dock.settings.overflowStyle.choices.scroll\",\n        },\n        default: \"autofit\",\n        onChange: () => {\n            setOverflowStyle();\n            ui.combatDock?.autosize();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"carouselStyle\", {\n        name: \"combat-tracker-dock.settings.carouselStyle.name\",\n        hint: \"combat-tracker-dock.settings.carouselStyle.hint\",\n        scope: \"world\",\n        config: true,\n        type: Number,\n        choices: {\n            0: \"combat-tracker-dock.settings.carouselStyle.choices.centerCarousel\",\n            1: \"combat-tracker-dock.settings.carouselStyle.choices.leftCarousel\",\n            2: \"combat-tracker-dock.settings.carouselStyle.choices.basic\",\n        },\n        default: 0,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"alignment\", {\n        name: \"combat-tracker-dock.settings.alignment.name\",\n        hint: \"combat-tracker-dock.settings.alignment.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            left: \"combat-tracker-dock.settings.alignment.choices.left\",\n            center: \"combat-tracker-dock.settings.alignment.choices.center\",\n            right: \"combat-tracker-dock.settings.alignment.choices.right\",\n        },\n        default: \"center\",\n        onChange: () => {\n            setAlignment();\n            setFlex();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"floatingSize\", {\n        name: \"combat-tracker-dock.settings.floatingSize.name\",\n        hint: \"combat-tracker-dock.settings.floatingSize.hint\",\n        scope: \"world\",\n        config: true,\n        type: Number,\n        default: 60,\n        range: {\n            min: 30,\n            max: 100,\n            step: 1,\n        },\n        onChange: () => {\n            setFloatingSize();\n            ui.combatDock?.refresh();\n        }\n    });\n\n    game.settings.register(MODULE_ID, \"portraitAspect\", {\n        name: \"combat-tracker-dock.settings.portraitAspect.name\",\n        hint: \"combat-tracker-dock.settings.portraitAspect.hint\",\n        scope: \"world\",\n        config: true,\n        type: Number,\n        choices: {\n            1: \"combat-tracker-dock.settings.portraitAspect.choices.square\",\n            1.5: \"combat-tracker-dock.settings.portraitAspect.choices.portrait\",\n            2: \"combat-tracker-dock.settings.portraitAspect.choices.long\",\n        },\n        default: 1.5,\n        onChange: () => {\n            setPortraitAspect();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"roundness\", {\n        name: \"combat-tracker-dock.settings.roundness.name\",\n        hint: \"combat-tracker-dock.settings.roundness.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            \"0%\": \"combat-tracker-dock.settings.roundness.choices.sharp\",\n            \"10%\": \"combat-tracker-dock.settings.roundness.choices.soft\",\n            \"20%\": \"combat-tracker-dock.settings.roundness.choices.round\",\n        },\n        default: \"0%\",\n        onChange: () => {\n            setRoundness();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"attributeColor\", {\n        name: \"combat-tracker-dock.settings.attributeColor.name\",\n        hint: \"combat-tracker-dock.settings.attributeColor.hint\",\n        scope: \"world\",\n        config: true,\n        type: new foundry.data.fields.ColorField(),\n        default: \"#41AA7D\",\n        onChange: () => {\n            setAttributeColor();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"attributeColor2\", {\n        name: \"combat-tracker-dock.settings.attributeColor2.name\",\n        hint: \"combat-tracker-dock.settings.attributeColor2.hint\",\n        scope: \"world\",\n        config: true,\n        type: new foundry.data.fields.ColorField(),\n        default: \"#ffcd00\",\n        onChange: () => {\n            setAttributeColor();\n            ui.combatDock?.refresh();\n        },\n    });\n    //\n    game.settings.register(MODULE_ID, \"attributeColorPortrait\", {\n        name: \"combat-tracker-dock.settings.attributeColorPortrait.name\",\n        hint: \"combat-tracker-dock.settings.attributeColorPortrait.hint\",\n        scope: \"world\",\n        config: true,\n        type: new foundry.data.fields.ColorField(),\n        default: \"#e62121\",\n        onChange: () => {\n            setAttributeColor();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"barsPlacement\", {\n        name: \"combat-tracker-dock.settings.barsPlacement.name\",\n        hint: \"combat-tracker-dock.settings.barsPlacement.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            left: \"combat-tracker-dock.settings.barsPlacement.choices.left\",\n            right: \"combat-tracker-dock.settings.barsPlacement.choices.right\",\n            twinned: \"combat-tracker-dock.settings.barsPlacement.choices.twinned\",\n        },\n        default: \"left\",\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"attributeVisibility\", {\n        name: \"combat-tracker-dock.settings.attributeVisibility.name\",\n        hint: \"combat-tracker-dock.settings.attributeVisibility.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            text: \"combat-tracker-dock.settings.attributeVisibility.choices.text\",\n            bars: \"combat-tracker-dock.settings.attributeVisibility.choices.bars\",\n            both: \"combat-tracker-dock.settings.attributeVisibility.choices.both\",\n        },\n        default: \"both\",\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"displayDescriptions\", {\n        name: \"combat-tracker-dock.settings.displayDescriptions.name\",\n        hint: \"combat-tracker-dock.settings.displayDescriptions.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            \"none\": \"combat-tracker-dock.settings.displayDescriptions.choices.none\",\n            \"owner\": \"combat-tracker-dock.settings.displayDescriptions.choices.owner\",\n            \"all\": \"combat-tracker-dock.settings.displayDescriptions.choices.all\",\n        },\n        default: \"owner\",\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"hideDefeated\", {\n        name: \"combat-tracker-dock.settings.hideDefeated.name\",\n        hint: \"combat-tracker-dock.settings.hideDefeated.hint\",\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"showDispositionColor\", {\n        name: \"combat-tracker-dock.settings.showDispositionColor.name\",\n        hint: \"combat-tracker-dock.settings.showDispositionColor.hint\",\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"showInitiativeOnPortrait\", {\n        name: \"combat-tracker-dock.settings.showInitiativeOnPortrait.name\",\n        hint: \"combat-tracker-dock.settings.showInitiativeOnPortrait.hint\",\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"portraitImage\", {\n        name: \"combat-tracker-dock.settings.portraitImage.name\",\n        hint: \"combat-tracker-dock.settings.portraitImage.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            actor: \"combat-tracker-dock.settings.portraitImage.choices.actor\",\n            token: \"combat-tracker-dock.settings.portraitImage.choices.token\",\n        },\n        default: \"actor\",\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"displayName\", {\n        name: \"combat-tracker-dock.settings.displayName.name\",\n        hint: \"combat-tracker-dock.settings.displayName.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        choices: {\n            default: \"combat-tracker-dock.settings.displayName.choices.default\",\n            token: \"combat-tracker-dock.settings.displayName.choices.token\",\n            owner: \"combat-tracker-dock.settings.displayName.choices.owner\",\n        },\n        default: \"default\",\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"playerPlayerPermission\", {\n        name: \"combat-tracker-dock.settings.playerPlayerPermission.name\",\n        hint: \"combat-tracker-dock.settings.playerPlayerPermission.hint\",\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"hideFirstRound\", {\n        name: \"combat-tracker-dock.settings.hideFirstRound.name\",\n        hint: \"combat-tracker-dock.settings.hideFirstRound.hint\",\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"hideEnemyInitiative\", {\n        name: \"combat-tracker-dock.settings.hideEnemyInitiative.name\",\n        hint: \"combat-tracker-dock.settings.hideEnemyInitiative.hint\",\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: false,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"portraitImageBorder\", {\n        name: \"combat-tracker-dock.settings.portraitImageBorder.name\",\n        hint: \"combat-tracker-dock.settings.portraitImageBorder.hint\",\n        scope: \"world\",\n        config: true,\n        type: new foundry.data.fields.FilePathField({categories: [\"IMAGE\"]}),\n        default: \"modules/combat-tracker-dock/assets/border.png\",\n        onChange: function () {\n            setPortraitImageBorder();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"portraitImageBackground\", {\n        name: \"combat-tracker-dock.settings.portraitImageBackground.name\",\n        hint: \"combat-tracker-dock.settings.portraitImageBackground.hint\",\n        scope: \"world\",\n        config: true,\n        type: new foundry.data.fields.FilePathField({categories: [\"IMAGE\"]}),\n        default: \"ui/denim075.png\",\n        onChange: function () {\n            setPortraitImageBackground();\n            ui.combatDock?.refresh();\n        },\n    });\n\n    game.settings.register(MODULE_ID, \"showSystemIcons\", {\n        name: \"combat-tracker-dock.settings.showSystemIcons.name\",\n        hint: \"combat-tracker-dock.settings.showSystemIcons.hint\",\n        scope: \"world\",\n        config: true,\n        type: Number,\n        choices: {\n            0: \"combat-tracker-dock.settings.showSystemIcons.choices.none\",\n            1: \"combat-tracker-dock.settings.showSystemIcons.choices.tooltip\",\n            2: \"combat-tracker-dock.settings.showSystemIcons.choices.resource\",\n            3: \"combat-tracker-dock.settings.showSystemIcons.choices.both\",\n        },\n        default: 1,\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"hideConflictingUIs\", {\n        name: \"combat-tracker-dock.settings.hideConflictingUIs.name\",\n        hint: \"combat-tracker-dock.settings.hideConflictingUIs.hint\",\n        scope: \"world\",\n        config: true,\n        type: Boolean,\n        default: true,\n        onChange: () => setHideConflictingUIs(),\n    });\n\n    registerSystemSettings();\n\n    setAllSettings();\n\n    game.settings.register(MODULE_ID, \"resource\", {\n        name: \"combat-tracker-dock.settings.resource.name\",\n        hint: \"combat-tracker-dock.settings.resource.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        default: \"\",\n        onChange: () => ui.combatDock?.refresh(),\n    });\n\n    game.settings.register(MODULE_ID, \"portraitResource\", {\n        name: \"combat-tracker-dock.settings.portraitResource.name\",\n        hint: \"combat-tracker-dock.settings.portraitResource.hint\",\n        scope: \"world\",\n        config: true,\n        type: String,\n        default: \"\",\n        onChange: () => ui.combatDock?.refresh(),\n    });\n}\n\nfunction setAllSettings() {\n    setDirection();\n    setOverflowStyle();\n    setAlignment();\n    setFlex();\n    setPortraitAspect();\n    setRoundness();\n    setAttributeColor();\n    setPortraitImageBorder();\n    setPortraitImageBackground();\n    setHideConflictingUIs();\n    setFloatingSize();\n}\n\nfunction setFloatingSize() {\n    const floatingSize = game.settings.get(MODULE_ID, \"floatingSize\");\n    document.documentElement.style.setProperty(\"--carousel-floating-size\", floatingSize + \"%\");\n}\n\nfunction setPortraitSize() {\n    const portraitSize = game.settings.get(MODULE_ID, \"portraitSize\");\n    document.documentElement.style.setProperty(\"--combatant-portrait-size\", portraitSize);\n}\n\nfunction setPortraitAspect() {\n    const portraitAspect = game.settings.get(MODULE_ID, \"portraitAspect\");\n    document.documentElement.style.setProperty(\"--combatant-portrait-aspect\", portraitAspect);\n}\n\nfunction setAlignment() {\n    const alignment = game.settings.get(MODULE_ID, \"alignment\");\n    document.documentElement.style.setProperty(\"--carousel-alignment\", alignment);\n    ui.combatDock?.setControlsOrder();\n}\n\nfunction setPortraitImageBorder() {\n    let portraitImageBorder = game.settings.get(MODULE_ID, \"portraitImageBorder\");\n    document.documentElement.style.setProperty(\"--combatant-portrait-image-border\", `url('${portraitImageBorder}')`);\n}\n\nfunction setPortraitImageBackground() {\n    let portraitImageBackground = game.settings.get(MODULE_ID, \"portraitImageBackground\");\n    document.documentElement.style.setProperty(\"--combatant-portrait-image-background\", `url('${portraitImageBackground}')`);\n}\n\nfunction setHideConflictingUIs() {\n    const hideConflictingUIs = game.settings.get(MODULE_ID, \"hideConflictingUIs\");\n    document.querySelector(\"#ui-top\")?.classList.toggle(\"ctd-hide-conflicting-uis\", hideConflictingUIs);\n}\n\nfunction setRoundness() {\n    const roundness = game.settings.get(MODULE_ID, \"roundness\");\n    document.documentElement.style.setProperty(\"--combatant-portrait-border-radius\", roundness);\n}\n\nfunction setAttributeColor() {\n    const attributeColor = game.settings.get(MODULE_ID, \"attributeColor\") || \"#41AA7D\";\n    document.documentElement.style.setProperty(\"--attribute-bar-primary-color\", attributeColor);\n\n    const color = Color.from(attributeColor);\n    const darkened = color.mix(Color.from(\"#000\"), 0.5);\n\n    document.documentElement.style.setProperty(\"--attribute-bar-secondary-color\", darkened.toString());\n\n    const attributeColor2 = game.settings.get(MODULE_ID, \"attributeColor2\") || \"#ffcd00\";\n    document.documentElement.style.setProperty(\"--attribute-bar-primary-color2\", attributeColor2);\n\n    const color2 = Color.from(attributeColor2);\n    const darkened2 = color2.mix(Color.from(\"#000\"), 0.5);\n\n    document.documentElement.style.setProperty(\"--attribute-bar-secondary-color2\", darkened2.toString());\n\n    const attributeColorPortrait = game.settings.get(MODULE_ID, \"attributeColorPortrait\") || \"#e62121\";\n    document.documentElement.style.setProperty(\"--attribute-bar-portrait-color\", attributeColorPortrait);\n\n}\n\nfunction setOverflowStyle() {\n    let overflowStyle = game.settings.get(MODULE_ID, \"overflowStyle\");\n    if (overflowStyle === \"autofit\") overflowStyle = \"hidden\";\n    if (overflowStyle === \"scroll\") {\n        const direction = game.settings.get(MODULE_ID, \"direction\");\n        if (direction !== \"columnFloat\") overflowStyle = \"scroll hidden\";\n        else overflowStyle = \"hidden scroll\";\n    }\n    document.documentElement.style.setProperty(\"--carousel-overflow\", overflowStyle);\n}\n\nfunction setDirection() {\n    let direction = game.settings.get(MODULE_ID, \"direction\");\n    if(!(direction in game.settings.settings.get(`${MODULE_ID}.direction`).choices)) {\n        direction = direction.includes(\"column\") ? \"columnFloat\" : \"rowDocked\"; \n        game.settings.set(MODULE_ID, \"direction\", direction);\n    }\n    document.documentElement.style.setProperty(\"--carousel-direction\", direction === \"columnFloat\" ? \"column\" : \"row\");\n    document.documentElement.style.setProperty(\"--combatant-portrait-margin\", direction !== \"columnFloat\" ? \"0 calc(var(--combatant-portrait-size) * 0.1)\" : \"0\");\n    ui.combatDock?.setControlsOrder();\n}\n\nfunction setFlex() {\n    const alignment = game.settings.get(MODULE_ID, \"alignment\");\n    const direction = game.settings.get(MODULE_ID, \"direction\");\n    let flexD = \"flex-start\";\n    if (direction == \"columnFloat\" && alignment == \"right\") flexD = \"flex-end\";\n    if (direction == \"columnFloat\" && alignment == \"center\") flexD = \"center\";\n\n    document.documentElement.style.setProperty(\"--carousel-align-items\", flexD);\n}\n\nfunction l(key) {\n    return game.i18n.localize(key);\n}\n\nexport function registerSystemSetting(key, data) {\n    const rootKey = MODULE_ID + \".settings.systems.\" + game.system.id;\n    game.settings.register(MODULE_ID, game.system.id + \".\" + key, {\n        ...data,\n        name: game.system.title + \" \" + l(MODULE_ID + \".settings.integration\") + \": \" + l(rootKey+\".\"+key+\".name\"),\n        hint: l(rootKey+\".\"+key+\".hint\"),\n    });\n}\n\nexport function getSystemSetting(key) {\n    return game.settings.get(MODULE_ID, game.system.id + \".\" + key);\n}\n","import { MODULE_ID } from \"../main.js\";\n\nexport class HandlebarsApplication extends foundry.applications.api.HandlebarsApplicationMixin(\n    foundry.applications.api.ApplicationV2,\n) {\n    constructor() {\n        super();\n        this.constructor.registerPositionSetting();\n        this.savePosition = foundry.utils.debounce(\n            this.savePosition.bind(this),\n            100,\n        );\n    }\n\n    static registerPositionSetting() {\n        if (\n            this.POSITION_SETTING_REGISTERED ||\n            !this.DEFAULT_OPTIONS.window?.savePosition\n        )\n            return;\n        this.POSITION_SETTING_REGISTERED = true;\n        game.settings.register(MODULE_ID, this.APP_ID + \"-position\", {\n            scope: \"client\",\n            config: false,\n            type: Object,\n            default: {},\n        });\n    }\n\n    static resetSavedPosition() {\n        game.settings.set(MODULE_ID, this.APP_ID + \"-position\", {});\n    }\n\n    savePosition(position) {\n        const positionToSave = {\n            left: position.left,\n            top: position.top,\n            width: position.width,\n            height: position.height,\n        };\n        // if (positionToSave.width === \"auto\") delete positionToSave.width;\n        // if (positionToSave.height === \"auto\") delete positionToSave.height\n        if (this.constructor.DEFAULT_OPTIONS.position.width === \"auto\") delete positionToSave.width;\n        if (this.constructor.DEFAULT_OPTIONS.position.height === \"auto\") delete positionToSave.height;\n        game.settings.set(MODULE_ID, this.APP_ID + \"-position\", positionToSave);\n    }\n\n    setPosition(...args) {\n        if (this.constructor.DEFAULT_OPTIONS.position.width === \"auto\") delete args.width;\n        if (this.constructor.DEFAULT_OPTIONS.position.height === \"auto\") delete args.height;\n        const r = super.setPosition(...args);\n        if (this.constructor.POSITION_SETTING_REGISTERED)\n            this.savePosition(this.position);\n        return r;\n    }\n\n    static get APP_ID() {\n        return this.name\n            .split(/(?=[A-Z])/)\n            .join(\"-\")\n            .toLowerCase();\n    }\n\n    get APP_ID() {\n        return this.constructor.APP_ID;\n    }\n\n    static get PARTS() {\n        return {\n            content: {\n                template: `modules/${MODULE_ID}/templates/${this.APP_ID}.hbs`,\n                classes: [],\n                scrollable: [],\n            },\n        };\n    }\n\n    static get DEFAULT_OPTIONS() {\n        return {\n            tag: \"div\",\n            id: this.APP_ID,\n            window: {\n                title: `${MODULE_ID}.${this.APP_ID}.title`,\n                frame: true,\n                positioned: true,\n                icon: \"\",\n                controls: [],\n                minimizable: true,\n                resizable: false,\n                contentTag: \"section\",\n                contentClasses: [],\n                savePosition: false,\n                preventEscapeClose: false\n            },\n            actions: {},\n            form: {\n                handler: undefined,\n                submitOnChange: false,\n                closeOnSubmit: false,\n            },\n            position: {\n                width: 560,\n                height: \"auto\",\n            },\n        };\n    }\n\n    async _prepareContext(options) {\n        if (this.getData) return this.getData();\n        const data = {};\n        return { data };\n    }\n\n    activateListeners() {}\n\n    _onRender(context, options) {\n        super._onRender(context, options);\n        if (this.constructor.DEFAULT_OPTIONS.window.preventEscapeClose) {\n            foundry.applications.instances.delete(this.id, this);\n            this.window.close.style.display = \"none\"\n        }\n        const html = this.element;\n        if (this.activateListeners) this.activateListeners(html);\n    }\n\n    async render(options1 = {}, options2 = {}) {\n        const activeOptions =\n            typeof options1 === \"boolean\" ? options2 : options1;\n        if (\n            !activeOptions.position &&\n            this.constructor.POSITION_SETTING_REGISTERED\n        )\n            activeOptions.position = game.settings.get(\n                MODULE_ID,\n                this.APP_ID + \"-position\",\n            );\n        return super.render(options1, options2);\n    }\n}\n\nexport function dynamicImport(url) {\n    const dynamicImport = new Function(\"url\", \"return import(url)\");\n    return dynamicImport(url);\n}\n\nexport function confirm(title, content, options = {}) {\n    title = l(title);\n    content = l(content);\n    return foundry.applications.api.DialogV2.confirm({\n        window: { title },\n        content,\n    });\n}\n\nexport function prompt(title, content, options = {}) {\n    title = l(title);\n    content = l(content);\n    return foundry.applications.api.DialogV2.prompt({\n        window: { title },\n        content,\n        ...options,\n    });\n}\n\nexport function deepClone(obj) {\n    return foundry.utils.deepClone(obj);\n}\n\nexport function expandObject(obj) {\n    return foundry.utils.expandObject(obj);\n}\n\nexport function flattenObject(obj) {\n    return foundry.utils.flattenObject(obj);\n}\n\nexport function mergeObject(obj, other) {\n    return foundry.utils.mergeObject(obj, other);\n}\n\nexport function mergeClone(obj, other) {\n    obj = foundry.utils.deepClone(obj);\n    other = foundry.utils.deepClone(other);\n    return foundry.utils.mergeObject(obj, other);\n}\n\nexport function randomID(length = 20) {\n    return foundry.utils.randomID(length);\n}\n\nexport function setProperty(obj, key, value) {\n    return foundry.utils.setProperty(obj, key, value);\n}\n\nexport function getProperty(obj, key) {\n    return foundry.utils.getProperty(obj, key);\n}\n\nexport function l(x) {\n    return game.i18n.localize(x);\n}\n\nexport function easeInSine(x) {\n    return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x) {\n    return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x) {\n    return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInQuad(x) {\n    return x * x;\n}\n\nexport function easeOutQuad(x) {\n    return 1 - (1 - x) * (1 - x);\n}\n\nexport function easeInOutQuad(x) {\n    return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;\n}\n\nexport function easeInCubic(x) {\n    return x * x * x;\n}\n\nexport function easeOutCubic(x) {\n    return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x) {\n    return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInQuart(x) {\n    return x * x * x * x;\n}\n\nexport function easeOutQuart(x) {\n    return 1 - Math.pow(1 - x, 4);\n}\n\nexport function easeInOutQuart(x) {\n    return x < 0.5 ? 8 * x * x * x * x : 1 - Math.pow(-2 * x + 2, 4) / 2;\n}\n\nexport function easeInQuint(x) {\n    return x * x * x * x * x;\n}\n\nexport function easeOutQuint(x) {\n    return 1 - Math.pow(1 - x, 5);\n}\n\nexport function easeInOutQuint(x) {\n    return x < 0.5 ? 16 * x * x * x * x * x : 1 - Math.pow(-2 * x + 2, 5) / 2;\n}\n\nexport function easeInExpo(x) {\n    return x == 0 ? x : Math.pow(2, 10 * (x - 1));\n}\n\nexport function easeOutExpo(x) {\n    return x == 1 ? x : 1 - Math.pow(2, -10 * x);\n}\n\nexport function easeInOutExpo(x) {\n    return x == 0\n        ? 0\n        : x == 1\n          ? 1\n          : x < 0.5\n            ? Math.pow(2, 20 * x - 10) / 2\n            : (2 - Math.pow(2, -20 * x + 10)) / 2;\n}\n\nexport function easeInCirc(x) {\n    return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x) {\n    return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x) {\n    return x < 0.5\n        ? 1 - Math.sqrt(1 - Math.pow(2 * x, 2)) / 2\n        : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n\nexport function easeInElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1) == 1) return 1;\n    if (!p) p = 0.3;\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    return -(\n        a *\n        Math.pow(2, 10 * (x -= 1)) *\n        Math.sin(((x * 1 - s) * (2 * Math.PI)) / p)\n    );\n}\n\nexport function easeOutElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1) == 1) return 1;\n    if (!p) p = 0.3;\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    return (\n        a * Math.pow(2, -10 * x) * Math.sin(((x * 1 - s) * (2 * Math.PI)) / p) +\n        1\n    );\n}\n\nexport function easeInOutElastic(x) {\n    let s = 1.70158;\n    let p = 0;\n    let a = 1;\n    if (x == 0) return 0;\n    if ((x /= 1 / 2) == 2) return 1;\n    if (!p) p = 0.3 * (0.3 + 1);\n    if (a < 1) {\n        a = 1;\n        s = p / 4;\n    } else {\n        s = (p / (2 * Math.PI)) * Math.asin(1 / a);\n    }\n    if (x < 1)\n        return (\n            -0.5 *\n            (a *\n                Math.pow(2, 10 * (x -= 1)) *\n                Math.sin(((x * 1 - s) * (2 * Math.PI)) / p))\n        );\n    return (\n        a *\n            Math.pow(2, -10 * (x -= 1)) *\n            Math.sin(((x * 1 - s) * (2 * Math.PI)) / p) *\n            0.5 +\n        1\n    );\n}\n\nexport function easeInBack(x) {\n    let s = 1.70158;\n    return x * x * ((s + 1) * x - s);\n}\n\nexport function easeOutBack(x) {\n    let s = 1.70158;\n    return 1 - (1 - x) * (1 - x) * ((s + 1) * x - s);\n}\n\nexport function easeInOutBack(x) {\n    let s = 1.70158;\n    if ((x /= 1 / 2) < 1)\n        return (1 / 2) * (x * x * (((s *= 1.525) + 1) * x - s));\n    return (1 / 2) * ((x -= 2) * x * (((s *= 1.525) + 1) * x + s) + 2);\n}\n\nexport function addColorPicker(input, { value, opacity = false } = {}) {\n    const hexToComponents = (hex) => {\n        const hexColor =\n            hex.length < 9 ? hex + \"f\".repeat(9 - hex.length) : hex;\n\n        const colorValue = hexColor.slice(0, 7);\n        const alphaValue = parseInt(hexColor.slice(7, 9), 16) / 255;\n        return { color: colorValue, alpha: alphaValue };\n    };\n\n    const componentsToHex = (color, alpha) => {\n        const colorValue = color.replace(\"#\", \"\");\n        const alphaValue = Math.round(alpha * 255)\n            .toString(16)\n            .padStart(2, \"0\");\n        return `#${colorValue}${alphaValue}`;\n    };\n\n    const textInput =\n        input.type === \"text\"\n            ? input\n            : input.querySelector(\"input[type='text']\");\n    if (textInput.classList.contains(\"color-picker-added\")) return;\n\n    textInput.classList.add(\"color-picker-added\");\n    textInput.classList.add(\"color\");\n    const parent = textInput.parentElement;\n\n    value ??= textInput.value || \"#000000ff\";\n\n    const { color, alpha } = hexToComponents(value);\n\n    const colorPickerElement = document.createElement(\"input\");\n    colorPickerElement.setAttribute(\"type\", \"color\");\n    if (opacity) colorPickerElement.style.maxWidth = \"2rem\";\n\n    const alphaPickerHtml = `<range-picker min=\"0\" max=\"1\" step=\"0.01\" value=\"${alpha}\" data-tooltip=\"Alpha\" style=\"min-width: 6rem;\"></range-picker>`;\n    const alphaPickerElement = new DOMParser()\n        .parseFromString(alphaPickerHtml, \"text/html\")\n        .querySelector(\"range-picker\");\n\n    const updateTextInput = (color, alpha) => {\n        const hex = componentsToHex(color, alpha);\n        if (!opacity) textInput.value = hex.slice(0, 7);\n        else textInput.value = hex;\n        textInput.dispatchEvent(new Event(\"change\"));\n    };\n\n    colorPickerElement.value = color;\n    alphaPickerElement.value = alpha;\n\n    colorPickerElement.addEventListener(\"input\", (event) => {\n        const color = event.target.value;\n        const alpha = alphaPickerElement.value;\n        updateTextInput(color, alpha);\n    });\n\n    alphaPickerElement.addEventListener(\"input\", (event) => {\n        const alpha = event.target.value;\n        const color = colorPickerElement.value;\n        updateTextInput(color, alpha);\n    });\n\n    textInput.after(colorPickerElement);\n    opacity && colorPickerElement.after(alphaPickerElement);\n}\n","import { MODULE_ID } from \"../main.js\";\r\nimport { HandlebarsApplication, mergeClone } from \"../lib/utils.js\";\r\n\r\nexport class AddEvent extends HandlebarsApplication {\r\n    constructor(combat) {\r\n        super();\r\n        this.combat = combat;\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return foundry.utils.mergeObject(super.defaultOptions, {\r\n            id: \"combat-dock-add-event\",\r\n            title: `combat-tracker-dock.add-event.title`,\r\n            template: `modules/combat-tracker-dock/templates/add-event.hbs`,\r\n            width: 400,\r\n            height: \"auto\",\r\n            closeOnSubmit: true,\r\n        });\r\n    }\r\n\r\n    static get DEFAULT_OPTIONS() {\r\n        return {\r\n            tag: \"form\",\r\n            id: \"combat-dock-add-event\",\r\n            window: {\r\n                title: `combat-tracker-dock.add-event.title`,\r\n            },\r\n            actions: {},\r\n            form: {\r\n                handler: this.#onSubmit,\r\n                closeOnSubmit: true,\r\n            },\r\n            position: {\r\n                width: 400,\r\n            },\r\n        };\r\n    }\r\n\r\n    static get PARTS() {\r\n        return mergeClone(super.PARTS, {\r\n            content: {\r\n                classes: [\"standard-form\"],\r\n            },\r\n            footer: {\r\n                template: \"templates/generic/form-footer.hbs\",\r\n            },\r\n        });\r\n    }\r\n\r\n    _prepareContext(options) {\r\n        const submitButton = {\r\n            type: \"submit\",\r\n            action: \"submit\",\r\n            icon: \"fas fa-plus\",\r\n            label: \"combat-tracker-dock.add-event.title\",\r\n        };\r\n        const recentEvents = game.settings.get(MODULE_ID, \"events\");\r\n        return { recentEvents, buttons: [submitButton] };\r\n    }\r\n\r\n    _onRender(context, options) {\r\n        super._onRender(context, options);\r\n        const html = this.element;\r\n        html.querySelectorAll(\".cct-event\").forEach((eventButton) => {\r\n            eventButton.addEventListener(\"click\", (e) => {\r\n                const eventIndex = e.currentTarget.dataset.index;\r\n                const recentEvents = game.settings.get(MODULE_ID, \"events\");\r\n                const event = recentEvents[eventIndex];\r\n                html.querySelector(\"[name='name']\").value = event.name;\r\n                html.querySelector(\"[name='img']\").value = event.img;\r\n                html.querySelector(\"[name='initiative']\").value = event.initiative;\r\n                html.querySelector(\"[name='duration']\").value = event.duration;\r\n                html.querySelector(\"[name='hidden']\").checked = event.hidden;\r\n            });\r\n        });\r\n    }\r\n\r\n    static async #onSubmit(event) {\r\n        const form = this.element;\r\n        const formData = new foundry.applications.ux.FormDataExtended(form).object;\r\n        if (!formData.name || !formData.img || (!Number.isNumeric(formData.initiative) && !formData.initiative)) return ui.notifications.error(game.i18n.localize(\"combat-tracker-dock.add-event.error\"));\r\n        this.combat.createEmbeddedDocuments(\"Combatant\", [\r\n            {\r\n                name: formData.name,\r\n                img: formData.img,\r\n                initiative: formData.initiative,\r\n                hidden: formData.hidden || false,\r\n                \"flags.combat-tracker-dock\": {\r\n                    event: true,\r\n                    duration: formData.duration || false,\r\n                    roundCreated: this.combat.round,\r\n                },\r\n            },\r\n        ]);\r\n        let recentEvents = game.settings.get(MODULE_ID, \"events\");\r\n        const newRecentEvent = { name: formData.name, img: formData.img, initiative: formData.initiative, duration: formData.duration, hidden: formData.hidden };\r\n        recentEvents = recentEvents.filter((event) => event.name !== newRecentEvent.name && event.img !== newRecentEvent.img);\r\n        recentEvents.unshift(newRecentEvent);\r\n        recentEvents = recentEvents.slice(0, 10);\r\n        await game.settings.set(MODULE_ID, \"events\", recentEvents);\r\n    }\r\n}\r\n","import { MODULE_ID } from \"../main.js\";\r\nimport { AddEvent } from \"./AddEvent.js\";\r\nimport { HandlebarsApplication, mergeClone, mergeObject } from \"../lib/utils.js\";\r\n\r\nexport class CombatDock extends HandlebarsApplication {\r\n    constructor(combat) {\r\n        super();\r\n        ui.combatDock?.close();\r\n        ui.combatDock = this;\r\n        this.portraits = [];\r\n        this.combat = combat ?? game.combat;\r\n        this.hooks = [];\r\n        this._playAnimation = true;\r\n        this._currentPortraitSize = {\r\n            max: parseInt(game.settings.get(MODULE_ID, \"portraitSize\")),\r\n            aspect: game.settings.get(MODULE_ID, \"portraitAspect\"),\r\n        };\r\n        this.setHooks();\r\n        window.addEventListener(\"resize\", this.autosize.bind(this));\r\n        this._combatTrackerRefreshed = false;\r\n    }\r\n\r\n    static get DEFAULT_OPTIONS() {\r\n        let options = mergeClone(super.DEFAULT_OPTIONS, {\r\n            classes: [\"hidden\"],\r\n            window: {\r\n                title: \"\",\r\n                icon: \"fas fa-arrows-up-down-left-right\",\r\n                frame: false,\r\n                positioned: false,\r\n                minimizable: false,\r\n                resizable: false,\r\n                savePosition: true,\r\n            },\r\n            position: {\r\n                width: \"auto\",\r\n                height: \"auto\"\r\n            }\r\n        });\r\n        if (game.settings.get(MODULE_ID, \"direction\") !== \"rowDocked\") {\r\n            mergeObject(options, this.WINDOWED_DEFAULT_OPTIONS);\r\n        }\r\n        return options;\r\n    }\r\n\r\n    static get WINDOWED_DEFAULT_OPTIONS() {\r\n        return {\r\n            window: {\r\n                frame: true,\r\n                positioned: true,\r\n                // savePosition: true,\r\n                preventEscapeClose: true\r\n            }\r\n        }\r\n    }\r\n\r\n    get sortedCombatants() {\r\n        return Array.from(this.combat.combatants.contents.sort(this.combat._sortCombatants));\r\n    }\r\n\r\n    get trueCarousel() {\r\n        return game.settings.get(MODULE_ID, \"carouselStyle\") < 2;\r\n    }\r\n\r\n    get leftAligned() {\r\n        return game.settings.get(MODULE_ID, \"carouselStyle\") == 1;\r\n    }\r\n\r\n    get autoFit() {\r\n        return game.settings.get(MODULE_ID, \"overflowStyle\") == \"autofit\";\r\n    }\r\n\r\n    get isVertical() {\r\n        return game.settings.get(MODULE_ID, \"direction\") == \"columnFloat\";\r\n    }\r\n\r\n    get isDocked() {\r\n        return game.settings.get(MODULE_ID, \"direction\") == \"rowDocked\";\r\n    }\r\n\r\n    setHooks() {\r\n        this.hooks = [\r\n            {\r\n                hook: \"renderCombatTracker\",\r\n                fn: this._onRenderCombatTracker.bind(this),\r\n            },\r\n            {\r\n                hook: \"createCombatant\",\r\n                fn: this.setupCombatants.bind(this),\r\n            },\r\n            {\r\n                hook: \"deleteCombatant\",\r\n                fn: this.setupCombatants.bind(this),\r\n            },\r\n            {\r\n                hook: \"updateCombatant\",\r\n                fn: this.updateCombatant.bind(this),\r\n            },\r\n            {\r\n                hook: \"updateCombat\",\r\n                fn: this._onCombatTurn.bind(this),\r\n            },\r\n            {\r\n                hook: \"deleteCombat\",\r\n                fn: this._onDeleteCombat.bind(this),\r\n            },\r\n            {\r\n                hook: \"combatStart\",\r\n                fn: this._onCombatStart.bind(this),\r\n            },\r\n            {\r\n                hook: \"hoverToken\",\r\n                fn: this._onHoverToken.bind(this),\r\n            },\r\n        ];\r\n        for (let hook of this.hooks) {\r\n            hook.id = Hooks.on(hook.hook, hook.fn);\r\n        }\r\n    }\r\n\r\n    removeHooks() {\r\n        for (let hook of this.hooks) {\r\n            Hooks.off(hook.hook, hook.id);\r\n        }\r\n    }\r\n\r\n    _prepareContext(options) {\r\n        const scroll = game.settings.get(MODULE_ID, \"overflowStyle\") === \"scroll\";\r\n        const reverseHeaderPosition = !this.isDocked && !this.isVertical;\r\n        return {\r\n            isGM: game.user.isGM,\r\n            scroll,\r\n            reverseHeaderPosition\r\n        };\r\n    }\r\n\r\n    setupCombatants() {\r\n        this.portraits = [];\r\n        this.sortedCombatants.forEach((combatant) => this.portraits.push(new CONFIG.combatTrackerDock.CombatantPortrait(combatant)));\r\n        const combatantsContainer = this.element.querySelector(\"#combatants\");\r\n        combatantsContainer.innerHTML = \"\";\r\n        this.portraits.forEach((p) => combatantsContainer.appendChild(p.element));\r\n        const isEven = this.portraits.length % 2 === 0;\r\n        this.element.classList.toggle(\"even\", isEven);\r\n        this.setupSeparator();\r\n        this.updateOrder();\r\n        this.autosize();\r\n        if (!this._combatTrackerRefreshed) {\r\n            this._combatTrackerRefreshed = true;\r\n            ui.combat.render(true);\r\n        }\r\n        if (this._playAnimation && this.sortedCombatants.length > 0) {\r\n            this._playAnimation = false;\r\n            const promises = this.portraits.map((p) => p.ready);\r\n            this._promises = promises;\r\n            Promise.all(promises).then(() => {\r\n                this.playIntroAnimation();\r\n            });\r\n        }\r\n    }\r\n\r\n    setupSeparator(){\r\n        const combatantsContainer = this.element.querySelector(\"#combatants\");\r\n        combatantsContainer.querySelectorAll(\".separator\").forEach(s => s.remove());\r\n        const turn = this.combat.turn + 1;\r\n        const combatantsCount = this.sortedCombatants.length;\r\n        const afterHalf = turn > Math.floor(combatantsCount / 2) || this.leftAligned ? 1 : 0;\r\n        const separator = document.createElement(\"div\");\r\n        separator.classList.add(\"separator\");\r\n        const line = document.createElement(\"div\");\r\n        line.classList.add(\"line\");\r\n        separator.appendChild(line);\r\n        const round = document.createElement(\"div\");\r\n        round.classList.add(\"round\", this.isVertical ? \"flexrow\" : \"flexcol\");\r\n        round.innerHTML = this.isVertical ? `<i class=\"fal fa-angle-down\"></i>${this.combat.round + afterHalf}` : `<i class=\"fal fa-angle-right\"></i>${this.combat.round + afterHalf}`;\r\n        separator.appendChild(round);\r\n        combatantsContainer.appendChild(separator);\r\n    }\r\n\r\n    playIntroAnimation(easing = \"cubic-bezier(0.22, 1, 0.36, 1)\") {\r\n        Hooks.callAll(\"combatDock:playIntroAnimation\", this);\r\n\r\n        const duration = CONFIG.combatTrackerDock.INTRO_ANIMATION_DURATION;\r\n        const delayMultiplier = CONFIG.combatTrackerDock.INTRO_ANIMATION_DELAY;\r\n\r\n        const isVertical = this.isVertical;\r\n        const alignment = game.settings.get(MODULE_ID, \"alignment\");\r\n\r\n        const transformAxis = isVertical ? \"X\" : \"Y\";\r\n        const transformDirection = isVertical && alignment == \"right\" ? \"\" : \"-\";\r\n\r\n        const playSlideInAnimation = (el, delay = 0) => {\r\n            el.style.transform = `translate${transformAxis}(${transformDirection}150%)`;\r\n            const anim = el.animate([{ transform: `translate${transformAxis}(${transformDirection}150%)` }, { transform: `translate${transformAxis}(0)` }], {\r\n                duration: duration,\r\n                easing: easing,\r\n                //fill: \"forwards\",\r\n                delay: delay,\r\n            });\r\n\r\n            anim.finished.then(() => {\r\n                el.style.transform = \"\";\r\n                Hooks.callAll(\"combatDock:playIntroAnimation:finished\", this, el);\r\n            });\r\n        };\r\n        let totalAnimationTime = 0;\r\n        Array.from(this.element.querySelector(\"#combatants\").children).forEach((el, index) => {\r\n            const order = this.trueCarousel ? parseInt(el.style.order) / 100 : index;\r\n            const delay = order * duration * delayMultiplier;\r\n            totalAnimationTime = Math.max(totalAnimationTime, delay + duration);\r\n            playSlideInAnimation(el, delay);\r\n        });\r\n\r\n        setTimeout(() => {\r\n            if (isVertical) this.centerCurrentCombatant();\r\n        }, totalAnimationTime + duration);\r\n\r\n        setTimeout(() => {\r\n            this.element.classList.remove(\"hidden\");\r\n            if (!isVertical) this.centerCurrentCombatant();\r\n        }, 10);\r\n    }\r\n\r\n    autosize() {\r\n        const max = parseInt(game.settings.get(MODULE_ID, \"portraitSize\"));\r\n        const aspect = game.settings.get(MODULE_ID, \"portraitAspect\");\r\n        this._currentPortraitSize = {\r\n            max: max,\r\n            aspect: aspect,\r\n        };\r\n        const verticalSize = max * aspect;\r\n        if (!this.autoFit) return document.documentElement.style.setProperty(\"--combatant-portrait-size\", max + \"px\");\r\n\r\n        const sizeModifier = game.settings.get(MODULE_ID, \"floatingSize\");\r\n        const combatantCount = this.sortedCombatants.length;\r\n        let maxSpace, portraitSize;\r\n        if (this.isVertical) {\r\n            maxSpace = window.innerHeight * sizeModifier / 100;\r\n        } else if (this.isDocked) {\r\n            maxSpace = document.getElementById(\"ui-top\").getBoundingClientRect().width * 0.9;\r\n        } else {\r\n            maxSpace = window.innerWidth * sizeModifier / 100;\r\n        }\r\n        portraitSize = this.isVertical ? Math.min(verticalSize, Math.floor(maxSpace / combatantCount)) / aspect : Math.min(max, Math.floor(maxSpace / combatantCount));\r\n\r\n        document.documentElement.style.setProperty(\"--combatant-portrait-size\", portraitSize / (this.isVertical ? 1 : 1.2) + \"px\");\r\n    }\r\n\r\n    updateCombatant(combatant, updates = {}) {\r\n        if (\"initiative\" in updates) {\r\n            this.setupCombatants();\r\n            return;\r\n        }\r\n        const portrait = this.portraits.find((p) => p.combatant === combatant);\r\n        if (portrait) portrait.renderInner();\r\n    }\r\n\r\n    updateCombatants() {\r\n        this.portraits.forEach((p) => p.renderInner());\r\n    }\r\n\r\n    updateOrder() {\r\n        this.setupSeparator();\r\n        const separator = this.element.querySelector(\".separator\");\r\n        const isTrueCarousel = this.trueCarousel;\r\n        separator.style.display = isTrueCarousel ? \"\" : \"none\";\r\n        if (this.sortedCombatants.filter((c) => c?.visible)?.length === 0) {\r\n            separator.style.display = \"none\";\r\n        }\r\n        separator.classList.remove(\"vertical\", \"horizontal\");\r\n        separator.classList.add(this.isVertical ? \"vertical\" : \"horizontal\");\r\n\r\n        const combatants = this.sortedCombatants;\r\n\r\n\r\n        if (!this.trueCarousel) return this.portraits.forEach((p) => p.element.style.setProperty(\"order\", combatants.indexOf(p.combatant)));\r\n\r\n        const isLeftAligned = this.leftAligned;\r\n\r\n        //order combatants so that the current combatant is at the center\r\n        const currentCombatant = this.combat.combatant;\r\n        const currentCombatantIndex = combatants.findIndex((c) => c === currentCombatant) + combatants.length;\r\n        const tempCombatantList = [...combatants, ...combatants, ...combatants];\r\n        const halfLength = isLeftAligned ? combatants.length : Math.floor(combatants.length / 2);\r\n        const orderedCombatants = tempCombatantList.slice(currentCombatantIndex - halfLength, currentCombatantIndex + halfLength + 1);\r\n\r\n        const lastCombatant = this.sortedCombatants[this.sortedCombatants.length - 1];\r\n\r\n        this.portraits.forEach((p) => {\r\n            const combatant = orderedCombatants.find((c) => c === p.combatant);\r\n            const index = orderedCombatants.findIndex((c) => c === combatant);\r\n            p.element.style.setProperty(\"order\", index * 100);\r\n        });\r\n\r\n        //get last combatant's order\r\n        const lastCombatantOrder = this.portraits.find((p) => p.combatant === lastCombatant)?.element?.style?.order ?? 999999;\r\n        //set separator's order to last combatant's order + 1\r\n\r\n        separator.style.setProperty(\"order\", parseInt(lastCombatantOrder) + 1);\r\n    }\r\n\r\n    updateStartEndButtons() {\r\n        if(!this.element) return;\r\n        const startButton = this.element.querySelector(`[data-action=\"start-combat\"]`);\r\n        const endButton = this.element.querySelector(`[data-action=\"end-combat\"]`);\r\n        startButton.style.display = this.combat.started ? \"none\" : \"\";\r\n        endButton.style.display = this.combat.started ? \"\" : \"none\";\r\n    }\r\n\r\n    appendHtml(){\r\n        if (this.isDocked) {\r\n            return document.querySelector(\"#ui-top\").prepend(this.element);\r\n        }\r\n    }\r\n\r\n    _onRender(context, options) {\r\n        if (this._closed) return this.close();\r\n        super._onRender(context, options);\r\n        this.setupCombatants();\r\n        this.appendHtml();\r\n        this.element.querySelectorAll(\".buttons-container button\").forEach((i) => {\r\n            i.addEventListener(\"click\", (e) => {\r\n                const action = e.currentTarget.dataset.action;\r\n                switch (action) {\r\n                    case \"previous-turn\":\r\n                        this.combat.previousTurn();\r\n                        break;\r\n                    case \"next-turn\":\r\n                        this.combat.nextTurn();\r\n                        break;\r\n                    case \"previous-round\":\r\n                        this.combat.previousRound();\r\n                        break;\r\n                    case \"next-round\":\r\n                        this.combat.nextRound();\r\n                        break;\r\n                    case \"end-combat\":\r\n                        this.combat.endCombat();\r\n                        break;\r\n                    case \"roll-all\":\r\n                        this.combat.rollAll({ event: e });\r\n                        break;\r\n                    case \"roll-npc\":\r\n                        this.combat.rollNPC({ event: e });\r\n                        break;\r\n                    case \"reset\":\r\n                        this.combat.resetAll();\r\n                        break;\r\n                    case \"configure\":\r\n                        new foundry.applications.apps.CombatTrackerConfig().render(true);\r\n                        break;\r\n                    case \"start-combat\":\r\n                        this.combat.startCombat();\r\n                        break;\r\n                    case \"add-event\":\r\n                        new AddEvent(this.combat).render(true);\r\n                        break;\r\n                }\r\n            });\r\n        });\r\n        this.autosize();\r\n        this.setControlsOrder();\r\n        new foundry.applications.ux.ContextMenu(\r\n            this.element.querySelector(\"#combatants\"),\r\n            \".combatant-portrait\",\r\n            [\r\n                {\r\n                    name: `${MODULE_ID}.contextMenu.setAsCurrent`,\r\n                    icon: `<i class=\"fas fa-swords\"></i>`,\r\n                    callback: (el) => {\r\n                        this.combat.update({ turn: this.sortedCombatants.indexOf(this.combat.combatants.get(el.dataset.combatantId)) });\r\n                    },\r\n                },\r\n                ...game.combats.directory._getEntryContextOptions(),\r\n            ],\r\n            { jQuery: false, fixed: true }\r\n        );\r\n    }\r\n\r\n    _onRenderCombatTracker() {\r\n        this.portraits.forEach((p) => p.renderInner());\r\n        this.updateStartEndButtons();\r\n    }\r\n\r\n    _onCombatTurn(combat, updates, update) {\r\n        if (!(\"turn\" in updates) && !(\"round\" in updates)) return;\r\n        if (\"round\" in updates) this._onRoundChange();\r\n        const combatantsContainer = this.element.querySelector(\"#combatants\");\r\n        const filteredChildren = Array.from(combatantsContainer.children).filter((c) => !c.classList.contains(\"separator\"));\r\n        const currentSize = combatantsContainer.getBoundingClientRect();\r\n        combatantsContainer.style.minWidth = currentSize.width + \"px\";\r\n        combatantsContainer.style.minHeight = currentSize.height + \"px\";\r\n        //find combatant with lowest order\r\n\r\n        const childrenByHighestOrder = [...filteredChildren].sort((a, b) => b.style.order - a.style.order);\r\n        const childrenByLowestOrder = [...filteredChildren].sort((a, b) => a.style.order - b.style.order);\r\n\r\n        const currentCombatant = this.combat.combatant;\r\n        const currentIndex = this.sortedCombatants.findIndex((c) => c === currentCombatant);\r\n        let nextDefeatedCount = 0;\r\n        let previousDefeatedCount = 0;\r\n        const sortedCombatants = this.sortedCombatants;\r\n        for (let i = 0 + 1; i < sortedCombatants.length; i++) {\r\n            const index = (currentIndex + i) % sortedCombatants.length;\r\n            const combatant = sortedCombatants[index];\r\n            if (combatant.defeated) previousDefeatedCount++;\r\n            else break;\r\n        }\r\n\r\n        for (let i = 0 + 1; i < sortedCombatants.length; i++) {\r\n            const index = (currentIndex - i + sortedCombatants.length) % sortedCombatants.length;\r\n            const combatant = sortedCombatants[index];\r\n            if (combatant.defeated) nextDefeatedCount++;\r\n            else break;\r\n        }\r\n\r\n        const nextDefeatedCombatants = childrenByLowestOrder.slice(0, nextDefeatedCount + 1);\r\n        const previousDefeatedCombatants = childrenByHighestOrder.slice(0, previousDefeatedCount + 1);\r\n\r\n        const first = nextDefeatedCount != 0 ? nextDefeatedCombatants : [[...filteredChildren].reduce((a, b) => (a.style.order < b.style.order ? a : b), combatantsContainer.children[0])];\r\n        const last = previousDefeatedCount != 0 ? previousDefeatedCombatants : [[...filteredChildren].reduce((a, b) => (a.style.order > b.style.order ? a : b), combatantsContainer.children[0])];\r\n\r\n        const els = update.direction === 1 ? first : last;\r\n\r\n        if (this._playAnimation && this.sortedCombatants.length > 0) {\r\n            this._playAnimation = false;\r\n            this.updateOrder();\r\n            this.playIntroAnimation();\r\n            return;\r\n        }\r\n\r\n        setTimeout(() => this.updateOrder(), 200);\r\n\r\n        if (!this.trueCarousel) {\r\n            combatantsContainer.style.minWidth = \"\";\r\n            combatantsContainer.style.minHeight = \"\";\r\n            return this.centerCurrentCombatant();\r\n        }\r\n\r\n        for (const el of els) {\r\n            el.classList.add(`collapsed-${this.isVertical ? \"vertical\" : \"horizontal\"}`);\r\n            setTimeout(() => {\r\n                el.classList.remove(`collapsed-${this.isVertical ? \"vertical\" : \"horizontal\"}`);\r\n                setTimeout(() => {\r\n                    combatantsContainer.style.minWidth = \"\";\r\n                    combatantsContainer.style.minHeight = \"\";\r\n                }, 200);\r\n                this.centerCurrentCombatant();\r\n            }, 200);\r\n        }\r\n    }\r\n\r\n    async _onRoundChange() {\r\n        const toDelete = [];\r\n        for (const combatant of this.combat.combatants) {\r\n            const duration = combatant.getFlag(MODULE_ID, \"duration\");\r\n            if (!duration) continue;\r\n            const roundCreated = combatant.getFlag(MODULE_ID, \"roundCreated\");\r\n            if (!roundCreated) continue;\r\n            const currentRound = this.combat.round;\r\n            const roundsElapsed = currentRound - roundCreated;\r\n            if (roundsElapsed >= duration) {\r\n                toDelete.push(combatant.id);\r\n                ChatMessage.create({\r\n                    speaker: { alias: \"Combat Tracker Dock\" },\r\n                    content: game.i18n.localize(\"combat-tracker-dock.add-event.expired\").replace(\"%n\", `<strong>${combatant.name}</strong>`),\r\n                    type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n                    whisper: [game.user.id],\r\n                });\r\n            }\r\n        }\r\n        if (toDelete.length > 0) {\r\n            await this.combat.deleteEmbeddedDocuments(\"Combatant\", toDelete);\r\n        }\r\n    }\r\n\r\n    centerCurrentCombatant() {\r\n        if(!this.element) return;\r\n        const carouselStyle = game.settings.get(MODULE_ID, \"carouselStyle\");\r\n        const combatantsEl = this.element.querySelector(\"#combatants\");\r\n        if (this.trueCarousel) {\r\n            if (carouselStyle == 1) {\r\n                return combatantsEl.scrollTo({\r\n                    top: 0,\r\n                    left: 0,\r\n                    behavior: \"smooth\",\r\n                });\r\n            }\r\n\r\n            combatantsEl.scrollTo({\r\n                top: combatantsEl.scrollHeight / 2 - combatantsEl.offsetHeight / 2 + this._currentPortraitSize.max * this._currentPortraitSize.aspect,\r\n                left: combatantsEl.scrollWidth / 2 - combatantsEl.offsetWidth / 2 + this._currentPortraitSize.max,\r\n                behavior: \"smooth\",\r\n            });\r\n        } else {\r\n            const current = this.portraits.find((p) => p.combatant === this.combat.combatants.get(this.combat?.current?.combatantId));\r\n            if (!current) return;\r\n            const el = current.element;\r\n            el.scrollIntoView({\r\n                behavior: \"smooth\",\r\n                block: \"center\",\r\n                inline: \"center\",\r\n            });\r\n        }\r\n    }\r\n\r\n    setControlsOrder() {\r\n        const uiLeft = this.element.querySelector(\".buttons-container.left\");\r\n        const uiRight = this.element.querySelector(\".buttons-container.right\");\r\n        uiLeft.style.marginRight = \"\";\r\n        uiRight.style.marginLeft = \"\";\r\n        const combatants = this.element.querySelector(\"#combatants\");\r\n        const alignment = game.settings.get(MODULE_ID, \"alignment\");\r\n        if (this.isVertical && alignment !== \"center\") {\r\n            if (alignment == \"right\") {\r\n                uiLeft.style.order = 0;\r\n                uiLeft.style.marginRight = \"1rem\";\r\n                uiRight.style.order = 1;\r\n                combatants.style.order = 2;\r\n            } else {\r\n                uiLeft.style.order = 1;\r\n                uiRight.style.order = 2;\r\n                uiRight.style.marginLeft = \"1rem\";\r\n                combatants.style.order = 0;\r\n            }\r\n        } else {\r\n            uiLeft.style.order = \"\";\r\n            uiRight.style.order = \"\";\r\n            combatants.style.order = \"\";\r\n        }\r\n    }\r\n\r\n    _onDeleteCombat(combat) {\r\n        if (combat === this.combat) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    _onCombatStart(combat) {\r\n        if (combat === this.combat) this._playAnimation = true;\r\n    }\r\n\r\n    _onHoverToken(token, hover) {\r\n        const portrait = this.portraits.find((p) => p.token === token);\r\n        if (!portrait) return;\r\n        portrait.element.classList.toggle(\"hovered\", hover);\r\n    }\r\n\r\n    refresh() {\r\n        this.autosize();\r\n        this.updateCombatants();\r\n        this.appendHtml();\r\n    }\r\n\r\n    async restart() {\r\n        await this.close();\r\n        await new CombatDock().render({ force: true });\r\n    }\r\n\r\n    async close(...args) {\r\n        this.removeHooks();\r\n        window.removeEventListener(\"resize\", this.autosize.bind(this));\r\n        if (this.element) this.element.remove();\r\n        this._closed = true;\r\n        return super.close(...args);\r\n    }\r\n}\r\n","import { MODULE_ID } from \"../main.js\";\r\nimport { generateDescription, getInitiativeDisplay, getSystemIcons } from \"../systems.js\";\r\n\r\nexport class CombatantPortrait {\r\n    constructor(combatant) {\r\n        this.combatant = combatant;\r\n        this.combat = combatant.combat;\r\n        this.element = document.createElement(\"div\");\r\n        this.element.classList.add(\"combatant-portrait\");\r\n        this.element.setAttribute(\"data-combatant-id\", combatant.id);\r\n        this.element.setAttribute(\"data-tooltip-class\", \"combat-dock-tooltip\");\r\n        this.element.style.backgroundImage = `url(\"${game.settings.get(MODULE_ID, \"portraitImageBackground\")}\")`;\r\n        this.resolve = null;\r\n        this.ready = new Promise((res) => (this.resolve = res));\r\n        this._hasTakenTurn = this.combat.round ?? 0 <= 1;\r\n        if (!game.settings.get(MODULE_ID, \"hideFirstRound\")) this._hasTakenTurn = true;\r\n        this.activateCoreListeners();\r\n        this.renderInner();\r\n    }\r\n\r\n    get actor() {\r\n        return this.combatant?.actor;\r\n    }\r\n\r\n    get token() {\r\n        return this.combatant?.token?.object;\r\n    }\r\n\r\n    get img() {\r\n        const useActor = game.settings.get(MODULE_ID, \"portraitImage\") === \"actor\";\r\n        return (useActor ? this.combatant.actor?.img : this.combatant.img) ?? this.combatant.img;\r\n    }\r\n\r\n    get name() {\r\n        if (this.combatant.isOwner) return this.combatant.name;\r\n        const displayName = game.settings.get(MODULE_ID, \"displayName\");\r\n        if (displayName === \"owner\") return this.combatant.isOwner ? this.combatant.name : \"???\";\r\n        if (displayName === \"default\") return this.combatant.name;\r\n        return [CONST.TOKEN_DISPLAY_MODES.HOVER, CONST.TOKEN_DISPLAY_MODES.ALWAYS].includes(this.token?.document?.displayName) ? this.combatant.name : \"???\";\r\n    }\r\n\r\n    get firstTurnHidden() {\r\n        const combatant = this.combatant;\r\n        const hasPermission = (combatant.actor?.permission ?? -10) >= CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER || combatant.isOwner;\r\n        const isFriendly = combatant.token?.disposition === CONST.TOKEN_DISPOSITIONS.FRIENDLY;\r\n        if (!hasPermission && !this._hasTakenTurn && !isFriendly) return true;\r\n        return false;\r\n    }\r\n\r\n    get isEvent() {\r\n        return this.combatant.flags[MODULE_ID]?.event ?? false;\r\n    }\r\n\r\n    get eventResource() {\r\n        if (!this.isEvent) return null;\r\n        const flags = this.combatant.flags[MODULE_ID];\r\n        const {duration, roundCreated} = flags;\r\n        const currentRound = this.combat.round;\r\n        return {\r\n            max: duration,\r\n            value: duration - (currentRound - roundCreated),\r\n            percentage: Math.round((duration - (currentRound - roundCreated)) / duration * 100),\r\n        };\r\n    }\r\n\r\n    get eventRoundsLeft() {\r\n        return this.combatant.getFlag(MODULE_ID, \"roundsLeft\") ?? 0;\r\n    }\r\n\r\n    activateCoreListeners() {\r\n        this.element.addEventListener(\"mouseenter\", this._onHoverIn.bind(this));\r\n        this.element.addEventListener(\"mouseleave\", this._onHoverOut.bind(this));\r\n    }\r\n    activateListeners() {\r\n        this.element.querySelector(\".combatant-wrapper\").addEventListener(\"click\", this._onCombatantMouseDown.bind(this));\r\n\r\n        (this.element.querySelectorAll(\".system-icon\") ?? []).forEach((iconEl, index) => {\r\n            const systemIcons = this._systemIcons;\r\n            const icon = systemIcons[index];\r\n            if (icon.callback && icon.enabled) {\r\n                iconEl.addEventListener(\"click\", async (event) => {\r\n                    event.stopPropagation();\r\n                    event.stopImmediatePropagation();\r\n                    icon.callback(event, this.combatant, index, icon.id);\r\n                });\r\n            }\r\n        });\r\n\r\n        if(!this.actor?.isOwner) return;\r\n\r\n        (this.element.querySelectorAll(\".portrait-effect\") ?? []).forEach((effectEl) => {\r\n            //delete on right click\r\n            effectEl.addEventListener(\"contextmenu\", async (event) => {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                const uuid = effectEl.dataset.uuid;\r\n                const effect = await fromUuid(uuid);\r\n                const statusEffect = CONFIG.statusEffects.find((s) => s.img === effect.img);\r\n\r\n                const response = await Dialog.confirm({\r\n                    title: game.i18n.localize(`${MODULE_ID}.deleteEffectTitle`),\r\n                    content: game.i18n.localize(`${MODULE_ID}.deleteEffectContent`) + game.i18n.localize(effect?.label ?? statusEffect?.name ?? \"\") + \"?\",\r\n                    yes: () => true,\r\n                    no: () => false,\r\n                    defaultYes: false,\r\n                    close: () => false,\r\n                });\r\n                if(!response) return;\r\n                if (!effect) {\r\n                    this.token?.toggleEffect(uuid);\r\n                    return;\r\n                }\r\n                await effect.delete();\r\n            });\r\n        });\r\n    }\r\n\r\n    async _onCombatantMouseDown(event) {\r\n        event.preventDefault();\r\n\r\n        if (event.target.dataset.action === \"player-pass\") return this.combat.nextTurn();\r\n\r\n        if (!event.target.classList.contains(\"combatant-wrapper\")) return;\r\n\r\n        if (event.button === 2) return game.user.isGM && this.combatant.sheet.render(true);\r\n\r\n        const combatant = this.combatant;\r\n        const token = combatant.token;\r\n        if (!combatant.actor?.testUserPermission(game.user, \"OBSERVER\")) return;\r\n        const now = Date.now();\r\n\r\n        // Handle double-left click to open sheet\r\n        const dt = now - this._clickTime;\r\n        this._clickTime = now;\r\n        if (dt <= 250) {\r\n            return combatant.actor?.sheet.render(true);\r\n        }\r\n\r\n        // Control and pan to Token object\r\n        if (token?.object) {\r\n            token.object?.control({ releaseOthers: true });\r\n            return canvas.animatePan(token.object.center);\r\n        }\r\n    }\r\n\r\n    _onHoverIn(event) {\r\n        if (!this.token) return;\r\n        if ( this.token?.isVisible && !this.token.controlled ) this.token._onHoverIn(event);\r\n    }\r\n\r\n    _onHoverOut(event) {\r\n        if (!this.token) return;\r\n        if (this.token.hover) this.token._onHoverOut(event);\r\n    }\r\n\r\n    async renderInner() {\r\n        const data = await this.getData();\r\n        this.element.classList.toggle(\"hidden\", !data);\r\n        if (!data) {\r\n            this.resolve(true);\r\n            this.element.innerHTML = \"\";\r\n            return;\r\n        }\r\n        const template = await foundry.applications.handlebars.renderTemplate(\"modules/combat-tracker-dock/templates/combatant-portrait.hbs\", { ...data });\r\n        const tooltip = await foundry.applications.handlebars.renderTemplate(\"modules/combat-tracker-dock/templates/combatant-tooltip.hbs\", { ...data });\r\n        this.element.innerHTML = template;\r\n        this.element.setAttribute(\"data-tooltip\", tooltip);\r\n        const direction = game.settings.get(MODULE_ID, \"direction\");\r\n        let tooltipDirection = \"\";\r\n        if (direction == \"columnFloat\") {\r\n            const alignment = game.settings.get(MODULE_ID, \"alignment\");\r\n            if(alignment == \"left\") tooltipDirection = foundry.helpers.interaction.TooltipManager.implementation.TOOLTIP_DIRECTIONS.RIGHT;\r\n            else if(alignment == \"right\") tooltipDirection = foundry.helpers.interaction.TooltipManager.implementation.TOOLTIP_DIRECTIONS.LEFT;\r\n        }\r\n        this.element.setAttribute(\"data-tooltip-direction\", tooltipDirection);\r\n\r\n        this.element.classList.toggle(\"active\", data.css.includes(\"active\"));\r\n        this.element.classList.toggle(\"visible\", data.css.includes(\"hidden\"));\r\n        this.element.classList.toggle(\"defeated\", data.css.includes(\"defeated\"));\r\n        this.element.style.borderBottomColor = this.getBorderColor(this.token?.document);\r\n        this.element.querySelector(\".roll-initiative\").addEventListener(\"click\", async (event) => {\r\n            event.preventDefault();\r\n            Hooks.once(\"renderCombatTracker\", () => {\r\n                ui.combatDock.updateOrder();\r\n            });\r\n            await this.combatant.combat.rollInitiative([this.combatant.id],{event});\r\n        });\r\n        this.element.querySelectorAll(\".action\").forEach((action) => {\r\n            action.addEventListener(\"click\", async (event) => {\r\n                event.stopPropagation();\r\n                event.stopImmediatePropagation();\r\n                const dataAction = action.dataset.action;\r\n                switch (dataAction) {\r\n                    case \"toggle-hidden\":\r\n                        await this.combatant.update({ hidden: !this.combatant.hidden });\r\n                        break;\r\n                    case \"toggle-defeated\":\r\n                        await ui.combat._onToggleDefeatedStatus(this.combatant);\r\n                        break;\r\n                    case \"ping\":\r\n                        await ui.combat._onPingCombatant(this.combatant);\r\n                        break;\r\n                }\r\n            });\r\n        });\r\n        const ib = this.element.querySelector(\".image-border\");\r\n        if(ib) ib.style.backgroundImage = `url(\"${game.settings.get(MODULE_ID, \"portraitImageBorder\")}\")`;\r\n        this.activateListeners();\r\n        this.resolve(true);\r\n    }\r\n\r\n    getResource(resource = null, primary = false) {\r\n\r\n        if (this.isEvent && primary) return this.eventResource;\r\n\r\n        if (!this.actor || !this.combat) return null;\r\n\r\n        resource = resource ?? this.combat.settings.resource;\r\n\r\n        let max, value, percentage;\r\n\r\n        if (!resource) return { max, value, percentage };\r\n\r\n        max = foundry.utils.getProperty(this.actor.system, resource + \".max\") ?? foundry.utils.getProperty(this.actor.system, resource.replace(\"value\", \"\") + \"max\");\r\n\r\n        value = foundry.utils.getProperty(this.actor.system, resource) ?? foundry.utils.getProperty(this.actor.system, resource + \".value\");\r\n\r\n        if (max !== undefined && value !== undefined && Number.isNumeric(max) && Number.isNumeric(value)) percentage = Math.min(Math.max( Math.round((value / max) * 100) , 0) , 100);\r\n\r\n        value = this.validateValue(value);\r\n        max = this.validateValue(max);\r\n\r\n        return { max, value, percentage };\r\n    }\r\n\r\n    validateValue(value) {\r\n        if (typeof value === \"boolean\") value = value ? \"\" : \"\";\r\n\r\n        if (Array.isArray(value)) value = value.join(\", \");\r\n\r\n        if (value === \"\") value = null;\r\n\r\n        if (!Number.isNumeric(value) && Object.prototype.toString.call(value) != \"[object String]\") value = null;\r\n\r\n        return value;\r\n    }\r\n\r\n    getBarsOrder(hasEffects, r1, r2) {\r\n        const sett = game.settings.get(MODULE_ID, \"barsPlacement\");\r\n        r1 = !isNaN(r1?.percentage) ? 0 : 1;\r\n        r2 = !isNaN(r2?.percentage) ? 0 : 1;\r\n\r\n        switch (sett) {\r\n            case \"left\":\r\n                return {bar1: 0, bar2: 1, init: 2, effects: 3, bar1ML: 0, bar2ML: 0, initBars: 2.5 - r1 - r2};\r\n            case \"right\":\r\n                return {bar1: 2, bar2: 3, init: 0, effects: 1, bar1ML: hasEffects ? 0 : \"auto\", bar2ML: 0, initBars: 0.5};\r\n            case \"twinned\":\r\n                return {bar1: 0, bar2: 3, init: 1, effects: 2, bar1ML: 0, bar2ML: hasEffects ? 0 : \"auto\", initBars: 1.5 - r1};\r\n        }\r\n    }\r\n\r\n    get hasPermission() {\r\n        const combatant = this.combatant;\r\n        const playerPlayerPermission = combatant.actor?.hasPlayerOwner && game.settings.get(MODULE_ID, \"playerPlayerPermission\");\r\n        const hasPermission = (combatant.actor?.permission ?? -10) >= CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER || combatant.isOwner || playerPlayerPermission;\r\n        return hasPermission;\r\n    }\r\n\r\n    async getData() {\r\n        // Format information about each combatant in the encounter\r\n        let hasDecimals = false;\r\n        const combatant = this.combatant;\r\n        const hideDefeated = game.settings.get(MODULE_ID, \"hideDefeated\");\r\n        if (hideDefeated && combatant.isDefeated) return null;\r\n        const isActive = this.combat.turns.indexOf(combatant) === this.combat.turn;\r\n        if (isActive && this.combat.started) this._hasTakenTurn = true;\r\n        const hasPermission = this.hasPermission;\r\n        if (!hasPermission && !this._hasTakenTurn) return null;\r\n        if (!combatant.visible && !game.user.isGM) return null;\r\n        const trackedAttributes = game.settings\r\n            .get(MODULE_ID, \"attributes\")\r\n            .map((a) => {\r\n                const resourceData = this.getResource(a.attr);\r\n                const iconHasExtension = a.icon.includes(\".\");\r\n                return {\r\n                    ...resourceData,\r\n                    icon: iconHasExtension ? `<img src=\"${a.icon}\" />` : `<i class=\"${a.icon} icon\"></i>`,\r\n                    units: a.units || \"\",\r\n                };\r\n            })\r\n            .filter((a) => a.value !== null && a.value !== undefined);\r\n\r\n        const systemIcons = this.getSystemIcons();\r\n        const systemIconCount = systemIcons.resource?.length ?? 0;\r\n\r\n        const attributesVisibility = game.settings.get(MODULE_ID, \"attributeVisibility\");\r\n\r\n        const displayDescriptionsSetting = game.settings.get(MODULE_ID, \"displayDescriptions\");\r\n\r\n        let displayDescriptions = false;\r\n\r\n        if (displayDescriptionsSetting === \"all\") displayDescriptions = true;\r\n        else if (displayDescriptionsSetting === \"owner\") displayDescriptions = hasPermission;\r\n\r\n        // Prepare turn data\r\n        const resource = hasPermission ? this.getResource(null, true) : null;\r\n        const resource2 = hasPermission ? this.getResource(game.settings.get(MODULE_ID, \"resource\")) : null;\r\n        const portraitResourceSetting = game.settings.get(MODULE_ID, \"portraitResource\");\r\n        const portraitResource = hasPermission && portraitResourceSetting ? this.getResource(portraitResourceSetting) : null;\r\n        const initiativeData = this.getInitiativeDisplay();\r\n        initiativeData.isIconImg = initiativeData.icon.includes(\".\");\r\n        initiativeData.isRollIconImg = initiativeData.rollIcon.includes(\".\");\r\n        const turn = {\r\n            id: combatant.id,\r\n            name: this.name,\r\n            img: this.img,\r\n            active: this.combat.turns.indexOf(combatant) === this.combat.turn,\r\n            owner: combatant.isOwner,\r\n            isGM: game.user.isGM,\r\n            showPass: combatant.isOwner && !game.user.isGM,\r\n            defeated: combatant.isDefeated,\r\n            hidden: combatant.hidden,\r\n            initiative: combatant.initiative,\r\n            hasRolled: combatant.initiative !== null && combatant.initiative !== undefined,\r\n            hasResource: resource !== null,\r\n            hasResource2: resource2 !== null,\r\n            hasPortraitResource: portraitResource !== null,\r\n            hasPlayerOwner: combatant.actor?.hasPlayerOwner,\r\n            hasPermission: hasPermission,\r\n            showInitiative: game.settings.get(MODULE_ID, \"showInitiativeOnPortrait\"),\r\n            isInitiativeNaN: combatant.initiative === null || combatant.initiative === undefined,\r\n            initiativeData: initiativeData,\r\n            resource: resource,\r\n            resource2: resource2,\r\n            portraitResource: portraitResource,\r\n            showBars: attributesVisibility == \"bars\" || attributesVisibility == \"both\",\r\n            showText: attributesVisibility == \"text\" || attributesVisibility == \"both\",\r\n            canPing: combatant.sceneId === canvas.scene?.id && game.user.hasPermission(\"PING_CANVAS\"),\r\n            attributes: trackedAttributes,\r\n            description: this.getDescription(),\r\n            resSystemIcons: systemIcons.resource,\r\n            tooltipSystemIcons: systemIcons.tooltip,\r\n            systemIconsSizeMulti: clamp(0.03, 1/(systemIconCount * 2) ,0.1),\r\n            barsOrder: null,\r\n            displayDescriptions: displayDescriptions,\r\n        };\r\n        if (turn.initiative !== null && !Number.isInteger(turn.initiative)) hasDecimals = true;\r\n        if (turn.initiativeData.value !== null && !Number.isInteger(turn.initiativeData.value)) hasDecimals = true;\r\n        turn.css = [turn.active ? \"active\" : \"\", turn.hidden ? \"hidden\" : \"\", turn.defeated ? \"defeated\" : \"\"].join(\" \").trim();\r\n\r\n        // Actor and Token status effects\r\n        turn.effects = new Set();\r\n        turn.hasAttributes = trackedAttributes.length > 0;\r\n        if (combatant.actor) {\r\n            for (const effect of combatant.actor.temporaryEffects) {\r\n                if (effect.statuses.has(CONFIG.specialStatusEffects.DEFEATED)) turn.defeated = true;\r\n                else if (effect.img) {\r\n                    const description = effect.description ? await foundry.applications.ux.TextEditor.implementation.enrichHTML(effect.description) : \"\";\r\n                    const duration = parseInt(effect.duration?.label ?? \"\");\r\n                    const percent = effect.duration?.remaining / effect.duration?.duration;\r\n                    const uuid = effect.uuid;\r\n                    turn.effects.add({ uuid, img: effect.img, label: effect.name, description: description, duration: duration, percent: isNaN(percent) ? null : percent*100, hasDuration: !isNaN(duration) });\r\n                }\r\n            }\r\n        }\r\n\r\n        turn.hasEffects = turn.effects.size > 0;\r\n        turn.barsOrder = this.getBarsOrder(turn.hasEffects, resource, resource2);\r\n        // Format initiative numeric precision\r\n        const precision = CONFIG.Combat.initiative.decimals;\r\n        if (turn.hasRolled && typeof turn.initiative == \"number\") turn.initiative = turn.initiative.toFixed(hasDecimals ? precision : 0);\r\n        if (turn.hasRolled && typeof turn.initiativeData.value == \"number\") turn.initiativeData.value = turn.initiativeData.value.toFixed(hasDecimals ? precision : 0);\r\n        if (!game.user.isGM && !combatant.actor?.isOwner && game.settings.get(MODULE_ID, \"hideEnemyInitiative\")) {\r\n            turn.initiative = \"?\";\r\n            turn.initiativeData.value = \"?\";\r\n        }\r\n        return turn;\r\n    }\r\n\r\n    getDescription() {\r\n        const actor = this.actor;\r\n        if (!actor) return null;\r\n        let description = null;\r\n\r\n        try {\r\n            description = generateDescription(actor);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n\r\n        return description;\r\n    }\r\n\r\n    getSystemIcons() {\r\n        try {\r\n            const sett = game.settings.get(MODULE_ID, \"showSystemIcons\");\r\n            const icons = sett > 0 ? getSystemIcons(this.combatant) : [];\r\n            const hasPermission = this.hasPermission;\r\n            icons.forEach((icon) => {\r\n                if (icon.callback) icon.hasCallback = true;\r\n                icon.visible ??= hasPermission;\r\n            });\r\n            this._systemIcons = icons;\r\n            if (!icons || !icons?.length) return { resource: null, tooltip: null };\r\n            return {\r\n                resource: sett >= 2 ? icons : null,\r\n                tooltip: sett == 1 || sett == 3 ? icons : null,\r\n            };\r\n        } catch (e) {\r\n            console.error(e);\r\n            return { resource: null, tooltip: null };\r\n        }\r\n    }\r\n\r\n    getInitiativeDisplay() {\r\n        return getInitiativeDisplay(this.combatant);\r\n    }\r\n\r\n    getBorderColor(tokenDocument) {\r\n        if (!game.settings.get(MODULE_ID, \"showDispositionColor\") || !tokenDocument) return \"#000\";\r\n\r\n        function getColor() {\r\n            const colors = CONFIG.Canvas.dispositionColors;\r\n            if ( tokenDocument.isOwner && !game.user.isGM ) return colors.CONTROLLED;\r\n            const D = CONST.TOKEN_DISPOSITIONS;\r\n            switch ( tokenDocument.disposition ) {\r\n              case D.SECRET: return colors.SECRET;\r\n              case D.HOSTILE: return colors.HOSTILE;\r\n              case D.NEUTRAL: return colors.NEUTRAL;\r\n              case D.FRIENDLY: return tokenDocument.actor?.hasPlayerOwner ? colors.PARTY : colors.FRIENDLY;\r\n              default: return colors.NEUTRAL;\r\n            }\r\n        }\r\n\r\n        return new Color(getColor()).toString();\r\n    }\r\n\r\n    destroy() {\r\n        this.element?.remove();\r\n    }\r\n}\r\n\r\nconst clamp = (value, min, max) => Math.min(Math.max(value, min), max);\r\n","import {MODULE_ID} from \"../main.js\";\n\nconst SHOWN_KEY = \"chat-welcome-message-shown\";\n\nexport function showWelcome() {\n    if (!game.user.isGM) return;\n    const module = game.modules.get(MODULE_ID);\n    const VIDEO_ID = \"2Iq_so_GsLA\";\n    const EMBEDDED_VIDEO = `<iframe width=\"100%\" height=\"auto\" src=\"https://www.youtube.com/embed/${VIDEO_ID}\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>`;\n    const WIKI_URL = module.protected ? `https://wiki.theripper93.com/premium/${MODULE_ID}` : `https://wiki.theripper93.com/free/${MODULE_ID}`;\n    const MESSAGE = `<h1>${module.title}</h1>\n    <p>by <a href=\"https://theripper93.com\">theripper93</a></p>\n    <p><strong>New to ${module.title}? Visit the <a href=\"${WIKI_URL}\">Wiki</a> for a quickstart guide and resources.</strong></p>\n    ${VIDEO_ID ? EMBEDDED_VIDEO : \"\"}\n    <p>Special thanks to all my <a href=\"https://www.patreon.com/theripper93\">Patreons</a> for making ongoing updates and development possible. Supporting gives you access to <strong>30+ premium modules</strong> and <strong>priority support</strong>.</p>\n    <p><strong>Explore all resources and modules:</strong></p> <ul>\n    <li><a href=\"https://theripper93.com/\">Check out all my free and premium modules</a></li>\n    <li><a href=\"${WIKI_URL}\">${module.title} Wiki</a></li>\n    <li><a href=\"https://www.patreon.com/theripper93\">Support on Patreon</a></li>\n    <li><a href=\"https://discord.theripper93.com/\">Discord Channel</a></li>\n    </ul>`;\n\n\n    game.settings.register(MODULE_ID, SHOWN_KEY, {\n        default: false,\n        type: Boolean,\n        scope: \"world\",\n        config: false,\n    });\n\n    if (!game.settings.get(MODULE_ID, SHOWN_KEY)) {\n\n        ChatMessage.create({\n            user: game.user.id,\n            whisper: game.users.filter(u => u.isGM).map(u => u.id),\n            blind: true,\n            content: MESSAGE,\n        });\n\n        game.settings.set(MODULE_ID, SHOWN_KEY, true);\n    }\n}","import { initConfig } from './config.js';\r\nimport {registerSettings} from './settings.js';\r\nimport {CombatDock} from './app/CombatDock.js';\r\nimport {CombatantPortrait} from './app/CombatantPortrait.js';\r\nimport {defaultAttributesConfig, generateDescription} from './systems.js';\r\nimport { showWelcome } from './lib/welcome.js';\r\nimport \"../scss/module.scss\";\r\n\r\nexport const MODULE_ID = 'combat-tracker-dock';\r\n\r\nexport function getCurrentCombat(){\r\n    return ui.combat.viewed;\r\n}\r\n\r\nHooks.once('init', function () {\r\n    registerWrappers();\r\n    registerHotkeys();\r\n    CONFIG.combatTrackerDock = {\r\n        CombatDock,\r\n        CombatantPortrait,\r\n        defaultAttributesConfig,\r\n        generateDescription,\r\n        INTRO_ANIMATION_DURATION: 1000,\r\n        INTRO_ANIMATION_DELAY: 0.25,\r\n    }\r\n\r\n    Hooks.callAll(`${MODULE_ID}-init`, CONFIG.combatTrackerDock);\r\n});\r\n\r\nHooks.on('ready', () => {\r\n    registerSettings();\r\n    initConfig();\r\n    const currentCombat = getCurrentCombat();\r\n    if(currentCombat && !ui.combatDock && game.settings.get(\"core\", \"noCanvas\")) {\r\n        new CONFIG.combatTrackerDock.CombatDock(currentCombat).render(true);\r\n    }\r\n    showWelcome();\r\n});\r\n\r\nHooks.on('createCombat', (combat) => {\r\n    if (game.combat === combat) {\r\n        new CONFIG.combatTrackerDock.CombatDock(combat).render(true);\r\n    }\r\n});\r\n\r\nHooks.on('updateCombat', (combat, updates) => {\r\n    if(updates.active || updates.scene === null) {\r\n        new CONFIG.combatTrackerDock.CombatDock(combat).render(true);\r\n    }\r\n    if(updates.scene && combat.scene !== game.scenes.viewed && ui.combatDock?.combat === combat) {\r\n        ui.combatDock.close();\r\n    }\r\n});\r\n\r\nHooks.on('canvasReady', () => {\r\n    Hooks.once(\"renderCombatTracker\", (tab) => {\r\n        const currentCombat = getCurrentCombat();\r\n            if(currentCombat) {\r\n                new CONFIG.combatTrackerDock.CombatDock(currentCombat).render(true);\r\n            } else {\r\n                ui.combatDock?.close();\r\n            }\r\n    })\r\n});\r\n\r\n\r\nfunction registerWrappers() {\r\n    if (!game.modules.get(\"lib-wrapper\")?.active) return;\r\n\r\n    libWrapper.register(MODULE_ID, \"Combatant.prototype.visible\", function (wrapped, ...args) {\r\n        const visible = wrapped(...args);\r\n        if (!ui.combatDock?.rendered) return visible;\r\n        const cDVisible = ui.combatDock.portraits.find((p) => p.combatant == this)?.firstTurnHidden;\r\n        return visible && !cDVisible;\r\n    });\r\n}\r\n\r\nfunction registerHotkeys() {\r\n    game.keybindings.register(MODULE_ID, \"combatPrev\", {\r\n        name: `${MODULE_ID}.hotkeys.combatPrev.name`,\r\n        editable: [{ key: \"KeyN\", modifiers: [foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT] }],\r\n        restricted: false,\r\n        onDown: () => {},\r\n        onUp: () => {\r\n            if (!game.combat) return;\r\n            const isOwner = game.combat.combatant?.isOwner;\r\n            if (!isOwner) return;\r\n            game.combat.previousTurn();\r\n        },\r\n    });\r\n\r\n    game.keybindings.register(MODULE_ID, \"combatNext\", {\r\n        name: `${MODULE_ID}.hotkeys.combatNext.name`,\r\n        editable: [{ key: \"KeyM\", modifiers: [foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT] }],\r\n        restricted: false,\r\n        onDown: () => {},\r\n        onUp: () => {\r\n            if (!game.combat) return;\r\n            const isOwner = game.combat.combatant?.isOwner;\r\n            if (!isOwner) return;\r\n            game.combat.nextTurn();\r\n        },\r\n    });\r\n}\r\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","initConfig","Hooks","on","app","html","data","game","user","isGM","attributes","TokenDocument","implementation","getTrackedAttributes","bar","forEach","a","push","attributeChoices","getTrackedAttributeChoices","unshift","label","attributeBarChoices","compiled","Handlebars","compile","MODULE_ID","compiled2","selectResourceHtml","options","settings","selectPortraitResourceHtml","fg","document","createElement","classList","add","innerHTML","i18n","localize","querySelector","closest","appendChild","portraitFg","button","addEventListener","e","preventDefault","foundry","applications","SettingsConfig","render","once","click","querySelectorAll","length","async","set","event","target","setPosition","height","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","apply","_objectSpread2","i","arguments","source","_defineProperty","getOwnPropertyDescriptors","defineProperties","_typeof","iterator","constructor","configurable","writable","_extends","assign","this","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceKeys","indexOf","sourceSymbolKeys","propertyIsEnumerable","userAgent","pattern","window","navigator","match","IE11OrLess","Edge","FireFox","Safari","IOS","ChromeForAndroid","captureMode","capture","passive","el","fn","off","removeEventListener","matches","selector","substring","msMatchesSelector","webkitMatchesSelector","_","getParentOrHost","host","nodeType","parentNode","ctx","includeCTX","_throttleTimeout","R_SPACE","toggleClass","name","state","className","replace","css","val","style","defaultView","getComputedStyle","currentStyle","matrix","selfOnly","appliedTransforms","transform","matrixFn","DOMMatrix","WebKitCSSMatrix","CSSMatrix","MSCSSMatrix","find","tagName","list","getElementsByTagName","n","getWindowScrollingElement","scrollingElement","documentElement","getRect","relativeToContainingBlock","relativeToNonStaticParent","undoScale","container","getBoundingClientRect","elRect","top","left","bottom","right","width","innerHeight","innerWidth","containerRect","parseInt","elMatrix","scaleX","scaleY","d","isScrolledPast","elSide","parentSide","parent","getParentAutoScrollElement","elSideVal","parentSideVal","getChild","childNum","includeDragEl","currentChild","children","display","Sortable","ghost","dragged","draggable","lastChild","last","lastElementChild","previousElementSibling","index","nodeName","toUpperCase","clone","getRelativeScrollOffset","offsetLeft","offsetTop","winScroller","scrollLeft","scrollTop","includeSelf","elem","gotSelf","clientWidth","scrollWidth","clientHeight","scrollHeight","elemCSS","overflowX","overflowY","body","isRectEqual","rect1","rect2","Math","round","throttle","callback","ms","args","setTimeout","scrollBy","x","y","Polymer","$","jQuery","Zepto","dom","cloneNode","expando","Date","getTime","AnimationStateManager","animationCallbackId","animationStates","captureAnimationState","animation","slice","child","rect","fromRect","thisAnimationDuration","childMatrix","f","addAnimationState","removeAnimationState","splice","indexOfObject","arr","Number","animateAll","_this","clearTimeout","animating","animationTime","time","toRect","prevFromRect","prevToRect","animatingRect","targetMatrix","calculateRealTime","sqrt","pow","animate","max","animationResetTimer","currentRect","duration","translateX","translateY","animatingX","animatingY","forRepaintDummy","repaint","offsetWidth","easing","animated","plugins","defaults","initializeByDefault","PluginManager","mount","plugin","option","p","pluginName","concat","pluginEvent","eventName","sortable","evt","eventCanceled","cancel","eventNameGlobal","initializePlugins","initialized","modified","modifyOption","getEventProperties","eventProperties","modifiedValue","optionListeners","dispatchEvent","_ref","rootEl","targetEl","cloneEl","toEl","fromEl","oldIndex","newIndex","oldDraggableIndex","newDraggableIndex","originalEvent","putSortable","extraEventProperties","onName","charAt","substr","CustomEvent","createEvent","initEvent","bubbles","cancelable","to","from","item","pullMode","lastPutMode","undefined","allEventProperties","_excluded","bind","dragEl","parentEl","ghostEl","nextEl","lastDownEl","cloneHidden","dragStarted","moved","activeSortable","active","hideGhostForTarget","_hideGhostForTarget","unhideGhostForTarget","_unhideGhostForTarget","cloneNowHidden","cloneNowShown","dispatchSortableEvent","_dispatchEvent","info","activeGroup","tapEvt","touchEvt","lastDx","lastDy","tapDistanceLeft","tapDistanceTop","lastTarget","lastDirection","targetMoveDistance","ghostRelativeParent","awaitingDragStarted","ignoreNextClick","sortables","pastFirstInvertThresh","isCircumstantialInvert","ghostRelativeParentInitialScroll","_silent","savedInputChecked","documentExists","PositionGhostAbsolutely","CSSFloatProperty","supportDraggable","supportCssPointerEvents","cssText","pointerEvents","_detectDirection","elCSS","elWidth","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","child1","child2","firstChildCSS","secondChildCSS","firstChildWidth","marginLeft","marginRight","secondChildWidth","flexDirection","gridTemplateColumns","split","touchingSideChild2","clear","_prepareGroup","toFn","pull","sameGroup","group","otherGroup","join","originalGroup","checkPull","checkPut","put","revertClone","stopPropagation","stopImmediatePropagation","nearestEmptyInsertDetectEvent","nearest","_detectNearestEmptySortable","ret","some","threshold","emptyInsertThreshold","insideHorizontally","insideVertically","touches","clientX","clientY","_onDragOver","_checkOutsideTargetEl","_isOutsideThisEl","toString","sort","disabled","store","handle","test","swapThreshold","invertSwap","invertedSwapThreshold","removeCloneOnHide","direction","ghostClass","chosenClass","dragClass","ignore","preventOnFilter","setData","dataTransfer","textContent","dropBubble","dragoverBubble","dataIdAttr","delay","delayOnTouchOnly","touchStartThreshold","devicePixelRatio","forceFallback","fallbackClass","fallbackOnBody","fallbackTolerance","fallbackOffset","supportPointer","nativeDraggable","_onTapStart","_onMove","dragRect","targetRect","willInsertAfter","retVal","onMoveFn","onMove","draggedRect","related","relatedRect","_disableDraggable","_unsilent","_generateId","str","src","href","sum","charCodeAt","_nextTick","_cancelNextTick","id","contains","_getDirection","type","touch","pointerType","originalTarget","shadowRoot","path","composedPath","_saveInputCheckedState","root","inputs","idx","checked","isContentEditable","criteria","trim","_prepareDragStart","dragStartFn","ownerDocument","nextSibling","_lastX","_lastY","_onDrop","_disableDelayedDragEvents","_triggerDragStart","_disableDelayedDrag","_delayedDragTouchMoveHandler","_dragStartTimer","abs","floor","_onTouchMove","_onDragStart","selection","empty","getSelection","removeAllRanges","err","_dragStarted","fallback","_appendGhost","_nulling","_emulateDragOver","elementFromPoint","ghostMatrix","relativeScrollOffset","dx","dy","b","c","cssMatrix","removeAttribute","_hideClone","cloneId","insertBefore","_loopId","setInterval","effectAllowed","_dragStartId","revert","vertical","isOwner","canSort","fromSortable","completedFired","dragOverEvent","_ignoreWhileAnimating","completed","elLastChild","_ghostIsLast","spacer","changed","_ghostIsFirst","firstChild","targetBeforeFirstSwap","sibling","differentLevel","differentRowCol","_dragElInRowColumn","dragElS1Opp","dragElS2Opp","dragElOppLength","targetS1Opp","targetS2Opp","targetOppLength","side1","scrolledPastTop","scrollBefore","_getSwapDirection","isLastTarget","mouseOnAxis","targetLength","targetS1","targetS2","invert","_getInsertDirection","dragIndex","nextElementSibling","after","moveVector","extra","axis","insertion","_showClone","_offMoveEvents","_offUpEvents","clearInterval","removeChild","save","handleEvent","_globalDragOver","dropEffect","toArray","order","getAttribute","useAnimation","items","closest$1","destroy","Array","utils","is","extend","dst","nextTick","cancelNextTick","detectDirection","element","_len","_key","create","version","scrollEl","scrollRootEl","touchEvt$1","autoScrolls","clearAutoScrolls","autoScroll","pid","isFallback","scroll","scrollCustomFn","sens","scrollSensitivity","speed","scrollSpeed","scrollThisInstance","scrollFn","layersOut","currentParent","canScrollX","canScrollY","scrollPosX","scrollPosY","vx","vy","layer","scrollOffsetY","scrollOffsetX","bubbleScroll","scrolling","drop","toSortable","changedTouches","onSpill","Revert","Remove","startIndex","dragStart","_ref2","_ref3","_ref4","parentSortable","AttributesConfig","FormApplication","super","defaultOptions","title","template","popOut","getData","activateListeners","_onAdd","_onReset","picker","_saveData","attr","icon","units","Dialog","confirm","content","yes","defaultSett","default","_getSubmitData","_onSubmit","close","li","defaultAttributesConfig","dnd5e","swade","pirateborg","cyphersystem","pf2e","pf1","crucible","wfrp4e","alienrpg","exaltedthird","exaltedessence","swnr","wwn","ars","lancer","dc20rpg","shadowdark","generateDescription","actor","system","isPC","creatureType","CONFIG","DND5E","creatureTypes","details","custom","cr","classes","values","map","level","race","class","alignment","DND4E","actorSizes","size","creatureOrigin","origin","wildcard","characterClass","characterBaseClass","ancestry","background","signatureName","taxonomy","archetype","threat","Species","currentCareer","itemTypes","career","general","specialty","careersynth","model","essence","hp","hd","combatTrackerDock","registerSettings","register","scope","config","onChange","ui","combatDock","refresh","registerMenu","hint","restricted","String","choices","rowDocked","rowFloat","columnFloat","restart","setDirection","setOverflowStyle","setFlex","autosize","setPortraitSize","portraitSize","setProperty","autofit","hidden","center","setAlignment","range","min","step","setFloatingSize","setPortraitAspect","setRoundness","fields","ColorField","setAttributeColor","twinned","text","bars","both","Boolean","token","owner","FilePathField","categories","setPortraitImageBorder","setPortraitImageBackground","setHideConflictingUIs","registerSystemSettings","registerSystemSetting","setAllSettings","floatingSize","portraitAspect","setControlsOrder","portraitImageBorder","portraitImageBackground","hideConflictingUIs","toggle","roundness","attributeColor","darkened","Color","mix","attributeColor2","darkened2","attributeColorPortrait","overflowStyle","includes","flexD","HandlebarsApplication","api","HandlebarsApplicationMixin","ApplicationV2","registerPositionSetting","savePosition","debounce","POSITION_SETTING_REGISTERED","DEFAULT_OPTIONS","APP_ID","resetSavedPosition","position","positionToSave","r","toLowerCase","PARTS","scrollable","tag","frame","positioned","controls","minimizable","resizable","contentTag","contentClasses","preventEscapeClose","actions","form","handler","submitOnChange","closeOnSubmit","_prepareContext","_onRender","context","instances","delete","options1","options2","activeOptions","mergeClone","other","deepClone","mergeObject","AddEvent","combat","footer","recentEvents","buttons","action","eventButton","eventIndex","currentTarget","dataset","img","initiative","formData","ux","FormDataExtended","isNumeric","notifications","error","createEmbeddedDocuments","roundCreated","newRecentEvent","CombatDock","portraits","hooks","_playAnimation","_currentPortraitSize","aspect","setHooks","_combatTrackerRefreshed","WINDOWED_DEFAULT_OPTIONS","sortedCombatants","combatants","contents","_sortCombatants","trueCarousel","leftAligned","autoFit","isVertical","isDocked","hook","_onRenderCombatTracker","setupCombatants","updateCombatant","_onCombatTurn","_onDeleteCombat","_onCombatStart","_onHoverToken","removeHooks","reverseHeaderPosition","combatant","CombatantPortrait","combatantsContainer","isEven","setupSeparator","updateOrder","promises","ready","_promises","Promise","all","then","playIntroAnimation","s","remove","turn","combatantsCount","afterHalf","separator","line","callAll","INTRO_ANIMATION_DURATION","delayMultiplier","INTRO_ANIMATION_DELAY","transformAxis","transformDirection","playSlideInAnimation","finished","totalAnimationTime","centerCurrentCombatant","verticalSize","sizeModifier","combatantCount","maxSpace","getElementById","updates","portrait","renderInner","updateCombatants","isTrueCarousel","visible","isLeftAligned","currentCombatant","currentCombatantIndex","findIndex","tempCombatantList","halfLength","orderedCombatants","lastCombatant","lastCombatantOrder","updateStartEndButtons","startButton","endButton","started","appendHtml","prepend","_closed","previousTurn","nextTurn","previousRound","nextRound","endCombat","rollAll","rollNPC","resetAll","apps","CombatTrackerConfig","startCombat","ContextMenu","update","combatantId","combats","directory","_getEntryContextOptions","fixed","_onRoundChange","filteredChildren","currentSize","minWidth","minHeight","childrenByHighestOrder","childrenByLowestOrder","currentIndex","nextDefeatedCount","previousDefeatedCount","defeated","nextDefeatedCombatants","previousDefeatedCombatants","first","reduce","els","toDelete","getFlag","ChatMessage","speaker","alias","CONST","CHAT_MESSAGE_TYPES","OTHER","whisper","deleteEmbeddedDocuments","carouselStyle","combatantsEl","scrollTo","behavior","offsetHeight","current","scrollIntoView","block","inline","uiLeft","uiRight","hover","force","setAttribute","backgroundImage","resolve","res","_hasTakenTurn","activateCoreListeners","displayName","TOKEN_DISPLAY_MODES","HOVER","ALWAYS","firstTurnHidden","hasPermission","permission","DOCUMENT_OWNERSHIP_LEVELS","OBSERVER","isFriendly","disposition","TOKEN_DISPOSITIONS","FRIENDLY","isEvent","flags","eventResource","currentRound","percentage","eventRoundsLeft","_onHoverIn","_onHoverOut","_onCombatantMouseDown","iconEl","_systemIcons","enabled","effectEl","uuid","effect","fromUuid","statusEffect","statusEffects","no","defaultYes","toggleEffect","sheet","testUserPermission","now","dt","_clickTime","control","releaseOthers","canvas","animatePan","isVisible","controlled","handlebars","renderTemplate","tooltip","tooltipDirection","helpers","interaction","TooltipManager","TOOLTIP_DIRECTIONS","RIGHT","LEFT","borderBottomColor","getBorderColor","rollInitiative","_onToggleDefeatedStatus","_onPingCombatant","ib","getResource","resource","primary","getProperty","validateValue","isArray","getBarsOrder","hasEffects","r1","r2","sett","isNaN","bar1","bar2","init","effects","bar1ML","bar2ML","initBars","playerPlayerPermission","hasPlayerOwner","hasDecimals","isDefeated","turns","trackedAttributes","systemIcons","getSystemIcons","systemIconCount","attributesVisibility","displayDescriptionsSetting","displayDescriptions","resource2","portraitResourceSetting","portraitResource","initiativeData","getInitiativeDisplay","isIconImg","isRollIconImg","rollIcon","showPass","hasRolled","hasResource","hasResource2","hasPortraitResource","showInitiative","isInitiativeNaN","showBars","showText","canPing","sceneId","scene","description","getDescription","resSystemIcons","tooltipSystemIcons","systemIconsSizeMulti","clamp","barsOrder","isInteger","Set","hasAttributes","temporaryEffects","statuses","has","specialStatusEffects","DEFEATED","TextEditor","enrichHTML","percent","remaining","hasDuration","precision","Combat","decimals","toFixed","console","icons","modules","getMidiFlag","actionType","toggleMidiFlag","flag","setFlag","color","iconIndex","iconId","systemData","alwaysShowActions","getSystemSetting","resources","focus","fontSize","getActiveTokens","t","eff","hasCallback","suit","getCardImage","cardstr","cards","cardString","tokenDocument","getColor","colors","Canvas","dispositionColors","CONTROLLED","D","SECRET","HOSTILE","NEUTRAL","PARTY","SHOWN_KEY","getCurrentCombat","viewed","registerWrappers","libWrapper","wrapped","rendered","cDVisible","registerHotkeys","keybindings","editable","modifiers","KeyboardManager","MODIFIER_KEYS","SHIFT","onDown","onUp","currentCombat","showWelcome","module","VIDEO_ID","EMBEDDED_VIDEO","WIKI_URL","protected","MESSAGE","users","u","blind","scenes","tab"],"ignoreList":[],"sourceRoot":""}