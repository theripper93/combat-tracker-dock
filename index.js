/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function ownKeys(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _extends(){return _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},_extends.apply(this,arguments)}function _objectWithoutProperties(t,e){if(null==t)return{};var a,n,i=function _objectWithoutPropertiesLoose(t,e){if(null==t)return{};var a,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(i[a]=t[a]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}t.d({},{D:()=>gt});function userAgent(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var e=userAgent(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),a=userAgent(/Edge/i),n=userAgent(/firefox/i),i=userAgent(/safari/i)&&!userAgent(/chrome/i)&&!userAgent(/android/i),o=userAgent(/iP(ad|od|hone)/i),r=userAgent(/chrome/i)&&userAgent(/android/i),s={capture:!1,passive:!1};function on(t,a,n){t.addEventListener(a,n,!e&&s)}function off(t,a,n){t.removeEventListener(a,n,!e&&s)}function matches(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function getParentOrHost(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function closest(t,e,a,n){if(t){a=a||document;do{if(null!=e&&(">"===e[0]?t.parentNode===a&&matches(t,e):matches(t,e))||n&&t===a)return t;if(t===a)break}while(t=getParentOrHost(t))}return null}var c,l=/\s+/g;function toggleClass(t,e,a){if(t&&e)if(t.classList)t.classList[a?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(l," ").replace(" "+e+" "," ");t.className=(n+(a?" "+e:"")).replace(l," ")}}function css(t,e,a){var n=t&&t.style;if(n){if(void 0===a)return document.defaultView&&document.defaultView.getComputedStyle?a=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(a=t.currentStyle),void 0===e?a:a[e];e in n||-1!==e.indexOf("webkit")||(e="-webkit-"+e),n[e]=a+("string"==typeof a?"":"px")}}function matrix(t,e){var a="";if("string"==typeof t)a=t;else do{var n=css(t,"transform");n&&"none"!==n&&(a=n+" "+a)}while(!e&&(t=t.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(a)}function find(t,e,a){if(t){var n=t.getElementsByTagName(e),i=0,o=n.length;if(a)for(;i<o;i++)a(n[i],i);return n}return[]}function getWindowScrollingElement(){var t=document.scrollingElement;return t||document.documentElement}function getRect(t,a,n,i,o){if(t.getBoundingClientRect||t===window){var r,s,c,l,u,d,m;if(t!==window&&t.parentNode&&t!==getWindowScrollingElement()?(s=(r=t.getBoundingClientRect()).top,c=r.left,l=r.bottom,u=r.right,d=r.height,m=r.width):(s=0,c=0,l=window.innerHeight,u=window.innerWidth,d=window.innerHeight,m=window.innerWidth),(a||n)&&t!==window&&(o=o||t.parentNode,!e))do{if(o&&o.getBoundingClientRect&&("none"!==css(o,"transform")||n&&"static"!==css(o,"position"))){var g=o.getBoundingClientRect();s-=g.top+parseInt(css(o,"border-top-width")),c-=g.left+parseInt(css(o,"border-left-width")),l=s+r.height,u=c+r.width;break}}while(o=o.parentNode);if(i&&t!==window){var h=matrix(o||t),f=h&&h.a,p=h&&h.d;h&&(l=(s/=p)+(d/=p),u=(c/=f)+(m/=f))}return{top:s,left:c,bottom:l,right:u,width:m,height:d}}}function isScrolledPast(t,e,a){for(var n=getParentAutoScrollElement(t,!0),i=getRect(t)[e];n;){var o=getRect(n)[a];if(!("top"===a||"left"===a?i>=o:i<=o))return n;if(n===getWindowScrollingElement())break;n=getParentAutoScrollElement(n,!1)}return!1}function getChild(t,e,a,n){for(var i=0,o=0,r=t.children;o<r.length;){if("none"!==r[o].style.display&&r[o]!==Sortable.ghost&&(n||r[o]!==Sortable.dragged)&&closest(r[o],a.draggable,t,!1)){if(i===e)return r[o];i++}o++}return null}function lastChild(t,e){for(var a=t.lastElementChild;a&&(a===Sortable.ghost||"none"===css(a,"display")||e&&!matches(a,e));)a=a.previousElementSibling;return a||null}function index(t,e){var a=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Sortable.clone||e&&!matches(t,e)||a++;return a}function getRelativeScrollOffset(t){var e=0,a=0,n=getWindowScrollingElement();if(t)do{var i=matrix(t),o=i.a,r=i.d;e+=t.scrollLeft*o,a+=t.scrollTop*r}while(t!==n&&(t=t.parentNode));return[e,a]}function getParentAutoScrollElement(t,e){if(!t||!t.getBoundingClientRect)return getWindowScrollingElement();var a=t,n=!1;do{if(a.clientWidth<a.scrollWidth||a.clientHeight<a.scrollHeight){var i=css(a);if(a.clientWidth<a.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||a.clientHeight<a.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!a.getBoundingClientRect||a===document.body)return getWindowScrollingElement();if(n||e)return a;n=!0}}}while(a=a.parentNode);return getWindowScrollingElement()}function isRectEqual(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function throttle(t,e){return function(){if(!c){var a=arguments;1===a.length?t.call(this,a[0]):t.apply(this,a),c=setTimeout(function(){c=void 0},e)}}}function scrollBy(t,e,a){t.scrollLeft+=e,t.scrollTop+=a}function clone(t){var e=window.Polymer,a=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):a?a(t).clone(!0)[0]:t.cloneNode(!0)}var u="Sortable"+(new Date).getTime();function AnimationStateManager(){var t,e=[];return{captureAnimationState:function captureAnimationState(){(e=[],this.options.animation)&&[].slice.call(this.el.children).forEach(function(t){if("none"!==css(t,"display")&&t!==Sortable.ghost){e.push({target:t,rect:getRect(t)});var a=_objectSpread2({},e[e.length-1].rect);if(t.thisAnimationDuration){var n=matrix(t,!0);n&&(a.top-=n.f,a.left-=n.e)}t.fromRect=a}})},addAnimationState:function addAnimationState(t){e.push(t)},removeAnimationState:function removeAnimationState(t){e.splice(function indexOfObject(t,e){for(var a in t)if(t.hasOwnProperty(a))for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t[a][n])return Number(a);return-1}(e,{target:t}),1)},animateAll:function animateAll(a){var n=this;if(!this.options.animation)return clearTimeout(t),void("function"==typeof a&&a());var i=!1,o=0;e.forEach(function(t){var e=0,a=t.target,r=a.fromRect,s=getRect(a),c=a.prevFromRect,l=a.prevToRect,u=t.rect,d=matrix(a,!0);d&&(s.top-=d.f,s.left-=d.e),a.toRect=s,a.thisAnimationDuration&&isRectEqual(c,s)&&!isRectEqual(r,s)&&(u.top-s.top)/(u.left-s.left)===(r.top-s.top)/(r.left-s.left)&&(e=function calculateRealTime(t,e,a,n){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-a.top,2)+Math.pow(e.left-a.left,2))*n.animation}(u,c,l,n.options)),isRectEqual(s,r)||(a.prevFromRect=r,a.prevToRect=s,e||(e=n.options.animation),n.animate(a,u,s,e)),e&&(i=!0,o=Math.max(o,e),clearTimeout(a.animationResetTimer),a.animationResetTimer=setTimeout(function(){a.animationTime=0,a.prevFromRect=null,a.fromRect=null,a.prevToRect=null,a.thisAnimationDuration=null},e),a.thisAnimationDuration=e)}),clearTimeout(t),i?t=setTimeout(function(){"function"==typeof a&&a()},o):"function"==typeof a&&a(),e=[]},animate:function animate(t,e,a,n){if(n){css(t,"transition",""),css(t,"transform","");var i=matrix(this.el),o=i&&i.a,r=i&&i.d,s=(e.left-a.left)/(o||1),c=(e.top-a.top)/(r||1);t.animatingX=!!s,t.animatingY=!!c,css(t,"transform","translate3d("+s+"px,"+c+"px,0)"),this.forRepaintDummy=function repaint(t){return t.offsetWidth}(t),css(t,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),css(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout(function(){css(t,"transition",""),css(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},n)}}}}var d=[],m={initializeByDefault:!0},g={mount:function mount(t){for(var e in m)m.hasOwnProperty(e)&&!(e in t)&&(t[e]=m[e]);d.forEach(function(e){if(e.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),d.push(t)},pluginEvent:function pluginEvent(t,e,a){var n=this;this.eventCanceled=!1,a.cancel=function(){n.eventCanceled=!0};var i=t+"Global";d.forEach(function(n){e[n.pluginName]&&(e[n.pluginName][i]&&e[n.pluginName][i](_objectSpread2({sortable:e},a)),e.options[n.pluginName]&&e[n.pluginName][t]&&e[n.pluginName][t](_objectSpread2({sortable:e},a)))})},initializePlugins:function initializePlugins(t,e,a,n){for(var i in d.forEach(function(n){var i=n.pluginName;if(t.options[i]||n.initializeByDefault){var o=new n(t,e,t.options);o.sortable=t,o.options=t.options,t[i]=o,_extends(a,o.defaults)}}),t.options)if(t.options.hasOwnProperty(i)){var o=this.modifyOption(t,i,t.options[i]);void 0!==o&&(t.options[i]=o)}},getEventProperties:function getEventProperties(t,e){var a={};return d.forEach(function(n){"function"==typeof n.eventProperties&&_extends(a,n.eventProperties.call(e[n.pluginName],t))}),a},modifyOption:function modifyOption(t,e,a){var n;return d.forEach(function(i){t[i.pluginName]&&i.optionListeners&&"function"==typeof i.optionListeners[e]&&(n=i.optionListeners[e].call(t[i.pluginName],a))}),n}};function dispatchEvent(t){var n=t.sortable,i=t.rootEl,o=t.name,r=t.targetEl,s=t.cloneEl,c=t.toEl,l=t.fromEl,d=t.oldIndex,m=t.newIndex,h=t.oldDraggableIndex,f=t.newDraggableIndex,p=t.originalEvent,b=t.putSortable,v=t.extraEventProperties;if(n=n||i&&i[u]){var y,k=n.options,S="on"+o.charAt(0).toUpperCase()+o.substr(1);!window.CustomEvent||e||a?(y=document.createEvent("Event")).initEvent(o,!0,!0):y=new CustomEvent(o,{bubbles:!0,cancelable:!0}),y.to=c||i,y.from=l||i,y.item=r||i,y.clone=s,y.oldIndex=d,y.newIndex=m,y.oldDraggableIndex=h,y.newDraggableIndex=f,y.originalEvent=p,y.pullMode=b?b.lastPutMode:void 0;var w=_objectSpread2(_objectSpread2({},v),g.getEventProperties(o,n));for(var E in w)y[E]=w[E];i&&i.dispatchEvent(y),k[S]&&k[S].call(n,y)}}var h=["evt"],f=function pluginEvent(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.evt,i=_objectWithoutProperties(a,h);g.pluginEvent.bind(Sortable)(t,e,_objectSpread2({dragEl:p,parentEl:b,ghostEl:v,rootEl:y,nextEl:k,lastDownEl:S,cloneEl:w,cloneHidden:E,dragStarted:z,putSortable:P,activeSortable:Sortable.active,originalEvent:n,oldIndex:C,oldDraggableIndex:_,newIndex:D,newDraggableIndex:T,hideGhostForTarget:at,unhideGhostForTarget:nt,cloneNowHidden:function cloneNowHidden(){E=!0},cloneNowShown:function cloneNowShown(){E=!1},dispatchSortableEvent:function dispatchSortableEvent(t){_dispatchEvent({sortable:e,name:t,originalEvent:n})}},i))};function _dispatchEvent(t){dispatchEvent(_objectSpread2({putSortable:P,cloneEl:w,targetEl:p,rootEl:y,oldIndex:C,oldDraggableIndex:_,newIndex:D,newDraggableIndex:T},t))}var p,b,v,y,k,S,w,E,C,D,_,T,I,P,A,O,N,x,R,M,z,L,F,H,$,G=!1,B=!1,W=[],j=!1,q=!1,Y=[],V=!1,U=[],X="undefined"!=typeof document,K=o,J=a||e?"cssFloat":"float",Z=X&&!r&&!o&&"draggable"in document.createElement("div"),Q=function(){if(X){if(e)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),tt=function _detectDirection(t,e){var a=css(t),n=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),i=getChild(t,0,e),o=getChild(t,1,e),r=i&&css(i),s=o&&css(o),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+getRect(i).width,l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+getRect(o).width;if("flex"===a.display)return"column"===a.flexDirection||"column-reverse"===a.flexDirection?"vertical":"horizontal";if("grid"===a.display)return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&r.float&&"none"!==r.float){var u="left"===r.float?"left":"right";return!o||"both"!==s.clear&&s.clear!==u?"horizontal":"vertical"}return i&&("block"===r.display||"flex"===r.display||"table"===r.display||"grid"===r.display||c>=n&&"none"===a[J]||o&&"none"===a[J]&&c+l>n)?"vertical":"horizontal"},et=function _prepareGroup(t){function toFn(t,e){return function(a,n,i,o){var r=a.options.group.name&&n.options.group.name&&a.options.group.name===n.options.group.name;if(null==t&&(e||r))return!0;if(null==t||!1===t)return!1;if(e&&"clone"===t)return t;if("function"==typeof t)return toFn(t(a,n,i,o),e)(a,n,i,o);var s=(e?a:n).options.group.name;return!0===t||"string"==typeof t&&t===s||t.join&&t.indexOf(s)>-1}}var e={},a=t.group;a&&"object"==_typeof(a)||(a={name:a}),e.name=a.name,e.checkPull=toFn(a.pull,!0),e.checkPut=toFn(a.put),e.revertClone=a.revertClone,t.group=e},at=function _hideGhostForTarget(){!Q&&v&&css(v,"display","none")},nt=function _unhideGhostForTarget(){!Q&&v&&css(v,"display","")};X&&!r&&document.addEventListener("click",function(t){if(B)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),B=!1,!1},!0);var it=function nearestEmptyInsertDetectEvent(t){if(p){var e=function _detectNearestEmptySortable(t,e){var a;return W.some(function(n){var i=n[u].options.emptyInsertThreshold;if(i&&!lastChild(n)){var o=getRect(n),r=t>=o.left-i&&t<=o.right+i,s=e>=o.top-i&&e<=o.bottom+i;return r&&s?a=n:void 0}}),a}((t=t.touches?t.touches[0]:t).clientX,t.clientY);if(e){var a={};for(var n in t)t.hasOwnProperty(n)&&(a[n]=t[n]);a.target=a.rootEl=e,a.preventDefault=void 0,a.stopPropagation=void 0,e[u]._onDragOver(a)}}},ot=function _checkOutsideTargetEl(t){p&&p.parentNode[u]._isOutsideThisEl(t.target)};function Sortable(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=_extends({},e),t[u]=this;var a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function direction(){return tt(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function setData(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Sortable.supportPointer&&"PointerEvent"in window&&!i,emptyInsertThreshold:5};for(var n in g.initializePlugins(this,t,a),a)!(n in e)&&(e[n]=a[n]);for(var o in et(e),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&Z,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?on(t,"pointerdown",this._onTapStart):(on(t,"mousedown",this._onTapStart),on(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(on(t,"dragover",this),on(t,"dragenter",this)),W.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),_extends(this,AnimationStateManager())}function _onMove(t,n,i,o,r,s,c,l){var d,m,g=t[u],h=g.options.onMove;return!window.CustomEvent||e||a?(d=document.createEvent("Event")).initEvent("move",!0,!0):d=new CustomEvent("move",{bubbles:!0,cancelable:!0}),d.to=n,d.from=t,d.dragged=i,d.draggedRect=o,d.related=r||n,d.relatedRect=s||getRect(n),d.willInsertAfter=l,d.originalEvent=c,t.dispatchEvent(d),h&&(m=h.call(g,d,c)),m}function _disableDraggable(t){t.draggable=!1}function _unsilent(){V=!1}function _generateId(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,a=e.length,n=0;a--;)n+=e.charCodeAt(a);return n.toString(36)}function _nextTick(t){return setTimeout(t,0)}function _cancelNextTick(t){return clearTimeout(t)}Sortable.prototype={constructor:Sortable,_isOutsideThisEl:function _isOutsideThisEl(t){this.el.contains(t)||t===this.el||(L=null)},_getDirection:function _getDirection(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,p):this.options.direction},_onTapStart:function _onTapStart(t){if(t.cancelable){var e=this,a=this.el,n=this.options,o=n.preventOnFilter,r=t.type,s=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,c=(s||t).target,l=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||c,u=n.filter;if(function _saveInputCheckedState(t){U.length=0;var e=t.getElementsByTagName("input"),a=e.length;for(;a--;){var n=e[a];n.checked&&U.push(n)}}(a),!p&&!(/mousedown|pointerdown/.test(r)&&0!==t.button||n.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!i||!c||"SELECT"!==c.tagName.toUpperCase())&&!((c=closest(c,n.draggable,a,!1))&&c.animated||S===c)){if(C=index(c),_=index(c,n.draggable),"function"==typeof u){if(u.call(this,t,c,this))return _dispatchEvent({sortable:e,rootEl:l,name:"filter",targetEl:c,toEl:a,fromEl:a}),f("filter",e,{evt:t}),void(o&&t.cancelable&&t.preventDefault())}else if(u&&(u=u.split(",").some(function(n){if(n=closest(l,n.trim(),a,!1))return _dispatchEvent({sortable:e,rootEl:n,name:"filter",targetEl:c,fromEl:a,toEl:a}),f("filter",e,{evt:t}),!0})))return void(o&&t.cancelable&&t.preventDefault());n.handle&&!closest(l,n.handle,a,!1)||this._prepareDragStart(t,s,c)}}},_prepareDragStart:function _prepareDragStart(t,i,o){var r,s=this,c=s.el,l=s.options,u=c.ownerDocument;if(o&&!p&&o.parentNode===c){var d=getRect(o);if(y=c,b=(p=o).parentNode,k=p.nextSibling,S=o,I=l.group,Sortable.dragged=p,A={target:p,clientX:(i||t).clientX,clientY:(i||t).clientY},R=A.clientX-d.left,M=A.clientY-d.top,this._lastX=(i||t).clientX,this._lastY=(i||t).clientY,p.style["will-change"]="all",r=function dragStartFn(){f("delayEnded",s,{evt:t}),Sortable.eventCanceled?s._onDrop():(s._disableDelayedDragEvents(),!n&&s.nativeDraggable&&(p.draggable=!0),s._triggerDragStart(t,i),_dispatchEvent({sortable:s,name:"choose",originalEvent:t}),toggleClass(p,l.chosenClass,!0))},l.ignore.split(",").forEach(function(t){find(p,t.trim(),_disableDraggable)}),on(u,"dragover",it),on(u,"mousemove",it),on(u,"touchmove",it),on(u,"mouseup",s._onDrop),on(u,"touchend",s._onDrop),on(u,"touchcancel",s._onDrop),n&&this.nativeDraggable&&(this.options.touchStartThreshold=4,p.draggable=!0),f("delayStart",this,{evt:t}),!l.delay||l.delayOnTouchOnly&&!i||this.nativeDraggable&&(a||e))r();else{if(Sortable.eventCanceled)return void this._onDrop();on(u,"mouseup",s._disableDelayedDrag),on(u,"touchend",s._disableDelayedDrag),on(u,"touchcancel",s._disableDelayedDrag),on(u,"mousemove",s._delayedDragTouchMoveHandler),on(u,"touchmove",s._delayedDragTouchMoveHandler),l.supportPointer&&on(u,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(r,l.delay)}}},_delayedDragTouchMoveHandler:function _delayedDragTouchMoveHandler(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function _disableDelayedDrag(){p&&_disableDraggable(p),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function _disableDelayedDragEvents(){var t=this.el.ownerDocument;off(t,"mouseup",this._disableDelayedDrag),off(t,"touchend",this._disableDelayedDrag),off(t,"touchcancel",this._disableDelayedDrag),off(t,"mousemove",this._delayedDragTouchMoveHandler),off(t,"touchmove",this._delayedDragTouchMoveHandler),off(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function _triggerDragStart(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?on(document,"pointermove",this._onTouchMove):on(document,e?"touchmove":"mousemove",this._onTouchMove):(on(p,"dragend",this),on(y,"dragstart",this._onDragStart));try{document.selection?_nextTick(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function _dragStarted(t,e){if(G=!1,y&&p){f("dragStarted",this,{evt:e}),this.nativeDraggable&&on(document,"dragover",ot);var a=this.options;!t&&toggleClass(p,a.dragClass,!1),toggleClass(p,a.ghostClass,!0),Sortable.active=this,t&&this._appendGhost(),_dispatchEvent({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function _emulateDragOver(){if(O){this._lastX=O.clientX,this._lastY=O.clientY,at();for(var t=document.elementFromPoint(O.clientX,O.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(O.clientX,O.clientY))!==e;)e=t;if(p.parentNode[u]._isOutsideThisEl(t),e)do{if(e[u]){if(e[u]._onDragOver({clientX:O.clientX,clientY:O.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);nt()}},_onTouchMove:function _onTouchMove(t){if(A){var e=this.options,a=e.fallbackTolerance,n=e.fallbackOffset,i=t.touches?t.touches[0]:t,o=v&&matrix(v,!0),r=v&&o&&o.a,s=v&&o&&o.d,c=K&&$&&getRelativeScrollOffset($),l=(i.clientX-A.clientX+n.x)/(r||1)+(c?c[0]-Y[0]:0)/(r||1),u=(i.clientY-A.clientY+n.y)/(s||1)+(c?c[1]-Y[1]:0)/(s||1);if(!Sortable.active&&!G){if(a&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<a)return;this._onDragStart(t,!0)}if(v){o?(o.e+=l-(N||0),o.f+=u-(x||0)):o={a:1,b:0,c:0,d:1,e:l,f:u};var d="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");css(v,"webkitTransform",d),css(v,"mozTransform",d),css(v,"msTransform",d),css(v,"transform",d),N=l,x=u,O=i}t.cancelable&&t.preventDefault()}},_appendGhost:function _appendGhost(){if(!v){var t=this.options.fallbackOnBody?document.body:y,e=getRect(p,!0,K,!0,t),a=this.options;if(K){for($=t;"static"===css($,"position")&&"none"===css($,"transform")&&$!==document;)$=$.parentNode;$!==document.body&&$!==document.documentElement?($===document&&($=getWindowScrollingElement()),e.top+=$.scrollTop,e.left+=$.scrollLeft):$=getWindowScrollingElement(),Y=getRelativeScrollOffset($)}toggleClass(v=p.cloneNode(!0),a.ghostClass,!1),toggleClass(v,a.fallbackClass,!0),toggleClass(v,a.dragClass,!0),css(v,"transition",""),css(v,"transform",""),css(v,"box-sizing","border-box"),css(v,"margin",0),css(v,"top",e.top),css(v,"left",e.left),css(v,"width",e.width),css(v,"height",e.height),css(v,"opacity","0.8"),css(v,"position",K?"absolute":"fixed"),css(v,"zIndex","100000"),css(v,"pointerEvents","none"),Sortable.ghost=v,t.appendChild(v),css(v,"transform-origin",R/parseInt(v.style.width)*100+"% "+M/parseInt(v.style.height)*100+"%")}},_onDragStart:function _onDragStart(t,e){var a=this,n=t.dataTransfer,o=a.options;f("dragStart",this,{evt:t}),Sortable.eventCanceled?this._onDrop():(f("setupClone",this),Sortable.eventCanceled||((w=clone(p)).removeAttribute("id"),w.draggable=!1,w.style["will-change"]="",this._hideClone(),toggleClass(w,this.options.chosenClass,!1),Sortable.clone=w),a.cloneId=_nextTick(function(){f("clone",a),Sortable.eventCanceled||(a.options.removeCloneOnHide||y.insertBefore(w,p),a._hideClone(),_dispatchEvent({sortable:a,name:"clone"}))}),!e&&toggleClass(p,o.dragClass,!0),e?(B=!0,a._loopId=setInterval(a._emulateDragOver,50)):(off(document,"mouseup",a._onDrop),off(document,"touchend",a._onDrop),off(document,"touchcancel",a._onDrop),n&&(n.effectAllowed="move",o.setData&&o.setData.call(a,n,p)),on(document,"drop",a),css(p,"transform","translateZ(0)")),G=!0,a._dragStartId=_nextTick(a._dragStarted.bind(a,e,t)),on(document,"selectstart",a),z=!0,i&&css(document.body,"user-select","none"))},_onDragOver:function _onDragOver(t){var e,a,n,i,o=this.el,r=t.target,s=this.options,c=s.group,l=Sortable.active,d=I===c,m=s.sort,g=P||l,h=this,S=!1;if(!V){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),r=closest(r,s.draggable,o,!0),dragOverEvent("dragOver"),Sortable.eventCanceled)return S;if(p.contains(t.target)||r.animated&&r.animatingX&&r.animatingY||h._ignoreWhileAnimating===r)return completed(!1);if(B=!1,l&&!s.disabled&&(d?m||(n=b!==y):P===this||(this.lastPutMode=I.checkPull(this,l,p,t))&&c.checkPut(this,l,p,t))){if(i="vertical"===this._getDirection(t,r),e=getRect(p),dragOverEvent("dragOverValid"),Sortable.eventCanceled)return S;if(n)return b=y,capture(),this._hideClone(),dragOverEvent("revert"),Sortable.eventCanceled||(k?y.insertBefore(p,k):y.appendChild(p)),completed(!0);var w=lastChild(o,s.draggable);if(!w||function _ghostIsLast(t,e,a){var n=getRect(lastChild(a.el,a.options.draggable)),i=10;return e?t.clientX>n.right+i||t.clientX<=n.right&&t.clientY>n.bottom&&t.clientX>=n.left:t.clientX>n.right&&t.clientY>n.top||t.clientX<=n.right&&t.clientY>n.bottom+i}(t,i,this)&&!w.animated){if(w===p)return completed(!1);if(w&&o===t.target&&(r=w),r&&(a=getRect(r)),!1!==_onMove(y,o,p,e,r,a,t,!!r))return capture(),w&&w.nextSibling?o.insertBefore(p,w.nextSibling):o.appendChild(p),b=o,changed(),completed(!0)}else if(w&&function _ghostIsFirst(t,e,a){var n=getRect(getChild(a.el,0,a.options,!0)),i=10;return e?t.clientX<n.left-i||t.clientY<n.top&&t.clientX<n.right:t.clientY<n.top-i||t.clientY<n.bottom&&t.clientX<n.left}(t,i,this)){var E=getChild(o,0,s,!0);if(E===p)return completed(!1);if(a=getRect(r=E),!1!==_onMove(y,o,p,e,r,a,t,!1))return capture(),o.insertBefore(p,E),b=o,changed(),completed(!0)}else if(r.parentNode===o){a=getRect(r);var C,_,A,O=p.parentNode!==o,N=!function _dragElInRowColumn(t,e,a){var n=a?t.left:t.top,i=a?t.right:t.bottom,o=a?t.width:t.height,r=a?e.left:e.top,s=a?e.right:e.bottom,c=a?e.width:e.height;return n===r||i===s||n+o/2===r+c/2}(p.animated&&p.toRect||e,r.animated&&r.toRect||a,i),x=i?"top":"left",R=isScrolledPast(r,"top","top")||isScrolledPast(p,"top","top"),M=R?R.scrollTop:void 0;if(L!==r&&(_=a[x],j=!1,q=!N&&s.invertSwap||O),C=function _getSwapDirection(t,e,a,n,i,o,r,s){var c=n?t.clientY:t.clientX,l=n?a.height:a.width,u=n?a.top:a.left,d=n?a.bottom:a.right,m=!1;if(!r)if(s&&H<l*i){if(!j&&(1===F?c>u+l*o/2:c<d-l*o/2)&&(j=!0),j)m=!0;else if(1===F?c<u+H:c>d-H)return-F}else if(c>u+l*(1-i)/2&&c<d-l*(1-i)/2)return function _getInsertDirection(t){return index(p)<index(t)?1:-1}(e);if((m=m||r)&&(c<u+l*o/2||c>d-l*o/2))return c>u+l/2?1:-1;return 0}(t,r,a,i,N?1:s.swapThreshold,null==s.invertedSwapThreshold?s.swapThreshold:s.invertedSwapThreshold,q,L===r),0!==C){var z=index(p);do{z-=C,A=b.children[z]}while(A&&("none"===css(A,"display")||A===v))}if(0===C||A===r)return completed(!1);L=r,F=C;var $=r.nextElementSibling,G=!1,W=_onMove(y,o,p,e,r,a,t,G=1===C);if(!1!==W)return 1!==W&&-1!==W||(G=1===W),V=!0,setTimeout(_unsilent,30),capture(),G&&!$?o.appendChild(p):r.parentNode.insertBefore(p,G?$:r),R&&scrollBy(R,0,M-R.scrollTop),b=p.parentNode,void 0===_||q||(H=Math.abs(_-getRect(r)[x])),changed(),completed(!0)}if(o.contains(p))return completed(!1)}return!1}function dragOverEvent(s,c){f(s,h,_objectSpread2({evt:t,isOwner:d,axis:i?"vertical":"horizontal",revert:n,dragRect:e,targetRect:a,canSort:m,fromSortable:g,target:r,completed,onMove:function onMove(a,n){return _onMove(y,o,p,e,a,getRect(a),t,n)},changed},c))}function capture(){dragOverEvent("dragOverAnimationCapture"),h.captureAnimationState(),h!==g&&g.captureAnimationState()}function completed(e){return dragOverEvent("dragOverCompleted",{insertion:e}),e&&(d?l._hideClone():l._showClone(h),h!==g&&(toggleClass(p,P?P.options.ghostClass:l.options.ghostClass,!1),toggleClass(p,s.ghostClass,!0)),P!==h&&h!==Sortable.active?P=h:h===Sortable.active&&P&&(P=null),g===h&&(h._ignoreWhileAnimating=r),h.animateAll(function(){dragOverEvent("dragOverAnimationComplete"),h._ignoreWhileAnimating=null}),h!==g&&(g.animateAll(),g._ignoreWhileAnimating=null)),(r===p&&!p.animated||r===o&&!r.animated)&&(L=null),s.dragoverBubble||t.rootEl||r===document||(p.parentNode[u]._isOutsideThisEl(t.target),!e&&it(t)),!s.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),S=!0}function changed(){D=index(p),T=index(p,s.draggable),_dispatchEvent({sortable:h,name:"change",toEl:o,newIndex:D,newDraggableIndex:T,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function _offMoveEvents(){off(document,"mousemove",this._onTouchMove),off(document,"touchmove",this._onTouchMove),off(document,"pointermove",this._onTouchMove),off(document,"dragover",it),off(document,"mousemove",it),off(document,"touchmove",it)},_offUpEvents:function _offUpEvents(){var t=this.el.ownerDocument;off(t,"mouseup",this._onDrop),off(t,"touchend",this._onDrop),off(t,"pointerup",this._onDrop),off(t,"touchcancel",this._onDrop),off(document,"selectstart",this)},_onDrop:function _onDrop(t){var e=this.el,a=this.options;D=index(p),T=index(p,a.draggable),f("drop",this,{evt:t}),b=p&&p.parentNode,D=index(p),T=index(p,a.draggable),Sortable.eventCanceled||(G=!1,q=!1,j=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_cancelNextTick(this.cloneId),_cancelNextTick(this._dragStartId),this.nativeDraggable&&(off(document,"drop",this),off(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),i&&css(document.body,"user-select",""),css(p,"transform",""),t&&(z&&(t.cancelable&&t.preventDefault(),!a.dropBubble&&t.stopPropagation()),v&&v.parentNode&&v.parentNode.removeChild(v),(y===b||P&&"clone"!==P.lastPutMode)&&w&&w.parentNode&&w.parentNode.removeChild(w),p&&(this.nativeDraggable&&off(p,"dragend",this),_disableDraggable(p),p.style["will-change"]="",z&&!G&&toggleClass(p,P?P.options.ghostClass:this.options.ghostClass,!1),toggleClass(p,this.options.chosenClass,!1),_dispatchEvent({sortable:this,name:"unchoose",toEl:b,newIndex:null,newDraggableIndex:null,originalEvent:t}),y!==b?(D>=0&&(_dispatchEvent({rootEl:b,name:"add",toEl:b,fromEl:y,originalEvent:t}),_dispatchEvent({sortable:this,name:"remove",toEl:b,originalEvent:t}),_dispatchEvent({rootEl:b,name:"sort",toEl:b,fromEl:y,originalEvent:t}),_dispatchEvent({sortable:this,name:"sort",toEl:b,originalEvent:t})),P&&P.save()):D!==C&&D>=0&&(_dispatchEvent({sortable:this,name:"update",toEl:b,originalEvent:t}),_dispatchEvent({sortable:this,name:"sort",toEl:b,originalEvent:t})),Sortable.active&&(null!=D&&-1!==D||(D=C,T=_),_dispatchEvent({sortable:this,name:"end",toEl:b,originalEvent:t}),this.save())))),this._nulling()},_nulling:function _nulling(){f("nulling",this),y=p=b=v=k=w=S=E=A=O=z=D=T=C=_=L=F=P=I=Sortable.dragged=Sortable.ghost=Sortable.clone=Sortable.active=null,U.forEach(function(t){t.checked=!0}),U.length=N=x=0},handleEvent:function handleEvent(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":p&&(this._onDragOver(t),function _globalDragOver(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function toArray(){for(var t,e=[],a=this.el.children,n=0,i=a.length,o=this.options;n<i;n++)closest(t=a[n],o.draggable,this.el,!1)&&e.push(t.getAttribute(o.dataIdAttr)||_generateId(t));return e},sort:function sort(t,e){var a={},n=this.el;this.toArray().forEach(function(t,e){var i=n.children[e];closest(i,this.options.draggable,n,!1)&&(a[t]=i)},this),e&&this.captureAnimationState(),t.forEach(function(t){a[t]&&(n.removeChild(a[t]),n.appendChild(a[t]))}),e&&this.animateAll()},save:function save(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function closest$1(t,e){return closest(t,e||this.options.draggable,this.el,!1)},option:function option(t,e){var a=this.options;if(void 0===e)return a[t];var n=g.modifyOption(this,t,e);a[t]=void 0!==n?n:e,"group"===t&&et(a)},destroy:function destroy(){f("destroy",this);var t=this.el;t[u]=null,off(t,"mousedown",this._onTapStart),off(t,"touchstart",this._onTapStart),off(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(off(t,"dragover",this),off(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),W.splice(W.indexOf(this.el),1),this.el=t=null},_hideClone:function _hideClone(){if(!E){if(f("hideClone",this),Sortable.eventCanceled)return;css(w,"display","none"),this.options.removeCloneOnHide&&w.parentNode&&w.parentNode.removeChild(w),E=!0}},_showClone:function _showClone(t){if("clone"===t.lastPutMode){if(E){if(f("showClone",this),Sortable.eventCanceled)return;p.parentNode!=y||this.options.group.revertClone?k?y.insertBefore(w,k):y.appendChild(w):y.insertBefore(w,p),this.options.group.revertClone&&this.animate(p,w),css(w,"display",""),E=!1}}else this._hideClone()}},X&&on(document,"touchmove",function(t){(Sortable.active||G)&&t.cancelable&&t.preventDefault()}),Sortable.utils={on,off,css,find,is:function is(t,e){return!!closest(t,e,t,!1)},extend:function extend(t,e){if(t&&e)for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t},throttle,closest,toggleClass,clone,index,nextTick:_nextTick,cancelNextTick:_cancelNextTick,detectDirection:tt,getChild},Sortable.get=function(t){return t[u]},Sortable.mount=function(){for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];e[0].constructor===Array&&(e=e[0]),e.forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Sortable.utils=_objectSpread2(_objectSpread2({},Sortable.utils),t.utils)),g.mount(t)})},Sortable.create=function(t,e){return new Sortable(t,e)},Sortable.version="1.15.0";var rt,st,ct,lt=[];function clearAutoScrolls(){lt.forEach(function(t){clearInterval(t.pid)}),lt=[]}throttle(function(t,e,a,n){if(e.scroll){var i,o=(t.touches?t.touches[0]:t).clientX,r=(t.touches?t.touches[0]:t).clientY,s=e.scrollSensitivity,c=e.scrollSpeed,l=getWindowScrollingElement(),d=!1;st!==a&&(st=a,clearAutoScrolls(),rt=e.scroll,i=e.scrollFn,!0===rt&&(rt=getParentAutoScrollElement(a,!0)));var m=0,g=rt;do{var h=g,f=getRect(h),p=f.top,b=f.bottom,v=f.left,y=f.right,k=f.width,S=f.height,w=void 0,E=void 0,C=h.scrollWidth,D=h.scrollHeight,_=css(h),T=h.scrollLeft,I=h.scrollTop;h===l?(w=k<C&&("auto"===_.overflowX||"scroll"===_.overflowX||"visible"===_.overflowX),E=S<D&&("auto"===_.overflowY||"scroll"===_.overflowY||"visible"===_.overflowY)):(w=k<C&&("auto"===_.overflowX||"scroll"===_.overflowX),E=S<D&&("auto"===_.overflowY||"scroll"===_.overflowY));var P=w&&(Math.abs(y-o)<=s&&T+k<C)-(Math.abs(v-o)<=s&&!!T),A=E&&(Math.abs(b-r)<=s&&I+S<D)-(Math.abs(p-r)<=s&&!!I);if(!lt[m])for(var O=0;O<=m;O++)lt[O]||(lt[O]={});lt[m].vx==P&&lt[m].vy==A&&lt[m].el===h||(lt[m].el=h,lt[m].vx=P,lt[m].vy=A,clearInterval(lt[m].pid),0==P&&0==A||(d=!0,lt[m].pid=setInterval(function(){n&&0===this.layer&&Sortable.active._onTouchMove(ct);var e=lt[this.layer].vy?lt[this.layer].vy*c:0,a=lt[this.layer].vx?lt[this.layer].vx*c:0;"function"==typeof i&&"continue"!==i.call(Sortable.dragged.parentNode[u],a,e,t,ct,lt[this.layer].el)||scrollBy(lt[this.layer].el,a,e)}.bind({layer:m}),24))),m++}while(e.bubbleScroll&&g!==l&&(g=getParentAutoScrollElement(g,!1)));0}},30);var ut=function drop(t){var e=t.originalEvent,a=t.putSortable,n=t.dragEl,i=t.activeSortable,o=t.dispatchSortableEvent,r=t.hideGhostForTarget,s=t.unhideGhostForTarget;if(e){var c=a||i;r();var l=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(l.clientX,l.clientY);s(),c&&!c.el.contains(u)&&(o("spill"),this.onSpill({dragEl:n,putSortable:a}))}};function Revert(){}function Remove(){}Revert.prototype={startIndex:null,dragStart:function dragStart(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function onSpill(t){var e=t.dragEl,a=t.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var n=getChild(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),a&&a.animateAll()},drop:ut},_extends(Revert,{pluginName:"revertOnSpill"}),Remove.prototype={onSpill:function onSpill(t){var e=t.dragEl,a=t.putSortable||this.sortable;a.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),a.animateAll()},drop:ut},_extends(Remove,{pluginName:"removeOnSpill"});const dt=Sortable;class HandlebarsApplication extends(foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2)){constructor(){super(),this.constructor.registerPositionSetting(),this.savePosition=foundry.utils.debounce(this.savePosition.bind(this),100)}static registerPositionSetting(){!this.POSITION_SETTING_REGISTERED&&this.DEFAULT_OPTIONS.window?.savePosition&&(this.POSITION_SETTING_REGISTERED=!0,game.settings.register(gt,this.APP_ID+"-position",{scope:"client",config:!1,type:Object,default:{}}))}static resetSavedPosition(){game.settings.set(gt,this.APP_ID+"-position",{})}savePosition(t){const e={left:t.left,top:t.top,width:t.width,height:t.height};"auto"===this.constructor.DEFAULT_OPTIONS.position.width&&delete e.width,"auto"===this.constructor.DEFAULT_OPTIONS.position.height&&delete e.height,game.settings.set(gt,this.APP_ID+"-position",e)}setPosition(...t){"auto"===this.constructor.DEFAULT_OPTIONS.position.width&&delete t.width,"auto"===this.constructor.DEFAULT_OPTIONS.position.height&&delete t.height;const e=super.setPosition(...t);return this.constructor.POSITION_SETTING_REGISTERED&&this.savePosition(this.position),e}static get APP_ID(){return this.name.split(/(?=[A-Z])/).join("-").toLowerCase()}get APP_ID(){return this.constructor.APP_ID}static get PARTS(){return{content:{template:`modules/${gt}/templates/${this.APP_ID}.hbs`,classes:[],scrollable:[]}}}static get DEFAULT_OPTIONS(){return{tag:"div",id:this.APP_ID,window:{title:`${gt}.${this.APP_ID}.title`,frame:!0,positioned:!0,icon:"",controls:[],minimizable:!0,resizable:!1,contentTag:"section",contentClasses:[],savePosition:!1,preventEscapeClose:!1},actions:{},form:{handler:void 0,submitOnChange:!1,closeOnSubmit:!1},position:{width:560,height:"auto"}}}async _prepareContext(t){if(this.getData)return this.getData();return{data:{}}}activateListeners(){}_onRender(t,e){super._onRender(t,e),this.constructor.DEFAULT_OPTIONS.window.preventEscapeClose&&(foundry.applications.instances.delete(this.id,this),this.window.close.style.display="none");const a=this.element;this.activateListeners&&this.activateListeners(a)}async render(t={},e={}){const a="boolean"==typeof t?e:t;return!a.position&&this.constructor.POSITION_SETTING_REGISTERED&&(a.position=game.settings.get(gt,this.APP_ID+"-position")),super.render(t,e)}}function mergeClone(t,e){return t=foundry.utils.deepClone(t),e=foundry.utils.deepClone(e),foundry.utils.mergeObject(t,e)}class AttributesConfig extends HandlebarsApplication{constructor(){super()}static get DEFAULT_OPTIONS(){return mergeClone(super.DEFAULT_OPTIONS,{tag:"form",id:"combat-dock-attributes-config",window:{title:`${gt}.settings.attributesMenu.name`,contentClasses:["standard-form"]},actions:{onAdd:this.onAdd,onReset:this.onReset},form:{handler:this.#t,closeOnSubmit:!0}})}static get PARTS(){return{content:{template:"modules/combat-tracker-dock/templates/attributes-config.hbs",classes:["standard-form","scrollable"]},footer:{template:"templates/generic/form-footer.hbs"}}}_prepareContext(t){const e=TokenDocument.implementation.getTrackedAttributes();e.bar.forEach(t=>t.push("value"));const a=TokenDocument.implementation.getTrackedAttributeChoices(e);return{attributes:game.settings.get(gt,"attributes"),attributeChoices:a,buttons:[{type:"submit",action:"submit",icon:"fas fa-save",label:"combat-tracker-dock.settings.attributesMenu.form.save"},{type:"button",action:"onReset",icon:"fas fa-undo",label:"combat-tracker-dock.settings.attributesMenu.form.reset"},{type:"button",action:"onAdd",icon:"fas fa-plus",label:"combat-tracker-dock.settings.attributesMenu.form.add"}]}}_onRender(t,e){super._onRender(t,e);const a=this.element;a.querySelectorAll(".attributePicker").forEach(t=>{t.addEventListener("change",t=>{const e=t.target.value;t.target.closest(".form-group").querySelector(".attr").value=e})}),dt.create(a.querySelector("ul"),{animation:200,filter:"input",preventOnFilter:!1})}static async onAdd(t){t.preventDefault(),await this._saveData();const e=game.settings.get(gt,"attributes");e.push({attr:"",icon:"",units:""}),await game.settings.set(gt,"attributes",e),this.render({force:!0})}static async onReset(t){t.preventDefault();if(await foundry.applications.api.DialogV2.confirm({window:{title:`${gt}.settings.attributesMenu.reset`},content:game.i18n.localize(`${gt}.settings.attributesMenu.resetWarning`)})){const t=game.settings.settings.get("combat-tracker-dock.attributes").default;await game.settings.set(gt,"attributes",t),this.render({force:!0})}}async _saveData(){let t=this._getSubmitData();t=t.filter(t=>""!==t.attr),await game.settings.set(gt,"attributes",t)}static async#t(t){t.preventDefault(),await this._saveData(),this.close()}_getSubmitData(){let t=[];const e=this.element.querySelectorAll("li");for(let a=0;a<e.length;a++){const n=e[a].querySelector(".attr").value,i=e[a].querySelector(".icon").value,o=e[a].querySelector(".units").value;t.push({attr:n,icon:i,units:o})}return t}}function defaultAttributesConfig(){return{dnd5e:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.ac.value",icon:"fas fa-shield",units:"AC"},{attr:"attributes.movement.walk",icon:"fas fa-person-running-fast",units:"ft."},{attr:"attributes.spell.dc",icon:"fas fa-hand-holding-magic",units:"Spell DC"},{attr:"resources.legact.value",icon:"far fa-bolt-lightning",units:""},{attr:"resources.legres.value",icon:"fas fa-shield-cross",units:""},{attr:"resources.lair.value",icon:"fa-solid fa-dungeon",units:""}],dnd4e:[{attr:"defences.ac.value",icon:"fas fa-shield",units:game.i18n.localize("DND4E.DefAC")},{attr:"defences.fort.value",icon:"fas fa-heart-pulse",units:game.i18n.localize("DND4E.DefFort")},{attr:"defences.ref.value",icon:"fas fa-rabbit-running",units:game.i18n.localize("DND4E.DefRef")},{attr:"defences.wil.value",icon:"fas fa-brain",units:game.i18n.localize("DND4E.DefWil")},{attr:"attributes.init.value",icon:"fas fa-traffic-light-go",units:game.i18n.localize("DND4E.Init")},{attr:"movement.walk.value",icon:"fas fa-person-running",units:game.i18n.localize("DND4E.Speed")},{attr:"attributes.hp.max",icon:"fas fa-heart",units:game.i18n.localize("DND4E.HPShort")},{attr:"details.bloodied",icon:"fas fa-heart-half-stroke",units:null}],"cyberpunk-red-core":[{attr:"derivedStats.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"derivedStats.walk.value",icon:"fas fa-person-running",units:"m/ft"},{attr:"derivedStats.run.value",icon:"fas fa-person-running-fast",units:"m/ft"},{attr:"externalData.currentArmorHead.value",icon:"fas fa-helmet-safety",units:"SP"},{attr:"externalData.currentArmorBody.value",icon:"fas fa-shirt-tank-top",units:"SP"}],swade:[{attr:"wounds.value",icon:"fas fa-heart",units:game.i18n.localize("SWADE.Wounds")},{attr:"fatigue.value",icon:"fas fa-face-hand-yawn",units:game.i18n.localize("SWADE.Fatigue")},{attr:"bennies.value",icon:"fas fa-bullseye",units:game.i18n.localize("SWADE.Bennies")},{attr:"stats.speed.value",icon:"fas fa-person-running",units:game.i18n.localize("SWADE.Pace")},{attr:"stats.parry.value",icon:"fas fa-swords",units:game.i18n.localize("SWADE.Parry")},{attr:"stats.toughness.value",icon:"fas fa-shield",units:game.i18n.localize("SWADE.Tough")},{attr:"stats.toughness.armor",icon:"fas fa-helmet-battle",units:game.i18n.localize("SWADE.Armor")}],pirateborg:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.luck.value",icon:"fas fa-clover",units:"Devil's Luck"},{attr:"attributes.rituals.value",icon:"fas fa-ankh",units:"Rituals"}],cyphersystem:[{attr:"pools.might.value",icon:"fas fa-hand-fist",units:"Might"},{attr:"pools.speed.value",icon:"fas fa-person-running",units:"Speed"},{attr:"pools.intellect.value",icon:"fas fa-brain",units:"Intellect"},{attr:"combat.damageTrack.state",icon:"fas fa-heart",units:""},{attr:"pools.health.value",icon:"fas fa-heart",units:"Health"},{attr:"combat.armor",icon:"fas fa-shield",units:"Armor"},{attr:"combat.damage",icon:"fas fa-axe-battle",units:"Damage"}],pf2e:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.ac.value",icon:"fas fa-shield",units:"AC"},{attr:"attributes.speed.value",icon:"systems/pf2e/icons/default-icons/action.svg",units:"ft."},{attr:"attributes.spellDC.value",icon:"fas fa-hand-holding-magic",units:"Spell DC"},{attr:"attributes.shield.hp.value",icon:"fas fa-shield",units:"Shield HP"}],pf1:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.ac.normal.total",icon:"fas fa-shield",units:"AC"},{attr:"attributes.ac.touch.total",icon:"fas fa-shield-slash",units:"Touch AC"},{attr:"attributes.ac.flatFooted.total",icon:"fas fa-circle-exclamation",units:"Flat Footed AC"},{attr:"attributes.cmd.total",icon:"fas fa-hand-fist",units:"CMD"},{attr:"attributes.cmd.flatFootedTotal",icon:"fas fa-person-circle-exclamation",units:"Flat Footed CMD"},{attr:"attributes.sr.total",icon:"fas fa-hand-holding-magic",units:"Spell Resistance"},{attr:"attributes.speed.land.total",icon:"fas fa-person-running",units:"ft."}],crucible:[{attr:"resources.health.value",icon:"fa-solid fa-heart",units:""},{attr:"resources.morale.value",icon:"fa-solid fa-brain",units:""},{attr:"resources.action.value",icon:"fa-solid fa-hand-fist",units:""},{attr:"resources.focus.value",icon:"fa-solid fa-hand-holding-magic",units:""},{attr:"resources.wounds.value",icon:"fa-solid fa-droplet",units:""},{attr:"resources.madness.value",icon:"fa-solid fa-head-side-brain",units:""}],wfrp4e:[{attr:"status.wounds.value",icon:"fa-thin fa-heart",units:game.i18n.localize("Wounds")},{attr:"status.advantage.value",icon:"fa-thin fa-swords",units:game.i18n.localize("Advantage")},{attr:"status.fortune.value",icon:"fa-thin fa-clover",units:game.i18n.localize("Fortune")},{attr:"status.resolve.value",icon:"fa-thin fa-face-pouting",units:game.i18n.localize("Resolve")},{attr:"details.move.run",icon:"fa-thin fa-person-running",units:game.i18n.localize("yds")}],alienrpg:[{attr:"header.health.value",icon:"fas fa-heart",units:game.i18n.localize("ALIENRPG.Health")},{attr:"header.stress.value",icon:"fas fa-face-scream",units:game.i18n.localize("ALIENRPG.Stress")},{attr:"general.armor.value",icon:"fas fa-shield",units:game.i18n.localize("ALIENRPG.Armor")},{attr:"attributes.speed.value",icon:"fas fa-person-running",units:game.i18n.localize("ALIENRPG.Speed")},{attr:"general.mobility.value",icon:"fas fa-user-ninja",units:game.i18n.localize("ALIENRPG.Skillmobility")},{attr:"general.observation.value",icon:"fas fa-eye",units:game.i18n.localize("ALIENRPG.Skillobservation")},{attr:"attributes.armorrating.value",icon:"fas fa-shield",units:game.i18n.localize("ALIENRPG.ArmorRating")},{attr:"attributes.hull.value",icon:"fas fa-shuttle-space",units:game.i18n.localize("ALIENRPG.HULL")},{attr:"attributes.armor.value",icon:"fas fa-shield",units:game.i18n.localize("ALIENRPG.SHIP-ARMOR")},{attr:"attributes.thrusters.value",icon:"fas fa-rocket-launch",units:game.i18n.localize("ALIENRPG.THRUSTERS")},{attr:"attributes.signature.value",icon:"fas fa-satellite-dish",units:game.i18n.localize("ALIENRPG.SIGNATURE")}],exaltedthird:[{attr:"health.value",icon:"fas fa-heart",units:game.i18n.localize("Ex3.Health")},{attr:"evasion.value",icon:"fas fa-rabbit-running",units:game.i18n.localize("Ex3.Evasion")},{attr:"parry.value",icon:"fas fa-swords",units:game.i18n.localize("Ex3.Parry")},{attr:"soak.value",icon:"fas fa-shield",units:game.i18n.localize("Ex3.Soak")},{attr:"hardness.value",icon:"fas fa-heart",units:game.i18n.localize("Ex3.Hardness")},{attr:"willpower.value",icon:"fas fa-hand-fist",units:game.i18n.localize("Ex3.Willpower")},{attr:"anima.value",icon:"fas fa-sun",units:game.i18n.localize("Ex3.Anima")}],exaltedessence:[{attr:"health.value",icon:"fas fa-heart",units:game.i18n.localize("ExEss.Health")},{attr:"evasion.value",icon:"fas fa-rabbit-running",units:game.i18n.localize("ExEss.Evasion")},{attr:"parry.value",icon:"fas fa-swords",units:game.i18n.localize("ExEss.Parry")},{attr:"soak.value",icon:"fas fa-shield",units:game.i18n.localize("ExEss.Soak")},{attr:"hardness.value",icon:"fas fa-heart",units:game.i18n.localize("ExEss.Hardness")},{attr:"power.value",icon:"fas fa-hand-fist",units:game.i18n.localize("ExEss.Power")},{attr:"will.value",icon:"fas fa-hand-sparkles",units:game.i18n.localize("ExEss.Will")},{attr:"anima.value",icon:"fas fa-sun",units:game.i18n.localize("ExEss.Anima")}],swnr:[{attr:"health.value",icon:"fas fa-heart",units:game.i18n.localize("swnr.sheet.hp")},{attr:"ac",icon:"fas fa-shield",units:game.i18n.localize("swnr.sheet.ac")},{attr:"speed",icon:"fas fa-person-running-fast",units:"m"},{attr:"save.physical",icon:"fas fa-hand-fist",units:game.i18n.localize("swnr.sheet.vs")},{attr:"save.evasion",icon:"fas fa-feather-pointed",units:game.i18n.localize("swnr.sheet.vs")},{attr:"save.mental",icon:"fas fa-brain",units:game.i18n.localize("swnr.sheet.vs")}],wwn:[{attr:"hp.value",icon:"fas fa-heart",units:"Hit Points"},{attr:"details.strain.value",icon:"fas fa-ankh",units:"System Strain"},{attr:"aac.value",icon:"fas fa-shield",units:"Armor Class"},{attr:"movement.base",icon:"fas fa-person-running",units:"ft. Movement"},{attr:"saves.evasion.value",icon:"fas fa-bullseye",units:"Evasion Save"},{attr:"saves.mental.value",icon:"fas fa-brain",units:"Mental Save"},{attr:"saves.physical.value",icon:"fas fa-hand-fist",units:"Physical Save"},{attr:"saves.luck.value",icon:"fas fa-star",units:"Luck Save"}],ars:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"Hit Points"},{attr:"attributes.ac.value",icon:"fas fa-shield",units:"Armor Class"},{attr:"attributes.movement.value",icon:"fas fa-person-running",units:"Movement"},{attr:"attributes.thaco.value",icon:"fas fa-swords",units:"THAC0"}],lancer:[{attr:"hp.value",icon:"mdi mdi-heart-outline",units:""},{attr:"structure.value",icon:"cci cci-structure",units:""},{attr:"heat.value",icon:"cci cci-heat",units:""},{attr:"stress.value",icon:"cci cci-reactor",units:""}],dc20rpg:[{attr:"resources.health.value",icon:"fas fa-heart",units:"HP"},{attr:"resources.mana.value",icon:"fas fa-star",units:"MP"},{attr:"resources.stamina.value",icon:"fas fa-hand-fist",units:"SP"},{attr:"defences.physical.value",icon:"fas fa-shield",units:"PD"},{attr:"defences.mystical.value",icon:"fas fa-wand-magic-sparkles",units:"MD"},{attr:"movement.ground.value",icon:"fas fa-person-walking",units:"Spaces"}],shadowdark:[{attr:"attributes.ac.value",icon:"fas fa-shield",units:"AC"},{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"}]}}function generateDescription(t){const{type:e,system:a}=t;switch(game.system.id){case"dnd5e":const n="character"===e;if("npc"===e){const e=game.i18n.localize(CONFIG.DND5E.creatureTypes[t.system.details.type.value]?.label??t.system.details.type.custom);return`CR ${a.details.cr>=1||a.details.cr<=0?a.details.cr:"1/"+1/a.details.cr} ${e}`}if(n){const e=Object.values(t.classes).map(t=>t.name).join(" / ");return`Level ${a.details.level} ${e} (${a.details.race})`}return null;case"dnd4e":switch(e){case"Player Character":return`${game.i18n.localize("DND4E.Level")} ${a.details.level} ${a.details.race} ${a.details.class} (${a.details.alignment})`;case"NPC":return`${CONFIG.DND4E.actorSizes[t.system.details.size]?.label} ${CONFIG.DND4E.creatureOrigin[t.system.details.origin]?.label} ${CONFIG.DND4E.creatureType[t.system.details.type]?.label}`;default:return null}case"swade":if(a?.wildcard)return`${game.i18n.localize("SWADE.WildCard")}`;switch(e){case"character":case"npc":return`${game.i18n.localize("SWADE.Extra")}`;case"vehicle":return game.i18n.localize("TYPES.Actor.vehicle");default:return null}case"pirateborg":switch(e){case"character":const e=[t.characterClass?.name||"Character"];return t.characterBaseClass?.name&&e.push(t.characterBaseClass.name),e.join(" - ");case"creature":return"Creature";case"vehicle":case"vehicle_npc":return"Ship";default:return null}case"cyphersystem":switch(e){case"pc":return"Character";case"npc":return"Creature";case"companion":return"Companion";case"community":return"Community";case"vehicle":return"Vehicle";case"marker":return"Marker";default:return null}case"pf2e":return"character"===e?`Level ${a.details.level.value} ${a.details.class.name} (${a.details.ancestry.name})`:null;case"crucible":if("hero"===t.type)return`${a.details.ancestry.name} ${a.details.background.name} ${a.details.signatureName?`(${a.details.signatureName})`:""}`;if("adversary"===t.type)return`${a.details.taxonomy.name} ${a.details.archetype.name} (${game.i18n.localize("ADVANCEMENT.Level")} ${a.details.level} ${game.i18n.localize("ADVERSARY.Threat"+a.details.threat.charAt(0).toUpperCase()+a.details.threat.slice(1))})`;case"wfrp4e":switch(e){case"character":return`${t.Species} ${t.currentCareer.name}`;case"npc":const e=t.itemTypes.career.length-1;if(e<0)return`${t.Species}`;{const a=Object.values(t.itemTypes.career).map(t=>t.name)[e];return`${t.Species} ${a}`}case"creature":return`${t.Species}`;default:return null}case"alienrpg":switch(e){case"character":let e;if(1==a.general.career.value?e=game.i18n.localize("ALIENRPG.ColonialMarine"):2==a.general.career.value?e=game.i18n.localize("ALIENRPG.ColonialMarshal"):3==a.general.career.value?e=game.i18n.localize("ALIENRPG.CompanyAgent"):4==a.general.career.value?e=game.i18n.localize("ALIENRPG.Kid"):5==a.general.career.value?e=game.i18n.localize("ALIENRPG.Medic"):6==a.general.career.value?e=game.i18n.localize("ALIENRPG.Mercenary"):7==a.general.career.value?e=game.i18n.localize("ALIENRPG.Officer"):8==a.general.career.value?e=game.i18n.localize("ALIENRPG.Pilot"):9==a.general.career.value?e=game.i18n.localize("ALIENRPG.Roughneck"):10==a.general.career.value?e=game.i18n.localize("ALIENRPG.Scientist"):11==a.general.career.value?e=game.i18n.localize("ALIENRPG.Synthetic"):12==a.general.career.value&&(e=game.i18n.localize("ALIENRPG.Homebrew")),0==t.itemTypes.specialty.length)return`${e}`;if(1==t.itemTypes.specialty.length){return`${e}: ${Object.values(t.itemTypes.specialty).map(t=>t.name)[0]}`}case"synthetic":let n;if(1==a.general.career.value?n=game.i18n.localize("ALIENRPG.ColonialMarine"):2==a.general.career.value?n=game.i18n.localize("ALIENRPG.ColonialMarshal"):3==a.general.career.value?n=game.i18n.localize("ALIENRPG.CompanyAgent"):4==a.general.career.value?n=game.i18n.localize("ALIENRPG.Kid"):5==a.general.career.value?n=game.i18n.localize("ALIENRPG.Medic"):6==a.general.career.value?n=game.i18n.localize("ALIENRPG.Mercenary"):7==a.general.career.value?n=game.i18n.localize("ALIENRPG.Officer"):8==a.general.career.value?n=game.i18n.localize("ALIENRPG.Pilot"):9==a.general.career.value?n=game.i18n.localize("ALIENRPG.Roughneck"):10==a.general.career.value?n=game.i18n.localize("ALIENRPG.Scientist"):11==a.general.career.value?n=game.i18n.localize("ALIENRPG.Synthetic"):12==a.general.career.value&&(n=game.i18n.localize("ALIENRPG.Homebrew")),0==t.itemTypes.specialty.length)return`${n}`;if(1==t.itemTypes.specialty.length){return`${n}: ${Object.values(t.itemTypes.specialty).map(t=>t.name)[0]}`}case"spacecraft":return`${game.i18n.localize("ALIENRPG.MODEL")}: ${a.attributes.model}`;default:return null}case"exaltedthird":switch(e){case"character":case"npc":return`${game.i18n.localize("Ex3.Essence")} ${a.essence.value}`;default:return null}case"exaltedessence":switch(e){case"character":case"npc":return`${game.i18n.localize("ExEss.Essence")} ${a.essence.value}`;default:return null}case"swnr":switch(e){case"character":return`${game.i18n.localize("swnr.sheet.level")} ${a.level.value} ${a.background} ${a.class}`;case"npc":return"NPC";case"vehicle":return"Vehicle";case"ship":return"Ship";case"drone":return"Drone";case"mech":return"Mech";default:return null}case"wwn":switch(e){case"Character":return`Level ${a.details.level} ${a.details.background} ${a.details.class}`;case"Faction":return"Faction";case"Monster":return`${a.hp.hd} hit dice Monster`;default:return null}case"ars":switch(e){case"character":return"Player Character";case"lootable":return"Loot";case"merchant":return"Merchant";case"npc":return"Non-Player-Character";default:return null}case"lancer":return game.lancer.combatTrackerDock?.generateDescription(t);case"shadowdark":switch(e){case"Player":case"NPC":return`Level: ${a.level.value}`;default:return null}}}function getSystemIcons(t){switch(game.system.id){case"dnd5e":if(game.modules.get("midi-qol")?.active&&t.actor){const getMidiFlag=e=>(t.actor.getFlag("midi-qol","actions")??{})[e]??!1,toggleMidiFlag=e=>{const a=t.actor.getFlag("midi-qol","actions")??{};a[e]=!a[e],t.actor.setFlag("midi-qol","actions",a)};return[{icon:"fas fa-circle",color:getMidiFlag("action")?"#888888":"green",enabled:!0,callback:t.isOwner?()=>toggleMidiFlag("action"):null},{icon:"fas fa-triangle",color:getMidiFlag("bonus")?"#888888":"#ff9f4c",enabled:!0,callback:t.isOwner?()=>toggleMidiFlag("bonus"):null},{icon:"fas fa-sparkle",color:getMidiFlag("reaction")?"#888888":"#e16de1",enabled:!0,callback:t.isOwner?()=>toggleMidiFlag("reaction"):null}]}return[{icon:"fas fa-circle",color:t.getFlag(gt,"action")??1?"green":"#888888",enabled:!0,callback:t.isOwner?(t,e,a,n)=>{e.setFlag(gt,"action",!(e.getFlag(gt,"action")??1))}:null},{icon:"fas fa-triangle",color:t.getFlag(gt,"bonus")??1?"#ff9f4c":"#888888",enabled:!0,callback:t.isOwner?(t,e,a,n)=>{e.setFlag(gt,"bonus",!(e.getFlag(gt,"bonus")??1))}:null},{icon:"fas fa-sparkle",color:t.getFlag(gt,"reaction")??1?"#e16de1":"#888888",enabled:!0,callback:t.isOwner?(t,e,a,n)=>{e.setFlag(gt,"reaction",!(e.getFlag(gt,"reaction")??1))}:null}];case"crucible":{const e=t.actor?.system,a=function getSystemSetting(t){return game.settings.get(gt,game.system.id+"."+t)}("alwaysShowActions")||void 0,n={value:e.resources.action.value,max:e.resources.action.max},i={value:e.resources.focus.value,max:e.resources.focus.max},o=[];for(let t=0;t<n.max;t++)o.push({icon:"fas fa-square",color:"#ff6400",enabled:n.value>0,visible:a}),n.value--;for(let t=0;t<i.max;t++)o.push({icon:"fas fa-sparkle",color:"#00bbff",enabled:i.value>0}),i.value--;return o}case"alienrpg":if(game.modules.get("alien-actions")?.active&&t.actor&&"spacecraft"!==t.actor.type)return[{icon:"fas fa-play",fontSize:"1rem",enabled:!0,callback:t.isOwner?(t,e)=>{e.actor.getActiveTokens().forEach(t=>t.toggleEffect(CONFIG.statusEffects.find(t=>"slowAction"===t.id)))}:null},{icon:"fas fa-forward",fontSize:"1rem",enabled:!0,callback:t.isOwner?(t,e)=>{e.actor.getActiveTokens().forEach(t=>t.toggleEffect(CONFIG.statusEffects.find(t=>"fastAction"===t.id)))}:null}];case"lancer":return game.lancer.combatTrackerDock?.getSystemIcons(t)??[];default:return[]}}function registerSystemSettings(){if("crucible"===game.system.id)!function registerSystemSetting(t,e){const a=gt+".settings.systems."+game.system.id;game.settings.register(gt,game.system.id+"."+t,{...e,name:game.system.title+" "+settings_l(gt+".settings.integration")+": "+settings_l(a+"."+t+".name"),hint:settings_l(a+"."+t+".hint")})}("alwaysShowActions",{scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.combatDock?.refresh()})}function registerSettings(){game.settings.register(gt,"attributes",{scope:"world",config:!1,type:Array,default:CONFIG.combatTrackerDock.defaultAttributesConfig()[game.system.id]??[],onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"events",{scope:"world",config:!1,type:Array,default:[]}),game.settings.registerMenu(gt,"attributesMenu",{name:game.i18n.localize(`${gt}.settings.attributesMenu.name`),label:game.i18n.localize(`${gt}.settings.attributesMenu.label`),hint:game.i18n.localize(`${gt}.settings.attributesMenu.hint`),icon:"fas fa-cogs",scope:"world",restricted:!0,type:AttributesConfig}),game.settings.register(gt,"direction",{name:"combat-tracker-dock.settings.direction.name",hint:"combat-tracker-dock.settings.direction.hint",scope:"world",config:!0,type:String,choices:{rowDocked:"combat-tracker-dock.settings.direction.choices.rowDocked",rowFloat:"combat-tracker-dock.settings.direction.choices.rowFloat",columnFloat:"combat-tracker-dock.settings.direction.choices.columnFloat"},default:"rowDocked",onChange:async()=>{await(ui.combatDock?.restart()),setDirection(),setOverflowStyle(),setFlex(),ui.combatDock?.autosize(),ui.combatDock?.refresh()}}),game.settings.register(gt,"portraitSize",{name:"combat-tracker-dock.settings.portraitSize.name",hint:"combat-tracker-dock.settings.portraitSize.hint",scope:"client",config:!0,type:String,choices:{"30px":"combat-tracker-dock.settings.portraitSize.choices.30px","50px":"combat-tracker-dock.settings.portraitSize.choices.50px","70px":"combat-tracker-dock.settings.portraitSize.choices.70px","90px":"combat-tracker-dock.settings.portraitSize.choices.90px","110px":"combat-tracker-dock.settings.portraitSize.choices.110px","150px":"combat-tracker-dock.settings.portraitSize.choices.150px","180px":"combat-tracker-dock.settings.portraitSize.choices.180px"},default:"70px",onChange:()=>{!function setPortraitSize(){const t=game.settings.get(gt,"portraitSize");document.documentElement.style.setProperty("--combatant-portrait-size",t)}(),ui.combatDock?.autosize(),ui.combatDock?.refresh()}}),game.settings.register(gt,"lessButtons",{name:"combat-tracker-dock.settings.lessButtons.name",hint:"combat-tracker-dock.settings.lessButtons.hint",scope:"client",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.render()}),game.settings.register(gt,"overflowStyle",{name:"combat-tracker-dock.settings.overflowStyle.name",hint:"combat-tracker-dock.settings.overflowStyle.hint",scope:"client",config:!0,type:String,choices:{autofit:"combat-tracker-dock.settings.overflowStyle.choices.autofit",hidden:"combat-tracker-dock.settings.overflowStyle.choices.hidden",scroll:"combat-tracker-dock.settings.overflowStyle.choices.scroll"},default:"autofit",onChange:()=>{setOverflowStyle(),ui.combatDock?.autosize(),ui.combatDock?.refresh(),ui.combatDock?.render()}}),game.settings.register(gt,"carouselStyle",{name:"combat-tracker-dock.settings.carouselStyle.name",hint:"combat-tracker-dock.settings.carouselStyle.hint",scope:"world",config:!0,type:Number,choices:{0:"combat-tracker-dock.settings.carouselStyle.choices.centerCarousel",1:"combat-tracker-dock.settings.carouselStyle.choices.leftCarousel",2:"combat-tracker-dock.settings.carouselStyle.choices.basic"},default:0,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"alignment",{name:"combat-tracker-dock.settings.alignment.name",hint:"combat-tracker-dock.settings.alignment.hint",scope:"world",config:!0,type:String,choices:{left:"combat-tracker-dock.settings.alignment.choices.left",center:"combat-tracker-dock.settings.alignment.choices.center",right:"combat-tracker-dock.settings.alignment.choices.right"},default:"center",onChange:()=>{setAlignment(),setFlex(),ui.combatDock?.refresh()}}),game.settings.register(gt,"floatingSize",{name:"combat-tracker-dock.settings.floatingSize.name",hint:"combat-tracker-dock.settings.floatingSize.hint",scope:"world",config:!0,type:Number,default:60,range:{min:30,max:100,step:1},onChange:()=>{setFloatingSize(),ui.combatDock?.refresh()}}),game.settings.register(gt,"portraitAspect",{name:"combat-tracker-dock.settings.portraitAspect.name",hint:"combat-tracker-dock.settings.portraitAspect.hint",scope:"world",config:!0,type:Number,choices:{1:"combat-tracker-dock.settings.portraitAspect.choices.square",1.5:"combat-tracker-dock.settings.portraitAspect.choices.portrait",2:"combat-tracker-dock.settings.portraitAspect.choices.long"},default:1.5,onChange:()=>{setPortraitAspect(),ui.combatDock?.refresh()}}),game.settings.register(gt,"roundness",{name:"combat-tracker-dock.settings.roundness.name",hint:"combat-tracker-dock.settings.roundness.hint",scope:"world",config:!0,type:String,choices:{"0%":"combat-tracker-dock.settings.roundness.choices.sharp","10%":"combat-tracker-dock.settings.roundness.choices.soft","20%":"combat-tracker-dock.settings.roundness.choices.round"},default:"0%",onChange:()=>{setRoundness(),ui.combatDock?.refresh()}}),game.settings.register(gt,"attributeColor",{name:"combat-tracker-dock.settings.attributeColor.name",hint:"combat-tracker-dock.settings.attributeColor.hint",scope:"world",config:!0,type:new foundry.data.fields.ColorField,default:"#41AA7D",onChange:()=>{setAttributeColor(),ui.combatDock?.refresh()}}),game.settings.register(gt,"attributeColor2",{name:"combat-tracker-dock.settings.attributeColor2.name",hint:"combat-tracker-dock.settings.attributeColor2.hint",scope:"world",config:!0,type:new foundry.data.fields.ColorField,default:"#ffcd00",onChange:()=>{setAttributeColor(),ui.combatDock?.refresh()}}),game.settings.register(gt,"attributeColorPortrait",{name:"combat-tracker-dock.settings.attributeColorPortrait.name",hint:"combat-tracker-dock.settings.attributeColorPortrait.hint",scope:"world",config:!0,type:new foundry.data.fields.ColorField,default:"#e62121",onChange:()=>{setAttributeColor(),ui.combatDock?.refresh()}}),game.settings.register(gt,"barsPlacement",{name:"combat-tracker-dock.settings.barsPlacement.name",hint:"combat-tracker-dock.settings.barsPlacement.hint",scope:"world",config:!0,type:String,choices:{left:"combat-tracker-dock.settings.barsPlacement.choices.left",right:"combat-tracker-dock.settings.barsPlacement.choices.right",twinned:"combat-tracker-dock.settings.barsPlacement.choices.twinned"},default:"left",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"attributeVisibility",{name:"combat-tracker-dock.settings.attributeVisibility.name",hint:"combat-tracker-dock.settings.attributeVisibility.hint",scope:"world",config:!0,type:String,choices:{text:"combat-tracker-dock.settings.attributeVisibility.choices.text",bars:"combat-tracker-dock.settings.attributeVisibility.choices.bars",both:"combat-tracker-dock.settings.attributeVisibility.choices.both"},default:"both",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"displayDescriptions",{name:"combat-tracker-dock.settings.displayDescriptions.name",hint:"combat-tracker-dock.settings.displayDescriptions.hint",scope:"world",config:!0,type:String,choices:{none:"combat-tracker-dock.settings.displayDescriptions.choices.none",owner:"combat-tracker-dock.settings.displayDescriptions.choices.owner",all:"combat-tracker-dock.settings.displayDescriptions.choices.all"},default:"owner",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"hideDefeated",{name:"combat-tracker-dock.settings.hideDefeated.name",hint:"combat-tracker-dock.settings.hideDefeated.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"showDispositionColor",{name:"combat-tracker-dock.settings.showDispositionColor.name",hint:"combat-tracker-dock.settings.showDispositionColor.hint",scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"showInitiativeOnPortrait",{name:"combat-tracker-dock.settings.showInitiativeOnPortrait.name",hint:"combat-tracker-dock.settings.showInitiativeOnPortrait.hint",scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"portraitImage",{name:"combat-tracker-dock.settings.portraitImage.name",hint:"combat-tracker-dock.settings.portraitImage.hint",scope:"world",config:!0,type:String,choices:{actor:"combat-tracker-dock.settings.portraitImage.choices.actor",token:"combat-tracker-dock.settings.portraitImage.choices.token"},default:"actor",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"displayName",{name:"combat-tracker-dock.settings.displayName.name",hint:"combat-tracker-dock.settings.displayName.hint",scope:"world",config:!0,type:String,choices:{default:"combat-tracker-dock.settings.displayName.choices.default",token:"combat-tracker-dock.settings.displayName.choices.token",owner:"combat-tracker-dock.settings.displayName.choices.owner"},default:"default",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"playerPlayerPermission",{name:"combat-tracker-dock.settings.playerPlayerPermission.name",hint:"combat-tracker-dock.settings.playerPlayerPermission.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"hideFirstRound",{name:"combat-tracker-dock.settings.hideFirstRound.name",hint:"combat-tracker-dock.settings.hideFirstRound.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"hideEnemyInitiative",{name:"combat-tracker-dock.settings.hideEnemyInitiative.name",hint:"combat-tracker-dock.settings.hideEnemyInitiative.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"portraitImageBorder",{name:"combat-tracker-dock.settings.portraitImageBorder.name",hint:"combat-tracker-dock.settings.portraitImageBorder.hint",scope:"world",config:!0,type:new foundry.data.fields.FilePathField({categories:["IMAGE"]}),default:"modules/combat-tracker-dock/assets/border.png",onChange:function(){setPortraitImageBorder(),ui.combatDock?.refresh()}}),game.settings.register(gt,"portraitImageBackground",{name:"combat-tracker-dock.settings.portraitImageBackground.name",hint:"combat-tracker-dock.settings.portraitImageBackground.hint",scope:"world",config:!0,type:new foundry.data.fields.FilePathField({categories:["IMAGE"]}),default:"ui/denim075.png",onChange:function(){setPortraitImageBackground(),ui.combatDock?.refresh()}}),game.settings.register(gt,"showSystemIcons",{name:"combat-tracker-dock.settings.showSystemIcons.name",hint:"combat-tracker-dock.settings.showSystemIcons.hint",scope:"world",config:!0,type:Number,choices:{0:"combat-tracker-dock.settings.showSystemIcons.choices.none",1:"combat-tracker-dock.settings.showSystemIcons.choices.tooltip",2:"combat-tracker-dock.settings.showSystemIcons.choices.resource",3:"combat-tracker-dock.settings.showSystemIcons.choices.both"},default:1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"hideConflictingUIs",{name:"combat-tracker-dock.settings.hideConflictingUIs.name",hint:"combat-tracker-dock.settings.hideConflictingUIs.hint",scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>setHideConflictingUIs()}),registerSystemSettings(),function setAllSettings(){setDirection(),setOverflowStyle(),setAlignment(),setFlex(),setPortraitAspect(),setRoundness(),setAttributeColor(),setPortraitImageBorder(),setPortraitImageBackground(),setHideConflictingUIs(),setFloatingSize()}(),game.settings.register(gt,"resource",{name:"combat-tracker-dock.settings.resource.name",hint:"combat-tracker-dock.settings.resource.hint",scope:"world",config:!0,type:String,default:"",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(gt,"portraitResource",{name:"combat-tracker-dock.settings.portraitResource.name",hint:"combat-tracker-dock.settings.portraitResource.hint",scope:"world",config:!0,type:String,default:"",onChange:()=>ui.combatDock?.refresh()})}function setFloatingSize(){const t=game.settings.get(gt,"floatingSize");document.documentElement.style.setProperty("--carousel-floating-size",t+"%")}function setPortraitAspect(){const t=game.settings.get(gt,"portraitAspect");document.documentElement.style.setProperty("--combatant-portrait-aspect",t)}function setAlignment(){const t=game.settings.get(gt,"alignment");document.documentElement.style.setProperty("--carousel-alignment",t),ui.combatDock?.setControlsOrder()}function setPortraitImageBorder(){let t=game.settings.get(gt,"portraitImageBorder");document.documentElement.style.setProperty("--combatant-portrait-image-border",`url('${t}')`)}function setPortraitImageBackground(){let t=game.settings.get(gt,"portraitImageBackground");document.documentElement.style.setProperty("--combatant-portrait-image-background",`url('${t}')`)}function setHideConflictingUIs(){const t=game.settings.get(gt,"hideConflictingUIs");document.querySelector("#ui-top")?.classList.toggle("ctd-hide-conflicting-uis",t)}function setRoundness(){const t=game.settings.get(gt,"roundness");document.documentElement.style.setProperty("--combatant-portrait-border-radius",t)}function setAttributeColor(){const t=game.settings.get(gt,"attributeColor")||"#41AA7D";document.documentElement.style.setProperty("--attribute-bar-primary-color",t);const e=Color.from(t).mix(Color.from("#000"),.5);document.documentElement.style.setProperty("--attribute-bar-secondary-color",e.toString());const a=game.settings.get(gt,"attributeColor2")||"#ffcd00";document.documentElement.style.setProperty("--attribute-bar-primary-color2",a);const n=Color.from(a).mix(Color.from("#000"),.5);document.documentElement.style.setProperty("--attribute-bar-secondary-color2",n.toString());const i=game.settings.get(gt,"attributeColorPortrait")||"#e62121";document.documentElement.style.setProperty("--attribute-bar-portrait-color",i)}function setOverflowStyle(){let t=game.settings.get(gt,"overflowStyle");if("autofit"===t&&(t="hidden"),"scroll"===t){t="columnFloat"!==game.settings.get(gt,"direction")?"scroll hidden":"hidden scroll"}document.documentElement.style.setProperty("--carousel-overflow",t)}function setDirection(){let t=game.settings.get(gt,"direction");t in game.settings.settings.get(`${gt}.direction`).choices||(t=t.includes("column")?"columnFloat":"rowDocked",game.settings.set(gt,"direction",t)),document.documentElement.style.setProperty("--carousel-direction","columnFloat"===t?"column":"row"),document.documentElement.style.setProperty("--combatant-portrait-margin","columnFloat"!==t?"0 calc(var(--combatant-portrait-size) * 0.1)":"0"),ui.combatDock?.setControlsOrder()}function setFlex(){const t=game.settings.get(gt,"alignment"),e=game.settings.get(gt,"direction");let a="flex-start";"columnFloat"==e&&"right"==t&&(a="flex-end"),"columnFloat"==e&&"center"==t&&(a="center"),document.documentElement.style.setProperty("--carousel-align-items",a)}function settings_l(t){return game.i18n.localize(t)}class AddEvent extends HandlebarsApplication{constructor(t){super(),this.combat=t}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"combat-dock-add-event",title:"combat-tracker-dock.add-event.title",template:"modules/combat-tracker-dock/templates/add-event.hbs",width:400,height:"auto",closeOnSubmit:!0})}static get DEFAULT_OPTIONS(){return{tag:"form",id:"combat-dock-add-event",window:{title:"combat-tracker-dock.add-event.title"},actions:{},form:{handler:this.#t,closeOnSubmit:!0},position:{width:400}}}static get PARTS(){return mergeClone(super.PARTS,{content:{classes:["standard-form"]},footer:{template:"templates/generic/form-footer.hbs"}})}_prepareContext(t){return{recentEvents:game.settings.get(gt,"events"),buttons:[{type:"submit",action:"submit",icon:"fas fa-plus",label:"combat-tracker-dock.add-event.title"}]}}_onRender(t,e){super._onRender(t,e);const a=this.element;a.querySelectorAll(".cct-event").forEach(t=>{t.addEventListener("click",t=>{const e=t.currentTarget.dataset.index,n=game.settings.get(gt,"events")[e];a.querySelector("[name='name']").value=n.name,a.querySelector("[name='img']").value=n.img,a.querySelector("[name='initiative']").value=n.initiative,a.querySelector("[name='duration']").value=n.duration,a.querySelector("[name='hidden']").checked=n.hidden})})}static async#t(t){const e=this.element,a=new foundry.applications.ux.FormDataExtended(e).object;if(!a.name||!a.img||!Number.isNumeric(a.initiative)&&!a.initiative)return ui.notifications.error(game.i18n.localize("combat-tracker-dock.add-event.error"));this.combat.createEmbeddedDocuments("Combatant",[{name:a.name,img:a.img,initiative:a.initiative,hidden:a.hidden||!1,"flags.combat-tracker-dock":{event:!0,duration:a.duration||!1,roundCreated:this.combat.round}}]);let n=game.settings.get(gt,"events");const i={name:a.name,img:a.img,initiative:a.initiative,duration:a.duration,hidden:a.hidden};n=n.filter(t=>t.name!==i.name&&t.img!==i.img),n.unshift(i),n=n.slice(0,10),await game.settings.set(gt,"events",n)}}class CombatDock extends HandlebarsApplication{constructor(t){super(),ui.combatDock?.close(),ui.combatDock=this,this.portraits=[],this.combat=t??game.combat,this.hooks=[],this._playAnimation=!0,this._currentPortraitSize={max:parseInt(game.settings.get(gt,"portraitSize")),aspect:game.settings.get(gt,"portraitAspect")},this.setHooks(),window.addEventListener("resize",this.autosize.bind(this)),this._combatTrackerRefreshed=!1}static get DEFAULT_OPTIONS(){let t=mergeClone(super.DEFAULT_OPTIONS,{classes:["hidden"],window:{title:"",icon:"fas fa-arrows-up-down-left-right",frame:!1,positioned:!1,minimizable:!1,resizable:!1,savePosition:!0},position:{width:"auto",height:"auto"}});return"rowDocked"!==game.settings.get(gt,"direction")&&function mergeObject(t,e){return foundry.utils.mergeObject(t,e)}(t,this.WINDOWED_DEFAULT_OPTIONS),t}static get WINDOWED_DEFAULT_OPTIONS(){return{window:{frame:!0,positioned:!0,preventEscapeClose:!0}}}get sortedCombatants(){return Array.from(this.combat.combatants.contents.sort(this.combat._sortCombatants))}get trueCarousel(){return game.settings.get(gt,"carouselStyle")<2}get leftAligned(){return 1==game.settings.get(gt,"carouselStyle")}get autoFit(){return"autofit"==game.settings.get(gt,"overflowStyle")}get isVertical(){return"columnFloat"==game.settings.get(gt,"direction")}get isDocked(){return"rowDocked"==game.settings.get(gt,"direction")}setHooks(){this.hooks=[{hook:"renderCombatTracker",fn:this._onRenderCombatTracker.bind(this)},{hook:"createCombatant",fn:this.setupCombatants.bind(this)},{hook:"deleteCombatant",fn:this.setupCombatants.bind(this)},{hook:"updateCombatant",fn:this.updateCombatant.bind(this)},{hook:"updateCombat",fn:this._onCombatTurn.bind(this)},{hook:"deleteCombat",fn:this._onDeleteCombat.bind(this)},{hook:"combatStart",fn:this._onCombatStart.bind(this)},{hook:"hoverToken",fn:this._onHoverToken.bind(this)}];for(let t of this.hooks)t.id=Hooks.on(t.hook,t.fn)}removeHooks(){for(let t of this.hooks)Hooks.off(t.hook,t.id)}_prepareContext(t){const e="scroll"===game.settings.get(gt,"overflowStyle"),a=game.settings.get(gt,"lessButtons"),n=!this.isDocked&&!this.isVertical;return{isGM:game.user.isGM,scroll:e,lessButtons:a,reverseHeaderPosition:n}}setupCombatants(){this.portraits=[],this.sortedCombatants.forEach(t=>this.portraits.push(new CONFIG.combatTrackerDock.CombatantPortrait(t)));const t=this.element.querySelector("#combatants");t.innerHTML="",this.portraits.forEach(e=>t.appendChild(e.element));const e=this.portraits.length%2==0;if(this.element.classList.toggle("even",e),this.setupSeparator(),this.updateOrder(),this.autosize(),this._combatTrackerRefreshed||(this._combatTrackerRefreshed=!0,ui.combat.render(!0)),this._playAnimation&&this.sortedCombatants.length>0){this._playAnimation=!1;const t=this.portraits.map(t=>t.ready);this._promises=t,Promise.all(t).then(()=>{this.playIntroAnimation()})}}setupSeparator(){const t=this.element.querySelector("#combatants");t.querySelectorAll(".separator").forEach(t=>t.remove());const e=this.combat.turn+1,a=this.sortedCombatants.length,n=e>Math.floor(a/2)||this.leftAligned?1:0,i=document.createElement("div");i.classList.add("separator");const o=document.createElement("div");o.classList.add("line"),i.appendChild(o);const r=document.createElement("div");r.classList.add("round",this.isVertical?"flexrow":"flexcol"),r.innerHTML=this.isVertical?`<i class="fal fa-angle-down"></i>${this.combat.round+n}`:`<i class="fal fa-angle-right"></i>${this.combat.round+n}`,i.appendChild(r),t.appendChild(i)}playIntroAnimation(t="cubic-bezier(0.22, 1, 0.36, 1)"){Hooks.callAll("combatDock:playIntroAnimation",this);const e=CONFIG.combatTrackerDock.INTRO_ANIMATION_DURATION,a=CONFIG.combatTrackerDock.INTRO_ANIMATION_DELAY,n=this.isVertical,i=game.settings.get(gt,"alignment"),o=n?"X":"Y",r=n&&"right"==i?"":"-",playSlideInAnimation=(a,n=0)=>{a.style.transform=`translate${o}(${r}150%)`;a.animate([{transform:`translate${o}(${r}150%)`},{transform:`translate${o}(0)`}],{duration:e,easing:t,delay:n}).finished.then(()=>{a.style.transform="",Hooks.callAll("combatDock:playIntroAnimation:finished",this,a)})};let s=0;Array.from(this.element.querySelector("#combatants").children).forEach((t,n)=>{const i=(this.trueCarousel?parseInt(t.style.order)/100:n)*e*a;s=Math.max(s,i+e),playSlideInAnimation(t,i)}),setTimeout(()=>{n&&this.centerCurrentCombatant()},s+e),setTimeout(()=>{this.element.classList.remove("hidden"),n||this.centerCurrentCombatant()},10)}autosize(){const t=parseInt(game.settings.get(gt,"portraitSize")),e=game.settings.get(gt,"portraitAspect");this._currentPortraitSize={max:t,aspect:e};const a=t*e;if(!this.autoFit)return document.documentElement.style.setProperty("--combatant-portrait-size",t+"px");const n=game.settings.get(gt,"floatingSize"),i=this.sortedCombatants.length;let o,r;o=this.isVertical?window.innerHeight*n/100:this.isDocked?.9*document.getElementById("ui-top").getBoundingClientRect().width:window.innerWidth*n/100,r=this.isVertical?Math.min(a,Math.floor(o/i))/e:Math.min(t,Math.floor(o/i)),document.documentElement.style.setProperty("--combatant-portrait-size",r/(this.isVertical?1:1.2)+"px")}updateCombatant(t,e={}){if("initiative"in e)return void this.setupCombatants();const a=this.portraits.find(e=>e.combatant===t);a&&a.renderInner()}updateCombatants(){this.portraits.forEach(t=>t.renderInner())}updateOrder(){this.setupSeparator();const t=this.element.querySelector(".separator"),e=this.trueCarousel;t.style.display=e?"":"none",0===this.sortedCombatants.filter(t=>t?.visible)?.length&&(t.style.display="none"),t.classList.remove("vertical","horizontal"),t.classList.add(this.isVertical?"vertical":"horizontal");const a=this.sortedCombatants;if(!this.trueCarousel)return this.portraits.forEach(t=>t.element.style.setProperty("order",a.indexOf(t.combatant)));const n=this.leftAligned,i=this.combat.combatant,o=a.findIndex(t=>t===i)+a.length,r=[...a,...a,...a],s=n?a.length:Math.floor(a.length/2),c=r.slice(o-s,o+s+1),l=this.sortedCombatants[this.sortedCombatants.length-1];this.portraits.forEach(t=>{const e=c.find(e=>e===t.combatant),a=c.findIndex(t=>t===e);t.element.style.setProperty("order",100*a)});const u=this.portraits.find(t=>t.combatant===l)?.element?.style?.order??999999;t.style.setProperty("order",parseInt(u)+1)}updateStartEndButtons(){if(!this.element)return;const t=this.element.querySelector('[data-action="start-combat"]'),e=this.element.querySelector('[data-action="end-combat"]');t.style.display=this.combat.started?"none":"",e.style.display=this.combat.started?"":"none"}appendHtml(){if(this.isDocked)return document.querySelector("#ui-top").prepend(this.element)}_onRender(t,e){if(this._closed)return this.close();super._onRender(t,e),this.setupCombatants(),this.appendHtml(),this.element.querySelectorAll(".buttons-container button").forEach(t=>{t.addEventListener("click",t=>{switch(t.currentTarget.dataset.action){case"previous-turn":this.combat.previousTurn();break;case"next-turn":this.combat.nextTurn();break;case"previous-round":this.combat.previousRound();break;case"next-round":this.combat.nextRound();break;case"end-combat":this.combat.endCombat();break;case"roll-all":this.combat.rollAll({event:t});break;case"roll-npc":this.combat.rollNPC({event:t});break;case"reset":this.combat.resetAll();break;case"configure":(new foundry.applications.apps.CombatTrackerConfig).render(!0);break;case"start-combat":this.combat.startCombat();break;case"add-event":new AddEvent(this.combat).render(!0)}})}),this.autosize(),this.setControlsOrder(),new foundry.applications.ux.ContextMenu(this.element.querySelector("#combatants"),".combatant-portrait",[{condition:game?.user?.isGM,name:`${gt}.contextMenu.setAsCurrent`,icon:'<i class="fas fa-swords"></i>',callback:t=>{this.combat.update({turn:this.sortedCombatants.indexOf(this.combat.combatants.get(t.dataset.combatantId))})}},...game.combats.directory._getEntryContextOptions()],{jQuery:!1,fixed:!0})}_onRenderCombatTracker(){this.portraits.forEach(t=>t.renderInner()),this.updateStartEndButtons()}_onCombatTurn(t,e,a){if(!("turn"in e)&&!("round"in e))return;"round"in e&&this._onRoundChange();const n=this.element.querySelector("#combatants"),i=Array.from(n.children).filter(t=>!t.classList.contains("separator")),o=n.getBoundingClientRect();n.style.minWidth=o.width+"px",n.style.minHeight=o.height+"px";const r=[...i].sort((t,e)=>e.style.order-t.style.order),s=[...i].sort((t,e)=>t.style.order-e.style.order),c=this.combat.combatant,l=this.sortedCombatants.findIndex(t=>t===c);let u=0,d=0;const m=this.sortedCombatants;for(let t=1;t<m.length;t++){if(!m[(l+t)%m.length].defeated)break;d++}for(let t=1;t<m.length;t++){if(!m[(l-t+m.length)%m.length].defeated)break;u++}const g=s.slice(0,u+1),h=r.slice(0,d+1),f=0!=u?g:[[...i].reduce((t,e)=>t.style.order<e.style.order?t:e,n.children[0])],p=0!=d?h:[[...i].reduce((t,e)=>t.style.order>e.style.order?t:e,n.children[0])],b=1===a.direction?f:p;if(this._playAnimation&&this.sortedCombatants.length>0)return this._playAnimation=!1,this.updateOrder(),void this.playIntroAnimation();if(setTimeout(()=>this.updateOrder(),200),!this.trueCarousel)return n.style.minWidth="",n.style.minHeight="",this.centerCurrentCombatant();for(const t of b)t.classList.add("collapsed-"+(this.isVertical?"vertical":"horizontal")),setTimeout(()=>{t.classList.remove("collapsed-"+(this.isVertical?"vertical":"horizontal")),setTimeout(()=>{n.style.minWidth="",n.style.minHeight=""},200),this.centerCurrentCombatant()},200)}async _onRoundChange(){const t=[];for(const e of this.combat.combatants){const a=e.getFlag(gt,"duration");if(!a)continue;const n=e.getFlag(gt,"roundCreated");if(!n)continue;this.combat.round-n>=a&&(t.push(e.id),ChatMessage.create({speaker:{alias:"Combat Tracker Dock"},content:game.i18n.localize("combat-tracker-dock.add-event.expired").replace("%n",`<strong>${e.name}</strong>`),type:CONST.CHAT_MESSAGE_TYPES.OTHER,whisper:[game.user.id]}))}t.length>0&&await this.combat.deleteEmbeddedDocuments("Combatant",t)}centerCurrentCombatant(){if(!this.element)return;const t=game.settings.get(gt,"carouselStyle"),e=this.element.querySelector("#combatants");if(this.trueCarousel){if(1==t)return e.scrollTo({top:0,left:0,behavior:"smooth"});e.scrollTo({top:e.scrollHeight/2-e.offsetHeight/2+this._currentPortraitSize.max*this._currentPortraitSize.aspect,left:e.scrollWidth/2-e.offsetWidth/2+this._currentPortraitSize.max,behavior:"smooth"})}else{const t=this.portraits.find(t=>t.combatant===this.combat.combatants.get(this.combat?.current?.combatantId));if(!t)return;t.element.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}}setControlsOrder(){const t=this.element.querySelector(".buttons-container.left"),e=this.element.querySelector(".buttons-container.right");t.style.marginRight="",e.style.marginLeft="";const a=this.element.querySelector("#combatants"),n=game.settings.get(gt,"alignment");this.isVertical&&"center"!==n?"right"==n?(t.style.order=0,t.style.marginRight="1rem",e.style.order=1,a.style.order=2):(t.style.order=1,e.style.order=2,e.style.marginLeft="1rem",a.style.order=0):(t.style.order="",e.style.order="",a.style.order="")}_onDeleteCombat(t){t===this.combat&&this.close()}_onCombatStart(t){t===this.combat&&(this._playAnimation=!0)}_onHoverToken(t,e){const a=this.portraits.find(e=>e.token===t);a&&a.element.classList.toggle("hovered",e)}refresh(){this.autosize(),this.updateCombatants(),this.appendHtml()}async restart(){await this.close(),await(new CombatDock).render({force:!0})}async close(...t){return this.removeHooks(),window.removeEventListener("resize",this.autosize.bind(this)),this.element&&this.element.remove(),this._closed=!0,super.close(...t)}}class CombatantPortrait{constructor(t){this.combatant=t,this.combat=t.combat,this.element=document.createElement("div"),this.element.classList.add("combatant-portrait"),this.element.setAttribute("data-combatant-id",t.id),this.element.setAttribute("data-tooltip-class","combat-dock-tooltip"),this.element.style.backgroundImage=`url("${game.settings.get(gt,"portraitImageBackground")}")`,this.resolve=null,this.ready=new Promise(t=>this.resolve=t),this._hasTakenTurn=this.combat.round??!0,game.settings.get(gt,"hideFirstRound")||(this._hasTakenTurn=!0),this.activateCoreListeners(),this.renderInner()}get actor(){return this.combatant?.actor}get token(){return this.combatant?.token?.object}get img(){return("actor"===game.settings.get(gt,"portraitImage")?this.combatant.actor?.img:this.combatant.img)??this.combatant.img}get name(){if(this.combatant.isOwner)return this.combatant.name;const t=game.settings.get(gt,"displayName");return"owner"===t?this.combatant.isOwner?this.combatant.name:"???":"default"===t||[CONST.TOKEN_DISPLAY_MODES.HOVER,CONST.TOKEN_DISPLAY_MODES.ALWAYS].includes(this.token?.document?.displayName)?this.combatant.name:"???"}get firstTurnHidden(){const t=this.combatant,e=(t.actor?.permission??-10)>=CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER||t.isOwner,a=t.token?.disposition===CONST.TOKEN_DISPOSITIONS.FRIENDLY;return!(e||this._hasTakenTurn||a)}get isEvent(){return this.combatant.flags[gt]?.event??!1}get eventResource(){if(!this.isEvent)return null;const t=this.combatant.flags[gt],{duration:e,roundCreated:a}=t,n=this.combat.round;return{max:e,value:e-(n-a),percentage:Math.round((e-(n-a))/e*100)}}get eventRoundsLeft(){return this.combatant.getFlag(gt,"roundsLeft")??0}activateCoreListeners(){this.element.addEventListener("mouseenter",this._onHoverIn.bind(this)),this.element.addEventListener("mouseleave",this._onHoverOut.bind(this))}activateListeners(){this.element.querySelector(".combatant-wrapper").addEventListener("click",this._onCombatantMouseDown.bind(this)),(this.element.querySelectorAll(".system-icon")??[]).forEach((t,e)=>{const a=this._systemIcons[e];a.callback&&a.enabled&&t.addEventListener("click",async t=>{t.stopPropagation(),t.stopImmediatePropagation(),a.callback(t,this.combatant,e,a.id)})}),this.actor?.isOwner&&(this.element.querySelectorAll(".portrait-effect")??[]).forEach(t=>{t.addEventListener("contextmenu",async e=>{e.preventDefault(),e.stopPropagation();const a=t.dataset.uuid,n=await fromUuid(a),i=CONFIG.statusEffects.find(t=>t.img===n.img);await foundry.applications.api.DialogV2.confirm({window:{title:`${gt}.deleteEffectTitle`},content:game.i18n.localize(`${gt}.deleteEffectContent`)+game.i18n.localize(n?.label??i?.name??"")+"?",defaultYes:!1})&&(n?await n.delete():this.token?.toggleEffect(a))})})}async _onCombatantMouseDown(t){if(t.preventDefault(),"player-pass"===t.target.dataset.action)return this.combat.nextTurn();if(!t.target.classList.contains("combatant-wrapper"))return;if(2===t.button)return game.user.isGM&&this.combatant.sheet.render(!0);const e=this.combatant,a=e.token;if(!e.actor?.testUserPermission(game.user,"OBSERVER"))return;const n=Date.now(),i=n-this._clickTime;return this._clickTime=n,i<=250?e.actor?.sheet.render(!0):a?.object?(a.object?.control({releaseOthers:!0}),canvas.animatePan(a.object.center)):void 0}_onHoverIn(t){this.token&&this.token?.isVisible&&!this.token.controlled&&this.token._onHoverIn(t)}_onHoverOut(t){this.token&&this.token.hover&&this.token._onHoverOut(t)}async renderInner(){const t=await this.getData();if(this.element.classList.toggle("hidden",!t),!t)return this.resolve(!0),void(this.element.innerHTML="");const e=await foundry.applications.handlebars.renderTemplate("modules/combat-tracker-dock/templates/combatant-portrait.hbs",{...t}),a=await foundry.applications.handlebars.renderTemplate("modules/combat-tracker-dock/templates/combatant-tooltip.hbs",{...t});this.element.innerHTML=e,this.element.setAttribute("data-tooltip",a);let n="";if("columnFloat"==game.settings.get(gt,"direction")){const t=game.settings.get(gt,"alignment");"left"==t?n=foundry.helpers.interaction.TooltipManager.implementation.TOOLTIP_DIRECTIONS.RIGHT:"right"==t&&(n=foundry.helpers.interaction.TooltipManager.implementation.TOOLTIP_DIRECTIONS.LEFT)}this.element.setAttribute("data-tooltip-direction",n),this.element.classList.toggle("active",t.css.includes("active")),this.element.classList.toggle("visible",t.css.includes("hidden")),this.element.classList.toggle("defeated",t.css.includes("defeated")),this.element.style.borderBottomColor=this.getBorderColor(this.token?.document),this.element.querySelector(".roll-initiative").addEventListener("click",async t=>{t.preventDefault(),Hooks.once("renderCombatTracker",()=>{ui.combatDock.updateOrder()}),await this.combatant.combat.rollInitiative([this.combatant.id],{event:t})}),this.element.querySelectorAll(".action").forEach(t=>{t.addEventListener("click",async e=>{e.stopPropagation(),e.stopImmediatePropagation();switch(t.dataset.action){case"toggle-hidden":await this.combatant.update({hidden:!this.combatant.hidden});break;case"toggle-defeated":await ui.combat._onToggleDefeatedStatus(this.combatant);break;case"ping":await ui.combat._onPingCombatant(this.combatant)}})});const i=this.element.querySelector(".image-border");i&&(i.style.backgroundImage=`url("${game.settings.get(gt,"portraitImageBorder")}")`),this.activateListeners(),this.resolve(!0)}getResource(t=null,e=!1){if(this.isEvent&&e)return this.eventResource;if(!this.actor||!this.combat)return null;let a,n,i;return(t=t??this.combat.settings.resource)?(a=foundry.utils.getProperty(this.actor.system,t+".max")??foundry.utils.getProperty(this.actor.system,t.replace("value","")+"max"),n=foundry.utils.getProperty(this.actor.system,t)??foundry.utils.getProperty(this.actor.system,t+".value"),void 0!==a&&void 0!==n&&Number.isNumeric(a)&&Number.isNumeric(n)&&(i=Math.min(Math.max(Math.round(n/a*100),0),100)),n=this.validateValue(n),a=this.validateValue(a),{max:a,value:n,percentage:i}):{max:a,value:n,percentage:i}}validateValue(t){return"boolean"==typeof t&&(t=t?"":""),Array.isArray(t)&&(t=t.join(", ")),""===t&&(t=null),Number.isNumeric(t)||"[object String]"==Object.prototype.toString.call(t)||(t=null),t}getBarsOrder(t,e,a){const n=game.settings.get(gt,"barsPlacement");switch(e=isNaN(e?.percentage)?1:0,a=isNaN(a?.percentage)?1:0,n){case"left":return{bar1:0,bar2:1,init:2,effects:3,bar1ML:0,bar2ML:0,initBars:2.5-e-a};case"right":return{bar1:2,bar2:3,init:0,effects:1,bar1ML:t?0:"auto",bar2ML:0,initBars:.5};case"twinned":return{bar1:0,bar2:3,init:1,effects:2,bar1ML:0,bar2ML:t?0:"auto",initBars:1.5-e}}}get hasPermission(){const t=this.combatant,e=t.actor?.hasPlayerOwner&&game.settings.get(gt,"playerPlayerPermission");return(t.actor?.permission??-10)>=CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER||t.isOwner||e}async getData(){let t=!1;const e=this.combatant;if(game.settings.get(gt,"hideDefeated")&&e.isDefeated)return null;this.combat.turns.indexOf(e)===this.combat.turn&&this.combat.started&&(this._hasTakenTurn=!0);const a=this.hasPermission;if(!a&&!this._hasTakenTurn)return null;if(!e.visible&&!game.user.isGM)return null;const n=game.settings.get(gt,"attributes").map(t=>({...this.getResource(t.attr),icon:t.icon.includes(".")?`<img src="${t.icon}" />`:`<i class="${t.icon} icon"></i>`,units:t.units||""})).filter(t=>null!==t.value&&void 0!==t.value),i=this.getSystemIcons(),o=i.resource?.length??0,r=game.settings.get(gt,"attributeVisibility"),s=game.settings.get(gt,"displayDescriptions");let c=!1;"all"===s?c=!0:"owner"===s&&(c=a);const l=a?this.getResource(null,!0):null,u=a?this.getResource(game.settings.get(gt,"resource")):null,d=game.settings.get(gt,"portraitResource"),m=a&&d?this.getResource(d):null,g=this.getInitiativeDisplay();g.isIconImg=g.icon.includes("."),g.isRollIconImg=g.rollIcon.includes(".");const h={id:e.id,name:this.name,img:this.img,active:this.combat.turns.indexOf(e)===this.combat.turn,owner:e.isOwner,isGM:game.user.isGM,showPass:e.isOwner&&!game.user.isGM,defeated:e.isDefeated,hidden:e.hidden,initiative:e.initiative,hasRolled:null!==e.initiative&&void 0!==e.initiative,hasResource:null!==l,hasResource2:null!==u,hasPortraitResource:null!==m,hasPlayerOwner:e.actor?.hasPlayerOwner,hasPermission:a,showInitiative:game.settings.get(gt,"showInitiativeOnPortrait"),isInitiativeNaN:null===e.initiative||void 0===e.initiative,initiativeData:g,resource:l,resource2:u,portraitResource:m,showBars:"bars"==r||"both"==r,showText:"text"==r||"both"==r,canPing:e.sceneId===canvas.scene?.id&&game.user.hasPermission("PING_CANVAS"),attributes:n,description:this.getDescription(),resSystemIcons:i.resource,tooltipSystemIcons:i.tooltip,systemIconsSizeMulti:clamp(.03,1/(2*o),.1),barsOrder:null,displayDescriptions:c};if(null===h.initiative||Number.isInteger(h.initiative)||(t=!0),null===h.initiativeData.value||Number.isInteger(h.initiativeData.value)||(t=!0),h.css=[h.active?"active":"",h.hidden?"hidden":"",h.defeated?"defeated":""].join(" ").trim(),h.effects=new Set,h.hasAttributes=n.length>0,e.actor)for(const t of e.actor.temporaryEffects)if(t.statuses.has(CONFIG.specialStatusEffects.DEFEATED))h.defeated=!0;else if(t.img){const e=t.description?await foundry.applications.ux.TextEditor.implementation.enrichHTML(t.description):"",a=parseInt(t.duration?.label??""),n=t.duration?.remaining/t.duration?.duration,i=t.uuid;h.effects.add({uuid:i,img:t.img,name:t.name,description:e,duration:a,percent:isNaN(n)?null:100*n,hasDuration:!isNaN(a)})}h.hasEffects=h.effects.size>0,h.barsOrder=this.getBarsOrder(h.hasEffects,l,u);const f=CONFIG.Combat.initiative.decimals;return h.hasRolled&&"number"==typeof h.initiative&&(h.initiative=h.initiative.toFixed(t?f:0)),h.hasRolled&&"number"==typeof h.initiativeData.value&&(h.initiativeData.value=h.initiativeData.value.toFixed(t?f:0)),game.user.isGM||e.actor?.isOwner||!game.settings.get(gt,"hideEnemyInitiative")||(h.initiative="?",h.initiativeData.value="?"),h}getDescription(){const t=this.actor;if(!t)return null;let e=null;try{e=generateDescription(t)}catch(t){console.error(t)}return e}getSystemIcons(){try{const t=game.settings.get(gt,"showSystemIcons"),e=t>0?getSystemIcons(this.combatant):[],a=this.hasPermission;return e.forEach(t=>{t.callback&&(t.hasCallback=!0),t.visible??=a}),this._systemIcons=e,e&&e?.length?{resource:t>=2?e:null,tooltip:1==t||3==t?e:null}:{resource:null,tooltip:null}}catch(t){return console.error(t),{resource:null,tooltip:null}}}getInitiativeDisplay(){return function getInitiativeDisplay(t){switch(game.system.id){case"swade":{let e="";const getCardImage=t=>Array.from(game.cards.get(game.settings.get("swade","actionDeck")).cards).find(e=>e.description===t)?.img;let a=t?.cardString??"";return a.includes("")?e="fas fa-heart":a.includes("")?e="fas fa-diamond":a.includes("")?e="fas fa-club":a.includes("")?e="fas fa-spade":"Red J"!==a&&"Blk J"!==a||(a="JK"),{value:a,icon:getCardImage(t?.cardString??"")??e,rollIcon:"far fa-cards-blank"}}case"wfrp4e":case"exaltedthird":case"exaltedessence":return{value:t?.initiative,icon:"far fa-dice-d10",rollIcon:"far fa-dice-d10"};case"alienrpg":return{value:t?.initiative,icon:"far fa-cards-blank",rollIcon:"fa-solid fa-cards-blank"};case"lancer":return game.lancer.combatTrackerDock?.getInitiativeDisplay(t)??{value:t?.initiative,icon:"fas fa-dice-d20",rollIcon:"fas fa-dice-d20"};case"dnd4e":return{value:t?.initiative?parseInt(t.initiative).toString():null,icon:"fas fa-dice-d20",rollIcon:"fas fa-dice-d20"};default:return{value:t?.initiative,icon:"far fa-dice-d20",rollIcon:"far fa-dice-d20"}}}(this.combatant)}getBorderColor(t){if(!game.settings.get(gt,"showDispositionColor")||!t)return"#000";return new Color(function getColor(){const e=CONFIG.Canvas.dispositionColors;if(t.isOwner&&!game.user.isGM)return e.CONTROLLED;const a=CONST.TOKEN_DISPOSITIONS;switch(t.disposition){case a.SECRET:return e.SECRET;case a.HOSTILE:return e.HOSTILE;case a.NEUTRAL:return e.NEUTRAL;case a.FRIENDLY:return t.actor?.hasPlayerOwner?e.PARTY:e.FRIENDLY;default:return e.NEUTRAL}}()).toString()}destroy(){this.element?.remove()}}const clamp=(t,e,a)=>Math.min(Math.max(t,e),a),mt="chat-welcome-message-shown";const gt="combat-tracker-dock";function getCurrentCombat(){return ui.combat.viewed}Hooks.once("init",function(){!function registerWrappers(){if(!game.modules.get("lib-wrapper")?.active)return;libWrapper.register(gt,"Combatant.prototype.visible",function(t,...e){const a=t(...e);if(!ui.combatDock?.rendered)return a;const n=ui.combatDock.portraits.find(t=>t.combatant==this)?.firstTurnHidden;return a&&!n})}(),function registerHotkeys(){game.keybindings.register(gt,"combatPrev",{name:`${gt}.hotkeys.combatPrev.name`,editable:[{key:"KeyN",modifiers:[foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT]}],restricted:!1,onDown:()=>{},onUp:()=>{if(!game.combat)return;const t=game.combat.combatant?.isOwner;t&&game.combat.previousTurn()}}),game.keybindings.register(gt,"combatNext",{name:`${gt}.hotkeys.combatNext.name`,editable:[{key:"KeyM",modifiers:[foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT]}],restricted:!1,onDown:()=>{},onUp:()=>{if(!game.combat)return;const t=game.combat.combatant?.isOwner;t&&game.combat.nextTurn()}})}(),CONFIG.combatTrackerDock={CombatDock,CombatantPortrait,defaultAttributesConfig,generateDescription,INTRO_ANIMATION_DURATION:1e3,INTRO_ANIMATION_DELAY:.25},Hooks.callAll(`${gt}-init`,CONFIG.combatTrackerDock)}),Hooks.on("ready",()=>{registerSettings(),function initConfig(){Hooks.on("renderCombatTrackerConfig",(t,e,a)=>{if(!game.user.isGM)return;const n=TokenDocument.implementation.getTrackedAttributes();n.bar.forEach(t=>t.push("value"));const i=TokenDocument.implementation.getTrackedAttributeChoices(n);i.unshift({label:"None",value:""});const o=TokenDocument.implementation.getTrackedAttributeChoices({bar:n.bar,value:[]});o.unshift({label:"None",value:""});const r=Handlebars.compile(`<select name="flags.${gt}.resource">{{selectOptions options selected=value}}</select>`),s=Handlebars.compile(`<select name="flags.${gt}.portraitResource">{{selectOptions options selected=value}}</select>`),c=r({options:i,value:game.settings.get(gt,"resource")}),l=s({options:o,value:game.settings.get(gt,"portraitResource")}),u=document.createElement("div");u.classList.add("form-group"),u.innerHTML=`\n        <label>${game.i18n.localize("COMBAT.CONFIG.FIELDS.core.combatTrackerConfig.resource.label")} 2</label>\n        ${c}\n        <p class="hint">${game.i18n.localize("COMBAT.CONFIG.FIELDS.core.combatTrackerConfig.resource.hint")}</p>\n        `,e.querySelector('select[name="core.combatTrackerConfig.resource"]').closest(".form-group").appendChild(u);const d=document.createElement("div");d.classList.add("form-group"),d.innerHTML=`\n        <label>${game.i18n.localize(`${gt}.combatConfig.portraitResource.label`)}</label>\n        ${l}\n        <p class="hint">${game.i18n.localize(`${gt}.combatConfig.portraitResource.hint`)}</p>\n        `,e.querySelector(`select[name="flags.${gt}.resource"]`).closest(".form-group").appendChild(d);const m=document.createElement("button");m.innerHTML='<i class="fa-solid fa-gears"></i> '+game.i18n.localize(`${gt}.configureCarousel`),m.addEventListener("click",t=>{t.preventDefault(),(new foundry.applications.settings.SettingsConfig).render(!0),Hooks.once("renderSettingsConfig",(t,e,a)=>{e.querySelector('button[data-tab="combat-tracker-dock"]').click()})}),Array.from(e.querySelectorAll(".form-group")).pop().after(m),e.querySelector(`select[name="flags.${gt}.resource"]`).addEventListener("change",async t=>{await game.settings.set(gt,"resource",t.target.value)}),e.querySelector(`select[name="flags.${gt}.portraitResource"]`).addEventListener("change",async t=>{await game.settings.set(gt,"portraitResource",t.target.value)}),t.setPosition({height:"auto"})})}();const t=getCurrentCombat();t&&!ui.combatDock&&game.settings.get("core","noCanvas")&&new CONFIG.combatTrackerDock.CombatDock(t).render(!0),function showWelcome(){if(!game.user.isGM)return;const t=game.modules.get(gt),e="2Iq_so_GsLA",a=`<iframe width="100%" height="auto" src="https://www.youtube.com/embed/${e}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`,n=t.protected?`https://wiki.theripper93.com/premium/${gt}`:`https://wiki.theripper93.com/free/${gt}`,i=`<h1>${t.title}</h1>\n    <p>by <a href="https://theripper93.com">theripper93</a></p>\n    <p><strong>New to ${t.title}? Visit the <a href="${n}">Wiki</a> for a quickstart guide and resources.</strong></p>\n    ${e?a:""}\n    <p>Special thanks to all my <a href="https://www.patreon.com/theripper93">Patreons</a> for making ongoing updates and development possible. Supporting gives you access to <strong>30+ premium modules</strong> and <strong>priority support</strong>.</p>\n    <p><strong>Explore all resources and modules:</strong></p> <ul>\n    <li><a href="https://theripper93.com/">Check out all my free and premium modules</a></li>\n    <li><a href="${n}">${t.title} Wiki</a></li>\n    <li><a href="https://www.patreon.com/theripper93">Support on Patreon</a></li>\n    <li><a href="https://discord.theripper93.com/">Discord Channel</a></li>\n    </ul>`;game.settings.register(gt,mt,{default:!1,type:Boolean,scope:"world",config:!1}),game.settings.get(gt,mt)||(ChatMessage.create({user:game.user.id,whisper:game.users.filter(t=>t.isGM).map(t=>t.id),blind:!0,content:i}),game.settings.set(gt,mt,!0))}()}),Hooks.on("createCombat",t=>{game.combat===t&&new CONFIG.combatTrackerDock.CombatDock(t).render(!0)}),Hooks.on("updateCombat",(t,e)=>{(e.active||null===e.scene)&&new CONFIG.combatTrackerDock.CombatDock(t).render(!0),e.scene&&t.scene!==game.scenes.viewed&&ui.combatDock?.combat===t&&ui.combatDock.close()}),Hooks.on("canvasReady",()=>{Hooks.once("renderCombatTracker",t=>{const e=getCurrentCombat();e?new CONFIG.combatTrackerDock.CombatDock(e).render(!0):ui.combatDock?.close()})})})();
//# sourceMappingURL=index.js.map