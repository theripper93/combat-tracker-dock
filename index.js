/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_extends.apply(this,arguments)}function _objectWithoutProperties(e,t){if(null==e)return{};var a,n,o=function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}e.d({},{D:()=>he});function userAgent(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var t=userAgent(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),a=userAgent(/Edge/i),n=userAgent(/firefox/i),o=userAgent(/safari/i)&&!userAgent(/chrome/i)&&!userAgent(/android/i),i=userAgent(/iP(ad|od|hone)/i),r=userAgent(/chrome/i)&&userAgent(/android/i),s={capture:!1,passive:!1};function on(e,a,n){e.addEventListener(a,n,!t&&s)}function off(e,a,n){e.removeEventListener(a,n,!t&&s)}function matches(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function getParentOrHost(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function closest(e,t,a,n){if(e){a=a||document;do{if(null!=t&&(">"===t[0]?e.parentNode===a&&matches(e,t):matches(e,t))||n&&e===a)return e;if(e===a)break}while(e=getParentOrHost(e))}return null}var c,u=/\s+/g;function toggleClass(e,t,a){if(e&&t)if(e.classList)e.classList[a?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(u," ").replace(" "+t+" "," ");e.className=(n+(a?" "+t:"")).replace(u," ")}}function css(e,t,a){var n=e&&e.style;if(n){if(void 0===a)return document.defaultView&&document.defaultView.getComputedStyle?a=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(a=e.currentStyle),void 0===t?a:a[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=a+("string"==typeof a?"":"px")}}function matrix(e,t){var a="";if("string"==typeof e)a=e;else do{var n=css(e,"transform");n&&"none"!==n&&(a=n+" "+a)}while(!t&&(e=e.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(a)}function find(e,t,a){if(e){var n=e.getElementsByTagName(t),o=0,i=n.length;if(a)for(;o<i;o++)a(n[o],o);return n}return[]}function getWindowScrollingElement(){var e=document.scrollingElement;return e||document.documentElement}function getRect(e,a,n,o,i){if(e.getBoundingClientRect||e===window){var r,s,c,u,d,m,g;if(e!==window&&e.parentNode&&e!==getWindowScrollingElement()?(s=(r=e.getBoundingClientRect()).top,c=r.left,u=r.bottom,d=r.right,m=r.height,g=r.width):(s=0,c=0,u=window.innerHeight,d=window.innerWidth,m=window.innerHeight,g=window.innerWidth),(a||n)&&e!==window&&(i=i||e.parentNode,!t))do{if(i&&i.getBoundingClientRect&&("none"!==css(i,"transform")||n&&"static"!==css(i,"position"))){var h=i.getBoundingClientRect();s-=h.top+parseInt(css(i,"border-top-width")),c-=h.left+parseInt(css(i,"border-left-width")),u=s+r.height,d=c+r.width;break}}while(i=i.parentNode);if(o&&e!==window){var f=matrix(i||e),p=f&&f.a,b=f&&f.d;f&&(u=(s/=b)+(m/=b),d=(c/=p)+(g/=p))}return{top:s,left:c,bottom:u,right:d,width:g,height:m}}}function isScrolledPast(e,t,a){for(var n=getParentAutoScrollElement(e,!0),o=getRect(e)[t];n;){var i=getRect(n)[a];if(!("top"===a||"left"===a?o>=i:o<=i))return n;if(n===getWindowScrollingElement())break;n=getParentAutoScrollElement(n,!1)}return!1}function getChild(e,t,a,n){for(var o=0,i=0,r=e.children;i<r.length;){if("none"!==r[i].style.display&&r[i]!==Sortable.ghost&&(n||r[i]!==Sortable.dragged)&&closest(r[i],a.draggable,e,!1)){if(o===t)return r[i];o++}i++}return null}function lastChild(e,t){for(var a=e.lastElementChild;a&&(a===Sortable.ghost||"none"===css(a,"display")||t&&!matches(a,t));)a=a.previousElementSibling;return a||null}function index(e,t){var a=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Sortable.clone||t&&!matches(e,t)||a++;return a}function getRelativeScrollOffset(e){var t=0,a=0,n=getWindowScrollingElement();if(e)do{var o=matrix(e),i=o.a,r=o.d;t+=e.scrollLeft*i,a+=e.scrollTop*r}while(e!==n&&(e=e.parentNode));return[t,a]}function getParentAutoScrollElement(e,t){if(!e||!e.getBoundingClientRect)return getWindowScrollingElement();var a=e,n=!1;do{if(a.clientWidth<a.scrollWidth||a.clientHeight<a.scrollHeight){var o=css(a);if(a.clientWidth<a.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||a.clientHeight<a.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!a.getBoundingClientRect||a===document.body)return getWindowScrollingElement();if(n||t)return a;n=!0}}}while(a=a.parentNode);return getWindowScrollingElement()}function isRectEqual(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function throttle(e,t){return function(){if(!c){var a=arguments;1===a.length?e.call(this,a[0]):e.apply(this,a),c=setTimeout(function(){c=void 0},t)}}}function scrollBy(e,t,a){e.scrollLeft+=t,e.scrollTop+=a}function clone(e){var t=window.Polymer,a=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):a?a(e).clone(!0)[0]:e.cloneNode(!0)}var d="Sortable"+(new Date).getTime();function AnimationStateManager(){var e,t=[];return{captureAnimationState:function captureAnimationState(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach(function(e){if("none"!==css(e,"display")&&e!==Sortable.ghost){t.push({target:e,rect:getRect(e)});var a=_objectSpread2({},t[t.length-1].rect);if(e.thisAnimationDuration){var n=matrix(e,!0);n&&(a.top-=n.f,a.left-=n.e)}e.fromRect=a}})},addAnimationState:function addAnimationState(e){t.push(e)},removeAnimationState:function removeAnimationState(e){t.splice(function indexOfObject(e,t){for(var a in e)if(e.hasOwnProperty(a))for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e[a][n])return Number(a);return-1}(t,{target:e}),1)},animateAll:function animateAll(a){var n=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof a&&a());var o=!1,i=0;t.forEach(function(e){var t=0,a=e.target,r=a.fromRect,s=getRect(a),c=a.prevFromRect,u=a.prevToRect,d=e.rect,m=matrix(a,!0);m&&(s.top-=m.f,s.left-=m.e),a.toRect=s,a.thisAnimationDuration&&isRectEqual(c,s)&&!isRectEqual(r,s)&&(d.top-s.top)/(d.left-s.left)===(r.top-s.top)/(r.left-s.left)&&(t=function calculateRealTime(e,t,a,n){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-a.top,2)+Math.pow(t.left-a.left,2))*n.animation}(d,c,u,n.options)),isRectEqual(s,r)||(a.prevFromRect=r,a.prevToRect=s,t||(t=n.options.animation),n.animate(a,d,s,t)),t&&(o=!0,i=Math.max(i,t),clearTimeout(a.animationResetTimer),a.animationResetTimer=setTimeout(function(){a.animationTime=0,a.prevFromRect=null,a.fromRect=null,a.prevToRect=null,a.thisAnimationDuration=null},t),a.thisAnimationDuration=t)}),clearTimeout(e),o?e=setTimeout(function(){"function"==typeof a&&a()},i):"function"==typeof a&&a(),t=[]},animate:function animate(e,t,a,n){if(n){css(e,"transition",""),css(e,"transform","");var o=matrix(this.el),i=o&&o.a,r=o&&o.d,s=(t.left-a.left)/(i||1),c=(t.top-a.top)/(r||1);e.animatingX=!!s,e.animatingY=!!c,css(e,"transform","translate3d("+s+"px,"+c+"px,0)"),this.forRepaintDummy=function repaint(e){return e.offsetWidth}(e),css(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),css(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout(function(){css(e,"transition",""),css(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},n)}}}}var m=[],g={initializeByDefault:!0},h={mount:function mount(e){for(var t in g)g.hasOwnProperty(t)&&!(t in e)&&(e[t]=g[t]);m.forEach(function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),m.push(e)},pluginEvent:function pluginEvent(e,t,a){var n=this;this.eventCanceled=!1,a.cancel=function(){n.eventCanceled=!0};var o=e+"Global";m.forEach(function(n){t[n.pluginName]&&(t[n.pluginName][o]&&t[n.pluginName][o](_objectSpread2({sortable:t},a)),t.options[n.pluginName]&&t[n.pluginName][e]&&t[n.pluginName][e](_objectSpread2({sortable:t},a)))})},initializePlugins:function initializePlugins(e,t,a,n){for(var o in m.forEach(function(n){var o=n.pluginName;if(e.options[o]||n.initializeByDefault){var i=new n(e,t,e.options);i.sortable=e,i.options=e.options,e[o]=i,_extends(a,i.defaults)}}),e.options)if(e.options.hasOwnProperty(o)){var i=this.modifyOption(e,o,e.options[o]);void 0!==i&&(e.options[o]=i)}},getEventProperties:function getEventProperties(e,t){var a={};return m.forEach(function(n){"function"==typeof n.eventProperties&&_extends(a,n.eventProperties.call(t[n.pluginName],e))}),a},modifyOption:function modifyOption(e,t,a){var n;return m.forEach(function(o){e[o.pluginName]&&o.optionListeners&&"function"==typeof o.optionListeners[t]&&(n=o.optionListeners[t].call(e[o.pluginName],a))}),n}};function dispatchEvent(e){var n=e.sortable,o=e.rootEl,i=e.name,r=e.targetEl,s=e.cloneEl,c=e.toEl,u=e.fromEl,m=e.oldIndex,g=e.newIndex,f=e.oldDraggableIndex,p=e.newDraggableIndex,b=e.originalEvent,v=e.putSortable,y=e.extraEventProperties;if(n=n||o&&o[d]){var k,S=n.options,w="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||t||a?(k=document.createEvent("Event")).initEvent(i,!0,!0):k=new CustomEvent(i,{bubbles:!0,cancelable:!0}),k.to=c||o,k.from=u||o,k.item=r||o,k.clone=s,k.oldIndex=m,k.newIndex=g,k.oldDraggableIndex=f,k.newDraggableIndex=p,k.originalEvent=b,k.pullMode=v?v.lastPutMode:void 0;var E=_objectSpread2(_objectSpread2({},y),h.getEventProperties(i,n));for(var C in E)k[C]=E[C];o&&o.dispatchEvent(k),S[w]&&S[w].call(n,k)}}var f=["evt"],p=function pluginEvent(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.evt,o=_objectWithoutProperties(a,f);h.pluginEvent.bind(Sortable)(e,t,_objectSpread2({dragEl:b,parentEl:v,ghostEl:y,rootEl:k,nextEl:S,lastDownEl:w,cloneEl:E,cloneHidden:C,dragStarted:z,putSortable:A,activeSortable:Sortable.active,originalEvent:n,oldIndex:D,oldDraggableIndex:I,newIndex:_,newDraggableIndex:T,hideGhostForTarget:ne,unhideGhostForTarget:oe,cloneNowHidden:function cloneNowHidden(){C=!0},cloneNowShown:function cloneNowShown(){C=!1},dispatchSortableEvent:function dispatchSortableEvent(e){_dispatchEvent({sortable:t,name:e,originalEvent:n})}},o))};function _dispatchEvent(e){dispatchEvent(_objectSpread2({putSortable:A,cloneEl:E,targetEl:b,rootEl:k,oldIndex:D,oldDraggableIndex:I,newIndex:_,newDraggableIndex:T},e))}var b,v,y,k,S,w,E,C,D,_,I,T,P,A,O,N,x,R,M,L,z,F,H,$,G,B=!1,j=!1,W=[],q=!1,Y=!1,X=[],V=!1,U=[],K="undefined"!=typeof document,J=i,Z=a||t?"cssFloat":"float",Q=K&&!r&&!i&&"draggable"in document.createElement("div"),ee=function(){if(K){if(t)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),te=function _detectDirection(e,t){var a=css(e),n=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),o=getChild(e,0,t),i=getChild(e,1,t),r=o&&css(o),s=i&&css(i),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+getRect(o).width,u=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+getRect(i).width;if("flex"===a.display)return"column"===a.flexDirection||"column-reverse"===a.flexDirection?"vertical":"horizontal";if("grid"===a.display)return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&r.float&&"none"!==r.float){var d="left"===r.float?"left":"right";return!i||"both"!==s.clear&&s.clear!==d?"horizontal":"vertical"}return o&&("block"===r.display||"flex"===r.display||"table"===r.display||"grid"===r.display||c>=n&&"none"===a[Z]||i&&"none"===a[Z]&&c+u>n)?"vertical":"horizontal"},ae=function _prepareGroup(e){function toFn(e,t){return function(a,n,o,i){var r=a.options.group.name&&n.options.group.name&&a.options.group.name===n.options.group.name;if(null==e&&(t||r))return!0;if(null==e||!1===e)return!1;if(t&&"clone"===e)return e;if("function"==typeof e)return toFn(e(a,n,o,i),t)(a,n,o,i);var s=(t?a:n).options.group.name;return!0===e||"string"==typeof e&&e===s||e.join&&e.indexOf(s)>-1}}var t={},a=e.group;a&&"object"==_typeof(a)||(a={name:a}),t.name=a.name,t.checkPull=toFn(a.pull,!0),t.checkPut=toFn(a.put),t.revertClone=a.revertClone,e.group=t},ne=function _hideGhostForTarget(){!ee&&y&&css(y,"display","none")},oe=function _unhideGhostForTarget(){!ee&&y&&css(y,"display","")};K&&!r&&document.addEventListener("click",function(e){if(j)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),j=!1,!1},!0);var ie=function nearestEmptyInsertDetectEvent(e){if(b){var t=function _detectNearestEmptySortable(e,t){var a;return W.some(function(n){var o=n[d].options.emptyInsertThreshold;if(o&&!lastChild(n)){var i=getRect(n),r=e>=i.left-o&&e<=i.right+o,s=t>=i.top-o&&t<=i.bottom+o;return r&&s?a=n:void 0}}),a}((e=e.touches?e.touches[0]:e).clientX,e.clientY);if(t){var a={};for(var n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);a.target=a.rootEl=t,a.preventDefault=void 0,a.stopPropagation=void 0,t[d]._onDragOver(a)}}},re=function _checkOutsideTargetEl(e){b&&b.parentNode[d]._isOutsideThisEl(e.target)};function Sortable(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=_extends({},t),e[d]=this;var a={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function direction(){return te(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function setData(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Sortable.supportPointer&&"PointerEvent"in window&&!o,emptyInsertThreshold:5};for(var n in h.initializePlugins(this,e,a),a)!(n in t)&&(t[n]=a[n]);for(var i in ae(t),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&Q,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?on(e,"pointerdown",this._onTapStart):(on(e,"mousedown",this._onTapStart),on(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(on(e,"dragover",this),on(e,"dragenter",this)),W.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),_extends(this,AnimationStateManager())}function _onMove(e,n,o,i,r,s,c,u){var m,g,h=e[d],f=h.options.onMove;return!window.CustomEvent||t||a?(m=document.createEvent("Event")).initEvent("move",!0,!0):m=new CustomEvent("move",{bubbles:!0,cancelable:!0}),m.to=n,m.from=e,m.dragged=o,m.draggedRect=i,m.related=r||n,m.relatedRect=s||getRect(n),m.willInsertAfter=u,m.originalEvent=c,e.dispatchEvent(m),f&&(g=f.call(h,m,c)),g}function _disableDraggable(e){e.draggable=!1}function _unsilent(){V=!1}function _generateId(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,a=t.length,n=0;a--;)n+=t.charCodeAt(a);return n.toString(36)}function _nextTick(e){return setTimeout(e,0)}function _cancelNextTick(e){return clearTimeout(e)}Sortable.prototype={constructor:Sortable,_isOutsideThisEl:function _isOutsideThisEl(e){this.el.contains(e)||e===this.el||(F=null)},_getDirection:function _getDirection(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,b):this.options.direction},_onTapStart:function _onTapStart(e){if(e.cancelable){var t=this,a=this.el,n=this.options,i=n.preventOnFilter,r=e.type,s=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,c=(s||e).target,u=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||c,d=n.filter;if(function _saveInputCheckedState(e){U.length=0;var t=e.getElementsByTagName("input"),a=t.length;for(;a--;){var n=t[a];n.checked&&U.push(n)}}(a),!b&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||n.disabled)&&!u.isContentEditable&&(this.nativeDraggable||!o||!c||"SELECT"!==c.tagName.toUpperCase())&&!((c=closest(c,n.draggable,a,!1))&&c.animated||w===c)){if(D=index(c),I=index(c,n.draggable),"function"==typeof d){if(d.call(this,e,c,this))return _dispatchEvent({sortable:t,rootEl:u,name:"filter",targetEl:c,toEl:a,fromEl:a}),p("filter",t,{evt:e}),void(i&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some(function(n){if(n=closest(u,n.trim(),a,!1))return _dispatchEvent({sortable:t,rootEl:n,name:"filter",targetEl:c,fromEl:a,toEl:a}),p("filter",t,{evt:e}),!0})))return void(i&&e.cancelable&&e.preventDefault());n.handle&&!closest(u,n.handle,a,!1)||this._prepareDragStart(e,s,c)}}},_prepareDragStart:function _prepareDragStart(e,o,i){var r,s=this,c=s.el,u=s.options,d=c.ownerDocument;if(i&&!b&&i.parentNode===c){var m=getRect(i);if(k=c,v=(b=i).parentNode,S=b.nextSibling,w=i,P=u.group,Sortable.dragged=b,O={target:b,clientX:(o||e).clientX,clientY:(o||e).clientY},M=O.clientX-m.left,L=O.clientY-m.top,this._lastX=(o||e).clientX,this._lastY=(o||e).clientY,b.style["will-change"]="all",r=function dragStartFn(){p("delayEnded",s,{evt:e}),Sortable.eventCanceled?s._onDrop():(s._disableDelayedDragEvents(),!n&&s.nativeDraggable&&(b.draggable=!0),s._triggerDragStart(e,o),_dispatchEvent({sortable:s,name:"choose",originalEvent:e}),toggleClass(b,u.chosenClass,!0))},u.ignore.split(",").forEach(function(e){find(b,e.trim(),_disableDraggable)}),on(d,"dragover",ie),on(d,"mousemove",ie),on(d,"touchmove",ie),on(d,"mouseup",s._onDrop),on(d,"touchend",s._onDrop),on(d,"touchcancel",s._onDrop),n&&this.nativeDraggable&&(this.options.touchStartThreshold=4,b.draggable=!0),p("delayStart",this,{evt:e}),!u.delay||u.delayOnTouchOnly&&!o||this.nativeDraggable&&(a||t))r();else{if(Sortable.eventCanceled)return void this._onDrop();on(d,"mouseup",s._disableDelayedDrag),on(d,"touchend",s._disableDelayedDrag),on(d,"touchcancel",s._disableDelayedDrag),on(d,"mousemove",s._delayedDragTouchMoveHandler),on(d,"touchmove",s._delayedDragTouchMoveHandler),u.supportPointer&&on(d,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(r,u.delay)}}},_delayedDragTouchMoveHandler:function _delayedDragTouchMoveHandler(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function _disableDelayedDrag(){b&&_disableDraggable(b),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function _disableDelayedDragEvents(){var e=this.el.ownerDocument;off(e,"mouseup",this._disableDelayedDrag),off(e,"touchend",this._disableDelayedDrag),off(e,"touchcancel",this._disableDelayedDrag),off(e,"mousemove",this._delayedDragTouchMoveHandler),off(e,"touchmove",this._delayedDragTouchMoveHandler),off(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function _triggerDragStart(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?on(document,"pointermove",this._onTouchMove):on(document,t?"touchmove":"mousemove",this._onTouchMove):(on(b,"dragend",this),on(k,"dragstart",this._onDragStart));try{document.selection?_nextTick(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function _dragStarted(e,t){if(B=!1,k&&b){p("dragStarted",this,{evt:t}),this.nativeDraggable&&on(document,"dragover",re);var a=this.options;!e&&toggleClass(b,a.dragClass,!1),toggleClass(b,a.ghostClass,!0),Sortable.active=this,e&&this._appendGhost(),_dispatchEvent({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function _emulateDragOver(){if(N){this._lastX=N.clientX,this._lastY=N.clientY,ne();for(var e=document.elementFromPoint(N.clientX,N.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(N.clientX,N.clientY))!==t;)t=e;if(b.parentNode[d]._isOutsideThisEl(e),t)do{if(t[d]){if(t[d]._onDragOver({clientX:N.clientX,clientY:N.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);oe()}},_onTouchMove:function _onTouchMove(e){if(O){var t=this.options,a=t.fallbackTolerance,n=t.fallbackOffset,o=e.touches?e.touches[0]:e,i=y&&matrix(y,!0),r=y&&i&&i.a,s=y&&i&&i.d,c=J&&G&&getRelativeScrollOffset(G),u=(o.clientX-O.clientX+n.x)/(r||1)+(c?c[0]-X[0]:0)/(r||1),d=(o.clientY-O.clientY+n.y)/(s||1)+(c?c[1]-X[1]:0)/(s||1);if(!Sortable.active&&!B){if(a&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<a)return;this._onDragStart(e,!0)}if(y){i?(i.e+=u-(x||0),i.f+=d-(R||0)):i={a:1,b:0,c:0,d:1,e:u,f:d};var m="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");css(y,"webkitTransform",m),css(y,"mozTransform",m),css(y,"msTransform",m),css(y,"transform",m),x=u,R=d,N=o}e.cancelable&&e.preventDefault()}},_appendGhost:function _appendGhost(){if(!y){var e=this.options.fallbackOnBody?document.body:k,t=getRect(b,!0,J,!0,e),a=this.options;if(J){for(G=e;"static"===css(G,"position")&&"none"===css(G,"transform")&&G!==document;)G=G.parentNode;G!==document.body&&G!==document.documentElement?(G===document&&(G=getWindowScrollingElement()),t.top+=G.scrollTop,t.left+=G.scrollLeft):G=getWindowScrollingElement(),X=getRelativeScrollOffset(G)}toggleClass(y=b.cloneNode(!0),a.ghostClass,!1),toggleClass(y,a.fallbackClass,!0),toggleClass(y,a.dragClass,!0),css(y,"transition",""),css(y,"transform",""),css(y,"box-sizing","border-box"),css(y,"margin",0),css(y,"top",t.top),css(y,"left",t.left),css(y,"width",t.width),css(y,"height",t.height),css(y,"opacity","0.8"),css(y,"position",J?"absolute":"fixed"),css(y,"zIndex","100000"),css(y,"pointerEvents","none"),Sortable.ghost=y,e.appendChild(y),css(y,"transform-origin",M/parseInt(y.style.width)*100+"% "+L/parseInt(y.style.height)*100+"%")}},_onDragStart:function _onDragStart(e,t){var a=this,n=e.dataTransfer,i=a.options;p("dragStart",this,{evt:e}),Sortable.eventCanceled?this._onDrop():(p("setupClone",this),Sortable.eventCanceled||((E=clone(b)).removeAttribute("id"),E.draggable=!1,E.style["will-change"]="",this._hideClone(),toggleClass(E,this.options.chosenClass,!1),Sortable.clone=E),a.cloneId=_nextTick(function(){p("clone",a),Sortable.eventCanceled||(a.options.removeCloneOnHide||k.insertBefore(E,b),a._hideClone(),_dispatchEvent({sortable:a,name:"clone"}))}),!t&&toggleClass(b,i.dragClass,!0),t?(j=!0,a._loopId=setInterval(a._emulateDragOver,50)):(off(document,"mouseup",a._onDrop),off(document,"touchend",a._onDrop),off(document,"touchcancel",a._onDrop),n&&(n.effectAllowed="move",i.setData&&i.setData.call(a,n,b)),on(document,"drop",a),css(b,"transform","translateZ(0)")),B=!0,a._dragStartId=_nextTick(a._dragStarted.bind(a,t,e)),on(document,"selectstart",a),z=!0,o&&css(document.body,"user-select","none"))},_onDragOver:function _onDragOver(e){var t,a,n,o,i=this.el,r=e.target,s=this.options,c=s.group,u=Sortable.active,m=P===c,g=s.sort,h=A||u,f=this,w=!1;if(!V){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),r=closest(r,s.draggable,i,!0),dragOverEvent("dragOver"),Sortable.eventCanceled)return w;if(b.contains(e.target)||r.animated&&r.animatingX&&r.animatingY||f._ignoreWhileAnimating===r)return completed(!1);if(j=!1,u&&!s.disabled&&(m?g||(n=v!==k):A===this||(this.lastPutMode=P.checkPull(this,u,b,e))&&c.checkPut(this,u,b,e))){if(o="vertical"===this._getDirection(e,r),t=getRect(b),dragOverEvent("dragOverValid"),Sortable.eventCanceled)return w;if(n)return v=k,capture(),this._hideClone(),dragOverEvent("revert"),Sortable.eventCanceled||(S?k.insertBefore(b,S):k.appendChild(b)),completed(!0);var E=lastChild(i,s.draggable);if(!E||function _ghostIsLast(e,t,a){var n=getRect(lastChild(a.el,a.options.draggable)),o=10;return t?e.clientX>n.right+o||e.clientX<=n.right&&e.clientY>n.bottom&&e.clientX>=n.left:e.clientX>n.right&&e.clientY>n.top||e.clientX<=n.right&&e.clientY>n.bottom+o}(e,o,this)&&!E.animated){if(E===b)return completed(!1);if(E&&i===e.target&&(r=E),r&&(a=getRect(r)),!1!==_onMove(k,i,b,t,r,a,e,!!r))return capture(),E&&E.nextSibling?i.insertBefore(b,E.nextSibling):i.appendChild(b),v=i,changed(),completed(!0)}else if(E&&function _ghostIsFirst(e,t,a){var n=getRect(getChild(a.el,0,a.options,!0)),o=10;return t?e.clientX<n.left-o||e.clientY<n.top&&e.clientX<n.right:e.clientY<n.top-o||e.clientY<n.bottom&&e.clientX<n.left}(e,o,this)){var C=getChild(i,0,s,!0);if(C===b)return completed(!1);if(a=getRect(r=C),!1!==_onMove(k,i,b,t,r,a,e,!1))return capture(),i.insertBefore(b,C),v=i,changed(),completed(!0)}else if(r.parentNode===i){a=getRect(r);var D,I,O,N=b.parentNode!==i,x=!function _dragElInRowColumn(e,t,a){var n=a?e.left:e.top,o=a?e.right:e.bottom,i=a?e.width:e.height,r=a?t.left:t.top,s=a?t.right:t.bottom,c=a?t.width:t.height;return n===r||o===s||n+i/2===r+c/2}(b.animated&&b.toRect||t,r.animated&&r.toRect||a,o),R=o?"top":"left",M=isScrolledPast(r,"top","top")||isScrolledPast(b,"top","top"),L=M?M.scrollTop:void 0;if(F!==r&&(I=a[R],q=!1,Y=!x&&s.invertSwap||N),D=function _getSwapDirection(e,t,a,n,o,i,r,s){var c=n?e.clientY:e.clientX,u=n?a.height:a.width,d=n?a.top:a.left,m=n?a.bottom:a.right,g=!1;if(!r)if(s&&$<u*o){if(!q&&(1===H?c>d+u*i/2:c<m-u*i/2)&&(q=!0),q)g=!0;else if(1===H?c<d+$:c>m-$)return-H}else if(c>d+u*(1-o)/2&&c<m-u*(1-o)/2)return function _getInsertDirection(e){return index(b)<index(e)?1:-1}(t);if((g=g||r)&&(c<d+u*i/2||c>m-u*i/2))return c>d+u/2?1:-1;return 0}(e,r,a,o,x?1:s.swapThreshold,null==s.invertedSwapThreshold?s.swapThreshold:s.invertedSwapThreshold,Y,F===r),0!==D){var z=index(b);do{z-=D,O=v.children[z]}while(O&&("none"===css(O,"display")||O===y))}if(0===D||O===r)return completed(!1);F=r,H=D;var G=r.nextElementSibling,B=!1,W=_onMove(k,i,b,t,r,a,e,B=1===D);if(!1!==W)return 1!==W&&-1!==W||(B=1===W),V=!0,setTimeout(_unsilent,30),capture(),B&&!G?i.appendChild(b):r.parentNode.insertBefore(b,B?G:r),M&&scrollBy(M,0,L-M.scrollTop),v=b.parentNode,void 0===I||Y||($=Math.abs(I-getRect(r)[R])),changed(),completed(!0)}if(i.contains(b))return completed(!1)}return!1}function dragOverEvent(s,c){p(s,f,_objectSpread2({evt:e,isOwner:m,axis:o?"vertical":"horizontal",revert:n,dragRect:t,targetRect:a,canSort:g,fromSortable:h,target:r,completed,onMove:function onMove(a,n){return _onMove(k,i,b,t,a,getRect(a),e,n)},changed},c))}function capture(){dragOverEvent("dragOverAnimationCapture"),f.captureAnimationState(),f!==h&&h.captureAnimationState()}function completed(t){return dragOverEvent("dragOverCompleted",{insertion:t}),t&&(m?u._hideClone():u._showClone(f),f!==h&&(toggleClass(b,A?A.options.ghostClass:u.options.ghostClass,!1),toggleClass(b,s.ghostClass,!0)),A!==f&&f!==Sortable.active?A=f:f===Sortable.active&&A&&(A=null),h===f&&(f._ignoreWhileAnimating=r),f.animateAll(function(){dragOverEvent("dragOverAnimationComplete"),f._ignoreWhileAnimating=null}),f!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(r===b&&!b.animated||r===i&&!r.animated)&&(F=null),s.dragoverBubble||e.rootEl||r===document||(b.parentNode[d]._isOutsideThisEl(e.target),!t&&ie(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),w=!0}function changed(){_=index(b),T=index(b,s.draggable),_dispatchEvent({sortable:f,name:"change",toEl:i,newIndex:_,newDraggableIndex:T,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function _offMoveEvents(){off(document,"mousemove",this._onTouchMove),off(document,"touchmove",this._onTouchMove),off(document,"pointermove",this._onTouchMove),off(document,"dragover",ie),off(document,"mousemove",ie),off(document,"touchmove",ie)},_offUpEvents:function _offUpEvents(){var e=this.el.ownerDocument;off(e,"mouseup",this._onDrop),off(e,"touchend",this._onDrop),off(e,"pointerup",this._onDrop),off(e,"touchcancel",this._onDrop),off(document,"selectstart",this)},_onDrop:function _onDrop(e){var t=this.el,a=this.options;_=index(b),T=index(b,a.draggable),p("drop",this,{evt:e}),v=b&&b.parentNode,_=index(b),T=index(b,a.draggable),Sortable.eventCanceled||(B=!1,Y=!1,q=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_cancelNextTick(this.cloneId),_cancelNextTick(this._dragStartId),this.nativeDraggable&&(off(document,"drop",this),off(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),o&&css(document.body,"user-select",""),css(b,"transform",""),e&&(z&&(e.cancelable&&e.preventDefault(),!a.dropBubble&&e.stopPropagation()),y&&y.parentNode&&y.parentNode.removeChild(y),(k===v||A&&"clone"!==A.lastPutMode)&&E&&E.parentNode&&E.parentNode.removeChild(E),b&&(this.nativeDraggable&&off(b,"dragend",this),_disableDraggable(b),b.style["will-change"]="",z&&!B&&toggleClass(b,A?A.options.ghostClass:this.options.ghostClass,!1),toggleClass(b,this.options.chosenClass,!1),_dispatchEvent({sortable:this,name:"unchoose",toEl:v,newIndex:null,newDraggableIndex:null,originalEvent:e}),k!==v?(_>=0&&(_dispatchEvent({rootEl:v,name:"add",toEl:v,fromEl:k,originalEvent:e}),_dispatchEvent({sortable:this,name:"remove",toEl:v,originalEvent:e}),_dispatchEvent({rootEl:v,name:"sort",toEl:v,fromEl:k,originalEvent:e}),_dispatchEvent({sortable:this,name:"sort",toEl:v,originalEvent:e})),A&&A.save()):_!==D&&_>=0&&(_dispatchEvent({sortable:this,name:"update",toEl:v,originalEvent:e}),_dispatchEvent({sortable:this,name:"sort",toEl:v,originalEvent:e})),Sortable.active&&(null!=_&&-1!==_||(_=D,T=I),_dispatchEvent({sortable:this,name:"end",toEl:v,originalEvent:e}),this.save())))),this._nulling()},_nulling:function _nulling(){p("nulling",this),k=b=v=y=S=E=w=C=O=N=z=_=T=D=I=F=H=A=P=Sortable.dragged=Sortable.ghost=Sortable.clone=Sortable.active=null,U.forEach(function(e){e.checked=!0}),U.length=x=R=0},handleEvent:function handleEvent(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":b&&(this._onDragOver(e),function _globalDragOver(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function toArray(){for(var e,t=[],a=this.el.children,n=0,o=a.length,i=this.options;n<o;n++)closest(e=a[n],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||_generateId(e));return t},sort:function sort(e,t){var a={},n=this.el;this.toArray().forEach(function(e,t){var o=n.children[t];closest(o,this.options.draggable,n,!1)&&(a[e]=o)},this),t&&this.captureAnimationState(),e.forEach(function(e){a[e]&&(n.removeChild(a[e]),n.appendChild(a[e]))}),t&&this.animateAll()},save:function save(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function closest$1(e,t){return closest(e,t||this.options.draggable,this.el,!1)},option:function option(e,t){var a=this.options;if(void 0===t)return a[e];var n=h.modifyOption(this,e,t);a[e]=void 0!==n?n:t,"group"===e&&ae(a)},destroy:function destroy(){p("destroy",this);var e=this.el;e[d]=null,off(e,"mousedown",this._onTapStart),off(e,"touchstart",this._onTapStart),off(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(off(e,"dragover",this),off(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),W.splice(W.indexOf(this.el),1),this.el=e=null},_hideClone:function _hideClone(){if(!C){if(p("hideClone",this),Sortable.eventCanceled)return;css(E,"display","none"),this.options.removeCloneOnHide&&E.parentNode&&E.parentNode.removeChild(E),C=!0}},_showClone:function _showClone(e){if("clone"===e.lastPutMode){if(C){if(p("showClone",this),Sortable.eventCanceled)return;b.parentNode!=k||this.options.group.revertClone?S?k.insertBefore(E,S):k.appendChild(E):k.insertBefore(E,b),this.options.group.revertClone&&this.animate(b,E),css(E,"display",""),C=!1}}else this._hideClone()}},K&&on(document,"touchmove",function(e){(Sortable.active||B)&&e.cancelable&&e.preventDefault()}),Sortable.utils={on,off,css,find,is:function is(e,t){return!!closest(e,t,e,!1)},extend:function extend(e,t){if(e&&t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e},throttle,closest,toggleClass,clone,index,nextTick:_nextTick,cancelNextTick:_cancelNextTick,detectDirection:te,getChild},Sortable.get=function(e){return e[d]},Sortable.mount=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t[0].constructor===Array&&(t=t[0]),t.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Sortable.utils=_objectSpread2(_objectSpread2({},Sortable.utils),e.utils)),h.mount(e)})},Sortable.create=function(e,t){return new Sortable(e,t)},Sortable.version="1.15.0";var se,ce,le,ue=[];function clearAutoScrolls(){ue.forEach(function(e){clearInterval(e.pid)}),ue=[]}throttle(function(e,t,a,n){if(t.scroll){var o,i=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,s=t.scrollSensitivity,c=t.scrollSpeed,u=getWindowScrollingElement(),m=!1;ce!==a&&(ce=a,clearAutoScrolls(),se=t.scroll,o=t.scrollFn,!0===se&&(se=getParentAutoScrollElement(a,!0)));var g=0,h=se;do{var f=h,p=getRect(f),b=p.top,v=p.bottom,y=p.left,k=p.right,S=p.width,w=p.height,E=void 0,C=void 0,D=f.scrollWidth,_=f.scrollHeight,I=css(f),T=f.scrollLeft,P=f.scrollTop;f===u?(E=S<D&&("auto"===I.overflowX||"scroll"===I.overflowX||"visible"===I.overflowX),C=w<_&&("auto"===I.overflowY||"scroll"===I.overflowY||"visible"===I.overflowY)):(E=S<D&&("auto"===I.overflowX||"scroll"===I.overflowX),C=w<_&&("auto"===I.overflowY||"scroll"===I.overflowY));var A=E&&(Math.abs(k-i)<=s&&T+S<D)-(Math.abs(y-i)<=s&&!!T),O=C&&(Math.abs(v-r)<=s&&P+w<_)-(Math.abs(b-r)<=s&&!!P);if(!ue[g])for(var N=0;N<=g;N++)ue[N]||(ue[N]={});ue[g].vx==A&&ue[g].vy==O&&ue[g].el===f||(ue[g].el=f,ue[g].vx=A,ue[g].vy=O,clearInterval(ue[g].pid),0==A&&0==O||(m=!0,ue[g].pid=setInterval(function(){n&&0===this.layer&&Sortable.active._onTouchMove(le);var t=ue[this.layer].vy?ue[this.layer].vy*c:0,a=ue[this.layer].vx?ue[this.layer].vx*c:0;"function"==typeof o&&"continue"!==o.call(Sortable.dragged.parentNode[d],a,t,e,le,ue[this.layer].el)||scrollBy(ue[this.layer].el,a,t)}.bind({layer:g}),24))),g++}while(t.bubbleScroll&&h!==u&&(h=getParentAutoScrollElement(h,!1)));0}},30);var de=function drop(e){var t=e.originalEvent,a=e.putSortable,n=e.dragEl,o=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,s=e.unhideGhostForTarget;if(t){var c=a||o;r();var u=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(u.clientX,u.clientY);s(),c&&!c.el.contains(d)&&(i("spill"),this.onSpill({dragEl:n,putSortable:a}))}};function Revert(){}function Remove(){}Revert.prototype={startIndex:null,dragStart:function dragStart(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function onSpill(e){var t=e.dragEl,a=e.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var n=getChild(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),a&&a.animateAll()},drop:de},_extends(Revert,{pluginName:"revertOnSpill"}),Remove.prototype={onSpill:function onSpill(e){var t=e.dragEl,a=e.putSortable||this.sortable;a.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),a.animateAll()},drop:de},_extends(Remove,{pluginName:"removeOnSpill"});const me=Sortable;class AttributesConfig extends FormApplication{constructor(){super()}static get defaultOptions(){return{...super.defaultOptions,title:game.i18n.localize(`${he}.settings.attributesMenu.name`),id:"combat-dock-attributes-config",template:"modules/combat-tracker-dock/templates/attributes-config.hbs",popOut:!0,width:500}}getData(){const e=TokenDocument.implementation.getTrackedAttributes();e.bar.forEach(e=>e.push("value"));const t=TokenDocument.implementation.getTrackedAttributeChoices(e);return{attributes:game.settings.get(he,"attributes"),attributeChoices:t}}activateListeners(e){super.activateListeners(e),e[0].querySelector("#add").addEventListener("click",this._onAdd.bind(this)),e[0].querySelector("#reset").addEventListener("click",this._onReset.bind(this)),e[0].querySelectorAll(".attributePicker").forEach(e=>{e.addEventListener("change",e=>{const t=e.target.value;e.target.closest(".form-group").querySelector(".attr").value=t})}),me.create(e[0].querySelector("ul"),{animation:200,filter:"input",preventOnFilter:!1})}async _onAdd(e){e.preventDefault(),await this._saveData();const t=game.settings.get(he,"attributes");t.push({attr:"",icon:"",units:""}),await game.settings.set(he,"attributes",t),this.render(!0)}async _onReset(e){e.preventDefault(),Dialog.confirm({title:game.i18n.localize(`${he}.settings.attributesMenu.reset`),content:game.i18n.localize(`${he}.settings.attributesMenu.resetWarning`),yes:async()=>{const e=game.settings.settings.get("combat-tracker-dock.attributes").default;await game.settings.set(he,"attributes",e),this.render(!0)}})}async _saveData(){let e=this._getSubmitData();e=e.filter(e=>""!==e.attr),await game.settings.set(he,"attributes",e)}async _onSubmit(e){e.preventDefault(),await this._saveData(),this.close()}_getSubmitData(){let e=[];const t=this.element[0].querySelectorAll("li");for(let a=0;a<t.length;a++){const n=t[a].querySelector(".attr").value,o=t[a].querySelector(".icon").value,i=t[a].querySelector(".units").value;e.push({attr:n,icon:o,units:i})}return e}}function defaultAttributesConfig(){return{dnd5e:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.ac.value",icon:"fas fa-shield",units:"AC"},{attr:"attributes.movement.walk",icon:"fas fa-person-running-fast",units:"ft."},{attr:"attributes.spell.dc",icon:"fas fa-hand-holding-magic",units:"Spell DC"},{attr:"resources.legact.value",icon:"far fa-bolt-lightning",units:""},{attr:"resources.legres.value",icon:"fas fa-shield-cross",units:""},{attr:"resources.lair.value",icon:"fa-solid fa-dungeon",units:""}],dnd4e:[{attr:"defences.ac.value",icon:"fas fa-shield",units:game.i18n.localize("DND4E.DefAC")},{attr:"defences.fort.value",icon:"fas fa-heart-pulse",units:game.i18n.localize("DND4E.DefFort")},{attr:"defences.ref.value",icon:"fas fa-rabbit-running",units:game.i18n.localize("DND4E.DefRef")},{attr:"defences.wil.value",icon:"fas fa-brain",units:game.i18n.localize("DND4E.DefWil")},{attr:"attributes.init.value",icon:"fas fa-traffic-light-go",units:game.i18n.localize("DND4E.Init")},{attr:"movement.walk.value",icon:"fas fa-person-running",units:game.i18n.localize("DND4E.Speed")},{attr:"attributes.hp.max",icon:"fas fa-heart",units:game.i18n.localize("DND4E.HPShort")},{attr:"details.bloodied",icon:"fas fa-heart-half-stroke",units:null}],"cyberpunk-red-core":[{attr:"derivedStats.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"derivedStats.walk.value",icon:"fas fa-person-running",units:"m/ft"},{attr:"derivedStats.run.value",icon:"fas fa-person-running-fast",units:"m/ft"},{attr:"externalData.currentArmorHead.value",icon:"fas fa-helmet-safety",units:"SP"},{attr:"externalData.currentArmorBody.value",icon:"fas fa-shirt-tank-top",units:"SP"}],swade:[{attr:"wounds.value",icon:"fas fa-heart",units:game.i18n.localize("SWADE.Wounds")},{attr:"fatigue.value",icon:"fas fa-face-hand-yawn",units:game.i18n.localize("SWADE.Fatigue")},{attr:"bennies.value",icon:"fas fa-bullseye",units:game.i18n.localize("SWADE.Bennies")},{attr:"stats.speed.value",icon:"fas fa-person-running",units:game.i18n.localize("SWADE.Pace")},{attr:"stats.parry.value",icon:"fas fa-swords",units:game.i18n.localize("SWADE.Parry")},{attr:"stats.toughness.value",icon:"fas fa-shield",units:game.i18n.localize("SWADE.Tough")},{attr:"stats.toughness.armor",icon:"fas fa-helmet-battle",units:game.i18n.localize("SWADE.Armor")}],pirateborg:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.luck.value",icon:"fas fa-clover",units:"Devil's Luck"},{attr:"attributes.rituals.value",icon:"fas fa-ankh",units:"Rituals"}],cyphersystem:[{attr:"pools.might.value",icon:"fas fa-hand-fist",units:"Might"},{attr:"pools.speed.value",icon:"fas fa-person-running",units:"Speed"},{attr:"pools.intellect.value",icon:"fas fa-brain",units:"Intellect"},{attr:"combat.damageTrack.state",icon:"fas fa-heart",units:""},{attr:"pools.health.value",icon:"fas fa-heart",units:"Health"},{attr:"combat.armor",icon:"fas fa-shield",units:"Armor"},{attr:"combat.damage",icon:"fas fa-axe-battle",units:"Damage"}],pf2e:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.ac.value",icon:"fas fa-shield",units:"AC"},{attr:"attributes.speed.value",icon:"systems/pf2e/icons/default-icons/action.svg",units:"ft."},{attr:"attributes.spellDC.value",icon:"fas fa-hand-holding-magic",units:"Spell DC"},{attr:"attributes.shield.hp.value",icon:"fas fa-shield",units:"Shield HP"}],pf1:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"},{attr:"attributes.ac.normal.total",icon:"fas fa-shield",units:"AC"},{attr:"attributes.ac.touch.total",icon:"fas fa-shield-slash",units:"Touch AC"},{attr:"attributes.ac.flatFooted.total",icon:"fas fa-circle-exclamation",units:"Flat Footed AC"},{attr:"attributes.cmd.total",icon:"fas fa-hand-fist",units:"CMD"},{attr:"attributes.cmd.flatFootedTotal",icon:"fas fa-person-circle-exclamation",units:"Flat Footed CMD"},{attr:"attributes.sr.total",icon:"fas fa-hand-holding-magic",units:"Spell Resistance"},{attr:"attributes.speed.land.total",icon:"fas fa-person-running",units:"ft."}],crucible:[{attr:"resources.health.value",icon:"fa-solid fa-heart",units:""},{attr:"resources.morale.value",icon:"fa-solid fa-brain",units:""},{attr:"resources.action.value",icon:"fa-solid fa-hand-fist",units:""},{attr:"resources.focus.value",icon:"fa-solid fa-hand-holding-magic",units:""},{attr:"resources.wounds.value",icon:"fa-solid fa-droplet",units:""},{attr:"resources.madness.value",icon:"fa-solid fa-head-side-brain",units:""}],wfrp4e:[{attr:"status.wounds.value",icon:"fa-thin fa-heart",units:game.i18n.localize("Wounds")},{attr:"status.advantage.value",icon:"fa-thin fa-swords",units:game.i18n.localize("Advantage")},{attr:"status.fortune.value",icon:"fa-thin fa-clover",units:game.i18n.localize("Fortune")},{attr:"status.resolve.value",icon:"fa-thin fa-face-pouting",units:game.i18n.localize("Resolve")},{attr:"details.move.run",icon:"fa-thin fa-person-running",units:game.i18n.localize("yds")}],alienrpg:[{attr:"header.health.value",icon:"fas fa-heart",units:game.i18n.localize("ALIENRPG.Health")},{attr:"header.stress.value",icon:"fas fa-face-scream",units:game.i18n.localize("ALIENRPG.Stress")},{attr:"general.armor.value",icon:"fas fa-shield",units:game.i18n.localize("ALIENRPG.Armor")},{attr:"attributes.speed.value",icon:"fas fa-person-running",units:game.i18n.localize("ALIENRPG.Speed")},{attr:"general.mobility.value",icon:"fas fa-user-ninja",units:game.i18n.localize("ALIENRPG.Skillmobility")},{attr:"general.observation.value",icon:"fas fa-eye",units:game.i18n.localize("ALIENRPG.Skillobservation")},{attr:"attributes.armorrating.value",icon:"fas fa-shield",units:game.i18n.localize("ALIENRPG.ArmorRating")},{attr:"attributes.hull.value",icon:"fas fa-shuttle-space",units:game.i18n.localize("ALIENRPG.HULL")},{attr:"attributes.armor.value",icon:"fas fa-shield",units:game.i18n.localize("ALIENRPG.SHIP-ARMOR")},{attr:"attributes.thrusters.value",icon:"fas fa-rocket-launch",units:game.i18n.localize("ALIENRPG.THRUSTERS")},{attr:"attributes.signature.value",icon:"fas fa-satellite-dish",units:game.i18n.localize("ALIENRPG.SIGNATURE")}],exaltedthird:[{attr:"health.value",icon:"fas fa-heart",units:game.i18n.localize("Ex3.Health")},{attr:"evasion.value",icon:"fas fa-rabbit-running",units:game.i18n.localize("Ex3.Evasion")},{attr:"parry.value",icon:"fas fa-swords",units:game.i18n.localize("Ex3.Parry")},{attr:"soak.value",icon:"fas fa-shield",units:game.i18n.localize("Ex3.Soak")},{attr:"hardness.value",icon:"fas fa-heart",units:game.i18n.localize("Ex3.Hardness")},{attr:"willpower.value",icon:"fas fa-hand-fist",units:game.i18n.localize("Ex3.Willpower")},{attr:"anima.value",icon:"fas fa-sun",units:game.i18n.localize("Ex3.Anima")}],exaltedessence:[{attr:"health.value",icon:"fas fa-heart",units:game.i18n.localize("ExEss.Health")},{attr:"evasion.value",icon:"fas fa-rabbit-running",units:game.i18n.localize("ExEss.Evasion")},{attr:"parry.value",icon:"fas fa-swords",units:game.i18n.localize("ExEss.Parry")},{attr:"soak.value",icon:"fas fa-shield",units:game.i18n.localize("ExEss.Soak")},{attr:"hardness.value",icon:"fas fa-heart",units:game.i18n.localize("ExEss.Hardness")},{attr:"power.value",icon:"fas fa-hand-fist",units:game.i18n.localize("ExEss.Power")},{attr:"will.value",icon:"fas fa-hand-sparkles",units:game.i18n.localize("ExEss.Will")},{attr:"anima.value",icon:"fas fa-sun",units:game.i18n.localize("ExEss.Anima")}],swnr:[{attr:"health.value",icon:"fas fa-heart",units:game.i18n.localize("swnr.sheet.hp")},{attr:"ac",icon:"fas fa-shield",units:game.i18n.localize("swnr.sheet.ac")},{attr:"speed",icon:"fas fa-person-running-fast",units:"m"},{attr:"save.physical",icon:"fas fa-hand-fist",units:game.i18n.localize("swnr.sheet.vs")},{attr:"save.evasion",icon:"fas fa-feather-pointed",units:game.i18n.localize("swnr.sheet.vs")},{attr:"save.mental",icon:"fas fa-brain",units:game.i18n.localize("swnr.sheet.vs")}],wwn:[{attr:"hp.value",icon:"fas fa-heart",units:"Hit Points"},{attr:"details.strain.value",icon:"fas fa-ankh",units:"System Strain"},{attr:"aac.value",icon:"fas fa-shield",units:"Armor Class"},{attr:"movement.base",icon:"fas fa-person-running",units:"ft. Movement"},{attr:"saves.evasion.value",icon:"fas fa-bullseye",units:"Evasion Save"},{attr:"saves.mental.value",icon:"fas fa-brain",units:"Mental Save"},{attr:"saves.physical.value",icon:"fas fa-hand-fist",units:"Physical Save"},{attr:"saves.luck.value",icon:"fas fa-star",units:"Luck Save"}],ars:[{attr:"attributes.hp.value",icon:"fas fa-heart",units:"Hit Points"},{attr:"attributes.ac.value",icon:"fas fa-shield",units:"Armor Class"},{attr:"attributes.movement.value",icon:"fas fa-person-running",units:"Movement"},{attr:"attributes.thaco.value",icon:"fas fa-swords",units:"THAC0"}],lancer:[{attr:"hp.value",icon:"mdi mdi-heart-outline",units:""},{attr:"structure.value",icon:"cci cci-structure",units:""},{attr:"heat.value",icon:"cci cci-heat",units:""},{attr:"stress.value",icon:"cci cci-reactor",units:""}],dc20rpg:[{attr:"resources.health.value",icon:"fas fa-heart",units:"HP"},{attr:"resources.mana.value",icon:"fas fa-star",units:"MP"},{attr:"resources.stamina.value",icon:"fas fa-hand-fist",units:"SP"},{attr:"defences.physical.value",icon:"fas fa-shield",units:"PD"},{attr:"defences.mystical.value",icon:"fas fa-wand-magic-sparkles",units:"MD"},{attr:"movement.ground.value",icon:"fas fa-person-walking",units:"Spaces"}],shadowdark:[{attr:"attributes.ac.value",icon:"fas fa-shield",units:"AC"},{attr:"attributes.hp.value",icon:"fas fa-heart",units:"HP"}]}}function generateDescription(e){const{type:t,system:a}=e;switch(game.system.id){case"dnd5e":const n="character"===t;if("npc"===t){const t=game.i18n.localize(CONFIG.DND5E.creatureTypes[e.system.details.type.value]?.label??e.system.details.type.custom);return`CR ${a.details.cr>=1||a.details.cr<=0?a.details.cr:"1/"+1/a.details.cr} ${t}`}if(n){const t=Object.values(e.classes).map(e=>e.name).join(" / ");return`Level ${a.details.level} ${t} (${a.details.race})`}return null;case"dnd4e":switch(t){case"Player Character":return`${game.i18n.localize("DND4E.Level")} ${a.details.level} ${a.details.race} ${a.details.class} (${a.details.alignment})`;case"NPC":return`${CONFIG.DND4E.actorSizes[e.system.details.size]?.label} ${CONFIG.DND4E.creatureOrigin[e.system.details.origin]?.label} ${CONFIG.DND4E.creatureType[e.system.details.type]?.label}`;default:return null}case"swade":if(a?.wildcard)return`${game.i18n.localize("SWADE.WildCard")}`;switch(t){case"character":case"npc":return`${game.i18n.localize("SWADE.Extra")}`;case"vehicle":return game.i18n.localize("TYPES.Actor.vehicle");default:return null}case"pirateborg":switch(t){case"character":const t=[e.characterClass?.name||"Character"];return e.characterBaseClass?.name&&t.push(e.characterBaseClass.name),t.join(" - ");case"creature":return"Creature";case"vehicle":case"vehicle_npc":return"Ship";default:return null}case"cyphersystem":switch(t){case"pc":return"Character";case"npc":return"Creature";case"companion":return"Companion";case"community":return"Community";case"vehicle":return"Vehicle";case"marker":return"Marker";default:return null}case"pf2e":return"character"===t?`Level ${a.details.level.value} ${a.details.class.name} (${a.details.ancestry.name})`:null;case"crucible":if("hero"===e.type)return`${a.details.ancestry.name} ${a.details.background.name} ${a.details.signatureName?`(${a.details.signatureName})`:""}`;if("adversary"===e.type)return`${a.details.taxonomy.name} ${a.details.archetype.name} (${game.i18n.localize("ADVANCEMENT.Level")} ${a.details.level} ${game.i18n.localize("ADVERSARY.Threat"+a.details.threat.charAt(0).toUpperCase()+a.details.threat.slice(1))})`;case"wfrp4e":switch(t){case"character":return`${e.Species} ${e.currentCareer.name}`;case"npc":const t=e.itemTypes.career.length-1;if(t<0)return`${e.Species}`;{const a=Object.values(e.itemTypes.career).map(e=>e.name)[t];return`${e.Species} ${a}`}case"creature":return`${e.Species}`;default:return null}case"alienrpg":switch(t){case"character":let t;if(1==a.general.career.value?t=game.i18n.localize("ALIENRPG.ColonialMarine"):2==a.general.career.value?t=game.i18n.localize("ALIENRPG.ColonialMarshal"):3==a.general.career.value?t=game.i18n.localize("ALIENRPG.CompanyAgent"):4==a.general.career.value?t=game.i18n.localize("ALIENRPG.Kid"):5==a.general.career.value?t=game.i18n.localize("ALIENRPG.Medic"):6==a.general.career.value?t=game.i18n.localize("ALIENRPG.Mercenary"):7==a.general.career.value?t=game.i18n.localize("ALIENRPG.Officer"):8==a.general.career.value?t=game.i18n.localize("ALIENRPG.Pilot"):9==a.general.career.value?t=game.i18n.localize("ALIENRPG.Roughneck"):10==a.general.career.value?t=game.i18n.localize("ALIENRPG.Scientist"):11==a.general.career.value?t=game.i18n.localize("ALIENRPG.Synthetic"):12==a.general.career.value&&(t=game.i18n.localize("ALIENRPG.Homebrew")),0==e.itemTypes.specialty.length)return`${t}`;if(1==e.itemTypes.specialty.length){return`${t}: ${Object.values(e.itemTypes.specialty).map(e=>e.name)[0]}`}case"synthetic":let n;if(1==a.general.career.value?n=game.i18n.localize("ALIENRPG.ColonialMarine"):2==a.general.career.value?n=game.i18n.localize("ALIENRPG.ColonialMarshal"):3==a.general.career.value?n=game.i18n.localize("ALIENRPG.CompanyAgent"):4==a.general.career.value?n=game.i18n.localize("ALIENRPG.Kid"):5==a.general.career.value?n=game.i18n.localize("ALIENRPG.Medic"):6==a.general.career.value?n=game.i18n.localize("ALIENRPG.Mercenary"):7==a.general.career.value?n=game.i18n.localize("ALIENRPG.Officer"):8==a.general.career.value?n=game.i18n.localize("ALIENRPG.Pilot"):9==a.general.career.value?n=game.i18n.localize("ALIENRPG.Roughneck"):10==a.general.career.value?n=game.i18n.localize("ALIENRPG.Scientist"):11==a.general.career.value?n=game.i18n.localize("ALIENRPG.Synthetic"):12==a.general.career.value&&(n=game.i18n.localize("ALIENRPG.Homebrew")),0==e.itemTypes.specialty.length)return`${n}`;if(1==e.itemTypes.specialty.length){return`${n}: ${Object.values(e.itemTypes.specialty).map(e=>e.name)[0]}`}case"spacecraft":return`${game.i18n.localize("ALIENRPG.MODEL")}: ${a.attributes.model}`;default:return null}case"exaltedthird":switch(t){case"character":case"npc":return`${game.i18n.localize("Ex3.Essence")} ${a.essence.value}`;default:return null}case"exaltedessence":switch(t){case"character":case"npc":return`${game.i18n.localize("ExEss.Essence")} ${a.essence.value}`;default:return null}case"swnr":switch(t){case"character":return`${game.i18n.localize("swnr.sheet.level")} ${a.level.value} ${a.background} ${a.class}`;case"npc":return"NPC";case"vehicle":return"Vehicle";case"ship":return"Ship";case"drone":return"Drone";case"mech":return"Mech";default:return null}case"wwn":switch(t){case"Character":return`Level ${a.details.level} ${a.details.background} ${a.details.class}`;case"Faction":return"Faction";case"Monster":return`${a.hp.hd} hit dice Monster`;default:return null}case"ars":switch(t){case"character":return"Player Character";case"lootable":return"Loot";case"merchant":return"Merchant";case"npc":return"Non-Player-Character";default:return null}case"lancer":return game.lancer.combatTrackerDock?.generateDescription(e);case"shadowdark":switch(t){case"Player":case"NPC":return`Level: ${a.level.value}`;default:return null}}}function getSystemIcons(e){switch(game.system.id){case"dnd5e":if(game.modules.get("midi-qol")?.active&&e.actor){const getMidiFlag=t=>(e.actor.getFlag("midi-qol","actions")??{})[t]??!1,toggleMidiFlag=t=>{const a=e.actor.getFlag("midi-qol","actions")??{};a[t]=!a[t],e.actor.setFlag("midi-qol","actions",a)};return[{icon:"fas fa-circle",color:getMidiFlag("action")?"#888888":"green",enabled:!0,callback:e.isOwner?()=>toggleMidiFlag("action"):null},{icon:"fas fa-triangle",color:getMidiFlag("bonus")?"#888888":"#ff9f4c",enabled:!0,callback:e.isOwner?()=>toggleMidiFlag("bonus"):null},{icon:"fas fa-sparkle",color:getMidiFlag("reaction")?"#888888":"#e16de1",enabled:!0,callback:e.isOwner?()=>toggleMidiFlag("reaction"):null}]}return[{icon:"fas fa-circle",color:e.getFlag(he,"action")??1?"green":"#888888",enabled:!0,callback:e.isOwner?(e,t,a,n)=>{t.setFlag(he,"action",!(t.getFlag(he,"action")??1))}:null},{icon:"fas fa-triangle",color:e.getFlag(he,"bonus")??1?"#ff9f4c":"#888888",enabled:!0,callback:e.isOwner?(e,t,a,n)=>{t.setFlag(he,"bonus",!(t.getFlag(he,"bonus")??1))}:null},{icon:"fas fa-sparkle",color:e.getFlag(he,"reaction")??1?"#e16de1":"#888888",enabled:!0,callback:e.isOwner?(e,t,a,n)=>{t.setFlag(he,"reaction",!(t.getFlag(he,"reaction")??1))}:null}];case"crucible":{const t=e.actor?.system,a=function getSystemSetting(e){return game.settings.get(he,game.system.id+"."+e)}("alwaysShowActions")||void 0,n={value:t.resources.action.value,max:t.resources.action.max},o={value:t.resources.focus.value,max:t.resources.focus.max},i=[];for(let e=0;e<n.max;e++)i.push({icon:"fas fa-square",color:"#ff6400",enabled:n.value>0,visible:a}),n.value--;for(let e=0;e<o.max;e++)i.push({icon:"fas fa-sparkle",color:"#00bbff",enabled:o.value>0}),o.value--;return i}case"alienrpg":if(game.modules.get("alien-actions")?.active&&e.actor&&"spacecraft"!==e.actor.type)return[{icon:"fas fa-play",fontSize:"1rem",enabled:!0,callback:e.isOwner?(e,t)=>{t.actor.getActiveTokens().forEach(e=>e.toggleEffect(CONFIG.statusEffects.find(e=>"slowAction"===e.id)))}:null},{icon:"fas fa-forward",fontSize:"1rem",enabled:!0,callback:e.isOwner?(e,t)=>{t.actor.getActiveTokens().forEach(e=>e.toggleEffect(CONFIG.statusEffects.find(e=>"fastAction"===e.id)))}:null}];case"lancer":return game.lancer.combatTrackerDock?.getSystemIcons(e)??[];default:return[]}}function registerSystemSettings(){if("crucible"===game.system.id)!function registerSystemSetting(e,t){const a=he+".settings.systems."+game.system.id;game.settings.register(he,game.system.id+"."+e,{...t,name:game.system.title+" "+l(he+".settings.integration")+": "+l(a+"."+e+".name"),hint:l(a+"."+e+".hint")})}("alwaysShowActions",{scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.combatDock?.refresh()})}function setPortraitAspect(){const e=game.settings.get(he,"portraitAspect");document.documentElement.style.setProperty("--combatant-portrait-aspect",e)}function setAlignment(){const e=game.settings.get(he,"alignment");document.documentElement.style.setProperty("--carousel-alignment",e),ui.combatDock?.setControlsOrder()}function setPortraitImageBorder(){let e=game.settings.get(he,"portraitImageBorder");document.documentElement.style.setProperty("--combatant-portrait-image-border",`url('${e}')`)}function setPortraitImageBackground(){let e=game.settings.get(he,"portraitImageBackground");document.documentElement.style.setProperty("--combatant-portrait-image-background",`url('${e}')`)}function setHideConflictingUIs(){const e=game.settings.get(he,"hideConflictingUIs");document.querySelector("#ui-top")?.classList.toggle("ctd-hide-conflicting-uis",e)}function setRoundness(){const e=game.settings.get(he,"roundness");document.documentElement.style.setProperty("--combatant-portrait-border-radius",e)}function setAttributeColor(){const e=game.settings.get(he,"attributeColor")||"#41AA7D";document.documentElement.style.setProperty("--attribute-bar-primary-color",e);const t=Color.from(e).mix(Color.from("#000"),.5);document.documentElement.style.setProperty("--attribute-bar-secondary-color",t.toString());const a=game.settings.get(he,"attributeColor2")||"#ffcd00";document.documentElement.style.setProperty("--attribute-bar-primary-color2",a);const n=Color.from(a).mix(Color.from("#000"),.5);document.documentElement.style.setProperty("--attribute-bar-secondary-color2",n.toString());const o=game.settings.get(he,"attributeColorPortrait")||"#e62121";document.documentElement.style.setProperty("--attribute-bar-portrait-color",o)}function setTooltipColor(){const e=game.settings.get(he,"tooltipColor")||"#888888";document.documentElement.style.setProperty("--carousel-tooltip-color",e);const t=Color.from(e).mix(Color.from("#000"),.65);document.documentElement.style.setProperty("--carousel-tooltip-bg-color",t.toString())}function setOverflowStyle(){let e=game.settings.get(he,"overflowStyle");if("autofit"===e&&(e="hidden"),"scroll"===e){e="columnFloat"!==game.settings.get(he,"direction")?"visible hidden":"hidden visible"}document.documentElement.style.setProperty("--carousel-overflow",e)}function setDirection(){const e=game.settings.get(he,"direction");document.documentElement.style.setProperty("--carousel-direction","columnFloat"===e?"column":"row"),document.documentElement.style.setProperty("--combatant-portrait-margin","columnFloat"!==e?"0 calc(var(--combatant-portrait-size) * 0.1)":"0"),ui.combatDock?.setControlsOrder()}function setFlex(){const e=game.settings.get(he,"alignment"),t=game.settings.get(he,"direction");let a="flex-start";"columnFloat"==t&&"right"==e&&(a="flex-end"),"columnFloat"==t&&"center"==e&&(a="center"),document.documentElement.style.setProperty("--carousel-align-items",a)}function l(e){return game.i18n.localize(e)}function colorPicker(e,t){const a=document.createElement("input");a.setAttribute("type","color"),a.setAttribute("data-edit",he+"."+e),a.value=game.settings.get(he,e);const n=t.querySelector(`input[name="${he}.${e}"]`);n&&(n.classList.add("color"),n.after(a))}class HandlebarsApplication extends(foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2)){constructor(){super(),this.constructor.registerPositionSetting(),this.savePosition=foundry.utils.debounce(this.savePosition.bind(this),100)}static registerPositionSetting(){!this.POSITION_SETTING_REGISTERED&&this.DEFAULT_OPTIONS.window?.savePosition&&(this.POSITION_SETTING_REGISTERED=!0,game.settings.register(he,this.APP_ID+"-position",{scope:"client",config:!1,type:Object,default:{}}))}static resetSavedPosition(){game.settings.set(he,this.APP_ID+"-position",{})}savePosition(e){const t={left:e.left,top:e.top,width:e.width,height:e.height};"auto"===t.width&&delete t.width,"auto"===t.height&&delete t.height,game.settings.set(he,this.APP_ID+"-position",t)}setPosition(...e){const t=super.setPosition(...e);return this.constructor.POSITION_SETTING_REGISTERED&&this.savePosition(this.position),t}static get APP_ID(){return this.name.split(/(?=[A-Z])/).join("-").toLowerCase()}get APP_ID(){return this.constructor.APP_ID}static get PARTS(){return{content:{template:`modules/${he}/templates/${this.APP_ID}.hbs`,classes:[],scrollable:[]}}}static get DEFAULT_OPTIONS(){return{tag:"div",id:this.APP_ID,window:{title:`${he}.${this.APP_ID}.title`,frame:!0,positioned:!0,icon:"",controls:[],minimizable:!0,resizable:!1,contentTag:"section",contentClasses:[],savePosition:!1},actions:{},form:{handler:void 0,submitOnChange:!1,closeOnSubmit:!1},position:{width:560,height:"auto"}}}async _prepareContext(e){if(this.getData)return this.getData();return{data:{}}}activateListeners(){}_onRender(e,t){super._onRender(e,t);const a=this.element;this.activateListeners&&this.activateListeners(a)}async render(e={},t={}){const a="boolean"==typeof e?t:e;return!a.position&&this.constructor.POSITION_SETTING_REGISTERED&&(a.position=game.settings.get(he,this.APP_ID+"-position")),super.render(e,t)}}class AddEvent extends HandlebarsApplication{constructor(e){super(),this.combat=e}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"combat-dock-add-event",title:"combat-tracker-dock.add-event.title",template:"modules/combat-tracker-dock/templates/add-event.hbs",width:400,height:"auto",closeOnSubmit:!0})}static get DEFAULT_OPTIONS(){return{tag:"form",id:"combat-dock-add-event",window:{title:"combat-tracker-dock.add-event.title"},actions:{},form:{handler:this.#e,closeOnSubmit:!0},position:{width:400}}}_prepareContext(e){return{recentEvents:game.settings.get(he,"events")}}_onRender(e,t){super._onRender(e,t);const a=this.element;a.querySelectorAll(".cct-event").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.index,n=game.settings.get(he,"events")[t];a.querySelector("[name='name']").value=n.name,a.querySelector("[name='img']").value=n.img,a.querySelector("[name='initiative']").value=n.initiative,a.querySelector("[name='duration']").value=n.duration,a.querySelector("[name='hidden']").checked=n.hidden})})}static async#e(e){const t=this.element,a=new foundry.applications.ux.FormDataExtended(t).object;if(!a.name||!a.img||!Number.isNumeric(a.initiative)&&!a.initiative)return ui.notifications.error(game.i18n.localize("combat-tracker-dock.add-event.error"));this.combat.createEmbeddedDocuments("Combatant",[{name:a.name,img:a.img,initiative:a.initiative,hidden:a.hidden||!1,"flags.combat-tracker-dock":{event:!0,duration:a.duration||!1,roundCreated:this.combat.round}}]);let n=game.settings.get(he,"events");const o={name:a.name,img:a.img,initiative:a.initiative,duration:a.duration,hidden:a.hidden};n=n.filter(e=>e.name!==o.name&&e.img!==o.img),n.unshift(o),n=n.slice(0,10),await game.settings.set(he,"events",n)}}class CombatDock extends HandlebarsApplication{constructor(e){super(),ui.combatDock?.close(),ui.combatDock=this,this.portraits=[],this.combat=e??game.combat,this.hooks=[],this._playAnimation=!0,this._currentPortraitSize={max:parseInt(game.settings.get(he,"portraitSize")),aspect:game.settings.get(he,"portraitAspect")},this.setHooks(),window.addEventListener("resize",this.autosize.bind(this)),this._combatTrackerRefreshed=!1}static get DEFAULT_OPTIONS(){let e=function mergeClone(e,t){return e=foundry.utils.deepClone(e),t=foundry.utils.deepClone(t),foundry.utils.mergeObject(e,t)}(super.DEFAULT_OPTIONS,{classes:["hidden"],window:{frame:!1,positioned:!1,minimizable:!1,resizable:!1}});return"rowDocked"!==game.settings.get(he,"direction")&&function mergeObject(e,t){return foundry.utils.mergeObject(e,t)}(e,this.WINDOWED_DEFAULT_OPTIONS),e}static get WINDOWED_DEFAULT_OPTIONS(){return{window:{frame:!0,positioned:!0,savePosition:!0}}}get sortedCombatants(){return Array.from(this.combat.combatants.contents.sort(this.combat._sortCombatants))}get trueCarousel(){return game.settings.get(he,"carouselStyle")<2}get leftAligned(){return 1==game.settings.get(he,"carouselStyle")}get autoFit(){return"autofit"==game.settings.get(he,"overflowStyle")}get isVertical(){return"columnFloat"==game.settings.get(he,"direction")}get isDocked(){return"rowDocked"==game.settings.get(he,"direction")}setHooks(){this.hooks=[{hook:"renderCombatTracker",fn:this._onRenderCombatTracker.bind(this)},{hook:"createCombatant",fn:this.setupCombatants.bind(this)},{hook:"deleteCombatant",fn:this.setupCombatants.bind(this)},{hook:"updateCombatant",fn:this.updateCombatant.bind(this)},{hook:"updateCombat",fn:this._onCombatTurn.bind(this)},{hook:"deleteCombat",fn:this._onDeleteCombat.bind(this)},{hook:"combatStart",fn:this._onCombatStart.bind(this)},{hook:"hoverToken",fn:this._onHoverToken.bind(this)}];for(let e of this.hooks)e.id=Hooks.on(e.hook,e.fn)}removeHooks(){for(let e of this.hooks)Hooks.off(e.hook,e.id)}_prepareContext(e){const t="scroll"===game.settings.get(he,"overflowStyle");return{isGM:game.user.isGM,scroll:t}}setupCombatants(){this.portraits=[],this.sortedCombatants.forEach(e=>this.portraits.push(new CONFIG.combatTrackerDock.CombatantPortrait(e)));const e=this.element.querySelector("#combatants");e.innerHTML="",this.portraits.forEach(t=>e.appendChild(t.element));const t=this.portraits.length%2==0;if(this.element.classList.toggle("even",t),this.setupSeparator(),this.updateOrder(),this.autosize(),this._combatTrackerRefreshed||(this._combatTrackerRefreshed=!0,ui.combat.render(!0)),this._playAnimation&&this.sortedCombatants.length>0){this._playAnimation=!1;const e=this.portraits.map(e=>e.ready);this._promises=e,Promise.all(e).then(()=>{this.playIntroAnimation()})}}setupSeparator(){const e=this.element.querySelector("#combatants");e.querySelectorAll(".separator").forEach(e=>e.remove());const t=this.combat.turn+1,a=this.sortedCombatants.length,n=t>Math.floor(a/2)||this.leftAligned?1:0,o=document.createElement("div");o.classList.add("separator");const i=document.createElement("div");i.classList.add("line"),o.appendChild(i);const r=document.createElement("div");r.classList.add("round",this.isVertical?"flexrow":"flexcol"),r.innerHTML=this.isVertical?`<i class="fal fa-angle-down"></i>${this.combat.round+n}`:`<i class="fal fa-angle-right"></i>${this.combat.round+n}`,o.appendChild(r),e.appendChild(o)}playIntroAnimation(e="cubic-bezier(0.22, 1, 0.36, 1)"){Hooks.callAll("combatDock:playIntroAnimation",this);const t=CONFIG.combatTrackerDock.INTRO_ANIMATION_DURATION,a=CONFIG.combatTrackerDock.INTRO_ANIMATION_DELAY,n=this.isVertical,o=game.settings.get(he,"alignment"),i=n?"X":"Y",r=n&&"right"==o?"":"-",playSlideInAnimation=(a,n=0)=>{a.style.transform=`translate${i}(${r}150%)`;a.animate([{transform:`translate${i}(${r}150%)`},{transform:`translate${i}(0)`}],{duration:t,easing:e,delay:n}).finished.then(()=>{a.style.transform="",Hooks.callAll("combatDock:playIntroAnimation:finished",this,a)})};let s=0;Array.from(this.element.querySelector("#combatants").children).forEach((e,n)=>{const o=(this.trueCarousel?parseInt(e.style.order)/100:n)*t*a;s=Math.max(s,o+t),playSlideInAnimation(e,o)}),setTimeout(()=>{n&&this.centerCurrentCombatant()},s+t),setTimeout(()=>{this.element.classList.remove("hidden"),n||this.centerCurrentCombatant()},10)}autosize(){const e=parseInt(game.settings.get(he,"portraitSize")),t=game.settings.get(he,"portraitAspect");this._currentPortraitSize={max:e,aspect:t};const a=e*t;if(!this.autoFit)return document.documentElement.style.setProperty("--combatant-portrait-size",e+"px");if(this.isVertical){const e=.9*document.getElementById("ui-left-column-2").getBoundingClientRect().height-document.getElementById("scene-navigation-active").getBoundingClientRect().height,n=this.sortedCombatants.length,o=Math.min(a,Math.floor(e/n))/t;document.documentElement.style.setProperty("--combatant-portrait-size",o+"px")}else if(this.isDocked){const t=.9*document.getElementById("ui-top").getBoundingClientRect().width,a=this.sortedCombatants.length,n=Math.min(e,Math.floor(t/a));document.documentElement.style.setProperty("--combatant-portrait-size",n/1.2+"px")}}async updateInitiative(e,t){e.initiative=t,await this.refresh(),this.updateOrder()}updateCombatant(e,t={}){if("initiative"in t)return void this.setupCombatants();const a=this.portraits.find(t=>t.combatant===e);a&&a.renderInner()}updateCombatants(){this.portraits.forEach(e=>e.renderInner())}updateOrder(){this.setupSeparator();const e=this.element.querySelector(".separator"),t=this.trueCarousel;e.style.display=t?"":"none",0===this.sortedCombatants.filter(e=>e?.visible)?.length&&(e.style.display="none"),e.classList.remove("vertical","horizontal"),e.classList.add(this.isVertical?"vertical":"horizontal");const a=this.sortedCombatants;if(!this.trueCarousel)return this.portraits.forEach(e=>e.element.style.setProperty("order",a.indexOf(e.combatant)));const n=this.leftAligned,o=this.combat.combatant,i=a.findIndex(e=>e===o)+a.length,r=[...a,...a,...a],s=n?a.length:Math.floor(a.length/2),c=r.slice(i-s,i+s+1),u=this.sortedCombatants[this.sortedCombatants.length-1];this.portraits.forEach(e=>{const t=c.find(t=>t===e.combatant),a=c.findIndex(e=>e===t);e.element.style.setProperty("order",100*a)});const d=this.portraits.find(e=>e.combatant===u)?.element?.style?.order??999999;e.style.setProperty("order",parseInt(d)+1)}updateStartEndButtons(){if(!this.element)return;const e=this.element.querySelector('[data-action="start-combat"]'),t=this.element.querySelector('[data-action="end-combat"]');e.style.display=this.combat.started?"none":"",t.style.display=this.combat.started?"":"none"}appendHtml(){if(this.isDocked)return document.querySelector("#ui-top").prepend(this.element)}_onRender(e,t){if(this._closed)return this.close();super._onRender(e,t),this.setupCombatants(),this.appendHtml(),this.element.querySelectorAll(".buttons-container button").forEach(e=>{e.addEventListener("click",e=>{switch(e.currentTarget.dataset.action){case"previous-turn":this.combat.previousTurn();break;case"next-turn":this.combat.nextTurn();break;case"previous-round":this.combat.previousRound();break;case"next-round":this.combat.nextRound();break;case"end-combat":this.combat.endCombat();break;case"roll-all":this.combat.rollAll({event:e});break;case"roll-npc":this.combat.rollNPC({event:e});break;case"reset":this.combat.resetAll();break;case"configure":(new foundry.applications.apps.CombatTrackerConfig).render(!0);break;case"start-combat":this.combat.startCombat();break;case"add-event":new AddEvent(this.combat).render(!0)}})}),this.autosize(),this.setControlsOrder(),new foundry.applications.ux.ContextMenu(this.element.querySelector("#combatants"),".combatant-portrait",game.combats.directory._getEntryContextOptions(),{jQuery:!1,fixed:!0})}_onRenderCombatTracker(){this.portraits.forEach(e=>e.renderInner()),this.updateStartEndButtons()}_onCombatTurn(e,t,a){if(!("turn"in t)&&!("round"in t))return;"round"in t&&this._onRoundChange();const n=this.element.querySelector("#combatants"),o=Array.from(n.children).filter(e=>!e.classList.contains("separator")),i=n.getBoundingClientRect();n.style.minWidth=i.width+"px",n.style.minHeight=i.height+"px";const r=[...o].sort((e,t)=>t.style.order-e.style.order),s=[...o].sort((e,t)=>e.style.order-t.style.order),c=this.combat.combatant,u=this.sortedCombatants.findIndex(e=>e===c);let d=0,m=0;const g=this.sortedCombatants;for(let e=1;e<g.length;e++){if(!g[(u+e)%g.length].defeated)break;m++}for(let e=1;e<g.length;e++){if(!g[(u-e+g.length)%g.length].defeated)break;d++}const h=s.slice(0,d+1),f=r.slice(0,m+1),p=0!=d?h:[[...o].reduce((e,t)=>e.style.order<t.style.order?e:t,n.children[0])],b=0!=m?f:[[...o].reduce((e,t)=>e.style.order>t.style.order?e:t,n.children[0])],v=1===a.direction?p:b;if(this._playAnimation&&this.sortedCombatants.length>0)return this._playAnimation=!1,this.updateOrder(),void this.playIntroAnimation();if(setTimeout(()=>this.updateOrder(),200),!this.trueCarousel)return n.style.minWidth="",n.style.minHeight="",this.centerCurrentCombatant();for(const e of v)e.classList.add("collapsed-"+(this.isVertical?"vertical":"horizontal")),setTimeout(()=>{e.classList.remove("collapsed-"+(this.isVertical?"vertical":"horizontal")),setTimeout(()=>{n.style.minWidth="",n.style.minHeight=""},200),this.centerCurrentCombatant()},200)}async _onRoundChange(){const e=[];for(const t of this.combat.combatants){const a=t.getFlag(he,"duration");if(!a)continue;const n=t.getFlag(he,"roundCreated");if(!n)continue;this.combat.round-n>=a&&(e.push(t.id),ChatMessage.create({speaker:{alias:"Combat Tracker Dock"},content:game.i18n.localize("combat-tracker-dock.add-event.expired").replace("%n",`<strong>${t.name}</strong>`),type:CONST.CHAT_MESSAGE_TYPES.OTHER,whisper:[game.user.id]}))}e.length>0&&await this.combat.deleteEmbeddedDocuments("Combatant",e)}centerCurrentCombatant(){const e=game.settings.get(he,"carouselStyle"),t=this.element.querySelector("#combatants");if(this.trueCarousel){if(2==e)return;return 1==e&&close,t.scrollTo({top:0,left:0,behavior:"smooth"})}{const e=this.portraits.find(e=>e.combatant===this.combat.combatants.get(this.combat?.current?.combatantId));if(!e)return;e.element.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}}setControlsOrder(){const e=this.element.querySelector(".buttons-container.left"),t=this.element.querySelector(".buttons-container.right");e.style.marginRight="",t.style.marginLeft="";const a=this.element.querySelector("#combatants"),n=game.settings.get(he,"alignment");this.isVertical&&"center"!==n?"right"==n?(e.style.order=0,e.style.marginRight="1rem",t.style.order=1,a.style.order=2):(e.style.order=1,t.style.order=2,t.style.marginLeft="1rem",a.style.order=0):(e.style.order="",t.style.order="",a.style.order="")}_onDeleteCombat(e){e===this.combat&&this.close()}_onCombatStart(e){e===this.combat&&(this._playAnimation=!0)}_onHoverToken(e,t){const a=this.portraits.find(t=>t.token===e);a&&a.element.classList.toggle("hovered",t)}refresh(){this.updateCombatants(),this.appendHtml()}async restart(){await this.close(),await(new CombatDock).render({force:!0})}async close(...e){return this.removeHooks(),window.removeEventListener("resize",this.autosize.bind(this)),this.element&&this.element.remove(),this._closed=!0,super.close(...e)}}class CombatantPortrait{constructor(e){this.combatant=e,this.combat=e.combat,this.element=document.createElement("div"),this.element.classList.add("combatant-portrait"),this.element.setAttribute("data-combatant-id",e.id),this.element.setAttribute("data-tooltip-class","combat-dock-tooltip"),this.element.style.backgroundImage=`url("${game.settings.get(he,"portraitImageBackground")}")`,this.resolve=null,this.ready=new Promise(e=>this.resolve=e),this._hasTakenTurn=this.combat.round??!0,game.settings.get(he,"hideFirstRound")||(this._hasTakenTurn=!0),this.activateCoreListeners(),this.renderInner()}get actor(){return this.combatant?.actor}get token(){return this.combatant?.token?.object}get img(){return("actor"===game.settings.get(he,"portraitImage")?this.combatant.actor?.img:this.combatant.img)??this.combatant.img}get name(){if(this.combatant.isOwner)return this.combatant.name;const e=game.settings.get(he,"displayName");return"owner"===e?this.combatant.isOwner?this.combatant.name:"???":"default"===e||[CONST.TOKEN_DISPLAY_MODES.HOVER,CONST.TOKEN_DISPLAY_MODES.ALWAYS].includes(this.token?.document?.displayName)?this.combatant.name:"???"}get firstTurnHidden(){const e=this.combatant,t=(e.actor?.permission??-10)>=CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER||e.isOwner,a=e.token?.disposition===CONST.TOKEN_DISPOSITIONS.FRIENDLY;return!(t||this._hasTakenTurn||a)}get isEvent(){return this.combatant.flags[he]?.event??!1}get eventResource(){if(!this.isEvent)return null;const e=this.combatant.flags[he],{duration:t,roundCreated:a}=e,n=this.combat.round;return{max:t,value:t-(n-a),percentage:Math.round((t-(n-a))/t*100)}}get eventRoundsLeft(){return this.combatant.getFlag(he,"roundsLeft")??0}activateCoreListeners(){this.element.addEventListener("mouseenter",this._onHoverIn.bind(this)),this.element.addEventListener("mouseleave",this._onHoverOut.bind(this))}activateListeners(){this.element.querySelector(".combatant-wrapper").addEventListener("click",this._onCombatantMouseDown.bind(this)),(this.element.querySelectorAll(".system-icon")??[]).forEach((e,t)=>{const a=this._systemIcons[t];a.callback&&a.enabled&&e.addEventListener("click",async e=>{e.stopPropagation(),e.stopImmediatePropagation(),a.callback(e,this.combatant,t,a.id)})}),this.actor?.isOwner&&(this.element.querySelectorAll(".portrait-effect")??[]).forEach(e=>{e.addEventListener("contextmenu",async t=>{t.preventDefault(),t.stopPropagation();const a=e.dataset.uuid,n=await fromUuid(a),o=CONFIG.statusEffects.find(e=>e.img===n.img);await Dialog.confirm({title:game.i18n.localize(`${he}.deleteEffectTitle`),content:game.i18n.localize(`${he}.deleteEffectContent`)+game.i18n.localize(n?.label??o?.name??"")+"?",yes:()=>!0,no:()=>!1,defaultYes:!1,close:()=>!1})&&(n?await n.delete():this.token?.toggleEffect(a))})})}async _onCombatantMouseDown(e){if(e.preventDefault(),"player-pass"===e.target.dataset.action)return this.combat.nextTurn();if(!e.target.classList.contains("combatant-wrapper"))return;if(2===e.button)return game.user.isGM&&this.combatant.sheet.render(!0);const t=this.combatant,a=t.token;if(!t.actor?.testUserPermission(game.user,"OBSERVER"))return;const n=Date.now(),o=n-this._clickTime;return this._clickTime=n,o<=250?t.actor?.sheet.render(!0):a?.object?(a.object?.control({releaseOthers:!0}),canvas.animatePan(a.object.center)):void 0}_onHoverIn(e){this.token&&this.token?.isVisible&&!this.token.controlled&&this.token._onHoverIn(e)}_onHoverOut(e){this.token&&this.token.hover&&this.token._onHoverOut(e)}async renderInner(){const e=await this.getData();if(this.element.classList.toggle("hidden",!e),!e)return this.resolve(!0),void(this.element.innerHTML="");const t=await foundry.applications.handlebars.renderTemplate("modules/combat-tracker-dock/templates/combatant-portrait.hbs",{...e}),a=await foundry.applications.handlebars.renderTemplate("modules/combat-tracker-dock/templates/combatant-tooltip.hbs",{...e});this.element.innerHTML=t,this.element.setAttribute("data-tooltip",a);if("column"==game.settings.get(he,"direction")){const e=game.settings.get(he,"alignment");this.element.setAttribute("data-tooltip-direction","left"==e?TooltipManager.TOOLTIP_DIRECTIONS.RIGHT:TooltipManager.TOOLTIP_DIRECTIONS.LEFT)}else this.element.setAttribute("data-tooltip-direction","");this.element.classList.toggle("active",e.css.includes("active")),this.element.classList.toggle("visible",e.css.includes("hidden")),this.element.classList.toggle("defeated",e.css.includes("defeated")),this.element.style.borderBottomColor=this.getBorderColor(this.token?.document),this.element.querySelector(".roll-initiative").addEventListener("click",async e=>{e.preventDefault(),Hooks.once("renderCombatTracker",()=>{ui.combatDock.updateOrder()}),await this.combatant.combat.rollInitiative([this.combatant.id],{event:e})}),this.element.querySelectorAll(".action").forEach(e=>{e.addEventListener("click",async t=>{t.stopPropagation(),t.stopImmediatePropagation();switch(e.dataset.action){case"toggle-hidden":await this.combatant.update({hidden:!this.combatant.hidden});break;case"toggle-defeated":await ui.combat._onToggleDefeatedStatus(this.combatant);break;case"ping":await ui.combat._onPingCombatant(this.combatant)}})});const n=this.element.querySelector(".image-border");n&&(n.style.backgroundImage=`url("${game.settings.get(he,"portraitImageBorder")}")`),this.activateListeners(),this.resolve(!0)}getResource(e=null,t=!1){if(this.isEvent&&t)return this.eventResource;if(!this.actor||!this.combat)return null;let a,n,o;return(e=e??this.combat.settings.resource)?(a=foundry.utils.getProperty(this.actor.system,e+".max")??foundry.utils.getProperty(this.actor.system,e.replace("value","")+"max"),n=foundry.utils.getProperty(this.actor.system,e)??foundry.utils.getProperty(this.actor.system,e+".value"),void 0!==a&&void 0!==n&&Number.isNumeric(a)&&Number.isNumeric(n)&&(o=Math.min(Math.max(Math.round(n/a*100),0),100)),n=this.validateValue(n),a=this.validateValue(a),{max:a,value:n,percentage:o}):{max:a,value:n,percentage:o}}validateValue(e){return"boolean"==typeof e&&(e=e?"":""),Array.isArray(e)&&(e=e.join(", ")),""===e&&(e=null),Number.isNumeric(e)||"[object String]"==Object.prototype.toString.call(e)||(e=null),e}getBarsOrder(e,t,a){const n=game.settings.get(he,"barsPlacement");switch(t=isNaN(t?.percentage)?1:0,a=isNaN(a?.percentage)?1:0,n){case"left":return{bar1:0,bar2:1,init:2,effects:3,bar1ML:0,bar2ML:0,initBars:2.5-t-a};case"right":return{bar1:2,bar2:3,init:0,effects:1,bar1ML:e?0:"auto",bar2ML:0,initBars:.5};case"twinned":return{bar1:0,bar2:3,init:1,effects:2,bar1ML:0,bar2ML:e?0:"auto",initBars:1.5-t}}}get hasPermission(){const e=this.combatant,t=e.actor?.hasPlayerOwner&&game.settings.get(he,"playerPlayerPermission");return(e.actor?.permission??-10)>=CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER||e.isOwner||t}async getData(){let e=!1;const t=this.combatant;if(game.settings.get(he,"hideDefeated")&&t.isDefeated)return null;this.combat.turns.indexOf(t)===this.combat.turn&&this.combat.started&&(this._hasTakenTurn=!0);const a=this.hasPermission;if(!a&&!this._hasTakenTurn)return null;if(!t.visible&&!game.user.isGM)return null;const n=game.settings.get(he,"attributes").map(e=>({...this.getResource(e.attr),icon:e.icon.includes(".")?`<img src="${e.icon}" />`:`<i class="${e.icon} icon"></i>`,units:e.units||""})).filter(e=>null!==e.value&&void 0!==e.value),o=this.getSystemIcons(),i=o.resource?.length??0,r=game.settings.get(he,"attributeVisibility"),s=game.settings.get(he,"displayDescriptions");let c=!1;"all"===s?c=!0:"owner"===s&&(c=a);const u=a?this.getResource(null,!0):null,d=a?this.getResource(game.settings.get(he,"resource")):null,m=game.settings.get(he,"portraitResource"),g=a&&m?this.getResource(m):null,h=this.getInitiativeDisplay();h.isIconImg=h.icon.includes("."),h.isRollIconImg=h.rollIcon.includes(".");const f={id:t.id,name:this.name,img:this.img,active:this.combat.turns.indexOf(t)===this.combat.turn,owner:t.isOwner,isGM:game.user.isGM,showPass:t.isOwner&&!game.user.isGM,defeated:t.isDefeated,hidden:t.hidden,initiative:t.initiative,hasRolled:null!==t.initiative&&void 0!==t.initiative,hasResource:null!==u,hasResource2:null!==d,hasPortraitResource:null!==g,hasPlayerOwner:t.actor?.hasPlayerOwner,hasPermission:a,showInitiative:game.settings.get(he,"showInitiativeOnPortrait"),isInitiativeNaN:null===t.initiative||void 0===t.initiative,initiativeData:h,resource:u,resource2:d,portraitResource:g,showBars:"bars"==r||"both"==r,showText:"text"==r||"both"==r,canPing:t.sceneId===canvas.scene?.id&&game.user.hasPermission("PING_CANVAS"),attributes:n,description:this.getDescription(),resSystemIcons:o.resource,tooltipSystemIcons:o.tooltip,systemIconsSizeMulti:clamp(.03,1/(2*i),.1),barsOrder:null,displayDescriptions:c};if(null===f.initiative||Number.isInteger(f.initiative)||(e=!0),null===f.initiativeData.value||Number.isInteger(f.initiativeData.value)||(e=!0),f.css=[f.active?"active":"",f.hidden?"hidden":"",f.defeated?"defeated":""].join(" ").trim(),f.effects=new Set,f.hasAttributes=n.length>0,t.actor)for(const e of t.actor.temporaryEffects)if(e.statuses.has(CONFIG.specialStatusEffects.DEFEATED))f.defeated=!0;else if(e.img){const t=e.description?await foundry.applications.ux.TextEditor.implementation.enrichHTML(e.description):"",a=parseInt(e.duration?.label??""),n=e.duration?.remaining/e.duration?.duration,o=e.uuid;f.effects.add({uuid:o,img:e.img,label:e.name,description:t,duration:a,percent:isNaN(n)?null:100*n,hasDuration:!isNaN(a)})}f.hasEffects=f.effects.size>0,f.barsOrder=this.getBarsOrder(f.hasEffects,u,d);const p=CONFIG.Combat.initiative.decimals;return f.hasRolled&&"number"==typeof f.initiative&&(f.initiative=f.initiative.toFixed(e?p:0)),f.hasRolled&&"number"==typeof f.initiativeData.value&&(f.initiativeData.value=f.initiativeData.value.toFixed(e?p:0)),game.user.isGM||t.actor?.isOwner||!game.settings.get(he,"hideEnemyInitiative")||(f.initiative="?",f.initiativeData.value="?"),f}getDescription(){const e=this.actor;if(!e)return null;let t=null;try{t=generateDescription(e)}catch(e){console.error(e)}return t}getSystemIcons(){try{const e=game.settings.get(he,"showSystemIcons"),t=e>0?getSystemIcons(this.combatant):[],a=this.hasPermission;return t.forEach(e=>{e.callback&&(e.hasCallback=!0),e.visible??=a}),this._systemIcons=t,t&&t?.length?{resource:e>=2?t:null,tooltip:1==e||3==e?t:null}:{resource:null,tooltip:null}}catch(e){return console.error(e),{resource:null,tooltip:null}}}getInitiativeDisplay(){return function getInitiativeDisplay(e){switch(game.system.id){case"swade":{let t="";const getCardImage=e=>Array.from(game.cards.get(game.settings.get("swade","actionDeck")).cards).find(t=>t.description===e)?.img;let a=e?.cardString??"";return a.includes("")?t="fas fa-heart":a.includes("")?t="fas fa-diamond":a.includes("")?t="fas fa-club":a.includes("")?t="fas fa-spade":"Red J"!==a&&"Blk J"!==a||(a="JK"),{value:a,icon:getCardImage(e?.cardString??"")??t,rollIcon:"far fa-cards-blank"}}case"wfrp4e":case"exaltedthird":case"exaltedessence":return{value:e?.initiative,icon:"far fa-dice-d10",rollIcon:"far fa-dice-d10"};case"alienrpg":return{value:e?.initiative,icon:"far fa-cards-blank",rollIcon:"fa-solid fa-cards-blank"};case"lancer":return game.lancer.combatTrackerDock?.getInitiativeDisplay(e)??{value:e?.initiative,icon:"fas fa-dice-d20",rollIcon:"fas fa-dice-d20"};case"dnd4e":return{value:e?.initiative?parseInt(e.initiative).toString():null,icon:"fas fa-dice-d20",rollIcon:"fas fa-dice-d20"};default:return{value:e?.initiative,icon:"far fa-dice-d20",rollIcon:"far fa-dice-d20"}}}(this.combatant)}getBorderColor(e){if(!game.settings.get(he,"showDispositionColor")||!e)return"#000";return new Color(function getColor(){const t=CONFIG.Canvas.dispositionColors;if(e.isOwner&&!game.user.isGM)return t.CONTROLLED;const a=CONST.TOKEN_DISPOSITIONS;switch(e.disposition){case a.SECRET:return t.SECRET;case a.HOSTILE:return t.HOSTILE;case a.NEUTRAL:return t.NEUTRAL;case a.FRIENDLY:return e.actor?.hasPlayerOwner?t.PARTY:t.FRIENDLY;default:return t.NEUTRAL}}()).toString()}destroy(){this.element?.remove()}}const clamp=(e,t,a)=>Math.min(Math.max(e,t),a),ge="chat-welcome-message-shown";const he="combat-tracker-dock";function getCurrentCombat(){return ui.combat.viewed}Hooks.once("init",function(){!function registerWrappers(){game.modules.get("lib-wrapper")?.active&&libWrapper.register(he,"Combatant.prototype.visible",function(e,...t){const a=e(...t);if(!ui.combatDock?.rendered)return a;const n=ui.combatDock.portraits.find(e=>e.combatant==this)?.firstTurnHidden;return a&&!n})}(),function registerHotkeys(){game.keybindings.register(he,"combatPrev",{name:`${he}.hotkeys.combatPrev.name`,editable:[{key:"KeyN",modifiers:[foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT]}],restricted:!1,onDown:()=>{},onUp:()=>{if(!game.combat)return;const e=game.combat.combatant?.isOwner;e&&game.combat.previousTurn()}}),game.keybindings.register(he,"combatNext",{name:`${he}.hotkeys.combatNext.name`,editable:[{key:"KeyM",modifiers:[foundry.helpers.interaction.KeyboardManager.MODIFIER_KEYS.SHIFT]}],restricted:!1,onDown:()=>{},onUp:()=>{if(!game.combat)return;const e=game.combat.combatant?.isOwner;e&&game.combat.nextTurn()}})}(),CONFIG.combatTrackerDock={CombatDock,CombatantPortrait,defaultAttributesConfig,generateDescription,INTRO_ANIMATION_DURATION:1e3,INTRO_ANIMATION_DELAY:.25},Hooks.callAll(`${he}-init`,CONFIG.combatTrackerDock)}),Hooks.once("setup",function registerSettings(){Hooks.on("renderSettingsConfig",(e,t,a)=>{colorPicker("attributeColor",t),colorPicker("attributeColor2",t),colorPicker("attributeColorPortrait",t),colorPicker("tooltipColor",t)}),game.settings.register(he,"attributes",{scope:"world",config:!1,type:Array,default:CONFIG.combatTrackerDock.defaultAttributesConfig()[game.system.id]??[],onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"events",{scope:"world",config:!1,type:Array,default:[]}),game.settings.registerMenu(he,"attributesMenu",{name:game.i18n.localize(`${he}.settings.attributesMenu.name`),label:game.i18n.localize(`${he}.settings.attributesMenu.label`),hint:game.i18n.localize(`${he}.settings.attributesMenu.hint`),icon:"fas fa-cogs",scope:"world",restricted:!0,type:AttributesConfig}),game.settings.register(he,"direction",{name:"combat-tracker-dock.settings.direction.name",hint:"combat-tracker-dock.settings.direction.hint",scope:"world",config:!0,type:String,choices:{rowDocked:"combat-tracker-dock.settings.direction.choices.rowDocked",rowFloat:"combat-tracker-dock.settings.direction.choices.rowFloat",columnFloat:"combat-tracker-dock.settings.direction.choices.columnFloat"},default:"rowDocked",onChange:async()=>{await(ui.combatDock?.restart()),setDirection(),setOverflowStyle(),setFlex(),ui.combatDock?.autosize(),ui.combatDock?.refresh()}}),game.settings.register(he,"portraitSize",{name:"combat-tracker-dock.settings.portraitSize.name",hint:"combat-tracker-dock.settings.portraitSize.hint",scope:"client",config:!0,type:String,choices:{"30px":"combat-tracker-dock.settings.portraitSize.choices.30px","50px":"combat-tracker-dock.settings.portraitSize.choices.50px","70px":"combat-tracker-dock.settings.portraitSize.choices.70px","90px":"combat-tracker-dock.settings.portraitSize.choices.90px","110px":"combat-tracker-dock.settings.portraitSize.choices.110px","150px":"combat-tracker-dock.settings.portraitSize.choices.150px","180px":"combat-tracker-dock.settings.portraitSize.choices.180px"},default:"70px",onChange:()=>{!function setPortraitSize(){const e=game.settings.get(he,"portraitSize");document.documentElement.style.setProperty("--combatant-portrait-size",e)}(),ui.combatDock?.autosize(),ui.combatDock?.refresh()}}),game.settings.register(he,"overflowStyle",{name:"combat-tracker-dock.settings.overflowStyle.name",hint:"combat-tracker-dock.settings.overflowStyle.hint",scope:"client",config:!0,type:String,choices:{autofit:"combat-tracker-dock.settings.overflowStyle.choices.autofit",hidden:"combat-tracker-dock.settings.overflowStyle.choices.hidden",scroll:"combat-tracker-dock.settings.overflowStyle.choices.scroll"},default:"autofit",onChange:()=>{setOverflowStyle(),ui.combatDock?.autosize(),ui.combatDock?.refresh()}}),game.settings.register(he,"carouselStyle",{name:"combat-tracker-dock.settings.carouselStyle.name",hint:"combat-tracker-dock.settings.carouselStyle.hint",scope:"world",config:!0,type:Number,choices:{0:"combat-tracker-dock.settings.carouselStyle.choices.centerCarousel",1:"combat-tracker-dock.settings.carouselStyle.choices.leftCarousel",2:"combat-tracker-dock.settings.carouselStyle.choices.basic"},default:0,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"alignment",{name:"combat-tracker-dock.settings.alignment.name",hint:"combat-tracker-dock.settings.alignment.hint",scope:"world",config:!0,type:String,choices:{left:"combat-tracker-dock.settings.alignment.choices.left",center:"combat-tracker-dock.settings.alignment.choices.center",right:"combat-tracker-dock.settings.alignment.choices.right"},default:"center",onChange:()=>{setAlignment(),setFlex(),ui.combatDock?.refresh()}}),game.settings.register(he,"portraitAspect",{name:"combat-tracker-dock.settings.portraitAspect.name",hint:"combat-tracker-dock.settings.portraitAspect.hint",scope:"world",config:!0,type:Number,choices:{1:"combat-tracker-dock.settings.portraitAspect.choices.square",1.5:"combat-tracker-dock.settings.portraitAspect.choices.portrait",2:"combat-tracker-dock.settings.portraitAspect.choices.long"},default:1.5,onChange:()=>{setPortraitAspect(),ui.combatDock?.refresh()}}),game.settings.register(he,"roundness",{name:"combat-tracker-dock.settings.roundness.name",hint:"combat-tracker-dock.settings.roundness.hint",scope:"world",config:!0,type:String,choices:{"0%":"combat-tracker-dock.settings.roundness.choices.sharp","10%":"combat-tracker-dock.settings.roundness.choices.soft","20%":"combat-tracker-dock.settings.roundness.choices.round"},default:"0%",onChange:()=>{setRoundness(),ui.combatDock?.refresh()}}),game.settings.register(he,"attributeColor",{name:"combat-tracker-dock.settings.attributeColor.name",hint:"combat-tracker-dock.settings.attributeColor.hint",scope:"world",config:!0,type:String,default:"#41AA7D",onChange:()=>{setAttributeColor(),ui.combatDock?.refresh()}}),game.settings.register(he,"attributeColor2",{name:"combat-tracker-dock.settings.attributeColor2.name",hint:"combat-tracker-dock.settings.attributeColor2.hint",scope:"world",config:!0,type:String,default:"#ffcd00",onChange:()=>{setAttributeColor(),ui.combatDock?.refresh()}}),game.settings.register(he,"attributeColorPortrait",{name:"combat-tracker-dock.settings.attributeColorPortrait.name",hint:"combat-tracker-dock.settings.attributeColorPortrait.hint",scope:"world",config:!0,type:String,default:"#e62121",onChange:()=>{setAttributeColor(),ui.combatDock?.refresh()}}),game.settings.register(he,"barsPlacement",{name:"combat-tracker-dock.settings.barsPlacement.name",hint:"combat-tracker-dock.settings.barsPlacement.hint",scope:"world",config:!0,type:String,choices:{left:"combat-tracker-dock.settings.barsPlacement.choices.left",right:"combat-tracker-dock.settings.barsPlacement.choices.right",twinned:"combat-tracker-dock.settings.barsPlacement.choices.twinned"},default:"left",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"attributeVisibility",{name:"combat-tracker-dock.settings.attributeVisibility.name",hint:"combat-tracker-dock.settings.attributeVisibility.hint",scope:"world",config:!0,type:String,choices:{text:"combat-tracker-dock.settings.attributeVisibility.choices.text",bars:"combat-tracker-dock.settings.attributeVisibility.choices.bars",both:"combat-tracker-dock.settings.attributeVisibility.choices.both"},default:"both",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"tooltipColor",{name:"combat-tracker-dock.settings.tooltipColor.name",hint:"combat-tracker-dock.settings.tooltipColor.hint",scope:"world",config:!0,type:String,default:"#888888",onChange:()=>{setTooltipColor(),ui.combatDock?.refresh()}}),game.settings.register(he,"displayDescriptions",{name:"combat-tracker-dock.settings.displayDescriptions.name",hint:"combat-tracker-dock.settings.displayDescriptions.hint",scope:"world",config:!0,type:String,choices:{none:"combat-tracker-dock.settings.displayDescriptions.choices.none",owner:"combat-tracker-dock.settings.displayDescriptions.choices.owner",all:"combat-tracker-dock.settings.displayDescriptions.choices.all"},default:"owner",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"hideDefeated",{name:"combat-tracker-dock.settings.hideDefeated.name",hint:"combat-tracker-dock.settings.hideDefeated.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"showDispositionColor",{name:"combat-tracker-dock.settings.showDispositionColor.name",hint:"combat-tracker-dock.settings.showDispositionColor.hint",scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"showInitiativeOnPortrait",{name:"combat-tracker-dock.settings.showInitiativeOnPortrait.name",hint:"combat-tracker-dock.settings.showInitiativeOnPortrait.hint",scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"portraitImage",{name:"combat-tracker-dock.settings.portraitImage.name",hint:"combat-tracker-dock.settings.portraitImage.hint",scope:"world",config:!0,type:String,choices:{actor:"combat-tracker-dock.settings.portraitImage.choices.actor",token:"combat-tracker-dock.settings.portraitImage.choices.token"},default:"actor",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"displayName",{name:"combat-tracker-dock.settings.displayName.name",hint:"combat-tracker-dock.settings.displayName.hint",scope:"world",config:!0,type:String,choices:{default:"combat-tracker-dock.settings.displayName.choices.default",token:"combat-tracker-dock.settings.displayName.choices.token",owner:"combat-tracker-dock.settings.displayName.choices.owner"},default:"default",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"playerPlayerPermission",{name:"combat-tracker-dock.settings.playerPlayerPermission.name",hint:"combat-tracker-dock.settings.playerPlayerPermission.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"hideFirstRound",{name:"combat-tracker-dock.settings.hideFirstRound.name",hint:"combat-tracker-dock.settings.hideFirstRound.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"hideEnemyInitiative",{name:"combat-tracker-dock.settings.hideEnemyInitiative.name",hint:"combat-tracker-dock.settings.hideEnemyInitiative.hint",scope:"world",config:!0,type:Boolean,default:!1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"portraitImageBorder",{name:"combat-tracker-dock.settings.portraitImageBorder.name",hint:"combat-tracker-dock.settings.portraitImageBorder.hint",scope:"world",config:!0,type:String,default:"modules/combat-tracker-dock/assets/border.png",filePicker:"imagevideo",onChange:function(){setPortraitImageBorder(),ui.combatDock?.refresh()}}),game.settings.register(he,"portraitImageBackground",{name:"combat-tracker-dock.settings.portraitImageBackground.name",hint:"combat-tracker-dock.settings.portraitImageBackground.hint",scope:"world",config:!0,type:String,default:"ui/denim075.png",filePicker:"imagevideo",onChange:function(){setPortraitImageBackground(),ui.combatDock?.refresh()}}),game.settings.register(he,"showSystemIcons",{name:"combat-tracker-dock.settings.showSystemIcons.name",hint:"combat-tracker-dock.settings.showSystemIcons.hint",scope:"world",config:!0,type:Number,choices:{0:"combat-tracker-dock.settings.showSystemIcons.choices.none",1:"combat-tracker-dock.settings.showSystemIcons.choices.tooltip",2:"combat-tracker-dock.settings.showSystemIcons.choices.resource",3:"combat-tracker-dock.settings.showSystemIcons.choices.both"},default:1,onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"hideConflictingUIs",{name:"combat-tracker-dock.settings.hideConflictingUIs.name",hint:"combat-tracker-dock.settings.hideConflictingUIs.hint",scope:"world",config:!0,type:Boolean,default:!0,onChange:()=>setHideConflictingUIs()}),registerSystemSettings(),function setAllSettings(){setDirection(),setOverflowStyle(),setAlignment(),setFlex(),setPortraitAspect(),setRoundness(),setAttributeColor(),setTooltipColor(),setPortraitImageBorder(),setPortraitImageBackground(),setHideConflictingUIs()}(),game.settings.register(he,"resource",{name:"combat-tracker-dock.settings.resource.name",hint:"combat-tracker-dock.settings.resource.hint",scope:"world",config:!0,type:String,default:"",onChange:()=>ui.combatDock?.refresh()}),game.settings.register(he,"portraitResource",{name:"combat-tracker-dock.settings.portraitResource.name",hint:"combat-tracker-dock.settings.portraitResource.hint",scope:"world",config:!0,type:String,default:"",onChange:()=>ui.combatDock?.refresh()})}),Hooks.on("createCombat",e=>{game.combat===e&&new CONFIG.combatTrackerDock.CombatDock(e).render(!0)}),Hooks.on("updateCombat",(e,t)=>{(t.active||null===t.scene)&&new CONFIG.combatTrackerDock.CombatDock(e).render(!0),t.scene&&e.scene!==game.scenes.viewed&&ui.combatDock?.combat===e&&ui.combatDock.close()}),Hooks.on("canvasReady",()=>{Hooks.once("renderCombatTracker",e=>{const t=getCurrentCombat();t?new CONFIG.combatTrackerDock.CombatDock(t).render(!0):ui.combatDock?.close()})}),Hooks.on("ready",()=>{const e=getCurrentCombat();e&&!ui.combatDock&&game.settings.get("core","noCanvas")&&new CONFIG.combatTrackerDock.CombatDock(e).render(!0),function showWelcome(){if(!game.user.isGM)return;const e=game.modules.get(he),t="2Iq_so_GsLA",a=`<iframe width="100%" height="auto" src="https://www.youtube.com/embed/${t}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`,n=e.protected?`https://wiki.theripper93.com/premium/${he}`:`https://wiki.theripper93.com/free/${he}`,o=`<h1>${e.title}</h1>\n    <p>by <a href="https://theripper93.com">theripper93</a></p>\n    <p><strong>New to ${e.title}? Visit the <a href="${n}">Wiki</a> for a quickstart guide and resources.</strong></p>\n    ${t?a:""}\n    <p>Special thanks to all my <a href="https://www.patreon.com/theripper93">Patreons</a> for making ongoing updates and development possible. Supporting gives you access to <strong>30+ premium modules</strong> and <strong>priority support</strong>.</p>\n    <p><strong>Explore all resources and modules:</strong></p> <ul>\n    <li><a href="https://theripper93.com/">Check out all my free and premium modules</a></li>\n    <li><a href="${n}">${e.title} Wiki</a></li>\n    <li><a href="https://www.patreon.com/theripper93">Support on Patreon</a></li>\n    <li><a href="https://discord.theripper93.com/">Discord Channel</a></li>\n    </ul>`;game.settings.register(he,ge,{default:!1,type:Boolean,scope:"world",config:!1}),game.settings.get(he,ge)||(ChatMessage.create({user:game.user.id,whisper:game.users.filter(e=>e.isGM).map(e=>e.id),blind:!0,content:o}),game.settings.set(he,ge,!0))}()}),Hooks.on("renderCombatTrackerConfig",(e,t,a)=>{if(!game.user.isGM)return;const n=TokenDocument.implementation.getTrackedAttributes();n.bar.forEach(e=>e.push("value"));const o=TokenDocument.implementation.getTrackedAttributeChoices(n);o.unshift({label:"None",value:""});const i=TokenDocument.implementation.getTrackedAttributeChoices({bar:n.bar,value:[]});i.unshift({label:"None",value:""});const r=Handlebars.compile(`<select name="flags.${he}.resource">{{selectOptions options selected=value}}</select>`),s=Handlebars.compile(`<select name="flags.${he}.portraitResource">{{selectOptions options selected=value}}</select>`),c=r({options:o,value:game.settings.get(he,"resource")}),u=s({options:i,value:game.settings.get(he,"portraitResource")}),d=document.createElement("div");d.classList.add("form-group"),d.innerHTML=`\n    <label>${game.i18n.localize("COMBAT.CONFIG.FIELDS.core.combatTrackerConfig.resource.label")} 2</label>\n    ${c}\n    <p class="hint">${game.i18n.localize("COMBAT.CONFIG.FIELDS.core.combatTrackerConfig.resource.hint")}</p>\n    `,t.querySelector('select[name="core.combatTrackerConfig.resource"]').closest(".form-group").appendChild(d);const m=document.createElement("div");m.classList.add("form-group"),m.innerHTML=`\n    <label>${game.i18n.localize(`${he}.combatConfig.portraitResource.label`)}</label>\n    ${u}\n    <p class="hint">${game.i18n.localize(`${he}.combatConfig.portraitResource.hint`)}</p>\n    `,t.querySelector(`select[name="flags.${he}.resource"]`).closest(".form-group").appendChild(m);const g=document.createElement("button");g.innerHTML='<i class="fa-solid fa-gears"></i> '+game.i18n.localize(`${he}.configureCarousel`),g.addEventListener("click",e=>{e.preventDefault(),(new foundry.applications.settings.SettingsConfig).render(!0),Hooks.once("renderSettingsConfig",(e,t,a)=>{t.querySelector('button[data-tab="combat-tracker-dock"]').click()})});t.querySelectorAll(".form-group")[t.querySelectorAll(".form-group").length-1].appendChild(g),t.querySelector(`select[name="flags.${he}.resource"]`).addEventListener("change",async e=>{await game.settings.set(he,"resource",e.target.value)}),t.querySelector(`select[name="flags.${he}.portraitResource"]`).addEventListener("change",async e=>{await game.settings.set(he,"portraitResource",e.target.value)}),e.setPosition({height:"auto"})})})();
//# sourceMappingURL=index.js.map